#+Latex_Class: copernicus
#+AUTHOR: 
#+LaTeX_CLASS_OPTIONS: [essd, manuscript]
#+Options: toc:nil ^:t {}:t

#+PROPERTY: header-args: :comments both
#+PROPERTY: header-args:org :eval no
#+PROPERTY: header-args:PSMAP :eval no
#+PROPERTY: header-args:elisp :eval no :tangle no
#+PROPERTY: header-args:bash :eval no :noweb yes :tangle-mode (identity #o544)
#+PROPERTY: header-args:jupyter-python :eval no :noweb yes :kernel ice_discharge :tangle-mode (identity #o544)
#+PROPERTY: header-args: :session ice_discharge

#+MACRO: JAKO @@latex:Sermeq Kujalleq@@
#+EXCLUDE_TAGS: noexport

#+BEGIN_EXPORT LaTeX
\title{Greenland Ice Sheet solid ice discharge from 1986 through March 2020}
\Author[1]{Kenneth D.}{Mankoff}
\Author[1]{Anne}{Solgaard}
\Author[1]{William}{Colgan}
\Author[1]{Andreas P.}{Ahlstrøm}
\Author[2]{Shfaqat Abbas}{Khan}
\Author[1]{Robert S.}{Fausto}
\affil[1]{Department of Glaciology and Climate, Geological Survey of Denmark and Greenland (GEUS), Copenhagen, Denmark}
\affil[2]{DTU Space, National Space Institute, Department of Geodesy, Technical University of Denmark, Kgs. Lyngby, Denmark}
\runningtitle{Greenland ice sheet solid ice discharge}
\runningauthor{K. D. Mankoff \textit{et al.}}
\correspondence{Ken Mankoff (kdm@geus.dk)}

\received{}
\pubdiscuss{}
\revised{}
\accepted{}
\published{}
%% These dates will be inserted by ACPD
\firstpage{1}
\maketitle

\newcommand{\textcite}[1]{\citet{#1}}
\newcommand{\autocite}[1]{\citep{#1}}
#+END_EXPORT


#+BEGIN_abstract
We present a 1986 through March 2020 estimate of Greenland Ice Sheet ice discharge. Our data include all discharging ice that flows faster than 100 m yr^{-1} and are generated through an automatic and adaptable method, as opposed to conventional handpicked gates. We position gates near the present-year termini and estimate problematic bed topography (ice thickness) values where necessary. In addition to using annual time-varying ice thickness, our time series uses velocity maps that begin with sparse spatial and temporal coverage and end with near-complete spatial coverage and twelve-day updates to velocity. The 2010 through 2019 average ice discharge through the flux gates is ~487 \(\pm\)49 Gt yr^{-1}. The 10 % uncertainty stems primarily from uncertain ice bed location (ice thickness). We attribute the ~50 Gt yr^{-1} differences among our results and previous studies to our use of updated bed topography from BedMachine v3. Discharge is approximately steady from 1986 to 2000, increases sharply from 2000 to 2005, and then is approximately steady again. However, regional and glacier variability is more pronounced, with recent decreases at most major glaciers and in all but one region offset by increases in the northwest region through 2017, and in the southeast from 2017 through March 2020. As part of the journal's living archive option and our goal to make an operational product, all input data, code, and results from this study will be updated as needed (when new input data are available, as new features are added, or to fix bugs) and made available at doi:10.22008/promice/data/ice_discharge citep:GEUS_discharge_paper and at http://github.com/GEUS-PROMICE/ice_discharge.
#+END_abstract

# For 2000 to present mean see LINK: id:eca400fe-cffc-4e6b-8fc1-694945093adb

* Table of Contents                               :toc_2:noexport:
- [[#about-this-document][About This Document]]
  - [[#workflow][Workflow]]
- [[#summary][Summary]]
- [[#new-in-this-version][New in this version]]
- [[#introduction][Introduction]]
- [[#input-data][Input data]]
- [[#methods][Methods]]
  - [[#terminology][Terminology]]
  - [[#gate-location][Gate location]]
  - [[#thickness][Thickness]]
  - [[#missing-or-invalid-data][Missing or invalid data]]
  - [[#discharge][Discharge]]
- [[#results][Results]]
  - [[#gates][Gates]]
  - [[#discharge-1][Discharge]]
- [[#discussion][Discussion]]
  - [[#comparison-with-past-studies][Comparison with past studies]]
- [[#data-availability][Data availability]]
- [[#conclusions][Conclusions]]
- [[#other][Other]]
- [[#references][References]]
- [[#figures][Figures]]
  - [[#overview][Overview]]
  - [[#heatmap][Heatmap]]
  - [[#ice-thickness-v-velocity-2d-histogram-color--count][Ice Thickness v. Velocity 2D Histogram: Color = count]]
  - [[#discharge-time-series][Discharge Time Series]]
  - [[#discharge-time-series-regions][Discharge Time Series: Regions]]
  - [[#discharge-time-series-top-few][Discharge Time Series: Top Few]]
- [[#appendix][Appendix]]
  - [[#errors-and-uncertainties][Errors and uncertainties]]
  - [[#velocity-versus-thickness][Velocity versus thickness]]
  - [[#køge-bugt-bed-change-between-citetbamber_2013_bed-and-citetmorlighem_2017_bedmachine][Køge Bugt bed change between citet:bamber_2013_bed and citet:morlighem_2017_bedmachine]]
  - [[#sentinel-1-ice-velocity-maps][Sentinel-1 ice velocity maps]]
  - [[#software][Software]]
- [[#code][Code]]
  - [[#makefile][Makefile]]
  - [[#misc-helper][Misc Helper]]
  - [[#import-data][Import Data]]
  - [[#find-gates][Find Gates]]
  - [[#effective-velocity][Effective Velocity]]
  - [[#export-all-data-to-csv][Export all data to CSV]]
  - [[#compute-errors][Compute Errors]]
  - [[#raw-data-to-discharge-product][Raw data to discharge product]]
  - [[#csv-to-netcdf][CSV to NetCDF]]
  - [[#figures-1][Figures]]
  - [[#auto-update][Auto update]]
- [[#supplementary-material][Supplementary Material]]
  - [[#errors-by-gate-sorted-by-total-d-err-err-][Errors by gate sorted by total D, err, err %]]
  - [[#annual-averages-from-observations-or-linear-interpolation][Annual averages from observations or linear interpolation]]
  - [[#køge-bugt-y2k][Køge Bugt Y2K]]
- [[#qa--qc--tests][QA / QC / tests]]
  - [[#files-used-in-this-work][Files used in this work]]
  - [[#results-1][Results]]
- [[#meta][Meta]]
- [[#latex-setup][LaTeX Setup]]

* About This Document                                   :noexport:

This document is an Emacs Org Mode plain-text file with code and text embedded. If you are viewing:

+ A DOC or PDF file, then it was generated by exporting from Org. Not all of the Org parts (code, results, comments, etc.) were exported. The Org source file is available upon request, and may be embedded in the PDF. Most non-Apple PDF viewers provide easy access to embedded or attached files.
 
+ A file with a =org= extension in something other than Emacs, then you are seeing the canonical version and the full source, but without any syntax highlighting, document structure, or the ability to execute the code blocks.

+ An =Org= file within Emacs, then this is the canonical version. You should be able to fully interact and reproduce the contents of this document, although it may require 3rd-party applications (Python, etc.) and a similar Emacs configuration. This is available upon request.

** Workflow

To recreate this work
+ See the hacking.org file

After updates, re-run make, and then...
+ Run the =workflow-update= block below
  + Cleaning all result blocks with =C-u C-c C-v k= or (org-babel-remove-result-one-or-many), then
  + Executing all blocks (without =:eval no=) using =C-c C-v C-b= or (org-babel-execute-buffer)
+ Review and commit changes
+ Re-run the =workflow-update= so that exported files have the right git commit
  + Review changes - there should be NONE
+ Push updates
  + =git push=
  + Upload data to dataverse

# WARNING: infinite recursion if not ":eval no"
#+header: :eval no
#+name: workflow-update
#+BEGIN_SRC emacs-lisp :results none :eval no :results none :exports none
(progn
  (require 'notifications)
  (toc-org-insert-toc)

  ;; remove #+results: blocks
  (org-babel-map-src-blocks nil (if (org-babel-where-is-src-block-result) 
				    (org-babel-insert-result "" '("replace"))))
  (save-buffer) ;; can now inspect "missing" results w/ git wdiff
  (org-babel-execute-buffer) ;; this make take a few whiles
  (save-buffer)
  (org-babel-tangle)
  (org-latex-export-to-latex)
  (notifications-notify
   :title "workflow-update done"
   :timeout 5000
   :transient t))
#+END_SRC



* Summary                                               :noexport:

# A short summary [...] 500-character (incl. spaces) non-technical text that may be used to promote your work to a broader audience. It should highlight your main conclusions and results, and what the implications are. If possible, please also summarize briefly why you did the research and how you did it.

We have produced an open and reproducible estimate of Greenland ice sheet solid ice discharge from 1986 through 2019. Our results show three modes at the total ice-sheet scale: Steady discharge from 1986 through 2000, increasing discharge from 2000 through 2005, steady discharge from 2005 through 2019. The behavior of individual sectors and glaciers is more complicated. This work was done to provide a 100% reproducible estimate to help constrain mass balance and sea level rise estimates. 

* New in this version

The data have been updated approximately every 12 days since the last version of the paper citep:mankoff_2020_solid was released. Every change is versioned with unique DOIs and posted on the new GEUS data portal at http://dataverse01.geus.dk/ or doi:10.22008/promice/data/ice_discharge. The git commit for this version of the paper is \input{|"git describe --always --dirty='*'"}.

# In this version the NSIDC 0478 ice velocity data citep:NSIDC_0478 have been updated from v2 to v2.1. These data are used for the baseline velocity and gate selection. Therefore the gate locations, number of gates, and number of gate pixels have all changed. Overall there are ~3 % fewer pixels, but only eight fewer gates, and some of the gate reduction is due to combining two gates on the same glacier that had a 1-pixel gap in the previous version. The effect of these changes is < 2.5 % of the estimated discharge. In this version there are now src_bash[:eval yes]{tail -n +2 tmp/dat_100_5000.csv | wc -l} {{{results(=5829=)}}} pixels and src_bash[:eval yes]{cut -d"," -f8 tmp/dat_100_5000.csv | tail -n +2 | sort | uniq | wc -l} {{{results(=267=)}}} gates. Many gates remain the same pixel for pixel, but some do not meet the same inclusion criteria applied to these new baseline data, while some glaciers are included in this version that were not in the previous version. Many gates are also a few pixels narrower.

The NSIDC 0646 ice velocity data citep:NSIDC_0646 have been updated from v2 to v3 with no significant changes. The early portion of the record has 1 less velocity map per month and ~1 Gt (~0.2 %) less discharge per year.

# This update increases coverage and discharge in the 1980s by ~25 to 40 Gt yr^{-1} (~6 to 10 %) due to higher velocity estimates than the previous product that covered that time period with annual averages citep:mouginot_2018_1972to1990,mouginot_2018_1991to2000. This change highlights that ice-sheet-wide differences between velocity products can be nontrivial (c.f. citet:millan_2019_mapping). The time series has also been extended through both the updated NSIDC 0646 data and src_bash[:eval yes]{ls ${DATADIR}/Sentinel1/Sentinel1_IV_maps|grep -E "IV_201[8|9]"|wc -l} {{{results(=61=)}}} Sentinel 1 velocity maps from 2018 through the present (src_bash[:eval yes]{date --iso} {{{results(=2020-09-21=)}}}). We have also added src_bash[:eval yes]{ls ${DATADIR}/MEaSUREs/NSIDC-0731.001/|grep greenland_vel_mosaic|wc -l} {{{results(=48=)}}} additional MEaSUREs (citet:NSIDC_0731,joughin_2010_greenland,joughin_2018_greenland; hereafter NSIDC 0731) monthly average velocity maps from 2014-12-01 through 2018-11-30.

# We have updated the time series graphics (Figures [[fig:discharge_ts]], [[fig:discharge_ts_regions]], and [[fig:discharge_ts_topfew]]) in the following manner: Any observation (gate, region, or ice sheet wide) where coverage is < 50 % is discarded from the graphic (low-coverage data are still included in the downloadable data), and annual average is only computed if there are three or more samples in a year. 

# Finally, the Supplemental includes significantly more meta-data about the input data used in this work to aid in both reproducibility by third parties, and in tracking the impact of additional and updated input data on future versions of this work.

# Results show a continued steady total discharge. The contributions from the central west (CW) region continue to decrease, while the central east (CE) region continues to increase, and CE and CW are now approximately tied for the third-largest discharging region. The top three individual contributing glaciers remain dynamic - Sermeq Kujalleq (English: Jakobshavn Glacier; Danish: Jakobshavn Isbræ) continued its rapid discharge decline in 2017 and 2018, returning to approximately its discharge from year 2000, but increased discharge slightly in 2019. For some time in 2018 and all data points so far in 2020 (i.e., though March) Helheim was the top Greenlandic glacier contributing to sea-level rise, although not with statistical significance (error bars still overlap).

* Introduction

The mass of the Greenland Ice Sheet is decreasing (e.g. citet:fettweis_2017_reconstructions,van-den-broeke_2017_greenland,wiese_2016_jpl,khan_2016_geodetic). Most ice sheet mass loss -- as iceberg discharge, submarine melting, and meltwater runoff -- enters the fjords and coastal seas, and therefore ice sheet mass loss directly contributes to sea-level rise citep:wcrp_2018,moon_2018_rising,nerem_2018_climate,chen_2017_increasing. Greenland's total ice loss can be estimated through a variety of independent methods, for example direct mass change estimates from GRACE citep:wiese_2016_jpl or by using satellite altimetry to estimate surface elevation change, which is then converted into mass change (using a firn model, e.g., citet:khan_2016_geodetic). However, partitioning the mass loss between ice discharge (D) and surface mass balance (SMB) remains challenging (cf. citet:rignot_2008_mass and citet:enderlin_2014_improved). Correctly assessing mass loss, as well as the attribution of this loss (SMB or D), is critical to understanding the process-level response of the Greenland Ice Sheet to climate change and thus improving models of future ice sheet changes and associated sea-level rise citep:moon_2018_rising.

The total mass of an ice sheet, or a drainage basin, changes if the mass gain (SMB inputs, primarily snowfall) is not balanced by the mass loss (D and SMB outputs, the latter generally meltwater runoff). This change is typically termed ice sheet mass balance (MB) and the formal expression for this rate of change in mass is (e.g., citet:cuffey_2010_the-physics),

#+NAME: eq:dMdt
\begin{equation}
\frac{\mathrm{d}M}{\mathrm{d}t} = \rho \int_A b \, \mathrm{d}A - \int_g Q \, \mathrm{d}g,
\end{equation}

where \(\rho\) is the average density of ice, \(b\) is an area mass balance, and \(Q\) is the discharge flux. The left-hand side of the equation is the rate of change of mass, the first term on the right-hand side is the area \(A\) integrated surface mass balance (SMB), and the second term is the discharge \(D\) mass flow rate that drains through gate \(g\). Equation [[eq:dMdt]] is often simplified to

#+NAME: eq:MB
\begin{equation}
MB = SMB - D
\end{equation}

where \(MB\) is the mass balance, and referred to as the "input--output" method (e.g., citet:khan_2015_greenland). Virtually all studies agree on the trend of Greenland mass balance, but large discrepancies persist in both the magnitude and attribution. Magnitude discrepancies include, for example, citet:kjeldsen_2015_spatial reporting a mass imbalance of -250 \(\pm\) 21 Gt yr^{-1} during 2003 to 2010, citet:ewert_2012_volume reporting -181 \(\pm\) 28 Gt yr^{-1} during 2003 to 2008, and citet:rignot_2008_mass reporting a mass imbalance of -265 \(\pm\) 19 Gt yr^{-1} during 2004 to 2008. Some of these differences may be due to different ice sheet area masks used in the studies. Attribution discrepancies include, for example, citet:enderlin_2014_improved attributing the majority (64 %) of mass loss to changes in SMB during the 2005 to 2009 period but citet:rignot_2008_mass attributing the majority (85 %) of mass loss to changes in D during the 2004 to 2008 period.

# Rignot 2008: TMB (2004-2007) = (231+293+265+267)/4 = 264 Gt yr-1  # Table 1
# Enderlin 2014: TMB (2005-2009) = 265 \pm 18 Gt yr-1 # text in Section 3
# Kjeldsen 2015: TMB (2003-2010) = 186 \pm 18.9 Gt yr-1 # Table 1

#+BEGIN_SRC jupyter-python :session tmp :exports none :results raw drawer
from uncertainties import unumpy
import numpy as np
np.mean(unumpy.uarray([231,293,265,267], [40,39,39,38]))
#+END_SRC

# error %
# Rignot: 19.5/264*100 = 7.38636363636
# Enderlin: 18/265*100 = 6.79245283019
# Kjeldsen: 19/186*100 = 10.2150537634

# When ice-sheet wide MB does agree between two independent studies, there may be spatially and/or temporally compensating errors underlying this outward agreement. Spatial discrepancies include, for example, citet:enderlin_2014_improved and citet:king_2018_seasonal. Temporal discrepancies include, for example, ???. A substantial portion of underlying spatial and temporal discrepancies may be associated with sampling bias. Underlying sampling discrepancy includes, for example, demonstrating agreement between satellite gravimetry derived mass loss estimates that sample Greenland peripheral glaciers and an input-output assessment that does not sample these disproportionately high mass loss glaciers citep:xu_2016_improved,noel_2017_greenland.


Discharge may be calculated through several methods, including mass flow rate through gates (e.g. citet:enderlin_2014_improved,king_2018_seasonal,mouginot_2019_forty), or solving as a residual from independent mass balance terms (e.g. citet:kjaer_2012_aerial,kjeldsen_2015_spatial). The gate method that we use in this study incorporates ice thickness and an estimated vertical profile from the observed surface velocity to calculate the discharge. A typical formulation of discharge across a gate \(D_g\) is,

#+NAME: eq:Q
\begin{equation}
D_g = \rho \, V \, H \, w,
\end{equation}

where \(\rho\) is the average density of ice, \(V\) is depth-average gate-perpendicular velocity, \(H\) is the ice thickness, and \(w\) is the gate width. Uncertainties in \(V\) and \(H\) naturally influence the estimated discharge. At fast-flowing outlet glaciers, \(V\) is typically assumed to be equal at all ice depths, and observed surface velocities can be directly translated into depth-averaged velocities (as in citet:enderlin_2014_improved,king_2018_seasonal). To minimize uncertainty from SMB or basal mass balance corrections downstream of a flux gate, the gate should be at the grounding line of the outlet glacier. Unfortunately, uncertainty in bed elevation (translating to ice thickness uncertainty) increases toward the grounding line.

Conventional methods of gate selection involve handpicking gate locations, generally as linear features (e.g., citet:enderlin_2014_improved) or visually approximating ice-orthogonal gates at one point in time (e.g., citet:king_2018_seasonal). Manual gate definition is suboptimal. For example, the largest discharging glaciers draw from an upstream radially diffusing region that may not easily be represented by a single linear gate. Approximately flow-orthogonal curved gates may not be flow orthogonal on the multidecade timescale due to changing flow directions. Manual gate selection makes it difficult to update gate locations, corresponding with glacier termini retreat or advance, in a systematic and reproducible fashion. We therefore adopt an algorithmic approach to generate gates based on a range of criteria.

Here, we present a discharge dataset based on gates selected in a reproducible fashion by a new algorithm. Relative to previous studies, we employ ice velocity observation over a longer period with higher temporal frequency and denser spatial coverage. We use ice velocity from 1986 through 2019 including twelve-day velocities for the last ~500 days of the time series, and discharge at 200 m pixel resolution capturing all ice flowing faster than 100 m yr^{-1} that crosses glacier termini into fjords.

* Input data

Historically, discharge gates were selected along well-constrained flight lines of airborne radar data citep:enderlin_2014_improved. Recent advances in ice thickness estimates through NASA Operation IceBridge citep:millan_2018_vulnerability, NASA Oceans Melting Greenland (OMG; citet:fenty_2016_oceans), fjord bathymetry citep:tinto_2015_bathymetry, and methods to estimate thickness from surface properties (e.g., citet:mcnabb_2012_using,james_2016_automated) have been combined into digital bed elevation models such as BedMachine v3 citep:morlighem_2017_bedmachine,NSIDC_BedMachine or released as independent datasets citep:millan_2018_vulnerability. From these advances, digital bed elevation models have become more robust at tidewater glacier termini and grounding lines. The incorporation of flight-line ice thickness data into higher-level products that include additional methods and data means gates are no longer limited to flight lines (e.g., citet:king_2018_seasonal).

Ice velocity data are available with increasing spatial and temporal resolution (e.g., citet:vijay_2019_resolving). Until recently, ice velocity mosaics were limited to once per year during winter citep:joughin_2010_greenland, and they are still temporally limited, often to annual resolution, prior to 2000 (e.g. citet:mouginot_2018_1972to1990,mouginot_2018_1991to2000). Focusing on recent times, ice-sheet-wide velocity mosaics from the Sentinel-1A & 1B are now available every twelve days (http://PROMICE.org). The increased availability of satellite data has improved ice velocity maps both spatially and temporally, thereby decreasing the need to rely on spatial and temporal interpolation of velocities from annual/winter mosaics citep:andersen_2015_basin-scale,king_2018_seasonal,mouginot_2019_forty.

The discharge gates in this study are generated using only surface speed and an ice mask. We use the MEaSUREs Greenland Ice Sheet Velocity Map from InSAR Data, Version 2 citep:joughin_2010_greenland,NSIDC_0478, hereafter termed "MEaSUREs 0478" due to the National Snow and Ice Data Center (NSIDC) dateset ID number. We use the BedMachine v3 citep:morlighem_2017_bedmachine,NSIDC_BedMachine ice mask.

For ice thickness estimates, we use surface elevation from GIMP (citet:howat_2014_greenland,NSIDC_0715; NSIDC dataset ID 0715), adjusted through time with surface elevation change from citet:khan_2016_geodetic and bed elevations from BedMachine v3 replaced by citet:millan_2018_vulnerability where available. Ice sector and region delineation is from citet:mouginot_2019_glacier. Ice velocity data are obtained from a variety of products including Sentinel-1A & 1B derived by PROMICE (see Appendix), MEaSUREs 0478, MEaSUREs 0646 citep:NSIDC_0646, citet:mouginot_2018_1972to1990, and citet:mouginot_2018_1991to2000. Official glacier names come from citet:bjork_2015_brief. Other glacier names come from citet:mouginot_2019_glacier. See Table [[tab:data]] for an overview of datasets used in this work.

#+BEGIN_SRC bash :results verbatim :eval no-export
echo "times  all: " $(head -n1 ./tmp/dat_100_5000.csv | tr ',' '\n' | grep "vel_eff" | wc -l)
echo "times 19XX: " $(head -n1 ./tmp/dat_100_5000.csv | tr ',' '\n' | grep "vel_eff_19" | wc -l)
echo "times 20XX: " $(head -n1 ./tmp/dat_100_5000.csv | tr ',' '\n' | grep "vel_eff_20" |wc -l)
for Y in $(seq 2000 2022); do 
  echo "times ${Y}: " $(head -n1 ./tmp/dat_100_5000.csv | tr ',' '\n' | grep "vel_eff_${Y}" |wc -l)
done
#+END_SRC

#+RESULTS:
#+begin_example
times  all:  478
times 19XX:  108
times 20XX:  370
times 2000:  12
times 2001:  9
times 2002:  10
times 2003:  9
times 2004:  8
times 2005:  9
times 2006:  10
times 2007:  9
times 2008:  10
times 2009:  11
times 2010:  8
times 2011:  8
times 2012:  10
times 2013:  11
times 2014:  14
times 2015:  25
times 2016:  34
times 2017:  41
times 2018:  54
times 2019:  30
times 2020:  30
times 2021:  8
times 2022:  0
#+end_example

This work uses src_bash[:eval yes]{head -n1 ./tmp/dat_100_5000.csv | tr ',' '\n' | grep "vel_eff" | wc -l} {{{results(=478=)}}} different velocity maps, biased toward post-2015 when twelve-day ice velocities become available from the Sentinel-1 satellites. The temporal distribution is ~10 maps per year from 1986 to 2013, 14 in 2014, 25 in 2015, 38 in 2016, 81 in 2017, 54 in 2018, and one every ~12 days in 2019 and 2020.

#+LATEX_ATTR: :placement [!h]
#+CAPTION: Summary of data sources used in this work.
#+NAME: tab:data
| Property                       | Name used in this paper  | Reference                                                      |
|--------------------------------+--------------------------+----------------------------------------------------------------|
| Basal topography               | BedMachine               | citet:morlighem_2017_bedmachine,NSIDC_BedMachine               |
| Basal topography for southeast |                          | citet:millan_2018_vulnerability                                |
| Surface elevation              | GIMP 0715                | citet:howat_2014_greenland,NSIDC_0715                          |
| Surface elevation Change       | Surface elevation change | citet:khan_2016_geodetic,GEUS_discharge_paper_elevation_change |
| Baseline velocity              | MEaSUREs 0478            | citet:NSIDC_0478                                               |
| Velocity                       | Sentinel                 | Appendix                                                       |
| Velocity                       | MEaSUREs 0646            | citet:NSIDC_0646                                               |
| Velocity                       | MEaSUREs 0731            | citet:NSIDC_0731,joughin_2010_greenland,joughin_2018_greenland |
| Velocity                       | pre-2000                 | citet:mouginot_2018_1972to1990,mouginot_2018_1991to2000        |
| Sectors and regions            | Sectors and regions      | citet:mouginot_2019_glacier                                    |
| Names                          |                          | citet:bjork_2015_brief,mouginot_2019_glacier                   |

* Methods
** Terminology 

We use the following terminology, displayed in Fig. [[fig:overview]]: 
+ "Pixels" are individual 200 m x 200 m raster discharge grid cells. We use the nearest neighbor when combining datasets that have different grid properties.
+ "Gates" are contiguous (including diagonal) clusters of pixels.
+ "Sectors" are spatial areas that have 0, 1, or > 1 gate(s) plus any upstream source of ice that flows through the gate(s), and come from citet:mouginot_2019_glacier.
+ "Regions" are groups of sectors, also from citet:mouginot_2019_glacier, and are labeled by approximate geographic region.
+ The "baseline" period is the average 2015, 2016, and 2017 winter velocity from MEaSUREs 0478.
+ "Coverage" is the percentage of total, region, sector, or gate discharge observed at any given time. By definition coverage is 100 % during the baseline period. From the baseline data, the contribution to total discharge of each pixel is calculated, and coverage is reported for all other maps that have missing observations (Fig. [[fig:coverage_schematic]]). Total estimated discharge is always reported because missing pixels are gap filled (see "Missing or invalid data" section below).
+ "Fast-flowing ice" is defined as ice that flows more than 100 m yr^{-1}.
+ Names are reported using the official Greenlandic names from citet:bjork_2015_brief; if an alternate name exists (e.g. from citet:mouginot_2019_glacier, or an English version), then this is shown in parentheses.

Although we refer to solid ice discharge, and it is in the solid phase when it passes the gates and eventually reaches the termini, submarine melting occurs at the termini and some of the discharge enters the fjord as liquid water citep:enderlin_2013_submarine.

** Gate location

Gates are algorithmically generated for fast-flowing ice (greater than 100 m yr^{-1}) close to the ice sheet terminus determined by the baseline-period data. We apply a 2D inclusive mask to the baseline data for all ice flowing faster than 100 m yr^{-1}. We then select the mask edge where it is near the BedMachine ice mask (not including ice shelves), which effectively provides grounding line termini. We buffer the termini 5000 m in all directions creating ovals around the termini and once again down-select to fast-flowing ice pixels. This procedure results in gates 5000 m upstream from the baseline terminus that bisect the baseline fast-flowing ice. We manually mask some land- or lake-terminating glaciers which are initially selected by the algorithm due to fast flow and mask issues. 

We select a 100 m yr^{-1} speed cutoff because slower ice, taking longer to reach the terminus, is more influenced by SMB. For the influence of this threshold on our results see the Discussion section and Fig. [[fig:heatmap]]. 

We select gates at 5000 m upstream from the baseline termini, which means that gates are likely > 5000 m from the termini further back in the historical record citep:murray_2015_extensive,wood_2018_ocean-induced. The choice of a 5000 m buffer follows from the fact that it is near terminus and thus avoids the need for (minor) SMB corrections downstream, yet is not too close to the terminus where discharge results are sensitive to the choice of distance-to-terminus value (Fig. [[fig:heatmap]]), which may be indicative of bed (ice thickness) errors.

** Thickness

We derive thickness from surface and bed elevation. We use GIMP 0715 surface elevations in all locations, and the BedMachine bed elevations in most locations, except southeast Greenland where we use the citet:millan_2018_vulnerability bed. The GIMP 0715 surface elevations are all time stamped per pixel. We adjust the surface through time by linearly interpolating elevation changes from citet:khan_2016_geodetic, which covers the period from 1995 to 2016. We use the average of the first and last 3 years for earlier and later times, respectively. Finally, from the fixed bed and temporally varying surface, we calculate the time-dependent ice thickness at each gate pixel.

** Missing or invalid data

The baseline data provide velocity at all gate locations by definition, but individual nonbaseline velocity maps often have missing or invalid data. Also, thickness provided by BedMachine is clearly incorrect in some places (e.g. fast-flowing ice that is 10 m thick, Fig. [[fig:h_v_histogram]]). We define invalid data and fill in missing data as described below.

*** Invalid velocity

We flag invalid (outlier) velocities by treating each pixel as an individual time series, applying a 30-point rolling window, flagging values more than 2 standard deviations outside the mean, and repeating this filter three times. We also drop the 1972 to 1985 years from citet:mouginot_2018_1972to1990 because there is low coverage and extremely high variability when using our algorithm.

This outlier detection method appears to correctly flag outliers (see citet:mankoff_2019_ice, for unfiltered time series graphs) but likely also flags some true short-term velocity increases. The effect of this filter is a ~1% reduction in discharge most years but more in years with high discharge -- a reduction of 3.2 % in 2013, 4.3 % in 2003, and more in the 1980s when the data are noisy. Any analysis using these data and focusing on individual glaciers or short-term changes (or lack thereof) should reevaluate the upstream data sources.

*** Missing velocity
:PROPERTIES:
:CUSTOM_ID: sec:missing_velocity
:END:

We generate an ice speed time series by assigning the PROMICE, MEaSUREs 0478, MEaSUREs 0646, and pre-2000 products to their respective reported time stamps (even though these are time-span products) or to the middle of their time span when they cover a long period such as the annual maps from citet:mouginot_2018_1972to1990,mouginot_2018_1991to2000. We ignore that any individual velocity map or pixel has a time span and not a time stamp. Velocities are sampled only where there are gate pixels. Missing pixel velocities are linearly interpolated in time, except for missing data at the beginning of the time series which are back- and forward filled with the temporally nearest value for that pixel (Fig. [[fig:coverage_schematic]]). We do not spatially interpolate missing velocities because the spatial changes around a missing data point are most likely larger than the temporal changes. We visually represent the discharge contribution of directly observed pixels, termed coverage (Fig. [[fig:coverage_schematic]]) as time series graphs and opacity of dots and error bars in the figures. The figures only display data where coverage is \(\ge\) 50 %, but the provided data files include coverage from 0 to 100 %. Therefore, the gap-filled discharge contribution at any given time is equal to 100 minus the coverage. Discharge is always reported as estimated total discharge even when coverage is less than 100 %.

*** Invalid thickness
:PROPERTIES:
:CUSTOM_ID: sec:invalid_thickness
:END:

The thickness data appear to be incorrect in some locations. For example, many locations have fast-flowing ice but report ice thickness as 10 m or less (Fig. [[fig:h_v_histogram]], left panel). We accept all ice thickness greater than 20 m and construct from this a thickness vs. log_{10}-speed relationship. For all ice thickness less than or equal to 20 m thick we adjust thickness based on this relationship (Fig. [[fig:h_v_histogram]], right panel). We selected the 20 m thickness cutoff after visually inspecting the velocity distribution (Fig. [[fig:h_v_histogram]], left panel). This thickness adjustment adds 20 Gt yr^{-1} to our baseline-period discharge estimate with no adjustment. In the Appendix and Table [[tab:thick_treatments]] we discuss the discharge contribution of these adjusted pixels, and a comparison among this and other thickness adjustments.


** Discharge

We calculate discharge per pixel using density (917 kg m^{-3}), filtered and filled ice speed, projection-corrected pixel width, and adjusted ice thickness derived from time-varying surface elevation and a fixed bed elevation (Eq. [[eq:Q]]). We assume that any change in surface elevation corresponds to a change in ice thickness and thereby neglect basal uplift, erosion, and melt, which combined are orders of magnitude less than surface melting (e.g., citet:cowton_2012_rapid,khan_2007_elastic). We also assume depth-averaged ice velocity is equal to the surface velocity.

We calculate discharge using the gate orthogonal velocity at each pixel and at each timestamp -- all velocity estimates are gate-orthogonal at all times, regardless of gate position, orientation, or changing glacier velocity direction over time.

Annual averages are calculated by linearly interpolating to daily and then estimating annual. The difference between this method and averaging only the observed samples is ~3 % median (5 % average, and a maximum of 10 % when examining the entire ice sheet and all years in our data). It is occasionally larger at individual glaciers when a year has few widely spaced samples of highly variable velocity.

*** Discharge uncertainty
\label{sec:D_uncertainty}

A longer discussion related to our and others treatments of errors and uncertainty is in the Appendix, but here we describe how we estimate the uncertainty related to the ice discharge following a simplistic approach. This yields an uncertainty of the total ice discharge of approximately 10 % throughout the time series. 

At each pixel we estimate the maximum discharge, \(D_{\mathrm{max}}\), from 

#+NAME: eq:D_err_max
\begin{equation}
D_{\mathrm{max}} = \rho \, (V + \sigma_V) \, (H + \sigma_H) \, W,
\end{equation}

and minimum discharge, \(D_{\mathrm{min}}\), from

#+NAME: eq:D_err_min
\begin{equation}
D_{\mathrm{min}} = \rho \, (V - \sigma_V) \, (H - \sigma_H) \, W,
\end{equation}

where \(\rho\) is ice density, \(V\) is baseline velocity, \(\sigma_V\) is baseline velocity error, \(H\) is ice thickness, \(\sigma_H\) is ice thickness error, and \(W\) is the width at each pixel. Included in the thickness term is surface elevation change through time (\(\mathrm{d}H/\mathrm{d}t\)). When datasets do not come with error estimates we treat the error as 0.

We use \(\rho = 917\) kg m^{-3} because the gates are near the terminus in the ablation zone, and ice thickness estimates should not include snow or firn, although regionally ice density may be < 917 kg m^{-3} due to crevasses. We ignore the velocity error \(\sigma_V\) because the proportional thickness error (\(\sigma_H/H\)) is an order of magnitude larger than the proportional velocity error (\(\sigma_V/V\)) yet both contribute linearly to the discharge. \(W\) is location dependent due to the errors between our working map projection (EPSG 3413) and a more accurate spheroid model of the earth surface. We adjust linear gate width by up to ~4% in the north and ~-2.5% in the south of Greenland (area errors are up to 8%). On a pixel-by-pixel basis we used the provided thickness uncertainty except where we modified the thickness (H < 20 m); we prescribe an uncertainty of 0.5 times the adjusted thickness. Subsequently, the uncertainty on individual glacier, sector, region, or ice sheet scale is obtained by summing, but not reducing by the square of the sums, the uncertainty related to each pixel. We are conservative with our thickness error estimates, by assuming the uncertainty range is from \(D_{\mathrm{min}}\) to \(D_{\mathrm{max}}\) and not reducing by the sum of squares of sectors or regions. 

* Results
** Gates

#+BEGIN_SRC bash :results verbatim :exports none :eval no-export
echo "pixels: " $(tail -n +2 tmp/dat_100_5000.csv | wc -l)
echo "gates: " $(cut -d"|" -f3 ./tmp/dat/gates_gateID@gates_100_5000.bsv | tail -n +2 | sort | uniq | wc -l)
echo "sectors: " $(cut -d"|" -f3 ./tmp/dat/sectors@Mouginot_2019.bsv | tail -n +2 | sort -n | uniq | wc -l)
echo "times: " $(head -n1 ./tmp/dat_100_5000.csv | tr ',' '\n' | grep "vel_eff" | wc -l)
#+END_SRC

#+RESULTS:
: pixels:  5829
: gates:  267
: sectors:  173
: times:  478

Our gate placement algorithm generates src_bash[:eval yes]{tail -n +2 tmp/dat_100_5000.csv | wc -l} {{{results(=5829=)}}} pixels making up src_bash[:eval yes]{cut -d"|" -f3 ./tmp/dat/gates_gateID@gates_100_5000.bsv | tail -n +2 | sort | uniq | wc -l} {{{results(=267=)}}} gates, assigned to src_bash[:eval yes]{cut -d"|" -f3 ./tmp/dat/sectors@Mouginot_2019.bsv | tail -n +2 | sort -n | uniq | wc -l} {{{results(=173=)}}} ice sheet sectors from citet:mouginot_2019_glacier. Previous similar studies have used 260 gates citep:mouginot_2019_forty, 230 gates citep:king_2018_seasonal, and 178 gates citep:enderlin_2014_improved.

The widest gate (~47 km) is Sermersuaq (Humboldt Gletsjer) and the second widest (~34 km) is Sermeq Kujalleq (Jakobshavn Isbræ). A total of 23 additional glaciers have gate lengths longer than 10 km. The minimum gate width is 3 pixels (600 m) by definition in the algorithm. 

# See LINK: [[id:62f5d28c-c704-422d-9e9b-c0771d5b86ee][Table of thickness adjustments]]

The average unadjusted thickness gates is 401 m with a standard deviation of 258. The average thickness after adjustment is 436 m with a standard deviation of 223. A histogram of unadjusted and adjusted thickness at all gate locations is shown in Fig. [[fig:h_v_histogram]].

** Discharge
:PROPERTIES:
:CUSTOM_ID: sec:results_flow_rate
:END:

#+BEGIN_SRC jupyter-python :session D_val_text :exports none :results raw drawer :eval no-export
import pandas as pd

t = pd.read_csv('./out/GIS_D.csv', index_col=0, parse_dates=True)\
      .resample('AS')\
      .mean()
t_err = pd.read_csv('./out/GIS_err.csv', index_col=0, parse_dates=True)\
          .resample('AS')\
          .mean()
t = t.merge(t_err, left_index=True, right_index=True)\
     .rename({'Discharge [Gt yr-1]' : 'D',
              'Discharge Error [Gt yr-1]' : 'err'}, axis='columns')

print("Initial:\n", t.loc['1986-01-01'])
print("\nMinimum\n", t.loc[t['D'].idxmin().strftime('%Y-%m-%d')])
print("\nY2K\n", t.loc['2000-01-01'])
print("\n2005\n", t.loc['2005-01-01'])

t[t.index.year > 2005]
#+END_SRC

#+RESULTS:
:RESULTS:
#+begin_example
Initial:
 D      458.552857
err     49.341571
Name: 1986-01-01 00:00:00, dtype: float64

Minimum
 D      426.753250
err     43.863625
Name: 1996-01-01 00:00:00, dtype: float64

Y2K
 D      441.668083
err     44.230167
Name: 2000-01-01 00:00:00, dtype: float64

2005
 D      497.942111
err     49.793111
Name: 2005-01-01 00:00:00, dtype: float64
#+end_example
| Date                |       D |     err |
|---------------------+---------+---------|
| 2006-01-01 00:00:00 | 488.524 | 49.0896 |
| 2007-01-01 00:00:00 | 480.89  | 48.664  |
| 2008-01-01 00:00:00 | 485.197 | 49.6216 |
| 2009-01-01 00:00:00 | 488.706 | 49.9101 |
| 2010-01-01 00:00:00 | 493.996 | 50.615  |
| 2011-01-01 00:00:00 | 498.024 | 51.1131 |
| 2012-01-01 00:00:00 | 493.842 | 51.2439 |
| 2013-01-01 00:00:00 | 497.143 | 51.2216 |
| 2014-01-01 00:00:00 | 499.943 | 51.2857 |
| 2015-01-01 00:00:00 | 502.725 | 51.3744 |
| 2016-01-01 00:00:00 | 490.763 | 50.3589 |
| 2017-01-01 00:00:00 | 498.567 | 50.857  |
| 2018-01-01 00:00:00 | 493.725 | 50.3031 |
| 2019-01-01 00:00:00 | 488.212 | 50.0041 |
| 2020-01-01 00:00:00 | 498.459 | 51.3725 |
| 2021-01-01 00:00:00 | 510.41  | 52.7211 |
:END:

Our ice discharge dataset (Fig. [[fig:discharge_ts]]) reports a total discharge of 460 \(\pm\) 49 Gt in 1986, has a minimum of 428 \(\pm\) 44 Gt in 1996, and increases to 443 \(\pm\) 44 in 2000 and further to 500 \(\pm\) 50 Gt/yr in 2005, after which annual discharge remains approximately steady at 483 to 505 \(\pm\) ~50 Gt/yr during the 2005 through 2019 period.

#+BEGIN_SRC jupyter-python :session D_val_text :exports none :results raw drawer :eval no-export
import pandas as pd

r = pd.read_csv('./out/region_D.csv', index_col=0, parse_dates=True)\
      .resample('AS')\
      .mean()
r_err = pd.read_csv('./out/region_err.csv', index_col=0, parse_dates=True)\
          .resample('AS')\
          .mean()
# t = t.merge(t_err, left_index=True, right_index=True)\
#      .rename({'Discharge [Gt yr-1]' : 'D',
#               'Discharge Error [Gt yr-1]' : 'err'}, axis='columns')

print("SE range: ", r['SE'].min(), r['SE'].max(), r_err['SE'].min(), r_err['SE'].max())
print("SE %: ", r['SE'].mean() / r.sum(axis='columns').mean()*100)
print("NE,NO,NW %:",r[['NE','NO','NW']].sum(axis='columns').mean()/r.sum(axis='columns').mean()*100)
print("\nNW increase\n:", r.loc['1999-01-01':,'NW'])
print("\nSE max and last:", r['SE'].max(), '\n', r['SE'].iloc[-10:].describe())
#+END_SRC

#+RESULTS:
#+begin_example
SE range:  136.58311111111112 163.86224999999996 16.01311111111111 20.359714285714286
SE %:  31.621919246331448
NE,NO,NW %: 31.40341849770316

NW increase
: Date
1999-01-01     89.299571
2000-01-01     90.061500
2001-01-01     90.361000
2002-01-01     91.236000
2003-01-01     92.864222
2004-01-01     96.504750
2005-01-01     95.827333
2006-01-01     96.192600
2007-01-01     95.896222
2008-01-01     97.776375
2009-01-01     99.046364
2010-01-01    101.792625
2011-01-01    104.925500
2012-01-01    103.884500
2013-01-01    106.265909
2014-01-01    109.218500
2015-01-01    109.461824
2016-01-01    110.335792
2017-01-01    113.142875
2018-01-01    112.938727
2019-01-01    107.131567
2020-01-01    107.296500
2021-01-01    108.778500
Freq: AS-JAN, Name: NW, dtype: float64

SE max and last: 163.86224999999996 
 count     10.000000
mean     150.006290
std        3.393650
min      143.074875
25%      148.665744
50%      150.289279
75%      150.812436
max      156.172500
Name: SE, dtype: float64
#+end_example

At the region scale, the SE glaciers (see Fig. [[fig:overview]] for regions) are responsible for 136 to 164 (\(\pm\) 12 %) Gt yr^{-1} of discharge (approximately one-third of ice-sheet-wide discharge) over the 1986 through 2019 period. By comparison, the predominantly land-terminating NO, NE, and SW together were also responsible for about one-third of total ice sheet discharge during this time (Fig. [[fig:discharge_ts_regions]]). The discharge from most regions has been approximately steady or declining for the past decade. The NW is the only region exhibiting a persistent long-term increase in discharge -- from ~90 to 115 Gt yr^{-1} (22 % increase) over the 1999 through 2017 period (+ ~1.4 Gt yr^{-1} or + ~1.2 % yr^{-1}). This 1999 through 2017 annual average increase in NW discharge offsets declining discharge from other regions, but the NW increase stopped in 2018 and discharge in the NW dropped by 5 Gt yr^{-1} (4 %) in 2019. This NW decline is then offset by a SE region increase. The largest contributing region, SE, contributed a high of 164 \(\pm\) 19 Gt in 2004 but dropped to ~150 \pm 18 Gt yr^{-1} for the past decade.

# 100 - 90/115*100 = 21.7391304348
# (115-90+1)/(2017-1999+1) = 1.36842105263
# (22/(2017-1999+1)) = 1.15789473684

#+BEGIN_SRC jupyter-python :session D_val_text :exports none :results raw drawer :eval no-export
import pandas as pd

s = pd.read_csv('./out/sector_D.csv', index_col=0, parse_dates=True)\
      .resample('AS')\
      .mean()
s_err = pd.read_csv('./out/sector_err.csv', index_col=0, parse_dates=True)\
          .resample('AS')\
          .mean()

print(s['JAKOBSHAVN_ISBRAE'].idxmax())
print(s.loc['2013-01-01', 'JAKOBSHAVN_ISBRAE'], s_err.loc['2013-01-01', 'JAKOBSHAVN_ISBRAE'])
print(s.loc['2013-01-01':, 'JAKOBSHAVN_ISBRAE'].idxmin())
print(s.loc['2018-01-01', 'JAKOBSHAVN_ISBRAE'], s_err.loc['2013-01-01', 'JAKOBSHAVN_ISBRAE'])
print(s.loc['2013-01-01':, 'JAKOBSHAVN_ISBRAE'])
#+END_SRC

#+RESULTS:
#+begin_example
2013-01-01 00:00:00
51.00927272727272 4.937
2018-01-01 00:00:00
34.94856818181818 4.937
Date
2013-01-01    51.009273
2014-01-01    50.367286
2015-01-01    49.431941
2016-01-01    48.483000
2017-01-01    38.562594
2018-01-01    34.948568
2019-01-01    35.767333
2020-01-01    39.460967
2021-01-01    43.942125
Freq: AS-JAN, Name: JAKOBSHAVN_ISBRAE, dtype: float64
#+end_example


Focusing on eight major contributors at the individual sector or glacier scale (Fig. [[fig:discharge_ts_topfew]]), Sermeq Kujalleq (Jakobshavn Isbræ) has slowed down from an annual average high of ~51 Gt yr^{-1} in 2013 to ~34 Gt yr^{-1} in 2018, likely due to ocean cooling citep:khazendar_2019_interruption. We exclude Ikertivaq from the top eight because that gate spans multiple sectors and outlets, while the other top dischargers are each a single outlet. The 2013 to 2016 slowdown of Sermeq Kujalleq (Fig. [[fig:discharge_ts_topfew]]) is compensated for by the many glaciers that make up the NW region (Fig. [[fig:discharge_ts_regions]]). The large 2017 and 2018 reduction in discharge at Sermeq Kujalleq is partially offset by a large increase in the second-largest contributor, Helheim Gletsjer (Helheim Glacier; Fig. [[fig:discharge_ts_topfew]]), and a small increase in the third-largest contributor, Kangerlussuaq citep:bevan_2019_impact. Helheim discharged more ice than Sermeq Kujalleq in early 2018 and for all data estimates to date (through March) in 2020, although error bars still overlap.

* Discussion

Different ice discharge estimates among studies likely stem from three categories: 1) changes in true discharge, 2) different input data (ice thickness and velocity), and 3) different assumptions and methods used to analyze data. Improved estimates of true discharge are the goal of this and many other studies, but changes in true discharge (category 1) can happen only when a work extends a time series into the future because historical discharge is fixed. Thus, any interstudy discrepancies in historical discharge must be due to category 2 (different data) or category 3 (different methods). Most studies use both updated data and new or different methods, but do not always provide sufficient information to disentangle the two. This is inefficient. To more quantitatively discuss interstudy discrepancies, it is imperative to explicitly consider all three potential causes of discrepancy. Only when results are fully reproducible -- meaning all necessary data and code are available (cf. citet:mankoff_2017_past,rezvanbehbahani_2017_predicting,mankoff_2019_ice) -- can new works confidently attribute discrepancies relative to old works. Therefore, in addition to providing new discharge estimates, we attempt to examine discrepancies among our estimates and other recent estimates. Without access to code and data from previous studies, it is challenging to take this examination beyond a qualitative discussion.

The algorithm-generated gates we present offer some advantages over traditional handpicked gates. Our gates are shared publicly, are generated by code that can be audited by others, and are easily adjustable within the algorithmic parameter space. This both allows sensitivity testing of gate location (Fig. [[fig:heatmap]]) and allows gate positions to systematically evolve with glacier termini (not done here).

** Comparison with past studies                           :ignore:

The total ice discharge we estimate is ~10 % less than the total discharge of two previous estimates citep:mouginot_2019_forty,enderlin_2014_improved, and similar to that of citet:king_2018_seasonal, who attributes their discrepancy with citet:enderlin_2014_improved to the latter using only summer velocities, which have higher annual average values than seasonally comprehensive velocity products. The gate locations also differ among studies, and glaciers with baseline velocity less than 100 m yr^{-1} are not included in our study due to our velocity cutoff threshold, but this should not lead to substantially different discharge estimates (Fig. [[fig:heatmap]]).

Our gate selection algorithm also does not place gates in northeast Greenland at Storstrømmen, Bredebræ (Bredebrae), or their confluence, because during the baseline period that surge glacier was in a slow phase. We do not manually add gates at these glaciers. The last surge ended in 1984 citep:reeh_1994_surge,mouginot_2018_insights, prior to the beginning of our time series, and these glaciers are therefore not likely to contribute substantial discharge even in the early period of discharge estimates.

We instead attribute the majority of our discrepancy with citet:enderlin_2014_improved to the use of differing bed topography in southeast Greenland. When we compare our top 10 highest discharging glaciers in 2000 with those reported by citet:enderlin_2014_improved, we find that the Køge Bugt (also knows as Køge Bay) discharge reported by citet:enderlin_2014_improved is ~31 Gt, but our estimate is only ~16 Gt (~17 Gt in citet:king_2018_seasonal, and similar in citet:mouginot_2019_forty). The citet:bamber_2013_bed bed elevation dataset that likely uses the same bed data employed by citet:enderlin_2014_improved has a major depression in the central Køge Bugt bed. This region of enhanced ice thicknesses is not present in the BedMachine dataset that we, citet:king_2018_seasonal, and citet:mouginot_2019_forty employ (Fig. [[fig:koge_bugt_bamber]]). If the Køge Bugt gates of citet:enderlin_2014_improved are in this location, then those gates overlie citet:bamber_2013_bed ice thicknesses that are about twice those reported in BedMachine v3. With all other values held constant, this results in roughly twice the discharge. Although we do not know whether BedMachine or citet:bamber_2013_bed is more correct, conservation of mass suggests that a substantial subglacial depression should be evident as either depressed surface elevation or velocity citep:morlighem_2016_improving.

We are unable to attribute the remaining discrepancy between our discharge estimates and those by citet:enderlin_2014_improved. It is likely a combination of different seasonal velocity sampling citep:king_2018_seasonal, our evolving surface elevation from citet:khan_2016_geodetic, or other previously unpublished algorithmic or data differences, of which many possibilities exist.

Our ice discharge estimates agree well with the most recently published discharge estimate (citet:king_2018_seasonal, also used by citet:bamber_2018_landice), except that our discharge is slightly less. We note that our uncertainty estimates include the citet:king_2018_seasonal estimates, but the opposite does not appear be true. The minor differences are likely due to different methods. citet:king_2018_seasonal use seasonally varying ice thicknesses, derived from seasonally varying surface elevations, and a Monte Carlo method to temporally interpolate missing velocity data to produce discharge estimates. In comparison, we use linear interpolation of both yearly surface elevation estimates and temporal data gaps. It is not clear whether linear or higher-order statistical approaches are best suited for interpolation as annual cycles begin to shift, as is the case with Sermeq Kujalleq (Jakobshavn Isbræ) after 2015. There are benefits and deficiencies with both methods. Linear interpolation may alias large changes if there are no other observations nearby in time. Statistical models of past glacier behavior may not be appropriate when glacier behavior changes.

It is unlikely that discharge estimates using gates that are only approximately flow orthogonal and time invariant citep:king_2018_seasonal have large errors due to this, because it is unlikely that glacier flow direction changes significantly, but our gate-orthogonal treatment may be the cause of some differences among our approach and other works. Discharge calculated using nonorthogonal methodology would overestimate true discharge.

* Data availability

This work in its entirety is available at doi:10.22008/promice/data/ice_discharge citep:GEUS_discharge_paper. The glacier-scale, sector, region, and Greenland summed ice sheet discharge dataset is available at doi:10.22008/promice/data/ice_discharge/d/v02 citep:GEUS_discharge_paper_d, where it will be updated as more velocity data become available. The gates can be found at doi:10.22008/promice/data/ice_discharge/gates/v02 citep:GEUS_discharge_paper_gates, the code at doi:10.22008/promice/data/ice_discharge/code/v0.0.1 citep:GEUS_discharge_paper_code, and the surface elevation change at doi:10.22008/promice/data/DTU/surface_elevation_change/v1.0.0 citep:GEUS_discharge_paper_elevation_change.

* Conclusions

We have presented a novel dataset of flux gates and a 1986 through 2019 glacier-scale ice discharge estimate for the Greenland Ice Sheet. These data are underpinned by an algorithm that both selects gates for ice flux and then computes ice discharges. 

Our results are similar to the most recent discharge estimate citep:king_2018_seasonal but begin in 1986 - although there are fewer samples prior to 2000. From our discharge estimate we show that over the past ~30 years, ice sheet discharge was ~440 Gt yr^{-1} prior to 2000, rose to over 500 Gt yr^{-1} from 2000 to 2005, and has held roughly steady since 2005 at near 500 Gt yr^{-1}. However, when viewed at a region or sector scale, the system appears more dynamic with spatial and temporal increases and decreases canceling each other out to produce the more stable ice sheet discharge. We note that there does not appear to be any dynamic connection among the regions, and any increase in one region that was offset by a decrease in another has likely been due to chance. If in coming years when changes occur the signals have matching signs, then ice sheet discharge would decrease or increase, rather than remain fairly steady.

The application of our flux gate algorithm shows that ice-sheet-wide discharge varies by ~30 Gt yr^{-1} due only to gate position, or ~40 Gt yr^{-1} due to gate position and cutoff velocity (Fig. [[fig:heatmap]]). This variance is approximately equal to the uncertainty associated with ice sheet wide discharge estimates reported in many studies (e.g. citet:rignot_2008_mass,andersen_2015_basin-scale,kjeldsen_2015_spatial). We highlight a major discrepancy with the ice discharge data of citet:enderlin_2014_improved and we suspect this discharge discrepancy -- most pronounced in southeast Greenland -- is associated with the choice of digital bed elevation model, specifically a deep hole in the bed at Køge Bugt.

Transparency in data and methodology are critical to move beyond a focus of estimating discharge quantities, towards more operational mass loss products with realistic errors and uncertainty estimates. The convention of devoting a paragraph, or even page, to methods is insufficient given the complexity, pace, and importance of Greenland Ice Sheet research citep:catania_2020. Therefore the flux gates, discharge data, and the algorithm used to generate the gates, discharge, and all figures from this paper are available. We hope that the flux gates, data, and code we provide here is a step toward helping others both improve their work and discover the errors in ours.

* Other                                                   :ignore:

#+BEGIN_authorcontribution
\ KDM conceived of the algorithm approach, and wrote the code. KDM , WIC, and RSF iterated over the algorithm results and methods. ASO provided the velocity data. SAK supplied the surface elevation change data. All authors contributed to the scientific discussion, writing, and editing of the manuscript. 
#+END_authorcontribution


#+BEGIN_competinginterests
\ The authors declare that they have no conflict of interest.
#+END_competinginterests


#+BEGIN_acknowledgements
We thank contributors and co-authors of previous versions of this paper, and the reviewers and editors for their constructive input that helped improve the paper. Andy Aschwanden helped improve metadata. Sentinel ice velocity maps were produced from Copernicus Sentinel-1 image data, processed by ESA data as part of PROMICE, and were provided by the Geological Survey of Denmark and Greenland (GEUS) at http://www.promice.org.
#+END_acknowledgements

#+BEGIN_financialsupport
This research has been supported by the Programme for Monitoring of the Greenland Ice Sheet (PROMICE) and the European Union's Horizon 2020 research and innovation program (INTAROS, grant no. 727890).
#+END_financialsupport


* References                                              :ignore:

#+LaTeX: \bibliographystyle{copernicus}
# #+LaTeX: \bibliography{/home/kdm/Documents/Papers/library,local}{}
# #+LaTeX: \bibliography{local}{}
#+LaTeX: \bibliography{ice_discharge}{}

* Figures
:PROPERTIES:
:clearpage: t
:END:
** Overview                                               :ignore:

#+NAME: fig:overview
#+ATTR_LATEX: :width 0.4\textwidth :placement [!h]
#+CAPTION: Overview showing fast-flowing ice (orange, greater than 100 m yr^{-1}) and the gates for eight major discharging glaciers (Fig. [[fig:discharge_ts_topfew]]). Gates are shown as black lines in inset images. Each inset is 30 x 30 km and they all have the same color scaling, but different from the main map. Insets pair with nearest label and box. On the main map, regions from citet:mouginot_2019_glacier are designated by thicker black lines and large bold labels. Sectors (same source) are delineated with thinner gray lines, and eight major discharging glaciers are labeled with smaller font. H = Helheim Gletsjer (Helheim Glacier), KB = Køge Bugt (Køge Bay), KG = Kangerlussuaq Gletsjer (Kangerlussuaq Glacier), KS = Kangilliup Sermia (English: Rink Glacier; Danish: Rink Isbræ), N = Nioghalvfjerdsbræ, P = Petermann Gletsjer (Petermann Glacier), SK = Sermeq Kujalleq (English: Jakobshavn Glacier; Danish: Jakobshavn Isbræ), and Z = Zachariae Isstrøm. Basemap terrain (gray), ocean bathymetry (blues), and ice mask (white) come from BedMachine.
[[./figs/overview.png]]


** Heatmap                                                :ignore:

#+NAME: fig:heatmap
#+ATTR_LATEX: :width \textwidth :placement [!h]
#+CAPTION: Heatmap and table showing ice sheet discharge as a function of gate buffer distance and ice speed cutoff. The colors of the numbers change for readability.
[[./figs/heatmap_all.png]]


** Ice Thickness v. Velocity 2D Histogram: Color = count  :ignore:

#+BEGIN_SRC jupyter-python :session histogram2D :exports none
import matplotlib
import matplotlib as mpl

if "LOADED" not in locals():
    <<load_data>>
    <<millan_2018>>
    <<adjust_thickness>>
    <<adjust_thickness_fit>>
    LOADED=True

plt.close(1)
fig = plt.figure(1, figsize=(8,4)) # w,h
# get_current_fig_manager().window.move(0,0)
fig.clf()
# fig.set_tight_layout(True)

ax1 = fig.add_subplot(121)
thick = th['thick']
thick[thick < 1] = 1
im = ax1.hexbin(vel_baseline['vel'].values, thick,
               gridsize=(40,25),
               norm=mpl.colors.LogNorm(),
               vmin=1, vmax=100,
               xscale='log', yscale='log',
               linewidths=0.01,
               edgecolors='k',  mincnt=1)
ax1.set_ylabel('Thickness [m]')
ax1.set_xlabel('Velocity [m yr$^{-1}$]')
# cb = fig.colorbar(im, ax=ax1, extend='max')
# cb.set_label('Count [#]')

ax2 = fig.add_subplot(122)
im = ax2.hexbin(vel_baseline['vel'].values, th['fit'],
               gridsize=(40,25),
               norm=mpl.colors.LogNorm(),
               vmin=1, vmax=100,
               extent=[2,4,0,3],
               xscale='log', yscale='log',
                linewidths=0.01,
               edgecolors='k',  mincnt=1)
#ax2.set_ylabel('Thickness [m]')
#ax2.set_xlabel('Velocity [m yr$^{-1}$]')
cb = fig.colorbar(im, ax=[ax1,ax2], extend='max')
cb.set_label('Count [#]')

from adjust_spines import adjust_spines as adj
adj(ax1, ['left','bottom'])
adj(ax2, ['bottom'])

plt.savefig('./figs/h_v_histogram.png', transparent=True, dpi=300, bbox_inches='tight')
#+END_SRC

#+NAME: fig:h_v_histogram
#+ATTR_LATEX: :height 0.5\textwidth
#+CAPTION: Two-dimensional histogram of velocity and thickness at all gate pixels. Left panel: Unadjusted (BedMachine & citet:millan_2018_vulnerability) thickness. Right panel: Adjusted (as described in the text) thickness.
[[./figs/h_v_histogram.png]]




** Discharge Time Series                                  :ignore:

#+NAME: fig:discharge_ts
#+ATTR_LATEX: :width \textwidth :placement [!h]
#+CAPTION: Bottom panel: Time series of ice discharge from the Greenland Ice Sheet. Dots represent when observations occurred (limited to coverage > 50 %). Orange stepped line is annual average (limited to three or more observations in a year). Coverage (percentage of total discharge observed at any given time) is shown in the top panel and also by the opacity of the dots' interior and error bars on lower panel. When coverage is < 100 %, total discharge is estimated and shown.
[[./figs/discharge_ts.png]]

** Discharge Time Series: Regions                         :ignore:

#+NAME: fig:discharge_ts_regions
#+ATTR_LATEX: :width \textwidth :placement [!h]
#+CAPTION: Bottom panel: Time series of ice discharge by region. Same graphical properties as Fig. [[fig:discharge_ts]].
[[./figs/discharge_ts_regions.png]]

** Discharge Time Series: Top Few                         :ignore:

#+NAME: fig:discharge_ts_topfew
#+ATTR_LATEX: :width \textwidth :placement [!h]
#+CAPTION: Bottom panel: Time series of ice discharge showing the eight major discharging glaciers from Figure [[fig:overview]]. Same graphical properties as Fig. [[fig:discharge_ts]].
[[./figs/discharge_ts_topfew.png]]

* Appendix                                                :ignore:
#+LaTeX: \appendix
#+LaTeX: \clearpage

** Errors and uncertainties

Here we describe our error and uncertainty treatments. We begin with a brief philosophical discussion of common uncertainty treatments, our general approach, and then the influence of various decisions made throughout our analysis, such as gate location and treatments of unknown thicknesses.

# Throughout this work we have tried to use simple rather than complicated methods (e.g. linear interpolation rather than Monte Carlo simulations, or setting bad thickness directly to X m rather than via a convoluted self-correlation) and conservative (low) rather than aggressive (high) estimates (e.g. unknown thicknesses set to 300 \(\pm\) 300 m rather than ~400 \(\pm\) 70 m citep:enderlin_2014_improved).

Traditional and mathematically valid uncertainty treatments divide errors into two classes: systematic (bias) and random. The primary distinction is that systematic errors do not decrease with more samples, and random errors decrease as the number of samples or measurements increases. The question is then which errors are systematic and which are random. A common treatment is to decide that errors within a region are systematic and among regions are random. This approach has no physical basis - two glaciers a few hundred meters apart but in different regions are assumed to have random errors, but two glaciers thousands of kilometers apart but within the same region are assumed to have systematic errors. It is more likely the case that all glaciers narrower than some width or deeper than some depth have systematic errors even if they are on opposite sides of the ice sheet, if ice thickness is estimated with the same method (i.e. the systematic error is likely caused by the sensor and airplane, not the location of the glacier).

The decision to have \(R\) random samples (where \(R\) is the number of regions, usually ~18 based on citet:zwally_2012_sectors) is also arbitrary. Mathematical treatment of random errors means that, even if the error is 50 % 18 measurements reduce it to only 11.79 %.

#+BEGIN_SRC jupyter-python :session err_example :results output :exports none :eval no-export
import numpy as np
from uncertainties import unumpy
val = 1 # arbitrary
err = 1 # 100% error # also try with 0.5

x = []
xerr = []
for i in [1,2,10,18,100,176,267,5829]:
    u = np.sum(unumpy.uarray([val]*i, [err]*i))
    x.append(u.n)
    xerr.append(u.s)
    print(i, u.n, u.s, np.round(u.s/u.n*100,2))
#+END_SRC

#+RESULTS:
: 1 1.0 1.0 100.0
: 2 2.0 1.4142135623730951 70.71
: 10 10.0 3.1622776601683795 31.62
: 18 18.0 4.242640687119285 23.57
: 100 100.0 10.0 10.0
: 176 176.0 13.2664991614216 7.54
: 267 267.0 16.34013463836819 6.12
: 5829 5829.0 76.34788798650555 1.31

This reduction is unlikely to be physically meaningful. Our 173 sectors, 267 gates, and 5829 pixels means that, even if errors were 100 % for each, we could reduce it to 7.5, 6.1, or 1.3 % respectively. We note that the area error introduced by the common EPSG:3413 map projection is -5 % in the north and +8 % in the south. While this error is mentioned in some other works (e.g., citet:joughin_2018_greenland) it is often not explicitly mentioned.

We do not have a solution for the issues brought up here, except to discuss them explicitly and openly so that those, and our own, error treatments are clearly presented and understood to likely contain errors themselves. 

*** Invalid thickness

#+header: :eval no-export
#+NAME: tab:thick_adjust
#+BEGIN_SRC jupyter-python :display text/org :exports results :results value :session thick_adj :noweb yes

<<load_data>>
<<millan_2018>>
<<adjust_thickness>>

df = pd.DataFrame(index=pd.DataFrame(np.random.random(3)).describe().index.values)
df['Good pixels'] = vel_baseline.loc[~th['bad']].describe()
df['Bad pixels'] = vel_baseline.loc[th['bad']].describe()
df.index = [_.capitalize() for _ in df.index]
df.rename({"Min" : "Minimum", "Max" : "Maximum", "Std" : "SD"}, axis="rows", inplace=True)

# print("#+LATEX_ATTR: :placement [!h]")
# print("#+CAPTION: Statistics of pixels with and without valid thickness. Numbers represent speed (m yr^{-1}) except for the \"count\" row\label{tab:thick_adjust}.")
df.round(0).astype(np.int)
#+END_SRC

#+NAME: tab:thick_adjust
#+LATEX_ATTR: :placement [!h]
#+CAPTION: Statistics of pixels with and without valid thickness. Numbers represent speed (m yr^{-1}) except for the "count" row\label{tab:thick_adjust}.
#+RESULTS: tab:thick_adjust
|         | Good pixels | Bad pixels |
|---------+-------------+------------|
| Count   |        5205 |        624 |
| Mean    |         857 |        272 |
| SD      |        1117 |        239 |
| Minimum |         100 |        100 |
| 25%     |         236 |        130 |
| 50%     |         506 |        181 |
| 75%     |         995 |        291 |
| Maximum |       10044 |       1505 |

# src_jupyter-python{vel.shape[0]} {{{results(=5829=)}}}
# src_jupyter-python{(th['bad'] == False).sum()} {{{results(=5205=)}}}
# src_jupyter-python{th['bad'].sum()} {{{results(=624=)}}}
# src_jupyter-python{np.round(th['bad'].sum()/vel.shape[0]*100).astype(np.int)} {{{results(=11=)}}}

We assume ice thicknesses < 20 m are incorrect where ice speed is > 100 m yr^{-1}. Of 5829 pixels, 5205 have valid thickness, and 624 (11 %) have invalid thickness. However, the speed at the locations of the invalid thicknesses is generally much less (and therefore the assumed thickness is less), and the influence on discharge is less than an average pixel with valid thickness (Table [[tab:thick_adjust]]).

# src_jupyter-python{th['gates'].unique().size} {{{results(=267=)}}}
# src_jupyter-python{(th.groupby('gates').mean()['bad'] == 0).sum()} {{{results(=179=)}}}
# src_jupyter-python{np.round((th.groupby('gates').mean()['bad'] == 0).sum()/th['gates'].unique().size*100).astype(np.int)} {{{results(=67=)}}}
# src_jupyter-python{(th.groupby('gates').mean()['bad'] > 0).sum()} {{{results(=88=)}}}
# src_jupyter-python{np.round((th.groupby('gates').mean()['bad'] > 0).sum()/th['gates'].unique().size*100).astype(np.int)} {{{results(=33=)}}}
# src_jupyter-python{(th.groupby('gates').mean()['bad'] > 0.5).sum()} {{{results(=64=)}}}
# src_jupyter-python{(th.groupby('gates').mean()['bad'] == 1).sum()} {{{results(=62=)}}}
# src_jupyter-python{np.round((th.groupby('gates').mean()['bad'] == 1).sum()/th['gates'].unique().size*100).astype(np.int)} {{{results(=23=)}}}

When aggregating by gate, there are 267 gates. Of these, 179 (67 %) have no bad pixels and 88 (33 %) have some bad pixels, 64 have > 50 % bad pixels, and 62 (23 %) are all bad pixels.

We adjust these thickness using a poor fit (correlation coefficient: 0.3) of the log$_{10}$ of the ice speed to thickness where the relationship is known (thickness > 20 m). We set errors equal to one half the thickness (i.e. \(\sigma_H = \pm 0.5 \, H\)). We also test the sensitivity of this treatment to simpler treatments, and have the following five categories:

+ NoAdj :: No adjustments made. Assume BedMachine thicknesses are all correct.
+ NoAdj+Millan :: Same as NoAdj but using citet:millan_2018_vulnerability bed where available.
+ 300 :: If a gate has some valid pixel thicknesses, set the invalid thicknesses to the minimum of the valid thicknesses. If a gate has no valid thickness, set the thickness to 300 m.
+ 400 :: Set all thicknesses < 50 m to 400 m
+ Fit :: Use the thickness--speed relationship described above.

Table [[tab:thick_treatments]] shows the estimated baseline discharge to these four treatments:

#+header: :eval no-export
#+NAME: tab:thick_treatments
#+BEGIN_SRC jupyter-python :session thick_treat :exports results :results value
<<load_data>>
<<millan_2018>>
<<adjust_thickness>>
<<adjust_thickness_fit>>
<<discharge_th>>

D_tmp = D_th.sum(axis=0).astype(np.int).astype(np.str)

df = pd.DataFrame(columns=['Discharge (Gt)'], index=['NoAdj','NoAdj+Millan',300,400,'Fit'])
df.loc['NoAdj'] = D_tmp['NoMillan'] + ' \pm ' + D_tmp['NoAdj_err']
df.loc['NoAdj+Millan'] = D_tmp['NoAdj'] + ' \pm ' + D_tmp['NoAdj_err']
df.loc[300] = D_tmp['300'] + ' \pm ' + D_tmp['300_err']
df.loc[400] = D_tmp['400'] + ' \pm ' + D_tmp['400_err']
df.loc['Fit'] = D_tmp['fit'] + ' \pm ' + D_tmp['fit_err']
df.index.name = 'Treatment'
# print("#+NAME: tab:thick_treatments")
# print('#+LATEX_ATTR: :placement [!h]')
# print('#+CAPTION: Effect of different thickness adjustments on baseline discharge\label{tab:thick_treatments}')
df
#+END_SRC

#+NAME: tab:thick_treatments
#+LATEX_ATTR: :placement [!h]
#+CAPTION: Effect of different thickness adjustments on baseline discharge\label{tab:thick_treatments}
#+RESULTS: tab:thick_treatments
| Treatment    | Discharge (Gt) |
|--------------+----------------|
| NoAdj        | 472 \pm 49     |
| NoAdj+Millan | 481 \pm 49     |
| 300          | 489 \pm 49     |
| 400          | 495 \pm 52     |
| Fit          | 493 \pm 51     |


Finally, Figure [[fig:gate_map]] shows the geospatial locations, concentration, and speed of gates with and without bad pixels.

#+NAME: fig:gate_map
#+ATTR_LATEX: :width \textwidth :placement [!h]
#+CAPTION: Gate locations and thickness quality. Left: locations of all gates. Black dots represent gates with 100 % valid thickness pixels, blue with partial, and red with none. Top right: Percent of bad pixels in each of the 267 gates, arranged by region. Bottom panel: Average speed of gates. Color same as left panel.
[[./figs/gate_map.png]]


*** Missing velocity
\label{sec:uncertain_vel}

We estimate discharge at all pixel locations for any time when there exists any velocity product. Not every velocity product provides velocity estimates at all locations, and we fill in where there are gaps by linearly interpolating velocity at each pixel in time. We calculate coverage, the discharge-weighted percent of observed velocity at any given time (Figure [[fig:coverage_schematic]]), and display coverage as 1) line plots over the time series graphs, 2) opacity of the error bars and 3) opacity of the infilling of time series dots. Linear interpolation and discharge-weighted coverage is illustrated in Figure [[fig:coverage_schematic]], where pixel A has a velocity value at all three times, but pixel B has a filled gap at time \(t_3\). The concentration of valid pixels is 0.5, but the weighted concentration, or coverage, is 9/11 or ~0.82. When displaying these three discharge values, \(t_1\) and \(t_4\) would have opacity of 1 (black), and \(t_3\) would have opacity of 0.82 (dark gray).

# Because velocity uncertainty is << thickness uncertainty (see next section) we do estimate a velocity uncertainty for our gap-filled velocities.

This treatment is applied at the pixel level and then weight averaged to the gate, sector, region, and ice sheet results.


#+BEGIN_SRC bash :results verbatim
inkscape -z ./figs/gate_weight_schematic.svg -e ./figs/gate_weight_schematic.png
#+END_SRC


#+NAME: fig:coverage_schematic
#+ATTR_LATEX: :width 0.33\textwidth :placement [!h]
#+CAPTION: Schematic demonstrating coverage. Velocities are filled with linear interpolation in time, and coverage is weighted by discharge. \(t\) columns represent the same two gate pixels (A & B) at three time steps, where \(t_n\) values are linearly spaced, but \(t_2\) is not observed anywhere on the ice sheet and therefore not included. Numbers in boxes represent example discharge values. The gray parenthetical number is filled, not sampled, in pixel B at time t\(_3\). Weighted filling computes the coverage as 9/11 = \(0.\overline{81}\), instead of 0.5 (half of the pixels at time t\(_3\) have observations).
[[./figs/gate_weight_schematic.png]]


*** Errors from map projection                          :noexport:
#+LaTeX: \label{sec:uncertain_map}

Our work takes place in a projected coordinate system (EPSG 3413) and therefore errors are introduced between the "true" earth spheroid (which is itself an approximation) and our projected coordinates system. We address these by calculating the projection error due to EPSG 3413 which is approximately +8 % in Northern Greenland and -6 % in Southern Greenland, and multiplying variables by a scaling factor if the variables do not already take this into account. Velocities are "true velocities" and not scaled, but the nominal 200 m gate width is scaled.

** Velocity versus thickness                            :noexport:
:PROPERTIES:
:clearpage: t
:END:

#+NAME: fig:h_v_histogram
#+ATTR_LATEX: :width \textwidth :placement [!h]
#+CAPTION: Thickness versus ice speed histogram. Points limited to discharge pixels.
[[./h_v_histogram.png]]


** Køge Bugt bed change between citet:bamber_2013_bed and citet:morlighem_2017_bedmachine
:PROPERTIES:
:clearpage: t
:END:

#+NAME: fig:koge_bugt_bamber
#+ATTR_LATEX: :width \textwidth :placement [!h]
#+CAPTION: Differences between BedMachine citep:morlighem_2017_bedmachine and citet:bamber_2013_bed near Køge Bugt. Panel (a) is baseline ice speed, (b) BedMachine thickness, (c) citet:bamber_2013_bed thickness, and (d) difference computed as BedMachine - Bamber. The curved line is the gate used in this work.
[[./figs/koge_bugt.png]]



** Sentinel-1 ice velocity maps
:PROPERTIES:
:CUSTOM_ID: sec:appendix:sentinel
:clearpage: t
:END:

We use ESA Sentinel-1 synthetic aperture radar (SAR) data to derive ice velocity maps covering the Greenland Ice Sheet margin using offset tracking citep:strozzi_2002_glacier assuming surface parallel flow using the digital elevation model from the Greenland Ice Mapping Project (GIMP DEM, NSIDC 0645) by citet:howat_2014_greenland,NSIDC_0645. The operational interferometric postprocessing (IPP) chain citep:dall_2015_ice,kusk_2018_system, developed at the Technical University of Denmark (DTU) Space and upgraded with offset tracking for ESA’s Climate Change Initiative (CCI) Greenland project, was employed to derive the surface movement. The Sentinel-1 satellites have a repeat cycle of 12 days, and due to their constellation, each track has a twelve-day repeat cycle. We produce a Greenland-wide product that spans two repeat cycles of Sentinel-1A. The product is a mosaic of all the ice velocity maps based on 12 day pairs produced from all the tracks from Sentinel-1A and 1B covering Greenland during those two cycles. The product thus has a total time span of 24 days. Twelve-day pairs are also included in each mosaic from track 90, 112 and 142 covering the ice sheet margin in the south as well as other tracks on an irregular basis in order to increase the spatial resolution. citet:rathmann_2017_highly and citet:vijay_2019_resolving have exploited the high temporal resolution of the product to investigate dynamics of glaciers. The maps are available from 2016-09-13 and onward, are updated regularly, and are available from http://promice.org.


** Software
:PROPERTIES:
:clearpage: t
:END:

This work was performed using only open-source software, primarily =GRASS GIS= citep:neteler_2012_GRASS and =Python= citep:van-rossum_1995_python, in particular the =Jupyter= citep:kluyver_2016_jupyter, =pandas= citep:mckinney_2010_pandas, =numpy= citep:oliphant_2006_numpy, =statsmodel= citep:seabold_2010_statsmodels, =x-array= citep:hoyer_2017_xarray, and =Matplotlib= citep:hunter_2007_matplotlib packages. The entire work was performed in =Emacs= citep:stallman_1981_emacs using =Org Mode= citep:schulte_2012_a-multi-language. The =parallel= citep:tange_2011_parallel tool was used to speed up processing. We used =proj4= citep:proj4 to compute the errors in the EPSG 3413 projection. All code used in this work is available in the Supplemental Material.

* Code                                                  :noexport:
:PROPERTIES:
:header-args:bash+: :comments both
:header-args:bash+: :tangle-mode (identity #o544)
:header-args:bash+: :shebang #!/usr/bin/env bash
:END:
** Makefile
:PROPERTIES:
:CUSTOM_ID: sec:makefile
:END:

This code, and all code files in this project, are derived products tangled from the ice_discharge.org source file.

#+BEGIN_SRC makefile :tangle Makefile :eval no
all: G run dist

G:
	grass -e -c EPSG:3413 ./G

run: FORCE
	grass ./G/PERMANENT --exec ./import.sh
	grass ./G/PERMANENT --exec ./gate_IO_runner.sh
	grass ./G/PERMANENT --exec ./vel_eff.sh
	grass ./G/PERMANENT --exec ./export.sh
	python ./errors.py
	python ./raw2discharge.py
	python ./csv2nc.py
	grass ./G/PERMANENT --exec ./gate_export.sh
	python ./figures.py

dist:
	ln -s out ice_discharge
	zip -r ice_discharge.zip ice_discharge
	rm ice_discharge

FORCE: # dummy target

clean:
	rm -fR G tmp out ice_discharge.zip
#+END_SRC

** Misc Helper
*** Support pretty messages
#+NAME: MSGS_pretty_print
#+BEGIN_SRC bash :results verbatim :tangle no
RED='\033[0;31m'
ORANGE='\033[0;33m'
GREEN='\033[0;32m'
NC='\033[0m' # No Color
MSG_OK() { printf "${GREEN}${1}${NC}\n"; }
MSG_WARN() { printf "${ORANGE}WARNING: ${1}${NC}\n"; }
MSG_ERR() { echo "${RED}ERROR: ${1}${NC}\n" >&2; }
#+END_SRC

*** GRASS config

https://grass.osgeo.org/grass74/manuals/variables.html

#+BEGIN_QUOTE
GRASS_VERBOSE
[all modules]
toggles verbosity level
-1 - complete silence (also errors and warnings are discarded)
0 - only errors and warnings are printed
1 - progress and important messages are printed (percent complete)
2 - all module messages are printed
3 - additional verbose messages are printed
#+END_QUOTE

#+NAME: GRASS_config
#+BEGIN_SRC bash :results verbatim :tangle no
export GRASS_VERBOSE=3
# export GRASS_MESSAGE_FORMAT=silent

if [ -z ${DATADIR+x} ]; then
    echo "DATADIR environment varible is unset."
    echo "Fix with: \"export DATADIR=/path/to/data\""
    exit 255
fi

set -x # print commands to STDOUT before running them

trap ctrl_c INT
function ctrl_c() {
  MSG_WARN "Caught CTRL-C"
  MSG_WARN "Killing process"
  kill -term $$ # send this program a terminate signal
}
#+END_SRC

** Import Data
:PROPERTIES:
:header-args:bash+: :tangle import.sh
:END:

#+BEGIN_SRC bash :results verbatim 
<<MSGS_pretty_print>>
<<GRASS_config>>
#+END_SRC

*** Bed and Surface
**** BedMachine v3
+ from [[textcite:Morlighem:2017BedMachine][Morlighem /et al./ (2017)]]
#+BEGIN_SRC bash :results verbatim
MSG_OK "BedMachine"
g.mapset -c BedMachine

for var in mask surface thickness bed errbed; do
  echo $var
  r.external source=netCDF:${DATADIR}/Morlighem_2017/BedMachineGreenland-2017-09-20.nc:${var} output=${var}
done

r.colors -a map=errbed color=haxby

g.mapset PERMANENT
g.region raster=surface@BedMachine res=200 -a -p
g.region -s
g.mapset BedMachine
g.region -dp

r.colors map=mask color=haxby

r.mapcalc "mask_ice = if(mask == 2, 1, null())"
#+END_SRC

**** Bamber 2013
#+BEGIN_SRC bash :results verbatim
MSG_OK "Bamber 2013"
g.mapset -c Bamber_2013
r.in.gdal input=${DATADIR}/Bamber_2013/IceThickness.tif output=thickness
r.null thickness null=0
#+END_SRC

**** Millan 2018
#+BEGIN_SRC bash :results verbatim
MSG_OK "Millan 2018"
g.mapset -c Millan_2018

x=2760
y=4044
res=150

# ###
# ### OLD
# ###
# FILE=Bathy_SEG_OIB_Millan_et_al_2018.nc
# # from the netcdf metadata, but x/y are swapped:
# n="-2616623"
# w="-109213.637"
# e=$(echo "$w + $x*$res" | bc -l)
# s=$(echo "$n - $y*$res" | bc -l)
# g.region e=$e w=$w s=$s n=$n res=$res -pl
# r.in.gdal -o input=netCDF:${ROOT}/${FILE}:BED output=BED_OLD
# r.region -c map=BED_OLD

###
### NEW
###
FILE=Bathy_SEG_OIB_Millan_et_al_2018_08082018.nc
n="-2616698.800"  # ymax
w="-109288.637" # xmin
e=$(echo "$w + $x*$res" | bc -l)
s=$(echo "$n - $y*$res" | bc -l)
g.region e=$e w=$w s=$s n=$n res=$res -pl
r.in.gdal -o input=netCDF:${DATADIR}/Millan_2018/${FILE}:BED output=BED_NEW
r.region -c map=BED_NEW

r.in.gdal -o input=netCDF:${DATADIR}/Millan_2018/${FILE}:THICKNESSGimp output=THICKNESS
r.region -c map=THICKNESS

g.region -d
r.mapcalc "bed_0 = BED_NEW"
r.null map=bed_0 null=0
r.mapcalc "thickness_0 = THICKNESS"
r.null map=thickness_0 null=0
#+END_SRC

***** Testing Old v. New (Millan)
#+BEGIN_SRC bash :results verbatim :tangle no
d.mon start=wx0
d.erase
d.rast bed@BedMachine
r.colors map=BED color=viridis
d.rast BED_OLD
d.rast BED_NEW

r.mapcalc "diff_old = BED_OLD - bed@BedMachine"
r.mapcalc "diff_new = BED_NEW - bed@BedMachine"
r.colors map=diff_old,diff_new color=differences
d.rast diff_old
d.rast diff_new
d.vect gates_final@gates_50_2500
#+END_SRC

***** Testing Millan v. BedMachine for Ikertivaq
#+BEGIN_SRC bash :results verbatim :tangle no
d.mon start=wx0
d.erase
d.rast bed@BedMachine
d.rast thickness@BedMachine

r.mapcalc "thickness = surface@BedMachine - BED_NEW"
d.rast thickness
d.rast diff_new

d.vect gates_final@gates_50_2500

g.copy vector=gates_final@gates_50_2500,gates
#+END_SRC

**** GIMP 0715
#+BEGIN_SRC bash :results verbatim
MSG_OK "GIMP 0715"
g.mapset -c GIMP.0715
ROOT=${DATADIR}/GIMP/0715

# reset
# g.remove -f type=raster name=$(g.list type=raster mapset=. separator=",")

# read in DEM, DAY, and ERR
# for f in $(ls ${ROOT}/reg/tile_?_?_reg_30m_???.tif); do
#   name=$(basename ${f})
#   r.external input=${f} output=${name}
# done
ls ${ROOT}/reg/tile_?_?_reg_30m_???.tif | parallel --verbose --bar r.external input={} output={/.}
ls ${ROOT}/fit/tile_?_?_fit_30m_???.tif | parallel --verbose --bar r.external input={} output={/.}

r.patch -s input=$(g.list type=raster pattern=tile_?_?_reg_30m_dem separator=,),$(g.list type=raster pattern=tile_?_?_fit_30m_dem separator=,) output=dem

# no fit day data to patch holes. We'll assign elevation pixels with DEM data but not DAY data to some day, TBD
r.patch -s input=$(g.list type=raster pattern=tile_?_?_reg_30m_day separator=,) output=day

r.patch -s input=$(g.list type=raster pattern=tile_?_?_reg_30m_err separator=,),$(g.list type=raster pattern=tile_?_?_fit_30m_err separator=,) output=err

r.null map=day null=0
#+END_SRC

*** Sectors
**** Mouginot 2019
+ From citet:mouginot_2019_glacier
***** Import & Clean
#+BEGIN_SRC bash :results verbatim
MSG_OK "Mouginot 2019 sectors"

g.mapset -c Mouginot_2019
v.in.ogr input=${DATADIR}/Mouginot_2019 output=sectors_all
v.extract input=sectors_all where="NAME NOT LIKE '%ICE_CAP%'" output=sectors

db.select table=sectors | head
v.db.addcolumn map=sectors columns="region_name varchar(100)"
db.execute sql="UPDATE sectors SET region_name=SUBREGION1 || \"___\" || NAME"

v.to.db map=sectors option=area columns=area units=meters

mkdir -p ./tmp/
# db.select table=sectors > ./tmp/Mouginot_2019.txt

v.to.rast input=sectors output=sectors use=cat label_column=region_name
r.mapcalc "mask_GIC = if(sectors)"

# # regions map
v.to.rast input=sectors output=regions_tmp use=cat label_column=SUBREGION1
# which categories exist?
# r.category regions separator=comma | cut -d, -f2 | sort | uniq
# Convert categories to numbers
r.category regions_tmp separator=comma | sed s/NO/1/ | sed s/NE/2/ | sed s/CE/3/ | sed s/SE/4/ | sed s/SW/5/ | sed s/CW/6/ | sed s/NW/7/ > ./tmp/mouginot.cat
r.category regions_tmp separator=comma rules=./tmp/mouginot.cat
# r.category regions_tmp
r.mapcalc "regions = @regions_tmp"

# # region vector 
# r.to.vect input=regions output=regions type=area
# v.db.addcolumn map=regions column="REGION varchar(2)"
# v.what.vect map=regions column=REGION query_map=sectors query_column=SUBREGION1

# # mask
#+END_SRC

***** Test
#+BEGIN_SRC bash :results verbatim :tangle no
grass74 ./G/Mouginot_2019
d.mon start=wx0
d.rast regions
d.rast sectors
d.vect sectors_all fill_color=none color=red
d.vect sectors fill_color=none
#+END_SRC

**** Zwally 2012

I use an "expanded boundary" version. This was created by loading the Zwally sectors into QGIS and moving the coasts outward. This is done because some gates (ice) is outside the boundaries provided by Zwally.

#+BEGIN_SRC bash
g.mapset -c Zwally_2012
v.in.ogr input=${DATADIR}/Zwally_2012/sectors_enlarged output=Zwally_2012
#+END_SRC

*** 2D Area Error
+ EPSG:3413 has projection errors of \(\pm\) ~8% in Greenland
+ Method
  + Email: [[mu4e:msgid:m2tvxmd2xr.fsf@gmail.com][Re: {GRASS-user} scale error for each pixel]]
  + Webmail: https://www.mail-archive.com/grass-user@lists.osgeo.org/msg35005.html
#+BEGIN_SRC bash :results verbatim
MSG_OK "2D Area Error"
g.mapset PERMANENT

if [[ "" == $(g.list type=raster pattern=err_2D) ]]; then
    r.mask -r
    g.region -d

    g.region res=1000 -ap # do things faster
    r.mapcalc "x = x()"
    r.mapcalc "y = y()"
    r.latlong input=x output=lat_low
    r.latlong -l input=x output=lon_low

    r.out.xyz input=lon_low,lat_low separator=space > ./tmp/llxy.txt
    PROJSTR=$(g.proj -j)
    echo $PROJSTR

    paste -d" " <(cut -d" " -f1,2 ./tmp/llxy.txt) <(cut -d" " -f3,4 ./tmp/llxy.txt | proj -VS ${PROJSTR} | grep Areal | column -t | sed s/\ \ /,/g | cut -d, -f4) > ./tmp/xy_err.txt

    r.in.xyz input=./tmp/xy_err.txt  output=err_2D_inv separator=space
    r.mapcalc "err_2D = 1/(err_2D_inv^0.5)" # convert area error to linear multiplier error
    g.region -d

    r.latlong input=x output=lat # for exporting at full res
    r.latlong -l input=x output=lon
fi

# sayav done
g.region -d
#+END_SRC

*** Velocity
**** MEaSUREs 
+ See: [[file:~/data/MEaSUREs/README.org][MEaSUREs README]]

+ [X] 0478 :: 2000 -- 2017 annual average
+ [ ] 0481 :: 6-11 day velocity
+ [X] 0646 :: Monthly velocity - sparse glacier coverage 1985 through 2016
+ [ ] 0670 :: 1995 -- 2015 average
+ [ ] 0725 :: 2015 & 2016 annual average
+ [X] 0731 :: Monthly  ice sheet velocity 2015 through 2018

***** 0478.002 
+ MEaSUREs Greenland Ice Sheet Velocity Map from InSAR Data, Version 2
+ Winter velocity maps
****** Import
+ First read in the 200 m files
+ Then read in the 500 m files if there were no 200 m files
#+BEGIN_SRC bash :results verbatim
MSG_OK "MEaSURES.0478"
g.mapset -c MEaSUREs.0478

MSG_OK "  200 m..."
r.mask -r
ROOT=${DATADIR}/MEaSUREs/NSIDC-0478.002/
VX=$(find ${ROOT} -name "*mosaic200_*vx*.tif" | head -n1) # DEBUG
for VX in $(find ${ROOT} -name "*mosaic200_*vx*.tif" | LC_ALL=C sort); do
  VY=${VX/vx/vy}
  EX=${VX/vx/ex}
  EY=${EX/ex/ey}
  DATE=$(dirname ${VX} | rev | cut -d"/" -f1 | rev | sed s/\\./_/g)
  # echo $DATE
  # need to import not link to external so that we can set nulls to 0
  parallel --verbose --bar r.in.gdal input={1} output={2}_${DATE} ::: ${VX} ${VY} ${EX} ${EY} :::+ VX VY EX EY
  parallel --verbose --bar r.null map={}_${DATE} null=0 ::: VX VY EX EY
done
g.region raster=VX_${DATE} -pa

MSG_OK "  500 m..."
VX=$(find ${ROOT} -name "*mosaic500_*vx*.tif" | head -n1) # DEBUG
for VX in $(find ${ROOT} -name "*mosaic500_*vx*.tif" | LC_ALL=C sort); do
  VY=${VX/vx/vy}
  EX=${VX/vx/ex}
  EY=${EX/ex/ey}
  DATE=$(dirname ${VX} | rev | cut -d"/" -f1 | rev | sed s/\\./_/g)
  echo $DATE

  # Read in all the 500 m velocity data
  parallel --verbose --bar r.external source={1} output={2}_${DATE}_500 ::: ${VX} ${VY} ${EX} ${EY} :::+ VX VY EX EY 
  # If the 200 m data exists, will produce an error and continue
  # If the 200 m data does not exist, will resample from 500
  r.mapcalc "VX_${DATE} = VX_${DATE}_500"
  r.mapcalc "VY_${DATE} = VY_${DATE}_500"
  r.mapcalc "EX_${DATE} = EX_${DATE}_500"
  r.mapcalc "EY_${DATE} = EY_${DATE}_500"
  parallel --verbose --bar r.null map={}_${DATE} null=0 ::: VX VY EX EY
done
#+END_SRC

****** Baseline: Average of 2015-2017
#+BEGIN_SRC bash :results verbatim
MSG_OK "Baseline"
g.mapset -c MEaSUREs.0478

r.series input=VX_2015_09_01,VX_2016_09_01,VX_2017_09_01 output=vx_baseline method=average range=-1000000,1000000
r.series input=VY_2015_09_01,VY_2016_09_01,VY_2017_09_01 output=vy_baseline method=average range=-1000000,1000000

r.series input=EX_2015_09_01,EX_2016_09_01,EX_2017_09_01 output=ex_baseline method=average range=-1000000,1000000
r.series input=EY_2015_09_01,EY_2016_09_01,EY_2017_09_01 output=ey_baseline method=average range=-1000000,1000000

r.mapcalc "vel_baseline = sqrt(vx_baseline^2 + vy_baseline^2)"
r.mapcalc "vel_err_baseline = sqrt(ex_baseline^2 + ey_baseline^2)"

parallel --verbose --bar r.null map={}_baseline setnull=0 ::: vx vy vel ex ey vel_err
r.colors -e map=vel_baseline,vel_err_baseline color=viridis
#+END_SRC

****** Fill in holes
+ There are holes in the velocity data which will create false gates. Fill them in.
+ Clump based on yes/no velocity
  + Largest clump is GIS
  + 2nd largest is ocean
+ Mask by ocean (so velocity w/ holes remains)
+ Fill holes
#+BEGIN_SRC bash :results verbatim
r.mask -r
r.mapcalc "no_vel = if(isnull(vel_baseline), 1, null())"
r.mask no_vel
r.clump input=no_vel output=no_vel_clump --o
ocean_clump=$(r.stats -c -n no_vel_clump sort=desc | head -n1 | cut -d" " -f1)
r.mask -i raster=no_vel_clump maskcats=${ocean_clump} --o
r.fillnulls input=vel_baseline out=vel_baseline_filled method=bilinear
r.mask -r
g.rename raster=vel_baseline_filled,vel_baseline --o
r.colors map=vel_baseline -e color=viridis
#+END_SRC

******* Display
#+BEGIN_SRC bash :results verbatim :tangle no
d.mon start=wx0
d.erase
d.rast vel
d.rast vel_filled
#+END_SRC

***** 0646.003
+ MEaSUREs Greenland Ice Velocity: Selected Glacier Site Velocity Maps from Optical Images, Version 2
+ Monthly velocity maps
****** Generate VRTs
+ One map per month
+ Build GDAL virtual tiles for every month (when data exists)
#+BEGIN_SRC bash :results verbatim
g.mapset -c MEaSUREs.0646

ROOT=${DATADIR}/MEaSUREs/NSIDC-0646.003/
VRTROOT=./tmp/NSIDC-0646.003.vrt/
mkdir -p ${VRTROOT}
for year in $(seq 1985 2018); do
  for month in $(seq -w 1 12); do
    if [[ ! -f ${VRTROOT}/${year}_${month}_vx.vrt ]]; then # VRT file does not exist?
      LIST=$(find ${ROOT} -name "*${year}-${month}_vx_*.tif" | LC_ALL=C sort)
      if [[ ! -z ${LIST} ]]; then
        MSG_OK "Building VRTs for ${year} ${month}"
        parallel --verbose --bar gdalbuildvrt -overwrite ${VRTROOT}/${year}_${month}_{}.vrt $\(find ${ROOT} -name "*${year}-${month}_{}_*.tif" \| LC_ALL=C sort\) ::: vx vy ex ey
      fi
    fi
  done
done
#+END_SRC

****** Import VRTs
#+BEGIN_SRC bash :results verbatim
MSG_OK "MEaSURES.0646"
g.mapset -c MEaSUREs.0646

r.mask -r
ROOT=./tmp/NSIDC-0646.003.vrt/
VX=$(find ${ROOT} -name "*vx*.vrt" | head -n1) # debug
for VX in $(find ${ROOT} -name "*vx*.vrt" | LC_ALL=C sort); do
    VY=${VX/vx/vy}
    EX=${VX/vx/ex}
    EY=${EX/ex/ey}
    DATE=$(basename $VX | cut -d"_" -f1-2)
    DATE=${DATE}_15
    echo $DATE
    
    parallel --verbose --bar r.external source={1} output={2}_${DATE} ::: ${VX} ${VY} ${EX} ${EY} :::+ VX VY EX EY
done
g.region raster=VX_${DATE} -pa
# g.list type=raster mapset=MEaSUREs.0646
#+END_SRC



***** 0731.001
MEaSUREs Greenland Monthly Ice Sheet Velocity Mosaics from SAR and Landsat, Version 1

****** Import
#+BEGIN_SRC bash :results verbatim
MSG_OK "MEaSURES.0731"
g.mapset -c MEaSUREs.0731
r.mask -r
ROOT=${DATADIR}/MEaSUREs/NSIDC-0731.001/
VX=$(find ${ROOT} -name "*mosaic_*vx*.tif" | head -n1) # DEBUG
for VX in $(find ${ROOT} -name "*mosaic_*vx*.tif" | LC_ALL=C sort); do
  VY=${VX/vx/vy}
  EX=${VX/vx/ex}
  EY=${EX/ex/ey}

  T0=$(dirname ${VX} | rev | cut -d"/" -f1 | rev|cut -d"_" -f4)
  T1=$(dirname ${VX} | rev | cut -d"/" -f1 | rev|cut -d"_" -f5)
  SEC0=$(date --utc --date="${T0}" +"%s")
  SEC1=$(date --utc --date="${T1}" +"%s")
  MID=$(echo "(${SEC0}+${SEC1})/2"|bc)
  DATE=$(date --utc --date="@${MID}" +"%Y_%m_%d")

  # echo $DATE
  parallel --verbose --bar r.external source={1} output={2}_${DATE} ::: ${VX} ${VY} ${EX} ${EY} :::+ VX VY EX EY
  parallel --verbose --bar r.null map={}_${DATE} null=0 ::: VX VY EX EY
done
g.region raster=VX_${DATE} -pa
#+END_SRC


**** Sentinel 1
***** Data Intro                                                   :noexport:
#+BEGIN_SRC bash :results verbatim :tangle no
DIR=${DATADIR}/Sentinel1/Sentinel1_IV_maps
(cd ${DIR}; ls *.nc | head)
(cd ${DIR}; ncdump -h $(ls *.nc | head -n1) | grep "float")
#+END_SRC

***** Import data                                                  :noexport:
+ Read in all the data
+ Conversion from [m day-1] to [m year-1] is done in section [[id:20210102T152009.186822][Just one velocity cutoff & buffer distance]]

#+NAME: sentinel1_import  
#+BEGIN_SRC bash :results verbatim
MSG_OK "Sentinel 1"
g.mapset -c Sentinel1
ROOT=${DATADIR}/Sentinel1/Sentinel1_IV_maps

find ${ROOT} -name "*.nc"
# FILE=$(find ${ROOT} -name "*.nc"|head -n1) # testing

FILE=$(find ${ROOT} -name "*.nc" | head -n1) # DEBUG
for FILE in $(find ${ROOT} -name "*.nc" | LC_ALL=C sort); do
  T=$(ncdump -v time $FILE | tail -n2 | tr -dc '[0-9]')
  DATE=$(date --utc --date="1990-01-01 +${T} days" --iso-8601)
  DATE_STR=$(echo ${DATE} | sed s/-/_/g)
  echo $DATE

  # TT=$(ncdump -v time_bnds $FILE | tail -n2 | head -n1)
  # T0=$(echo ${TT} | cut -d, -f1)
  # T1=$(echo ${TT} | cut -d, -f2 | tr -dc [0-9])
  # D0=$(date --date="1990-01-01 +${T0} days" --iso-8601)
  # D1=$(date --date="1990-01-01 +${T1} days" --iso-8601)

  r.external -o source="NetCDF:${FILE}:land_ice_surface_easting_velocity" output=vx_${DATE_STR}
  r.external -o source="NetCDF:${FILE}:land_ice_surface_northing_velocity" output=vy_${DATE_STR}

  r.external -o source="NetCDF:${FILE}:land_ice_surface_easting_velocity_std" output=ex_${DATE_STR}
  r.external -o source="NetCDF:${FILE}:land_ice_surface_northing_velocity_std" output=ey_${DATE_STR}
done
#+END_SRC

**** Mouginot 2018 (pre-2000 velocities)
+ See citet:mouginot_2018_1972to1990 and citet:mouginot_2018_1991to2000

#+BEGIN_SRC bash :results verbatim
MSG_OK "Mouginot pre 2000"
g.mapset -c Mouginot_pre2000

ROOT=${DATADIR}/Mouginot_2018/D1GW91
find ${ROOT} -name "*.nc"
FILE=$(find ${ROOT} -name "*.nc" | head -n1 | LC_ALL=C sort) # DEBUG
for FILE in $(find ${ROOT} -name "*.nc"); do
  YYYYMMDD=$(echo ${FILE} | cut -d"_" -f4)
  YEAR=$(echo ${YYYYMMDD} | cut -d"-" -f1)
  DATE=${YEAR}_01_01
  echo $DATE
  r.external -o source="NetCDF:${FILE}:VX" output=vx_${DATE}
  r.external -o source="NetCDF:${FILE}:VY" output=vy_${DATE}
done

# ROOT=${DATADIR}/Mouginot_2018/D1MM37
# find ${ROOT} -name "*.nc"
# FILE=$(find ${ROOT} -name "*.nc" | head -n1) # DEBUG
# for FILE in $(find ${ROOT} -name "*.nc"); do
#   YYYYMMDD=$(echo ${FILE} | cut -d"_" -f4)
#   YEAR=$(echo ${YYYYMMDD} | cut -d"-" -f1)
#   DATE=${YEAR}_01_01
#   echo $DATE
#   r.external -o source="NetCDF:${FILE}:VX" output=vx_${DATE}
#   r.external -o source="NetCDF:${FILE}:VY" output=vy_${DATE}
# done
#+END_SRC

***** Display
#+BEGIN_SRC bash :results verbatim :tangle no
d.mon start=wx0
g.list type=raster pattern=vx_*

d.erase; d.rast vx_1990-07-01
d.erase; d.rast vx_1991-07-01
d.erase; d.rast vx_1992-07-01
d.erase; d.rast vx_1993-07-01
d.erase; d.rast vx_1994-07-01
d.erase; d.rast vx_1995-07-01
d.erase; d.rast vx_1996-07-01
d.erase; d.rast vx_1997-07-01
d.erase; d.rast vx_1998-07-01
d.erase; d.rast vx_1999-07-01
#+END_SRC


*** Glacier Names
+ From [[textcite:Bjork:2015Brief][Bjørk /et al./ (2015)]].
+ Also use citet:mouginot_2019_glacier
**** Bjørk 2015
+ Write out x,y,name. Can use x,y and mean gate location to find closest name for each gate.
#+BEGIN_SRC bash :results verbatim
MSG_OK "Bjørk 2015"
g.mapset -c Bjork_2015

ROOT=${DATADIR}/Bjørk_2015/

cat ${ROOT}/GreenlandGlacierNames_GGNv01.csv |  iconv -c -f utf-8 -t ascii | grep GrIS | awk -F';' '{print $3"|"$2"|"$7}' | sed s/,/./g | m.proj -i input=- | sed s/0.00\ //g | v.in.ascii input=- output=names columns="x double precision, y double precision, name varchar(99)"

# db.select table=names | tr '|' ',' > ./tmp/Bjork_2015_names.csv
#+END_SRC
**** Mouginot 2019
#+BEGIN_SRC bash :results verbatim
g.mapset Mouginot_2019
db.select table=sectors | head
# v.out.ascii -c input=sectors output=./tmp/Mouginot_2019_names.csv columns=NAME,SUBREGION1
#+END_SRC


*** Elevation

+ h_0 (BedMachine v3) is assumed to be 2007
+ h_{\(\pm\) n} is based on elevation data from Shfaqat Abbas Khan. See [[file:${DATADIR}/Khan_2016/README.org]]
**** dh/dt
#+BEGIN_SRC bash :results verbatim
MSG_OK "dh/dt"

g.mapset -c Khan_2016
r.mask -r

g.region -d
g.region res=2000 -pa

cat << EOF > ./tmp/elev_filter.txt
TITLE     See r.mfilter manual
    MATRIX    3
    1 1 1
    1 1 1
    1 1 1
    DIVISOR   0
    TYPE      P
EOF

FILE=${DATADIR}/Khan_2016/dhdt_1995-2015_GrIS.txt
head -n1 $FILE
Y=1995 # debug
for Y in $(seq 1995 2010); do
  col=$(echo "$Y-1995+3" | bc -l)
  if [[ "" == $(g.list type=raster pattern=dh_${Y}) ]]; then
    # remove comments, leading spaces, and convert spaces to comma, swap lat,lon, then import
    cat ${FILE} | grep -v "^%" | sed s/^\ *//g | sed s/\ \ \*/,/g | cut -d"," -f1,2,${col} | awk -F, '{print $2 "|" $1 "|" $3}' | m.proj -i input=- | r.in.xyz input=- output=dh_${Y}_unfiltered
  fi
done


FILE=${DATADIR}/Khan_2016/GR_2011_2020.txt
head -n10 $FILE
Y=2011 # debug
for Y in $(seq 2011 2019); do
  col=$(echo "($Y-2011)*2 +3" | bc -l)
  echo $Y $col

  if [[ "" == $(g.list type=raster pattern=dh_${Y}) ]]; then
    # remove comments, leading spaces, and convert spaces to comma, swap lat,lon, then import
    cat ${FILE} | grep -v "^%" | sed s/^\ *//g | sed s/\ \ \*/,/g | cut -d"," -f1,2,${col} | awk -F, '{print $2 "|" $1 "|" $3}' | m.proj -i input=- | r.in.xyz input=- output=dh_${Y}_unfiltered
  fi
done

parallel "r.mfilter -z input=dh_{1}_unfiltered output=dh_{1} filter=./tmp/elev_filter.txt repeat=2" ::: $(seq 1995 2019)
parallel "r.colors map=dh_{1} color=difference" ::: $(seq 1995 2019)
#+END_SRC



** Find Gates
:PROPERTIES:
:header-args:bash+: :tangle gate_IO.sh
:END:

*** Algorithm
+ [X] Find all fast-moving ice (>X m yr^{-1})
  + Results not very sensitive to velocity limit (10 to 100 m yr^{-1} examined)
+ [X] Find grounding line by finding edge cells where fast-moving ice borders water or ice shelf based (loosely) on BedMachine mask
+ [X] Move grounding line cells inland by X km, again limiting to regions of fast ice.
  + Results not very sensitive to gate position (1 - 5 km range examined)

+ [X] Discard gates if group size \in [1,2]
+ [X] Manually clean a few areas (e.g. land-terminating glaciers, gates due to invalid masks, etc.) by manually selecting invalid regions in Google Earth, then remove gates in these regions

Note that "fast ice" refers to flow velocity, not the sea ice term of "stuck to the land".

INSTRUCTIONS: Set VELOCITY_CUTOFF and BUFFER_DIST to 50 and 2500 respectively and run the code. Then repeat for a range of other velocity cutoffs and buffer distances to get a range of sensitivities.

OR: Tangle via ((org-babel-tangle) the code below (C-c C-v C-t or ) to [[./gate_IO.sh]] and then run this in a GRASS session:
#+BEGIN_SRC bash :results verbatim :tangle gate_IO_runner.sh
<<MSGS_pretty_print>>
<<GRASS_config>>

VELOCITY_CUTOFF=100
BUFFER_DIST=5000
. ./gate_IO.sh
#+END_SRC

Create a new mapset for this specific velocity cutoff and buffer distance

#+BEGIN_SRC bash :results verbatim
g.mapset -c gates_${VELOCITY_CUTOFF}_${BUFFER_DIST}
g.region -d
#+END_SRC

From above:

+ [X] Find grounding line by finding edge cells where fast-moving ice borders water or ice shelf based (loosely) on BedMachine mask

The "loosely" is because the BedMachine mask doesn't always reach into each fjord all the way. I buffer the BedMachine mask by 2 km here so that it extends to the edge of the velocity data.

#+BEGIN_SRC bash :results verbatim
g.copy raster=mask_ice@BedMachine,mask_ice --o
# Grow by 2 km (10 cells @ 200 m/cell)
r.grow input=mask_ice output=mask_ice_grow radius=10 new=1 --o
r.mask mask_ice_grow
#+END_SRC

The fast ice edge is where there is fast-flowing ice overlapping with not-ice.

#+BEGIN_SRC bash :results verbatim
r.mapcalc "fast_ice = if(vel_baseline@MEaSUREs.0478 > ${VELOCITY_CUTOFF}, 1, null())" --o
r.mask -r

# no velocity data, or is flagged as ice shelf or land in BedMachine
r.mapcalc "not_ice = if(isnull(vel_baseline@MEaSUREs.0478) ||| (mask@BedMachine == 0) ||| (mask@BedMachine == 3), 1, null())" --o

r.grow input=not_ice output=not_ice_grow radius=1.5 new=99 --o
r.mapcalc "fast_ice_edge = if(((not_ice_grow == 99) && (fast_ice == 1)), 1, null())" --o
#+END_SRC

The gates are set ${BUFFER_DIST} inland from the fast ice edge. This is done by buffering the fast ice edge (which fills the space between the fast ice edge and buffer extent) and then growing the buffer by 1. This last step defines the gate locations.

However, in order to properly estimate discharge, the gate location is not enough. Ice must flow from outside the gates, through the gates, to inside the gates, and not flow from one gate pixel to another gate pixel (or it would be counted 2x). 

#+BEGIN_SRC bash :results verbatim
r.buffer input=fast_ice_edge output=fast_ice_buffer distances=${BUFFER_DIST} --o
r.grow input=fast_ice_buffer output=fast_ice_buffer_grow radius=1.5 new=99 --o
r.mask -i not_ice --o
r.mapcalc "gates_inside = if(((fast_ice_buffer_grow == 99) && (fast_ice == 1)), 1, null())" --o
r.mask -r

r.grow input=gates_inside output=gates_inside_grow radius=1.1 new=99 --o
r.mask -i not_ice --o
r.mapcalc "gates_maybe = if(((gates_inside_grow == 99) && (fast_ice == 1) && isnull(fast_ice_buffer)), 1, null())" --o
r.mask -r

r.grow input=gates_maybe output=gates_maybe_grow radius=1.1 new=99 --o
r.mask -i not_ice --o
r.mapcalc "gates_outside = if(((gates_maybe_grow == 99) && (fast_ice == 1) && isnull(fast_ice_buffer) && isnull(gates_inside)), 1, null())" --o
r.mask -r

r.mapcalc "gates_IO = 0" --o
r.mapcalc "gates_IO = if(isnull(gates_inside), gates_IO, 1)" --o
r.mapcalc "gates_IO = if(isnull(gates_outside), gates_IO, -1)" --o

r.colors map=gates_inside color=red
r.colors map=gates_maybe color=grey
r.colors map=gates_outside color=blue
r.colors map=gates_IO color=viridis
#+END_SRC

+ For each gate, split into two for the vector components of the velocity, then...
+ If flow is from gate to INSIDE, it is discharged
+ If flow is from gate to GATE, it is ignored
+ If flow is from gate to NOT(GATE || INSIDE) it is ignored
  + If gates are a closed loop, such as the 1700 m flight-line, then
    this scenario would be NEGATIVE discharge, not ignored. This was
    tested with the 1700 m flight-line and compared against both the
    vector calculations and WIC estimates.

#+NAME: tbl_velocity
| var            | value  | meaning           |
|----------------+--------+-------------------|
| vx             | > 0    | east / right      |
| vx             | < 0    | west / left       |
| vy             | > 0    | north / up        |
| vy             | < 0    | south / down      |
|----------------+--------+-------------------|
| GRASS indexing | [0,1]  | cell to the right |
|                | [0,-1] | left              |
|                | [-1,0] | above             |
|                | [1,0]  | below             |

#+BEGIN_SRC bash :results verbatim
# g.mapset -c gates_50_2500

r.mask -r

r.mapcalc "gates_x = 0" --o
r.mapcalc "gates_x = if((gates_maybe == 1) && (vx_baseline@MEaSUREs.0478 > 0), gates_IO[0,1], gates_x)" --o
r.mapcalc "gates_x = if((gates_maybe != 0) && (vx_baseline@MEaSUREs.0478 < 0), gates_IO[0,-1], gates_x)" --o

r.mapcalc "gates_y = 0" --o
r.mapcalc "gates_y = if((gates_maybe != 0) && (vy_baseline@MEaSUREs.0478 > 0), gates_IO[-1,0], gates_y)" --o
r.mapcalc "gates_y = if((gates_maybe != 0) && (vy_baseline@MEaSUREs.0478 < 0), gates_IO[1,0], gates_y)" --o

r.mapcalc "gates_x = if(gates_x == 1, 1, 0)" --o
r.mapcalc "gates_y = if(gates_y == 1, 1, 0)" --o

r.null map=gates_x null=0 # OR r.null map=gates_x setnull=0
r.null map=gates_y null=0 # OR r.null map=gates_y setnull=0
#+END_SRC
*** Clean Gates                                                    :noexport:
**** Subset to where there is known discharge
#+BEGIN_SRC bash :results verbatim
r.mapcalc "gates_xy_clean0 = if((gates_x == 1) || (gates_y == 1), 1, null())" --o
#+END_SRC

**** Remove small areas (clusters <X cells)
#+BEGIN_SRC bash :results verbatim
# Remove clusters of 2 or less. How many hectares in X pixels?
# frink "(200 m)^2 * 2 -> hectares" # ans: 8.0

r.clump -d input=gates_xy_clean0 output=gates_gateID --o
r.reclass.area -d input=gates_gateID output=gates_area value=9 mode=lesser method=reclass --o

r.mapcalc "gates_xy_clean1 = if(isnull(gates_area), gates_xy_clean0, null())" --o
#+END_SRC


**** Limit to Mouginot 2019 mask
+ Actually, limit to approximate Mouginot 2019 mask - its a bit narrow in some places
#+BEGIN_SRC bash :results verbatim
# r.mask mask_GIC@Mouginot_2019 --o
r.grow input=mask_GIC@Mouginot_2019 output=mask_GIC_Mouginot_2019_grow radius=4.5 # three cells
r.mask mask_GIC_Mouginot_2019_grow --o
r.mapcalc "gates_xy_clean2 = gates_xy_clean1" --o
r.mask -r

# r.univar map=gates_xy_clean1
# r.univar map=gates_xy_clean2
#+END_SRC

**** Remove areas from manually-drawn KML mask
+ See [[./dat/remove_manual.kml]]
#+BEGIN_SRC bash :results verbatim
v.import input=./dat/remove_manual.kml output=remove_manual --o
r.mask -i vector=remove_manual --o
r.mapcalc "gates_xy_clean3 = gates_xy_clean2" --o
r.mask -r

r.univar map=gates_xy_clean2
r.univar map=gates_xy_clean3
#+END_SRC

*** Final Gates
#+BEGIN_SRC bash :results verbatim
g.copy "gates_xy_clean3,gates_final" --o
#+end_src

*** Add meta-data to gates
Add:
+ Gate ID
+ Calculate the average x,y of the gate, and then from that ONE point, determine the following. Do this from the average point rather than for each gate pixel because some gates span multiple sectors, or different ends of the gate are nearer different names, etc.
  + Average lon,lat of gate
  + Nearest citet:mouginot_2019_glacier region, sector, and name
  + Nearest citet:bjork_2015_brief name

Do this for both the area vector and the point vector so that we can export
+ KML and GeoPackage with gates and metadata
+ simple CSV w/ gates and metadata.

**** Gate ID
#+BEGIN_SRC bash :results verbatim

# db.droptable -f table=gates_final
# db.droptable -f table=gates_final_pts

# areas (clusters of gate pixels, but diagonals are separate)
r.to.vect input=gates_final output=gates_final type=area --o
v.db.dropcolumn map=gates_final column=label
v.db.dropcolumn map=gates_final column=value
v.db.addcolumn map=gates_final columns="gate INT"
v.what.rast map=gates_final raster=gates_gateID column=gate type=centroid

# # points (each individual gate pixel)
# r.to.vect input=gates_final output=gates_final_pts type=point --o
# v.db.dropcolumn map=gates_final_pts column=label
# v.db.dropcolumn map=gates_final_pts column=value
# v.db.addcolumn map=gates_final_pts columns="gate INT"
# v.what.rast map=gates_final_pts raster=gates_gateID column=gate type=point
#+END_SRC
**** Mean x,y
#+BEGIN_SRC bash :results verbatim
# v.db.addcolumn map=gates_final columns="x DOUBLE PRECSION, y DOUBLE PRECISION, mean_x INT, mean_y INT, area INT"
v.db.addcolumn map=gates_final columns="mean_x INT, mean_y INT"
v.to.db map=gates_final option=coor columns=x,y units=meters
v.to.db map=gates_final option=area columns=area units=meters

for G in $(db.select -c sql="select gate from gates_final"|sort -n|uniq); do
  db.execute sql="UPDATE gates_final SET mean_x=(SELECT AVG(x) FROM gates_final WHERE gate == ${G}) where gate == ${G}"
  db.execute sql="UPDATE gates_final SET mean_y=(SELECT AVG(y) FROM gates_final WHERE gate == ${G}) where gate == ${G}"
done

v.out.ascii -c input=gates_final columns=gate,mean_x,mean_y | cut -d"|" -f4- | sort -n|uniq | v.in.ascii input=- output=gates_final_pts skip=1 cat=1 x=2 y=3 --o
v.db.addtable gates_final_pts
v.db.addcolumn map=gates_final_pts columns="gate INT"
v.db.update map=gates_final_pts column=gate query_column=cat

#v.db.addcolumn map=gates_final_pts columns="mean_x INT, mean_y INT"
v.to.db map=gates_final_pts option=coor columns=mean_x,mean_y units=meters
#+END_SRC

Here we have:
#+BEGIN_SRC bash :results verbatim :tangle no
db.select table=gates_final|head -n10 # cat|gate|x|y|mean_x|mean_y
db.select table=gates_final_pts|head # cat|gate|mean_x|mean_y
#+END_SRC

**** Mean lon,lat
#+BEGIN_SRC bash :results verbatim
v.what.rast map=gates_final_pts raster=lon@PERMANENT column=lon
v.what.rast map=gates_final_pts raster=lat@PERMANENT column=lat

v.db.addcolumn map=gates_final columns="mean_lon DOUBLE PRECISION, mean_lat DOUBLE PRECISION"
for G in $(db.select -c sql="select gate from gates_final"|sort -n|uniq); do
    db.execute sql="UPDATE gates_final SET mean_lon=(SELECT lon FROM gates_final_pts WHERE gate = ${G}) where gate = ${G}"
    db.execute sql="UPDATE gates_final SET mean_lat=(SELECT lat FROM gates_final_pts WHERE gate = ${G}) where gate = ${G}"
done
#+END_SRC

**** Sector, Region, Names, etc.
+ Sector Number
+ Region Code
+ Nearest Sector or Glacier Name
#+BEGIN_SRC bash :results verbatim
v.db.addcolumn map=gates_final columns="sector INT"
v.db.addcolumn map=gates_final_pts columns="sector INT"
v.distance from=gates_final to=sectors@Mouginot_2019 upload=to_attr column=sector to_column=cat
v.distance from=gates_final_pts to=sectors@Mouginot_2019 upload=to_attr column=sector to_column=cat

v.db.addcolumn map=gates_final columns="region VARCHAR(2)"
v.db.addcolumn map=gates_final_pts columns="region VARCHAR(2)"
v.distance from=gates_final to=sectors@Mouginot_2019 upload=to_attr column=region to_column=SUBREGION1
v.distance from=gates_final_pts to=sectors@Mouginot_2019 upload=to_attr column=region to_column=SUBREGION1

v.db.addcolumn map=gates_final columns="Mouginot_2019 VARCHAR(99)"
v.db.addcolumn map=gates_final_pts columns="Mouginot_2019 VARCHAR(99)"
v.distance from=gates_final to=sectors@Mouginot_2019 upload=to_attr column=Mouginot_2019 to_column=NAME
v.distance from=gates_final_pts to=sectors@Mouginot_2019 upload=to_attr column=Mouginot_2019 to_column=NAME

v.db.addcolumn map=gates_final columns="Bjork_2015 VARCHAR(99)"
v.db.addcolumn map=gates_final_pts columns="Bjork_2015 VARCHAR(99)"
v.distance from=gates_final to=names@Bjork_2015 upload=to_attr column=Bjork_2015 to_column=name
v.distance from=gates_final_pts to=names@Bjork_2015 upload=to_attr column=Bjork_2015 to_column=name

v.db.addcolumn map=gates_final columns="Zwally_2012 INT"
v.db.addcolumn map=gates_final_pts columns="Zwally_2012 INT"
v.distance from=gates_final to=Zwally_2012@Zwally_2012 upload=to_attr column=Zwally_2012 to_column=cat_
v.distance from=gates_final_pts to=Zwally_2012@Zwally_2012 upload=to_attr column=Zwally_2012 to_column=cat_

v.db.addcolumn map=gates_final columns="n_pixels INT"
v.db.addcolumn map=gates_final_pts columns="n_pixels INT"
for G in $(db.select -c sql="select gate from gates_final"|sort -n|uniq); do
    db.execute sql="UPDATE gates_final SET n_pixels=(SELECT SUM(area)/(200*200) FROM gates_final WHERE gate = ${G}) where gate = ${G}"
    # now copy that to the average gate location (point) table
    db.execute sql="UPDATE gates_final_pts SET n_pixels = (SELECT n_pixels FROM gates_final WHERE gate = ${G}) WHERE gate = ${G}"
done
#+END_SRC
**** Clean up
#+BEGIN_SRC bash :results verbatim
db.dropcolumn -f table=gates_final column=area
# db.dropcolumn -f table=gates_final column=cat
#+END_SRC

**** Export as metadata CSV
#+BEGIN_SRC bash :results verbatim
mkdir -p out
db.select sql="SELECT gate,mean_x,mean_y,lon,lat,n_pixels,sector,region,Bjork_2015,Mouginot_2019,Zwally_2012 from gates_final_pts" separator=, | sort -n | uniq  > ./out/gate_meta.csv
#+END_SRC

*** Export Gates to KML                                            :noexport:
#+BEGIN_SRC bash :results verbatim
v.out.ogr input=gates_final output=./tmp/gates_final_${VELOCITY_CUTOFF}_${BUFFER_DIST}.kml format=KML --o
# open ./tmp/gates_final_${VELOCITY_CUTOFF}_${BUFFER_DIST}.kml
#+END_SRC

*** Sensitivity of results to gate distance and cutoff velocity
:PROPERTIES:
:header-args:bash+: :tangle no
:END:

Run the gate detection algorithm at a variety of cutoff velocities and buffer distances
#+BEGIN_SRC bash :results verbatim :tangle no
for VELOCITY_CUTOFF in 10 20 30 40 50 60 70 80 90 100 125 150; do
  for BUFFER_DIST in 1000 2000 3000 4000 5000 6000 7000 8000 9000; do
      . ./gate_IO.sh
  done
done
#+END_SRC

**** Heatmap
***** Compute
#+BEGIN_SRC bash :results verbatim
rm ./tmp/gate_test.dat
for M in $(g.mapset -l | tr ' ' '\n' | grep gates); do
  g.mapset ${M} --quiet
  r.mask -r --quiet
  g.region -d

  ### To generate this heatmap for a sub-region or single glacier, PRIOR to
  ### this in PERMANENT mapset, zoom in, then "set computational region extent from display",
  ### then save w/ "g.region save=SUBREGION --o", then in the loop zoom in on each mapset with:
  # g.region res=200 align=vel_baseline@MEaSUREs.0478 -pa
  # g.region region=SUBREGION@PERMANENT --o -pa

  r.mapcalc "vel_eff = (if(gates_x == 1, abs(vx_baseline@MEaSUREs.0478), 0) + if(gates_y == 1, abs(vy_baseline@MEaSUREs.0478), 0))" --o
  r.mask gates_final --o
  # frink "(m/yr * m) * m * kg/m^3 * 1E12 -> Gt/yr"

  ### simple D w/ "raw" unadjusted thickness
  r.mapcalc "tmp_D = (vel_eff * 200) * thickness@BedMachine * 917 / pow(10.0, 12)" --o

  ### D w/ adjusted thickness
  # in BedMachine mapset, from the OLS fits.summary()
  # r.mapcalc "thick_fit_adj=if(thickness<20,380*log(vel_baseline@MEaSUREs.0478,10)-380,thickness)"
  # r.mapcalc "tmp_D = (vel_eff * 200) * thick_fit_adj@BedMachine * 917 / pow(10.0, 12)" --o

  r.univar tmp_D | grep sum
  echo ${M} $(r.univar tmp_D | grep sum) >> ./tmp/gate_test.dat
  g.remove -f type=raster name=tmp_D
done
#+END_SRC

#+BEGIN_SRC bash :results verbatim
cat ./tmp/gate_test.dat | sort
#+END_SRC

***** Display

#+BEGIN_SRC jupyter-python :session v_b_compare :exports results :results raw drawer :display text/org
# %matplotlib qt5
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

from matplotlib import rc
rc('font', size=12)
rc('text', usetex=False)

df0 = pd.read_csv('./tmp/gate_test.dat', sep=" ", names=['param','D'], usecols=((0,2)), index_col=0)
vel = np.sort(np.unique([_.split('_')[1] for _ in df0.index.values.astype(str)]).astype(np.int))
buf = np.unique([_.split('_')[2] for _ in df0.index.values.astype(str)]).astype(np.int)
df = pd.DataFrame(columns=vel, index=buf)
for v in vel:
    for b in buf:
        idx='gates_'+str(v)+'_'+str(b)
        df.loc[b,v] = np.float(df0.loc[idx].values[0])

df = df.apply(pd.to_numeric)
df_int = df.apply(pd.to_numeric).round().astype(np.int)

fig = plt.figure(1, figsize=(8,6)) # w,h
fig.clf()
fig.set_tight_layout(True)
ax = fig.add_subplot(111)

sns.set()

im = sns.heatmap(df,
                 annot=df_int, annot_kws={"size":12},
                 vmin=440, vmax=490,
                 # vmin=470, vmax=510,
                 cbar_kws={'label':'Unadjusted Baseline Discharge [Gt yr$^{-1}$]'},
                           #, 'extend':'min'},
                           # "ticks":[470,480,490,500,510]},
                 fmt='d',
                 ax=ax)

plt.yticks(rotation=0)
ax.text(0.5, -0.1, 'Cutoff Velocity [m yr$^{-1}$]',
        transform=ax.transAxes, horizontalalignment='center')
ax.text(-0.14, 0.5, 'Distance from terminus [m]',
        rotation='vertical',
        transform=ax.transAxes, verticalalignment='center')

       
plt.savefig('./figs/heatmap_all.png', transparent=True, bbox_inches='tight', dpi=300)
plt.savefig('./figs/heatmap_all.pdf', bbox_inches='tight')

df.round()
#+END_SRC

** Effective Velocity
:PROPERTIES:
:header-args:bash+: :tangle vel_eff.sh
:END:

#+BEGIN_SRC bash :results verbatim
<<MSGS_pretty_print>>
<<GRASS_config>>
#+END_SRC


*** NOTDONE All Mapsets
Effective velocity (because gates may only be valid in =x= or =y= direction) was calculated for the sensitivity test above at one time, but for all gate locations (buffer dist and speed cutoff). Now we need to calculate it at all times

#+BEGIN_SRC bash :results verbatim :tangle no
g.mapsets gates_100_5000
r.mask -r

mapset=$(g.mapset -l | tr ' ' '\n' | grep -E gates_??_????| head -n1) # DEBUG
for mapset in $(g.mapset -l | tr ' ' '\n' | grep -E gates_??_????); do
  g.mapset ${mapset} --quiet

  g.region -d
  r.mapcalc "MASK = if((gates_x == 1) | (gates_y == 1), 1, null())" --o
  VX=$(g.list -m type=raster pattern=VX_????_??_?? mapset=* | head -n1) # DEBUG
  for VX in $(g.list -m type=raster pattern=VX_????_??_?? mapset=*); do
    VY=${VX/VX/VY}
    EX=${VX/VX/EX}
    EY=${VX/VX/EY}
    DATE=$(echo $VX | cut -d"_" -f2- | cut -d@ -f1)
    echo $DATE
    r.mapcalc "vel_eff_${DATE} = if(gates_x == 1, if(${VX} == -2*10^9, 0, abs(${VX})), 0) + if(gates_y, if(${VY} == -2*10^9, 0, abs(${VY})), 0)"
    r.mapcalc "err_eff_${DATE} = if(gates_x@gates_50_2500 == 1, if(${EX} == -2*10^9, 0, abs(${EX})), 0) + if(gates_y@gates_50_2500, if(${EY} == -2*10^9, 0, abs(${EY})), 0)"
  done

  VX=$(g.list -m type=raster pattern=vx_????_??_?? mapset=Sentinel1 | head -n1) # DEBUG
  for VX in $(g.list -m type=raster pattern=vx_????_??_?? mapset=Sentinel1); do
    VY=${VX/vx/vy}
    EX=${VX/vx/ex}
    EY=${VX/vx/ey}
    DATE=$(echo $VX | cut -d"_" -f2- | cut -d@ -f1)
    echo $DATE
    r.mapcalc "vel_eff_${DATE} = 365 * (if(gates_x@gates_50_2500 == 1, if(isnull(${VX}), 0, abs(${VX}))) + if(gates_y@gates_50_2500, if(isnull(${VY}), 0, abs(${VY}))))"
    r.mapcalc "err_eff_${DATE} = 365 * (if(gates_x@gates_50_2500 == 1, if(isnull(${EX}), 0, abs(${EX}))) + if(gates_y@gates_50_2500, if(isnull(${EY}), 0, abs(${EY}))))"
  done
done


#+END_SRC

*** Just one velocity cutoff & buffer distance 
:PROPERTIES:
:ID:       20210102T152009.186822
:END:

#+BEGIN_SRC bash :results verbatim
g.mapsets -l

r.mask -r

MAPSET=gates_100_5000

g.mapset MEaSUREs.0478
g.region -d
r.mapcalc "MASK = if((gates_x@${MAPSET} == 1) | (gates_y@${MAPSET} == 1), 1, null())" --o
VX=$(g.list type=raster pattern=VX_????_??_?? | head -n1) # DEBUG
VX=$(g.list type=raster pattern=VX_????_??_?? | grep 2012_03_03) # DEBUG
for VX in $(g.list type=raster pattern=VX_????_??_??); do
  VY=${VX/VX/VY}
  EX=${VX/VX/EX}
  EY=${VX/VX/EY}
  DATE=$(echo $VX | cut -d"_" -f2-)
  echo $DATE
  # g.region raster=${VX}
  r.mapcalc "vel_eff_${DATE} = if(gates_x@${MAPSET} == 1, if(${VX} == -2*10^9, 0, abs(${VX})), 0) + if(gates_y@${MAPSET}, if(${VY} == -2*10^9, 0, abs(${VY})), 0)"
  r.mapcalc "err_eff_${DATE} = if(gates_x@${MAPSET} == 1, if(${EX} == -2*10^9, 0, abs(${EX})), 0) + if(gates_y@${MAPSET}, if(${EY} == -2*10^9, 0, abs(${EY})), 0)"
done


g.mapset MEaSUREs.0646
g.region -d
r.mapcalc "MASK = if((gates_x@${MAPSET} == 1) | (gates_y@${MAPSET} == 1), 1, null())" --o
VX=$(g.list type=raster pattern=VX_????_??_?? | head -n1) # DEBUG
for VX in $(g.list type=raster pattern=VX_????_??_??); do
  VY=${VX/VX/VY}
  EX=${VX/VX/EX}
  EY=${VX/VX/EY}
  DATE=$(echo $VX | cut -d"_" -f2-)
  echo $DATE
  r.mapcalc "vel_eff_${DATE} = if(gates_x@${MAPSET} == 1, if(isnull(${VX}), 0, abs(${VX}))) + if(gates_y@${MAPSET}, if(isnull(${VY}), 0, abs(${VY})))"
  r.mapcalc "err_eff_${DATE} = if(gates_x@${MAPSET} == 1, if(isnull(${EX}), 0, abs(${EX}))) + if(gates_y@${MAPSET}, if(isnull(${EY}), 0, abs(${EY})))"
done


g.mapset MEaSUREs.0731
g.region -d
r.mapcalc "MASK = if((gates_x@${MAPSET} == 1) | (gates_y@${MAPSET} == 1), 1, null())" --o
VX=$(g.list type=raster pattern=VX_????_??_?? | head -n1) # DEBUG
for VX in $(g.list type=raster pattern=VX_????_??_??); do
  VY=${VX/VX/VY}
  EX=${VX/VX/EX}
  EY=${VX/VX/EY}
  DATE=$(echo $VX | cut -d"_" -f2-)
  echo $DATE
  r.mapcalc "vel_eff_${DATE} = if(gates_x@${MAPSET} == 1, if(isnull(${VX}), 0, abs(${VX}))) + if(gates_y@${MAPSET}, if(isnull(${VY}), 0, abs(${VY})))"
  r.mapcalc "err_eff_${DATE} = if(gates_x@${MAPSET} == 1, if(isnull(${EX}), 0, abs(${EX}))) + if(gates_y@${MAPSET}, if(isnull(${EY}), 0, abs(${EY})))"
done


g.mapset Mouginot_pre2000
g.region -d
r.mapcalc "MASK = if((gates_x@${MAPSET} == 1) | (gates_y@${MAPSET} == 1), 1, null())" --o
VX=$(g.list type=raster pattern=vx_????_??_?? | head -n1) # DEBUG
for VX in $(g.list type=raster pattern=vx_????_??_??); do
  VY=${VX/vx/vy}
  DATE=$(echo $VX | cut -d"_" -f2-)
  echo $DATE
  r.mapcalc "vel_eff_${DATE} = (if(gates_x@${MAPSET} == 1, if(isnull(${VX}), 0, abs(${VX}))) + if(gates_y@${MAPSET}, if(isnull(${VY}), 0, abs(${VY}))))"
done

#+END_SRC

#+NAME: sentinel1_effective_velocity
#+BEGIN_SRC bash :results verbatim
g.mapset Sentinel1
g.region -d
r.mapcalc "MASK = if((gates_x@${MAPSET} == 1) | (gates_y@${MAPSET} == 1), 1, null())" --o
VX=$(g.list type=raster pattern=vx_????_??_?? | head -n1) # DEBUG
for VX in $(g.list type=raster pattern=vx_????_??_??); do
  VY=${VX/vx/vy}
  EX=${VX/vx/ex}
  EY=${VX/vx/ey}
  DATE=$(echo $VX | cut -d"_" -f2-)
  echo $DATE
  r.mapcalc "vel_eff_${DATE} = 365 * (if(gates_x@${MAPSET} == 1, if(isnull(${VX}), 0, abs(${VX}))) + if(gates_y@${MAPSET}, if(isnull(${VY}), 0, abs(${VY}))))"
  r.mapcalc "err_eff_${DATE} = 365 * (if(gates_x@${MAPSET} == 1, if(isnull(${EX}), 0, abs(${EX}))) + if(gates_y@${MAPSET}, if(isnull(${EY}), 0, abs(${EY}))))"
done
#+END_SRC

#+BEGIN_SRC bash :results verbatim
# fix return code of this script so make continues
MSG_OK "vel_eff DONE" 
#+END_SRC

** Export all data to CSV
:PROPERTIES:
:header-args:bash+: :tangle export.sh
:END:

#+BEGIN_SRC bash :results verbatim
<<MSGS_pretty_print>>
<<GRASS_config>>
#+END_SRC

#+NAME: export
#+BEGIN_SRC bash :results output
MSG_OK "Exporting..."
g.mapset PERMANENT
g.region -dp

MAPSET=gates_100_5000

VEL_baseline="vel_baseline@MEaSUREs.0478 vx_baseline@MEaSUREs.0478 vy_baseline@MEaSUREs.0478 vel_err_baseline@MEaSUREs.0478 ex_baseline@MEaSUREs.0478 ey_baseline@MEaSUREs.0478"
VEL_0478=$(g.list -m mapset=MEaSUREs.0478 type=raster pattern=vel_eff_????_??_?? separator=space)
ERR_0478=$(g.list -m mapset=MEaSUREs.0478 type=raster pattern=err_eff_????_??_?? separator=space)
VEL_0646=$(g.list -m mapset=MEaSUREs.0646 type=raster pattern=vel_eff_????_??_?? separator=space)
ERR_0646=$(g.list -m mapset=MEaSUREs.0646 type=raster pattern=err_eff_????_??_?? separator=space)
VEL_0731=$(g.list -m mapset=MEaSUREs.0731 type=raster pattern=vel_eff_????_??_?? separator=space)
ERR_0731=$(g.list -m mapset=MEaSUREs.0731 type=raster pattern=err_eff_????_??_?? separator=space)
VEL_SENTINEL=$(g.list -m mapset=Sentinel1 type=raster pattern=vel_eff_????_??_?? separator=space)
ERR_SENTINEL=$(g.list -m mapset=Sentinel1 type=raster pattern=err_eff_????_??_?? separator=space)
VEL_MOUGINOT=$(g.list -m mapset=Mouginot_pre2000 type=raster pattern=vel_eff_????_??_?? separator=space)
THICK=$(g.list -m mapset=Khan_2016 type=raster pattern=dh_???? separator=space)
GIMP_0715="dem@GIMP.0715 day@GIMP.0715" # ,err@GIMP.0715

LIST="lon lat err_2D gates_x@${MAPSET} gates_y@${MAPSET} gates_gateID@${MAPSET} sectors@Mouginot_2019 regions@Mouginot_2019 bed@BedMachine thickness@BedMachine surface@BedMachine thickness@Bamber_2013 bed_0@Millan_2018 thickness_0@Millan_2018 ${THICK} ${GIMP_0715} ${VEL_baseline} ${VEL_0478} ${VEL_0646} ${VEL_0731} ${VEL_SENTINEL} ${VEL_MOUGINOT} errbed@BedMachine ${ERR_0478} ${ERR_0646} ${ERR_0731} ${ERR_SENTINEL}"

mkdir tmp/dat
r.mapcalc "MASK = if(gates_final@${MAPSET}) | if(dem@GIMP.0715) | if(mask_GIC@Mouginot_2019)" --o
parallel --bar "if [[ ! -e ./tmp/dat/{1}.bsv ]]; then (echo x\|y\|{1}; r.out.xyz input={1}) > ./tmp/dat/{1}.bsv; fi" ::: ${LIST}
r.mask -r

# combine individual files to one mega csv
cat ./tmp/dat/lat.bsv | cut -d"|" -f1,2 | datamash -t"|" transpose > ./tmp/dat_100_5000_t.bsv
for f in ./tmp/dat/*; do
  cat $f | cut -d"|" -f3 | datamash -t"|" transpose >> ./tmp/dat_100_5000_t.bsv
done
cat ./tmp/dat_100_5000_t.bsv |datamash -t"|" transpose | tr '|' ',' > ./tmp/dat_100_5000.csv
rm ./tmp/dat_100_5000_t.bsv
#+END_SRC

** Compute Errors
:PROPERTIES:
:header-args:jupyter-python+: :tangle errors.py
:END:

*** Velocity v Thickness Errors
+ Is velocity uncertainty important relative to thickness uncertainty?
  + ANS: No, proportional velocity uncertainty is an order of magnitude less than thickness uncertainty.
#+BEGIN_SRC jupyter-python :results raw drawer :session discharge :display text/plain :tangle no
import pandas as pd
import numpy as np

df = pd.read_csv("./tmp/dat_100_5000.csv")

thick = df['thickness@BedMachine'].copy()
thick[thick < 50] = 50  # IS THIS REASONABLE? IMPORTANT?
thick[thick == 0] = 1
thick_err = np.abs(df['errbed@BedMachine'].values)


vel = df['vel_baseline@MEaSUREs.0478']
vel_err = df['vel_err_baseline@MEaSUREs.0478']

print("Relative thickness error:")
print((thick_err/thick*100).describe())
print("\n\nRelative velocity error:")
print((vel_err/vel*100).describe())

# import matplotlib.pyplot as plt
# plt.clf()
# ax = plt.hexbin((thick_err/thick), (vel_err/vel), mincnt=1, bins='log', xscale='log', yscale='log')
# plt.xlabel('Relative Thickness Error [Log_10]')
# plt.ylabel('Relative Velocity Error [Log_10]')
#+END_SRC

*** Do velocity errors scale w/ velocity?
+ ANS: Not really.
#+BEGIN_SRC jupyter-python :results raw drawer :session discharge :display text/plain :tangle no
import pandas as pd
import numpy as np
import datetime

# df = pd.read_csv("./tmp/dat_100_5000.csv")
# vel = df['vel_baseline@MEaSUREs.0478']
# vel_err = df['vel_err_baseline@MEaSUREs.0478']


vel = pd.read_csv("./tmp/dat_100_5000.csv", usecols=(lambda c: ('vel_eff' in c)))
vel.rename(columns=lambda c: datetime.datetime(int(c[8:12]), int(c[13:15]), int(c[16:18])), inplace=True)
vel.replace(0, np.nan, inplace=True)
# vel = vel.loc[:,vel.columns.year < 2018] # drop 2018
vel.sort_index(axis='columns', inplace=True)

vel_err = pd.read_csv("./tmp/dat_100_5000.csv", usecols=(lambda c: ('err_eff' in c)))
vel_err.rename(columns=lambda c: datetime.datetime(int(c[8:12]), int(c[13:15]), int(c[16:18])), inplace=True)
# vel_err = vel_err.loc[:,vel_err.columns.year < 2018] # drop 2018
for c in vel.columns:
    if c not in vel_err.columns:
        vel_err[c] = 0 
vel_err.sort_index(axis='columns', inplace=True) 


import matplotlib.pyplot as plt
plt.clf()
ax = plt.hexbin(vel.values.flatten()+1,
                vel_err.values.flatten()+1,
                mincnt=1,
                bins='log',
                xscale='log', yscale='log',
                gridsize=100)
plt.xlabel("Velocity [m yr$^{-1}$]")
plt.ylabel("Velocity Error [m yr$^{-1}$]")
#+END_SRC

*** Results (GIS)
#+BEGIN_SRC jupyter-python :results raw drawer :session discharge :display text/org :tangle no :eval no-export
from uncertainties import unumpy
import pandas as pd
import numpy as np

df_out = pd.DataFrame(columns=['Val','Unit'])
df_out.index.name = 'Method'

df = pd.read_csv("./tmp/dat_100_5000.csv")

thick = df['thickness@BedMachine']
# thick[thick < 50] = 50  # IS THIS REASONABLE? IMPORTANT?
# vel = df['vel_baseline@MEaSUREs.0478']
vel = np.abs(df['vx_baseline@MEaSUREs.0478'])*df['gates_x@gates_100_5000'] + np.abs(df['vy_baseline@MEaSUREs.0478'])*df['gates_y@gates_100_5000']
D = 200  * thick * vel * 917 / 1E12
df_out.loc['D'] = [np.sum(D), 'Gt']

err_thick = np.abs(df['errbed@BedMachine'].values)
# err_vel = np.abs(df['vel_err_baseline@MEaSUREs.0478'])
err_vel = np.abs(df['ex_baseline@MEaSUREs.0478'])*df['gates_x@gates_100_5000'] + np.abs(df['ey_baseline@MEaSUREs.0478'])*df['gates_y@gates_100_5000']

e_th = 200 * err_thick * vel * 917 / 1E12
df_out.loc['Err (Thickness)'] = [np.sum(e_th), 'Gt']
df_out.loc['Err (Thickness %)'] = [np.sum(e_th)/np.sum(D)*100, '%']

e_vel = 200 * thick * err_vel * 917 / 1E12
df_out.loc['Err (Velocity)'] = [np.sum(e_vel), 'Gt']
df_out.loc['Err (Velocity %)'] = [np.sum(e_vel)/np.sum(D)*100, '%']
df_out.loc['Err (Combined)'] = [np.sum(e_vel+e_th), 'Gt']
df_out.loc['Err (%)'] = [np.sum(e_vel+e_th)/np.sum(D)*100, '%']
# The above assumes everything is systematic/independent/correlated

# If errors are all random and uncorrelated:
t = unumpy.uarray(thick, err_thick)
v = unumpy.uarray(vel, err_vel)
e = np.sum(200 * t * v * 917 / 1E12)
df_out.loc['Random Errors'] = [e, 'Gt']
df_out.loc['Random Errors (%)'] = [e.s/e.n*100, '%']

df_out
#+END_SRC

#+RESULTS:
| Method            |                 Val | Unit |
|-------------------+---------------------+------|
| D                 |   471.5426188537758 | Gt   |
| Err (Thickness)   |   50.18996460822251 | Gt   |
| Err (Thickness %) |   10.64378119844694 | %    |
| Err (Velocity)    |  3.2451848262508327 | Gt   |
| Err (Velocity %)  |  0.6882060489334383 | %    |
| Err (Combined)    |  53.435149434473345 | Gt   |
| Err (%)           |  11.331987247380379 | %    |
| Random Errors     |         471.5+/-1.4 | Gt   |
| Random Errors (%) | 0.28888822450030804 | %    |

*** Results (Mouginot 2019 Sector)
#+BEGIN_SRC jupyter-python :results raw drawer :session discharge :display text/org :eval no-export
from uncertainties import unumpy
import pandas as pd
import numpy as np

df = pd.read_csv("./tmp/dat_100_5000.csv")

err_sector = pd.DataFrame(columns=['D', 'E', 'E%'])
err_sector.index.name = 'Sector'

sectors = np.unique(df['sectors@Mouginot_2019'].values)
for s in sectors:
    sub = df[df['sectors@Mouginot_2019'] == s]
    thick = sub['thickness@BedMachine']
    vel = sub['vel_baseline@MEaSUREs.0478']
    # vel = np.abs(sub['vx_baseline@MEaSUREs.0478'])*sub['gates_x@gates_100_5000'] + np.abs(sub['vy_baseline@MEaSUREs.0478'])*sub['gates_y@gates_100_5000']
    D = 200  * thick * vel * 917 / 1E12
    err_thick = np.abs(sub['errbed@BedMachine'].values)
    # err_thick[np.where(err_thick < 50)] = 50  # IS THIS REASONABLE? IMPORTANT?
    e_th = 200 * err_thick * vel * 917 / 1E12
    err_sector.loc[s] = [np.sum(D), np.sum(e_th), np.round(np.sum(e_th),10)/np.round(np.sum(D),10)*100]

err_sector.loc['GIS'] = np.sum(err_sector, axis=0)
err_sector.loc['GIS']['E%'] = err_sector.loc['GIS']['E']/err_sector.loc['GIS']['D']*100

err_sector.to_csv('./tmp/err_sector_mouginot.csv')

err_sector.rename(columns = {'D':'D [Gt]',
                             'E':'Error [Gt]',
                             'E%':'Error [%]'}, inplace=True)

err_sector
#+END_SRC

#+RESULTS:
| Sector |      D [Gt] | Error [Gt] | Error [%] |
|--------+-------------+------------+-----------|
|      1 |     1.13296 |   0.119511 |   10.5486 |
|      2 |    0.254923 |   0.105848 |   41.5214 |
|      3 |     13.9562 |   0.900377 |   6.45147 |
|      4 |     1.81572 |   0.268763 |    14.802 |
|      6 |     5.98601 |   0.394399 |   6.58867 |
|      7 |    0.759871 |  0.0538301 |   7.08411 |
|      8 |    0.633468 |  0.0446303 |   7.04539 |
|      9 |     8.93733 |   0.687491 |   7.69236 |
|     10 |      1.9844 |   0.151168 |   7.61786 |
|     14 |     3.07864 |   0.314741 |   10.2234 |
|     15 |    0.450661 |  0.0507318 |   11.2572 |
|     16 |     5.03681 |   0.523718 |   10.3978 |
|     19 |    0.117655 |  0.0335031 |   28.4758 |
|     20 |    0.442004 |  0.0382464 |   8.65295 |
|     21 |    0.840605 |  0.0942844 |   11.2163 |
|     22 |    0.790089 |   0.132326 |   16.7482 |
|     23 |     1.15269 |   0.124484 |   10.7995 |
|     25 |   0.0965041 |  0.0129959 |   13.4666 |
|     26 |     1.01834 |   0.059183 |   5.81173 |
|     27 |     5.77916 |   0.247833 |    4.2884 |
|     28 |    0.625812 |  0.0235983 |   3.77083 |
|     29 |     1.90881 |   0.122375 |   6.41102 |
|     30 |     1.74212 |   0.139962 |   8.03402 |
|     31 |    0.721142 |  0.0574444 |   7.96576 |
|     32 |     5.22645 |   0.365244 |   6.98839 |
|     33 |     8.06032 |   0.898265 |   11.1443 |
|     34 |     4.34442 |   0.386386 |   8.89385 |
|     35 |     5.34555 |   0.647521 |   12.1133 |
|     36 |     4.44943 |   0.395877 |   8.89724 |
|     37 |     7.77054 |   0.390137 |   5.02072 |
|     38 |     4.75347 |   0.543275 |    11.429 |
|     41 |     2.88232 |   0.239682 |    8.3156 |
|     42 |     1.01876 |  0.0664516 |    6.5228 |
|     43 |     6.58074 |   0.265285 |   4.03123 |
|     44 |    0.996849 |  0.0583816 |   5.85661 |
|     45 |    0.841672 |  0.0732469 |   8.70255 |
|     47 |     1.63371 |   0.207228 |   12.6845 |
|     48 |     2.46628 |   0.362852 |   14.7125 |
|     49 |    0.785023 |  0.0331364 |   4.22108 |
|     50 |     5.78814 |   0.330976 |   5.71817 |
|     53 |     3.06926 |   0.162114 |   5.28187 |
|     55 |    0.129045 |  0.0216342 |   16.7648 |
|     56 |    0.416233 |  0.0805611 |   19.3548 |
|     58 |     12.4341 |   0.652429 |   5.24708 |
|     59 |     14.1655 |    1.44915 |   10.2302 |
|     60 |     8.84446 |   0.639192 |   7.22703 |
|     61 |    0.553378 |  0.0977556 |   17.6652 |
|     62 |    0.639435 |  0.0253148 |   3.95893 |
|     63 |     28.3613 |    2.23295 |   7.87322 |
|     64 |     4.64096 |   0.561211 |   12.0926 |
|     65 |     4.40276 |   0.158794 |   3.60668 |
|     66 | 0.000223683 |  0.0378539 |     16923 |
|     67 |  0.00503859 |    0.64676 |   12836.1 |
|     68 |     3.70874 |   0.836823 |   22.5635 |
|     69 |     1.87811 |   0.178538 |   9.50626 |
|     72 |     1.39015 |   0.114702 |   8.25104 |
|     73 |  0.00307288 |   0.549584 |     17885 |
|     74 |      4.2916 |   0.521755 |   12.1576 |
|     75 |    0.117939 |  0.0329024 |   27.8978 |
|     76 |     1.66594 |    0.28158 |   16.9022 |
|     77 | 0.000443706 |   0.060892 |   13723.5 |
|     78 |     1.72598 |     0.1312 |   7.60148 |
|     80 |      7.8069 |   0.644373 |   8.25389 |
|     81 |     7.33425 |   0.611139 |   8.33267 |
|     82 |     1.31302 |  0.0833806 |   6.35031 |
|     83 |     4.44366 |   0.603423 |   13.5794 |
|     84 |     1.57504 |   0.253256 |   16.0794 |
|     86 |     7.30662 |   0.765899 |   10.4823 |
|     88 |  0.00275237 |    0.19056 |    6923.5 |
|     93 |     2.68238 |   0.223059 |   8.31571 |
|     94 |     1.19422 |   0.344398 |   28.8389 |
|     95 |     11.2367 |   0.304892 |   2.71337 |
|     96 |     5.30953 |   0.909599 |   17.1314 |
|     97 |  0.00490425 |  0.0141609 |   288.746 |
|     98 |     1.46695 |   0.233396 |   15.9102 |
|    100 |    0.248149 |   0.164958 |   66.4752 |
|    102 |     22.8012 |     1.8543 |   8.13244 |
|    103 |    0.362388 |   0.038987 |   10.7584 |
|    104 |    0.635742 |  0.0934609 |   14.7011 |
|    105 |   0.0713579 |  0.0121074 |   16.9672 |
|    106 |     14.7017 |    0.70068 |   4.76598 |
|    107 |     4.15737 |   0.349785 |   8.41361 |
|    108 |    0.510391 |   0.116783 |   22.8811 |
|    109 |    0.045015 |  0.0362538 |   80.5373 |
|    110 |    0.389191 |  0.0215441 |   5.53562 |
|    111 |  0.00115479 |   0.119557 |   10353.1 |
|    112 | 6.05528e-05 | 0.00906305 |   14967.2 |
|    113 |   0.0639219 |   0.370122 |   579.022 |
|    114 |     1.65272 |   0.167552 |   10.1379 |
|    115 |    0.994759 |   0.233459 |   23.4689 |
|    116 | 0.000509676 |  0.0818634 |   16061.8 |
|    117 |     4.43129 |    0.47649 |   10.7529 |
|    118 |  0.00128358 |   0.245275 |   19108.7 |
|    120 |    0.419347 |    0.12187 |   29.0619 |
|    121 |     1.23718 |   0.290739 |      23.5 |
|    122 |  0.00250193 |   0.422061 |   16869.5 |
|    123 |  0.00050518 |  0.0359559 |   7117.45 |
|    124 |    0.002328 |   0.330146 |   14181.5 |
|    125 |     1.21532 |   0.102551 |   8.43823 |
|    126 |     1.60821 |   0.247405 |   15.3839 |
|    127 |     9.07181 |   0.456823 |   5.03563 |
|    128 |  0.00252363 |   0.401012 |   15890.3 |
|    132 |    0.193755 |   0.154766 |   79.8771 |
|    134 |     1.52012 |    1.21553 |   79.9626 |
|    136 | 0.000397048 |   0.099331 |   25017.4 |
|    138 |    0.032685 |  0.0221705 |   67.8307 |
|    139 |    0.100994 |  0.0370782 |   36.7134 |
|    140 |    0.301306 |   0.141927 |   47.1041 |
|    141 |   0.0565944 |  0.0282081 |   49.8425 |
|    142 |   0.0668502 |  0.0335327 |    50.161 |
|    144 |  0.00146915 |  0.0144612 |   984.321 |
|    146 |    0.278089 |  0.0226055 |   8.12888 |
|    147 |     2.18806 |   0.233926 |    10.691 |
|    148 |     1.27653 |  0.0910306 |   7.13111 |
|    150 |   0.0918815 |  0.0320071 |   34.8352 |
|    151 |    0.427981 |  0.0843866 |   19.7174 |
|    152 |    0.141149 |  0.0516591 |   36.5991 |
|    153 |    0.254032 |   0.113703 |   44.7595 |
|    154 |    0.532234 |   0.170229 |   31.9839 |
|    156 |  0.00108883 |   0.164682 |   15124.7 |
|    157 |   0.0766498 |  0.0374593 |   48.8708 |
|    158 |    0.353257 |  0.0633385 |   17.9299 |
|    164 |    0.030944 |  0.0396854 |   128.249 |
|    172 |  0.00740499 |  0.0262357 |   354.298 |
|    174 | 0.000183178 |   0.021491 |   11732.3 |
|    183 |     0.33767 |  0.0574514 |   17.0141 |
|    185 |    0.528683 |  0.0885119 |    16.742 |
|    186 |    0.683322 |   0.537818 |   78.7063 |
|    188 |  0.00299054 |  0.0192545 |   643.848 |
|    189 |     7.11456 |   0.385537 |   5.41899 |
|    190 |     4.65674 |    1.72775 |   37.1021 |
|    191 |  0.00025485 |  0.0533937 |     20951 |
|    192 |      4.4188 |   0.249871 |   5.65474 |
|    193 |     2.19751 |   0.124156 |   5.64983 |
|    195 |    0.267033 |  0.0566183 |   21.2027 |
|    196 |   0.0148698 | 0.00933636 |   62.7874 |
|    197 |    0.694158 |   0.125963 |   18.1461 |
|    199 |    0.453779 |   0.560361 |   123.488 |
|    200 |  0.00254369 |  0.0430946 |   1694.18 |
|    203 |    0.897733 |   0.108282 |   12.0618 |
|    204 |  0.00338184 |  0.0175625 |   519.317 |
|    207 |     6.61744 |   0.820205 |   12.3946 |
|    208 |     2.84014 |   0.226375 |   7.97057 |
|    209 |     0.83978 |   0.134441 |   16.0091 |
|    210 |    0.681866 |   0.130944 |   19.2038 |
|    211 |      2.8354 |   0.274688 |    9.6878 |
|    212 |     5.53488 |   0.422405 |   7.63169 |
|    213 |     4.61738 |   0.480633 |   10.4092 |
|    214 |     8.98708 |   0.918741 |   10.2229 |
|    215 |   0.0391676 |   0.073413 |   187.433 |
|    216 |     0.54006 |  0.0775712 |   14.3634 |
|    218 |     50.4639 |    4.61404 |   9.14324 |
|    219 |    0.176467 |  0.0420522 |   23.8301 |
|    222 |   0.0923766 |  0.0527156 |   57.0659 |
|    223 |     11.2588 |   0.472191 |   4.19398 |
|    224 |    0.494333 |   0.256009 |   51.7889 |
|    231 |    0.966708 |   0.117179 |   12.1214 |
|    232 | 0.000299178 |  0.0636515 |   21275.5 |
|    233 |     4.57801 |   0.342675 |   7.48524 |
|    234 |   0.0208636 |  0.0146862 |   70.3915 |
|    236 | 0.000372432 |  0.0693781 |   18628.4 |
|    237 |    0.122571 |   0.357291 |   291.497 |
|    239 |   0.0939576 |  0.0281907 |   30.0036 |
|    240 |   0.0990675 |  0.0231812 |   23.3994 |
|    243 |     1.80218 |   0.272452 |   15.1179 |
|    248 |     5.14003 |   0.219126 |   4.26313 |
|    249 |     1.14112 |   0.119979 |   10.5142 |
|    251 |  0.00946236 |  0.0059137 |   62.4971 |
|    252 |  0.00391211 | 0.00454773 |   116.248 |
|    254 |   0.0800955 |  0.0389183 |   48.5899 |
|    255 |    0.936375 |  0.0962841 |   10.2826 |
|    257 | 0.000597703 |  0.0791324 |   13239.4 |
|    259 | 0.000308847 |  0.0471869 |   15278.4 |
|    GIS |     472.177 |     50.082 |   10.6066 |

*** Results (Mouginot 2019 Region)
#+BEGIN_SRC jupyter-python :results raw drawer :session discharge :display text/org :eval no-export
from uncertainties import unumpy
import pandas as pd
import numpy as np

df = pd.read_csv("./tmp/dat_100_5000.csv")

err_sector = pd.DataFrame(columns=['D','E', 'E%'])
err_sector.index.name = 'Sector'

sectors = np.unique(df['regions@Mouginot_2019'].values)
for s in sectors:
   sub = df[df['regions@Mouginot_2019'] == s]
   thick = sub['thickness@BedMachine']
   vel = np.abs(sub['vx_baseline@MEaSUREs.0478'])*sub['gates_x@gates_100_5000'] + np.abs(sub['vy_baseline@MEaSUREs.0478'])*sub['gates_y@gates_100_5000']
   D = 200  * thick * vel * 917 / 1E12
   err_thick = np.abs(sub['errbed@BedMachine'].values)
   # err_thick[np.where(err_thick < 50)] = 50  # IS THIS REASONABLE? IMPORTANT?
   e_th = 200 * err_thick * vel * 917 / 1E12
   err_sector.loc[s] = [np.sum(D), np.sum(e_th), np.round(np.sum(e_th),10)/np.round(np.sum(D),10)*100]

err_sector.loc['GIS'] = np.sum(err_sector, axis=0)
err_sector.loc['GIS']['E%'] = err_sector.loc['GIS']['E']/err_sector.loc['GIS']['D']*100

err_sector.to_csv('./tmp/err_region_mouginot.csv')

err_sector.rename(columns = {'D':'D [Gt]', 
                         'E':'Error [Gt]',
                         'E%':'Error [%]'}, inplace=True)

err_sector
#+END_SRC

#+RESULTS:
| Sector |  D [Gt] | Error [Gt] | Error [%] |
|--------+---------+------------+-----------|
|      1 | 24.2756 |    1.83611 |   7.56358 |
|      2 | 27.1697 |    2.40068 |   8.83588 |
|      3 | 68.2741 |    7.47249 |   10.9448 |
|      4 | 134.125 |    17.5465 |   13.0823 |
|      5 | 14.2328 |    3.05582 |   21.4702 |
|      6 | 88.0896 |    7.54673 |   8.56711 |
|      7 | 115.376 |    10.3316 |   8.95473 |
|    GIS | 471.543 |      50.19 |   10.6438 |

*** Results (Gate)                                                 :noexport:
#+BEGIN_SRC jupyter-python :results raw drawer :session discharge :display text/org :eval no-export
from uncertainties import unumpy
import pandas as pd
import numpy as np

df = pd.read_csv("./tmp/dat_100_5000.csv")

err_gate = pd.DataFrame(columns=['D','E', 'E%'])
err_gate.index.name = 'Gate'

gates = np.unique(df['gates_gateID@gates_100_5000'].values)
for g in gates:
    sub = df[df['gates_gateID@gates_100_5000'] == g]
    thick = sub['thickness@BedMachine']
    vel = np.abs(sub['vx_baseline@MEaSUREs.0478'])*sub['gates_x@gates_100_5000'] + np.abs(sub['vy_baseline@MEaSUREs.0478'])*sub['gates_y@gates_100_5000']
    D = 200  * thick * vel * 917 / 1E12
    err_thick = np.abs(sub['errbed@BedMachine'].values)
    # err_thick[np.where(err_thick < 50)] = 50  # IS THIS REASONABLE? IMPORTANT?
    e_th = 200 * err_thick * vel * 917 / 1E12
    err_gate.loc[g] = [np.sum(D), np.sum(e_th), np.sum(e_th)/np.sum(D)*100]

err_gate.loc['GIS'] = np.sum(err_gate, axis=0)
err_gate.loc['GIS']['E%'] = err_gate.loc['GIS']['E']/err_gate.loc['GIS']['D']*100

gate_meta = pd.read_csv("./out/gate_meta.csv")
err_gate['name'] = ''
for g in err_gate.index.values:
    if (g == 'GIS'): continue
    if (sum(gate_meta.gate == g) == 0): continue
    err_gate.loc[g,'name'] = gate_meta[gate_meta.gate == g].Mouginot_2019.values[0]

err_gate.to_csv('./tmp/err_gate.csv')
err_gate.rename(columns = {'D':'D [Gt]', 
                           'E':'Error [Gt]',
                           'E%':'Error [%]'}, inplace=True),

err_gate
#+END_SRC

#+RESULTS:
| Gate |      D [Gt] | Error [Gt] | Error [%] | name                             |
|------+-------------+------------+-----------+----------------------------------|
|    1 | 0.000242779 |   0.030608 |   12607.4 | JUNGERSEN_HENSON_NARAVANA        |
|    3 |  0.00010155 |  0.0153045 |     15071 | JUNGERSEN_HENSON_NARAVANA        |
|    4 |    0.123399 |  0.0207551 |   16.8195 | MARIE_SOPHIE_GLETSCHER           |
|    5 |    0.544954 |  0.0715866 |   13.1363 | HAGEN_BRAE                       |
|    6 |   0.0308782 |  0.0581098 |   188.191 | BRIKKERNE_GLETSCHER              |
|    7 |    0.430717 |    0.08547 |   19.8437 | ACADEMY                          |
|    8 |   0.0445647 |  0.0359111 |   80.5819 | HARDER_GLETSCHER                 |
|   10 |     2.56798 |    0.10477 |   4.07984 | RYDER_GLETSCHER                  |
|   11 |     1.56763 |    0.15128 |   9.65019 | OSTENFELD_GLETSCHER              |
|   12 |    0.306089 |  0.0243717 |   7.96228 | STEENSBY_GLETSCHER               |
|   17 |   0.0463436 |  0.0407937 |   88.0245 | OSTENFELD_GLETSCHER              |
|   19 |   0.0449537 |  0.0489306 |   108.847 | OSTENFELD_GLETSCHER              |
|   22 |    0.208659 |  0.0173091 |    8.2954 | RYDER_GLETSCHER                  |
|   23 |    0.277659 |  0.0390611 |    14.068 | RYDER_GLETSCHER                  |
|   25 |   0.0256916 |  0.0819198 |   318.858 | PETERMANN_GLETSCHER_N            |
|   26 |    0.489938 |   0.169616 |   34.6199 | PETERMANN_GLETSCHER_N            |
|   27 |     11.3084 |    0.48615 |     4.299 | PETERMANN_GLETSCHER              |
|   28 |      6.0462 |   0.343538 |   5.68188 | HUMBOLDT_GLETSCHER               |
|   29 |     12.2803 |   0.662151 |   5.39196 | NIOGHALVFJERDSFJORDEN            |
|   30 |    0.211186 |  0.0106246 |   5.03091 | HUMBOLDT_GLETSCHER               |
|   31 |     14.3226 |    1.46042 |   10.1966 | ZACHARIAE_ISSTROM                |
|   32 | 7.55834e-05 | 0.00770218 |   10190.3 | DIEBITSCH                        |
|   33 | 0.000111118 |  0.0141656 |   12748.2 | DIEBITSCH                        |
|   34 |   0.0075044 |  0.0265923 |   354.356 | MORRIS_JESUP                     |
|   35 |   0.0381932 |  0.0485401 |   127.091 | BOWDOIN                          |
|   36 |     0.72019 |   0.106663 |   14.8104 | MELVILLE_GLETSCHER               |
|   37 |   0.0761574 |  0.0129914 |   17.0586 | SHARP                            |
|   38 |    0.484742 |  0.0523378 |    10.797 | FARQUHAR_GLETSCHER               |
|   39 |     2.56157 |   0.374898 |   14.6355 | TRACY_GLETSCHER                  |
|   40 |     1.64511 |   0.204995 |   12.4609 | HEILPRIN_GLETSCHER               |
|   46 |    0.880626 |  0.0390674 |   4.43633 | HARALD_MOLTKE_BRAE               |
|   47 |  0.00873454 | 0.00185963 |   21.2905 | SAVISSUAQ_WW                     |
|   48 |   0.0951409 |  0.0225635 |   23.7159 | SAVISSUAQ_WW                     |
|   49 |     0.38921 |  0.0684422 |   17.5849 | SAVISSUAQ_WWWW                   |
|   50 |   0.0844815 |  0.0232816 |   27.5582 | SAVISSUAQ_W                      |
|   51 |   0.0264578 | 0.00951808 |   35.9746 | SAVISSUAQ_W                      |
|   52 |    0.555191 |  0.0914293 |   16.4681 | SAVISSUAQ                        |
|   53 |    0.263227 |  0.0557872 |   21.1936 | YNGVAR_NIELSEN_BRAE_W            |
|   54 |    0.717578 |   0.124884 |   17.4036 | YNGVAR_NIELSEN_BRAE              |
|   55 |    0.851283 |  0.0718501 |   8.44022 | CARLOS                           |
|   57 |  0.00178218 |  0.0024406 |   136.945 | CARLOS                           |
|   58 |   0.0151679 | 0.00953498 |   62.8628 | HELLAND                          |
|   59 |     2.37727 |   0.241067 |   10.1405 | GADE-MORELL                      |
|   60 |   0.0433492 |   0.025323 |   58.4162 | GADE-MORELL                      |
|   61 |  0.00955888 | 0.00246878 |   25.8271 | DOCKER_SMITH_GLETSCHER_W         |
|   62 |     1.41693 |  0.0933727 |   6.58978 | DOCKER_SMITH_GLETSCHER_W         |
|   63 |     1.54897 |   0.118967 |   7.68038 | DOCKER_SMITH_GLETSCHER           |
|   64 |    0.249263 |  0.0189032 |   7.58366 | DOCKER_SMITH_GLETSCHER           |
|   66 |     1.05962 |  0.0622346 |    5.8733 | RINK_GLETSCHER                   |
|   67 |     3.46136 |    0.17273 |   4.99025 | ISSUUARSUIT_SERMIA               |
|   69 |      1.0023 |  0.0280765 |    2.8012 | ISSUUARSUIT_SERMIA               |
|   71 |      1.1039 |  0.0416315 |   3.77131 | ISSUUARSUIT_SERMIA               |
|   72 |     1.09776 |   0.072307 |   6.58677 | NONAME_NORTH_OSCAR               |
|   73 |     8.37833 |   0.428752 |    5.1174 | KONG_OSCAR_GLETSCHER             |
|   77 |   0.0425836 |  0.0024955 |   5.86023 | KONG_OSCAR_GLETSCHER             |
|   78 |   0.0623227 |  0.0026047 |   4.17937 | NORDENSKIOLD_GLESCHER_NW         |
|   79 |      8.2212 |   0.472487 |   5.74718 | NORDENSKIOLD_GLESCHER_NW         |
|   89 |    0.436271 |  0.0395597 |   9.06768 | NANSEN_GLETSCHER                 |
|   90 |   0.0728292 |  0.0144968 |   19.9052 | SVERDRUP_GLETSCHER               |
|   91 |     5.50316 |   0.469718 |   8.53541 | SVERDRUP_GLETSCHER               |
|   92 |     1.29725 |   0.162003 |   12.4882 | STEENSTRUP-DIETRICHSON           |
|   93 |     1.06817 |   0.108468 |   10.1545 | STEENSTRUP-DIETRICHSON           |
|   94 |     3.23444 |   0.365915 |   11.3131 | STEENSTRUP-DIETRICHSON           |
|   95 |     5.69675 |   0.692471 |   12.1555 | KJER_GLETSCHER                   |
|   96 |    0.211067 |  0.0309464 |   14.6619 | HAYES_GLETSCHER_N_NN             |
|   99 |    0.154598 |  0.0161649 |    10.456 | HAYES_GLETSCHER_N_NN             |
|  100 |    0.583881 |  0.0318647 |   5.45739 | HAYES_GLETSCHER_N_NN             |
|  102 |    0.764497 |  0.0387761 |   5.07211 | HAYES_GLETSCHER_N_NN             |
|  103 |     7.80872 |   0.861927 |    11.038 | HAYES_GLETSCHER_N_NN             |
|  104 |     3.29024 |   0.299349 |   9.09811 | HAYES_GLETSCHER_M_SS             |
|  111 |    0.644011 |  0.0450114 |   6.98923 | HAYES_GLETSCHER_M_SS             |
|  112 |    0.143022 |  0.0130102 |   9.09666 | HAYES_GLETSCHER_M_SS             |
|  113 |      5.4707 |   0.600724 |   10.9807 | ALISON_GLETSCHER                 |
|  114 |    0.109609 |  0.0399905 |   36.4848 | WALTERSHAUSEN                    |
|  115 |     1.57334 |   0.164376 |   10.4476 | ALISON_GLETSCHER                 |
|  116 |    0.030311 |  0.0201952 |   66.6267 | ADOLF_HOEL                       |
|  117 |     5.20321 |   0.362617 |   6.96909 | ILLULLIP_SERMIA                  |
|  118 |    0.440167 |  0.0392276 |   8.91197 | CORNELL_GLETSCHER                |
|  119 |    0.235532 |  0.0134709 |   5.71936 | CORNELL_GLETSCHER                |
|  120 |    0.303209 |   0.143097 |   47.1942 | GERARD_DE_GEER                   |
|  122 |    0.980607 |  0.0842863 |   8.59532 | USSING_BRAEER_N                  |
|  123 |    0.963729 |  0.0734385 |   7.62024 | USSING_BRAEER_N                  |
|  124 |   0.0556981 |  0.0276349 |   49.6155 | JAETTEGLETSCHER                  |
|  125 |     1.73727 |   0.103502 |   5.95772 | USSING_BRAEER                    |
|  126 |     0.14425 |   0.021226 |   14.7147 | USSING_BRAEER                    |
|  127 |    0.722277 |  0.0267532 |   3.70401 | QEQERTARSUUP_SERMIA              |
|  128 |   0.0664664 |  0.0332622 |   50.0436 | NORDENSKIOLD_NE                  |
|  129 |     6.21867 |   0.256793 |    4.1294 | KAKIVFAAT_SERMIAT                |
|  130 |     0.04207 | 0.00444826 |   10.5735 | KAKIVFAAT_SERMIAT                |
|  131 |  0.00143109 |   0.013929 |   973.315 | HISINGER_GLETSCHER               |
|  132 |     1.14576 |  0.0662401 |   5.78134 | NUNATAKASSAAP_SERMIA             |
|  133 |     0.61965 |  0.0782348 |   12.6256 | UPERNAVIK_ISSTROM_N              |
|  134 |     7.42538 |   0.762106 |   10.2635 | UPERNAVIK_ISSTROM_N              |
|  135 |     6.59969 |   0.819664 |   12.4197 | UPERNAVIK_ISSTROM_C              |
|  136 |     2.76336 |      0.221 |   7.99752 | UPERNAVIK_ISSTROM_S              |
|  137 |    0.111059 |  0.0151142 |   13.6092 | UPERNAVIK_ISSTROM_SS             |
|  138 |     0.87857 |   0.106359 |   12.1059 | F_GRAAE                          |
|  139 |  0.00332712 |  0.0173174 |   520.492 | CHARCOT                          |
|  140 |     9.21617 |   0.672305 |   7.29484 | DAUGAARD-JENSEN                  |
|  141 |     1.25742 |   0.137761 |   10.9558 | INNGIA_ISBRAE                    |
|  142 |     1.31589 |   0.137993 |   10.4867 | UMIAMMAKKU_ISBRAE                |
|  143 |     12.9161 |   0.860943 |   6.66564 | RINK_ISBRAE                      |
|  144 |   0.0284199 |  0.0102236 |   35.9735 | EIELSON_HARE_FJORD-ROLIGE        |
|  145 |     1.73059 |   0.252957 |   14.6168 | KANGERLUSSUUP_SERMERSUA          |
|  146 | 0.000237044 |  0.0329672 |   13907.6 | GEIKIE3                          |
|  148 | 0.000214731 |   0.042169 |     19638 | GEIKIE3                          |
|  149 |  0.00065282 |  0.0919847 |   14090.4 | GEIKIE3                          |
|  150 |    0.557926 |   0.093334 |   16.7287 | EIELSON_HARE_FJORD-ROLIGE        |
|  151 |    0.653493 |   0.205208 |   31.4016 | BREDEGLETSJER                    |
|  152 |    0.250978 |   0.112266 |   44.7315 | SYDBR                            |
|  153 |    0.666664 |  0.0349643 |   5.24467 | SERMEQ_SILARLEQ                  |
|  154 |      1.9771 |   0.337389 |   17.0648 | VESTFJORD                        |
|  155 |     5.07068 |   0.347505 |   6.85323 | SERMEQ_SILARLEQ                  |
|  156 |     1.59047 |   0.250703 |   15.7628 | MAGGA_DAN_GLETSCHER              |
|  157 |    0.751903 |  0.0531029 |   7.06247 | CW_NONAME2                       |
|  158 |    0.218979 |  0.0734166 |   33.5267 | GEIKIE_UNNAMED_VESTFORD_S        |
|  159 |  0.00739597 | 0.00607013 |   82.0734 | GEIKIE_UNNAMED_VESTFORD_S        |
|  160 |   0.0534913 |  0.0342403 |   64.0109 | GEIKIE_UNNAMED_VESTFORD_S        |
|  161 |    0.523165 |  0.0359505 |   6.87173 | LILLE_GLETSCHER                  |
|  162 |    0.166355 |  0.0116804 |   7.02138 | LILLE_GLETSCHER                  |
|  163 |    0.351213 |  0.0176866 |   5.03587 | STORE_GLETSCHER                  |
|  164 |    0.347412 |  0.0624201 |   17.9672 | DENDRITGLETSCHER                 |
|  165 |     8.37552 |   0.669684 |   7.99573 | STORE_GLETSCHER                  |
|  166 |   0.0209341 |  0.0146903 |   70.1741 | GEIKIE7                          |
|  167 |     1.97443 |   0.158261 |   8.01552 | SERMEQ_AVANNARLEQ2               |
|  169 |     7.31806 |   0.612554 |   8.37045 | SERMEQ_KUJALLEQ                  |
|  170 |   0.0643453 |  0.0308835 |   47.9965 | GEIKIE6                          |
|  177 |    0.987068 |  0.0470645 |   4.76811 | KANGILERNGATA_SERMIA             |
|  180 |     1.16795 |  0.0962233 |   8.23863 | EQIP_SERMIA                      |
|  181 |    0.172823 |  0.0614777 |   35.5727 | BORGGRAVEN                       |
|  182 |   0.0900161 |  0.0518285 |   57.5769 | SERMEQ_AVANNARLEQ                |
|  183 |    0.285159 |  0.0615595 |   21.5878 | KRONBORG                         |
|  184 |     45.8327 |    4.25735 |   9.28889 | JAKOBSHAVN_ISBRAE                |
|  185 |   0.0950084 |  0.0354866 |    37.351 | ROSENBORG                        |
|  186 |   0.0196455 | 0.00543977 |   27.6897 | ROSENBORG                        |
|  187 |   0.0774279 | 0.00387909 |   5.00994 | KONG_CHRISTIAN                   |
|  188 |  0.00985496 | 0.00620388 |   62.9518 | STYRTE                           |
|  189 |     3.09807 |   0.377386 |   12.1813 | KONG_CHRISTIAN                   |
|  190 |       25.69 |    2.10264 |   8.18466 | KANGERLUSSUAQ                    |
|  191 |  0.00316558 |  0.0036173 |    114.27 | COURTAULD                        |
|  192 |    0.782581 |  0.0303407 |     3.877 | UNNAMED_KANGER_W                 |
|  193 |    0.148695 |  0.0416993 |   28.0436 | SORGENFRI                        |
|  194 |  0.00499414 |  0.0143874 |   288.086 | UNNAMED_KANGER_E                 |
|  195 |    0.167212 |  0.0389837 |    23.314 | SAQQARLIUP_ALANGORLIUP           |
|  197 |    0.199083 |   0.133361 |   66.9875 | FREDERIKSBORG_GLETSCHER          |
|  200 |  0.00570695 |   0.013359 |   234.083 | UNNAMED_DECEPTION_N              |
|  201 |   0.0720322 | 0.00738748 |   10.2558 | UNNAMED_DECEPTION_N              |
|  202 |  0.00617465 | 0.00803134 |    130.07 | UNNAMED_DECEPTION_N              |
|  203 |     1.29878 |  0.0719576 |   5.54038 | POLARIC-DECEPTION_O_N            |
|  204 |   0.0343321 |  0.0058739 |   17.1091 | POLARIC-DECEPTION_O_N            |
|  205 |   0.0642151 |  0.0543273 |   84.6021 | POLARIC-DECEPTION_O_N            |
|  206 |  0.00126529 |   0.192713 |   15230.7 | UNNAMED_POLARIC_S                |
|  207 |  0.00109256 |   0.152833 |   13988.5 | UNNAMED_POLARIC_S                |
|  208 | 7.55157e-05 | 0.00353036 |      4675 | UNNAMED_POLARIC_S                |
|  209 |     2.04015 |  0.0460258 |     2.256 | UNNAMED_DECEPTION_O_CN_CS        |
|  210 |     7.53807 |   0.211834 |   2.81018 | UNNAMED_DECEPTION_O_CN_CS        |
|  211 |      5.1197 |   0.217338 |   4.24513 | UNNAMED_UUNARTIT_ISLANDS         |
|  212 |    0.782933 |   0.040692 |   5.19739 | KRUUSE_FJORD                     |
|  213 |    0.165063 |  0.0466749 |   28.2771 | KRUUSE_FJORD                     |
|  214 |   0.0037298 | 0.00430118 |   115.319 | KRUUSE_FJORD                     |
|  215 |  0.00056825 |  0.0397383 |   6993.11 | LAUBE_GLETSCHER                  |
|  216 | 0.000397872 |  0.0664788 |   16708.6 | UNNAMED_LAUBE_S                  |
|  218 |  0.00013842 |  0.0216197 |   15618.9 | UNNAMED_LAUBE_S                  |
|  223 |  0.00193743 |   0.329281 |   16995.7 | UNNAMED_LAUBE_S                  |
|  224 |     4.68071 |   0.799209 |   17.0745 | KIV_STEENSTRUP_NODRE_BRAE        |
|  225 | 0.000364528 |  0.0678545 |   18614.4 | KIV_STEENSTRUP_SONDRE_BRAE       |
|  226 | 0.000300914 |  0.0459726 |   15277.6 | NIGERTULUUP_KATTILERTARPIA       |
|  227 | 0.000618851 |  0.0819412 |   13240.9 | GLACIERDEFRANCE                  |
|  228 |     1.23429 |   0.348222 |   28.2123 | MIDGARDGLETSCHER                 |
|  229 | 8.76822e-05 | 0.00994987 |   11347.7 | MIDGARDGLETSCHER                 |
|  230 |     2.74438 |   0.228307 |   8.31907 | FENRISGLETSCHER                  |
|  231 |     28.3759 |    2.23476 |   7.87556 | HELHEIMGLETSCHER                 |
|  235 |    0.465927 |   0.577122 |   123.865 | HEIM_GLETSCHER                   |
|  236 |  0.00251018 |  0.0437202 |   1741.71 | BRCKNER_GLETSCHER                |
|  237 |    0.727763 |   0.561489 |   77.1526 | NONAME_IKERTIVAQ_N               |
|  238 |     7.58332 |   0.891979 |   11.7624 | IKERTIVAQ_NN                     |
|  239 |     10.3018 |   0.945436 |   9.17739 | IKERTIVAQ_M                      |
|  240 |  0.00296942 |  0.0191137 |   643.684 | NONAME_IKERTIVAQ_S               |
|  243 |    0.002139 |   0.155148 |   7253.29 | SE_NONAME1                       |
|  244 |     3.97901 |   0.852601 |   21.4275 | KOGE_BUGT_N                      |
|  245 |     16.5818 |   0.776811 |   4.68471 | KOGE_BUGT_C                      |
|  246 |    0.286414 |   0.012137 |   4.23755 | KOGE_BUGT_S                      |
|  251 |     6.25444 |   0.330864 |   5.29007 | KOGE_BUGT_S                      |
|  252 |    0.405083 |  0.0310792 |    7.6723 | KOGE_BUGT_S                      |
|  254 | 0.000476612 |  0.0881848 |   18502.4 | KOGE_BUGT_SS                     |
|  257 | 0.000940643 |   0.165067 |   17548.3 | KOGE_BUGT_SS                     |
|  258 |  0.00166026 |    0.11882 |   7156.68 | KOGE_BUGT_SS                     |
|  259 |   0.0053018 |   0.325812 |   6145.31 | UMIIVIK_FJORD                    |
|  260 |  0.00244804 |  0.0272499 |   1113.13 | UMIIVIK_FJORD                    |
|  262 |     2.68931 |   0.273666 |   10.1761 | NARSAP_SERMIA                    |
|  263 |   0.0148826 |   0.199411 |   1339.89 | UMIIVIK_FJORD                    |
|  264 |     4.54327 |    1.03591 |    22.801 | UMIIVIK_FJORD                    |
|  266 |    0.169451 |   0.108632 |   64.1079 | UMIIVIK_FJORD                    |
|  270 |    0.498188 |  0.0555729 |    11.155 | AKULLERSUUP-QAMANAARSUUP         |
|  271 | 0.000274782 |  0.0575628 |   20948.5 | APUSEERSERPIA                    |
|  272 |     4.34363 |   0.590233 |   13.5885 | GRAULV                           |
|  274 |    0.205523 |   0.028599 |   13.9153 | GRAULV                           |
|  275 |     5.03253 |   0.522981 |    10.392 | KANGIATA_NUNAATA_SERMIA          |
|  276 |     4.74497 |   0.281126 |   5.92472 | GYLDENLOVE                       |
|  277 |    0.132893 |   0.290371 |   218.501 | GYLDENLOVE_S                     |
|  278 |  2.8184e-05 | 0.00448207 |   15902.9 | SE_NONAME2                       |
|  280 | 0.000322359 |  0.0686486 |   21295.7 | GYLDENLOVE_SS                    |
|  281 | 0.000454846 |  0.0715212 |   15724.3 | GYLDENLOVE_S                     |
|  282 | 3.29127e-05 | 0.00523086 |   15893.1 | SE_NONAME2                       |
|  283 | 7.61328e-05 |  0.0116113 |   15251.4 | SE_NONAME2                       |
|  284 | 0.000866503 |   0.154398 |   17818.6 | SE_NONAME2                       |
|  285 | 0.000512678 |  0.0943475 |   18402.9 | SE_NONAME2                       |
|  286 | 0.000503471 |   0.063902 |   12692.3 | FIMBULGETLSCHER                  |
|  287 |  0.00212486 |   0.354715 |   16693.6 | FIMBULGETLSCHER                  |
|  288 |  7.2802e-05 | 0.00889059 |     12212 | SE_NONAME2                       |
|  289 | 0.000892266 |   0.174267 |   19530.9 | SE_NONAME2                       |
|  290 |     3.80157 |   0.301286 |    7.9253 | AP_BERNSTOFF_GLETSCHER           |
|  292 |      1.1574 |  0.0669075 |   5.78082 | AP_BERNSTOFF_GLETSCHER           |
|  295 | 0.000255828 |  0.0436295 |   17054.2 | SE_NONAME2                       |
|  296 | 0.000252462 |  0.0424767 |     16825 | SE_NONAME2                       |
|  299 |     1.07737 |   0.254791 |   23.6493 | MAELKEVEJEN                      |
|  300 |  0.00277807 |   0.012022 |   432.748 | SKINFAXE                         |
|  302 |     1.55004 |   0.224873 |   14.5075 | SKINFAXE                         |
|  303 |     1.87072 |   0.105903 |   5.66107 | RIMFAXE                          |
|  304 |     1.35502 |     0.1138 |    8.3984 | HEIMDAL_GLETSCHER                |
|  305 |   0.0521568 | 0.00787523 |   15.0991 | TINGMIARMIUT_FJORD               |
|  306 |     7.88829 |   0.646318 |   8.19339 | TINGMIARMIUT_FJORD               |
|  307 |   0.0767972 |  0.0146471 |   19.0725 | MOGENS_HEINESEN_N                |
|  308 |     2.06156 |   0.312754 |   15.1707 | MOGENS_HEINESEN_N                |
|  309 |    0.974754 |   0.118258 |   12.1321 | MOGENS_HEINESEN_C                |
|  310 |     4.76843 |   0.171368 |    3.5938 | MOGENS_HEINESEN_S                |
|  311 | 0.000279193 |  0.0520355 |   18637.8 | MOGENS_HEINESEN_SS_SSS           |
|  312 |    0.128705 |  0.0322384 |   25.0483 | AVANNARLEQ-NIGERLIKASIK          |
|  314 |    0.447875 |  0.0633354 |   14.1413 | MOGENS_HEINESEN_SS_SSS           |
|  315 |   0.0113678 |  0.0059108 |   51.9958 | AVANNARLEQ-NIGERLIKASIK          |
|  316 |     4.37051 |   0.368132 |   8.42309 | PUISORTOQ_N                      |
|  317 |     1.78383 |   0.169431 |   9.49815 | UKAASORSUAQ                      |
|  318 |    0.823701 |   0.125904 |   15.2851 | PUISORTOQ_S                      |
|  319 |   0.0108862 |  0.0065084 |   59.7857 | PUISORTOQ_S                      |
|  320 |    0.374217 |  0.0651766 |   17.4168 | NAPASORSUAQ_N                    |
|  322 |    0.349705 |  0.0723664 |   20.6936 | NAPASORSUAQ_N                    |
|  323 | 7.64832e-05 |  0.0160352 |   20965.6 | NAPASORSUAQ_C_S                  |
|  324 | 0.000108454 |  0.0172894 |   15941.7 | NAPASORSUAQ_C_S                  |
|  325 | 6.43811e-05 | 0.00945635 |   14688.1 | NAPASORSUAQ_C_S                  |
|  326 |     4.41149 |   0.399073 |    9.0462 | ANORITUUP_KANGERLUA              |
|  327 |    0.487421 |   0.042182 |   8.65412 | SERMILIGAARSSUK_BRAE             |
|  328 |  6.8588e-05 | 0.00796309 |     11610 | ANORITUUP_KANGERLUA              |
|  329 |    0.325979 |   0.099656 |   30.5713 | ANORITUUP_KANGERLUA              |
|  331 |   0.0013534 |   0.259317 |   19160.4 | UNNAMED_ANORITUUP_KANGERLUA_S    |
|  332 | 0.000125657 |  0.0235513 |   18742.6 | UNNAMED_ANORITUUP_KANGERLUA_SS   |
|  333 | 0.000157755 |  0.0272631 |   17281.9 | UNNAMED_ANORITUUP_KANGERLUA_SS   |
|  334 | 0.000215261 |   0.028888 |     13420 | UNNAMED_ANORITUUP_KANGERLUA_SS   |
|  335 |    0.729977 |  0.0809549 |   11.0901 | QAJUUTTAP_SERMIA                 |
|  336 |    0.984474 |   0.231078 |   23.4723 | UNNAMED_HERLUF_TROLLE_N          |
|  337 |    0.119701 |  0.0331975 |   27.7337 | EQALORUTSIT_KILLIIT_SERMIAT      |
|  338 |     1.68952 |    1.43696 |   85.0517 | EQALORUTSIT_KILLIIT_SERMIAT      |
|  340 |    0.867976 |   0.144974 |   16.7025 | KIATTUUT-QOOQQUP                 |
|  341 |     1.64827 |   0.166902 |   10.1259 | UNNAMED_HERLUF_TROLLE_S          |
|  342 |   0.0611434 |   0.298648 |   488.439 | UNNAMED_KANGERLULUK              |
|  343 | 0.000406285 |   0.101505 |   24983.6 | NAAJAT_SERMIAT                   |
|  344 |    0.193898 |   0.156242 |   80.5793 | SERMILIK                         |
|  345 | 5.21983e-05 | 0.00781245 |   14966.9 | HERLUF_TROLLE-KANGERLULUK-DANELL |
|  346 | 0.000292309 |   0.038651 |   13222.6 | UNNAMED_KANGERLULUK              |
|  347 | 0.000101103 |  0.0131135 |   12970.4 | UNNAMED_KANGERLULUK              |
|  349 |    0.436155 |   0.127036 |   29.1263 | UNNAMED_DANELL_FJORD             |
|  350 |    0.118661 | 0.00703144 |   5.92567 | UNNAMED_SOUTH_DANELL_FJORD       |
|  352 | 6.05612e-05 | 0.00952727 |   15731.6 | SOUTHERN_TIP                     |
|  353 | 0.000162942 |  0.0297611 |   18264.9 | SOUTHERN_TIP                     |
|  354 |  6.0955e-05 | 0.00177019 |    2904.1 | SOUTHERN_TIP                     |
|  355 | 0.000142931 |  0.0184732 |   12924.5 | SOUTHERN_TIP                     |
|  356 |  6.6866e-05 | 0.00864522 |   12929.2 | SOUTHERN_TIP                     |
|  357 | 0.000303222 |  0.0335544 |     11066 | SOUTHERN_TIP                     |
|  GIS |     471.543 |      50.19 |   10.6438 |                                  |


** Raw data to discharge product
:PROPERTIES:
:header-args:jupyter-python+: :tangle raw2discharge.py :session discharge
:END:
*** Load data

+ What columns are in the file?
+ Don't show all the "vel_eff_YYYY_MM_DD" and "err_eff_YYYY_MM_DD" columns.

#+BEGIN_SRC bash :results verbatim :tangle no :eval no-export
head -n1 ./tmp/dat_100_5000.csv | tr ',' '\n' | grep -v "vel_eff_*" | grep -v "err_eff_*" | grep -v "dh_*" | sort | uniq | tr '\n' '\t'
echo "also: dh_YYYY@elev, vel_eff_YYYY_MM_DD@various, etc."
#+END_SRC

#+RESULTS:
: bed_0@Millan_2018	bed@BedMachine	day@GIMP.0715	dem@GIMP.0715	err_2D	errbed@BedMachine	ex_baseline@MEaSUREs.0478	ey_baseline@MEaSUREs.0478	gates_gateID@gates_100_5000	gates_x@gates_100_5000	gates_y@gates_100_5000	lat	lon	regions@Mouginot_2019	sectors@Mouginot_2019	surface@BedMachine	thickness_0@Millan_2018	thickness@Bamber_2013	thickness@BedMachine	vel_baseline@MEaSUREs.0478	vel_err_baseline@MEaSUREs.0478	vx_baseline@MEaSUREs.0478	vy_baseline@MEaSUREs.0478	x	y	also: dh_YYYY@elev, vel_eff_YYYY_MM_DD@various, etc.

#+NAME: load_data
#+BEGIN_SRC jupyter-python :exports none :results none
import matplotlib.pyplot as plt
import numpy as np
import pandas as pd
import datetime as dt

# pd.options.display.notebook_repr_html = False

###
### Load metadata
### 
meta_cols = ["x", "y", "err_2D", 
             "regions@Mouginot_2019", "sectors@Mouginot_2019", "gates_gateID@gates_100_5000"]
meta = pd.read_csv("./tmp/dat_100_5000.csv", usecols=meta_cols)
# rename columns
meta.rename(inplace=True, columns={'regions@Mouginot_2019':'regions', 
                                   'sectors@Mouginot_2019':'sectors',
                                   'gates_gateID@gates_100_5000':'gates'})
regions = {1:'NO', 2:'NE', 3:'CE', 4:'SE', 5:'SW', 6:'CW', 7:'NW'}
meta['regions'] = meta['regions'].map(regions.get) # Convert sector numbers to meaningful names
meta['ones'] = 1

R = pd.read_csv('./out/gate_meta.csv')
meta['name'] = ''
for g in meta['gates'].unique(): meta.loc[meta['gates'] == g, 'name'] = R[R['gate'] == g]['Mouginot_2019'].values

###
### Load BASELINE velocity
###
vel_baseline = pd.read_csv("./tmp/dat_100_5000.csv", usecols=['vel_baseline@MEaSUREs.0478'])
vel_baseline.rename(inplace=True, columns={'vel_baseline@MEaSUREs.0478':'vel'})

###
### Load all velocity
###
vel = pd.read_csv("./tmp/dat_100_5000.csv", usecols=(lambda c: ('vel_eff' in c)))
vel.rename(columns=lambda c: dt.datetime(int(c[8:12]), int(c[13:15]), int(c[16:18])), inplace=True)
# vel.drop(columns=dt.datetime(1999, 7, 1), inplace=True) # bad year?
vel.replace(0, np.nan, inplace=True)
# vel = vel.loc[:,vel.columns.year < 2018] # drop 2018
vel = vel.loc[:,vel.columns.year >= 1985] # drop early years
vel.sort_index(axis='columns', inplace=True)
vel.drop(labels=vel.columns[vel.columns.duplicated(keep='first')], axis='columns', inplace=True)

####################
# Filter Velocity: Rolling Windows
##################
def filter_bad_v(v):
    WINDOW=30
    SIGMA=2
    vel_rolling = v.T.rolling(window=WINDOW, center=True, min_periods=1).mean().T
    vel_residual = v - vel_rolling
    vel_std = vel_residual.T.rolling(window=WINDOW, center=True, min_periods=1).std().T
    vel_outlier = (v > vel_rolling+SIGMA*vel_std) | ( v < vel_rolling-SIGMA*vel_std)
    v[vel_outlier] = np.nan
    return v
####################
vel = filter_bad_v(vel)
vel = filter_bad_v(vel)
vel = filter_bad_v(vel)

fill = vel.copy() / vel # 1 where data, nan where not

vel = vel.interpolate(method='time', axis='columns', limit_area='inside', limit_direction='both')
vel.fillna(method='ffill', axis=1, inplace=True)
vel.fillna(method='bfill', axis=1, inplace=True)

# vel[meta.name == TESTNAME].T.sort_index().head()
# fill[meta.name == TESTNAME].T.sort_index().head()

# vel.sum(axis='rows').resample('1D').mean().interpolate(method='time', limit_area='inside').resample('A').mean()/1E6


###
### Load all velocity ERROR
###
err = pd.read_csv("./tmp/dat_100_5000.csv", usecols=(lambda c: ('err_eff' in c)))
err.rename(columns=lambda c: dt.datetime(int(c[8:12]), int(c[13:15]), int(c[16:18])), inplace=True)
err.replace(0, np.nan, inplace=True)
err = err.loc[:,err.columns.year > 1985] # drop early years
err.sort_index(axis='columns', inplace=True)
err.drop(labels=err.columns[err.columns.duplicated(keep='first')], axis='columns', inplace=True)
# err.interpolate(method='time', limit_area='inside', axis=1 inplace=True)
err.fillna(method='ffill', axis=1, inplace=True)
err.fillna(method='backfill', axis=1, inplace=True)

for c in err.columns[err.columns.duplicated()]:
    err.drop(columns=c, inplace=True)

# make sure we have error (even if 0) for each velocity, and no err w/o vel
for c in vel.columns:
    if c not in err.columns:
        err[c] = np.nan

for c in err.columns:
    if c not in vel.columns:
        err.drop(columns=c, inplace=True)
    
err.sort_index(axis='columns', inplace=True)

# tmp = np.array([c if c not in err.columns else None for c in vel.columns]); print(tmp[tmp != None])


###
### Thickness
###
th = pd.read_csv("./tmp/dat_100_5000.csv", usecols=["thickness@BedMachine",
                                           "surface@BedMachine",
                                           "bed@BedMachine",
                                           "errbed@BedMachine",
                                           "bed_0@Millan_2018",
                                           "thickness_0@Millan_2018",
                                           "gates_gateID@gates_100_5000"])
th.rename(inplace=True, columns={'thickness@BedMachine':'thick',
                                 'bed_0@Millan_2018':'bed@Millan_2018',
                                 'thickness_0@Millan_2018':'thickness@Millan_2018',
                                 'errbed@BedMachine': 'err',
                                 'gates_gateID@gates_100_5000':'gates'})
th_GIMP = pd.read_csv("./tmp/dat_100_5000.csv", usecols=(lambda c: ('@GIMP.0715' in c)))
th_GIMP['day'] = [dt.datetime(2000,1,1) + dt.timedelta(days=np.int(_)) for _ in th_GIMP['day@GIMP.0715']]
for _ in th_GIMP.columns: th[_] = th_GIMP[_]
del(th_GIMP)


###
### dh/dt
###
dhdt = pd.read_csv("./tmp/dat_100_5000.csv", usecols=(lambda c: ('dh' in c)))
mv = {}
for c in dhdt.columns: mv[c] = np.int(c.split('@')[0].split('_')[1])
dhdt.rename(inplace=True, columns=mv)

# assume trend continues from last measured value
dhdt[2020] = dhdt[2019]
dhdt[2021] = dhdt[2020]
for y in np.arange(1985,1994+1): dhdt[y] = dhdt.loc[:,1995:1997].mean(axis='columns')
dhdt.sort_index(axis='columns', inplace=True)

# what is the unadjusted discharge using BedMachine thickness?
D = (vel).apply(lambda c: c * (200 * th['thick'] * meta['err_2D'].values), axis=0) * 917 / 1E12
D.sum(axis='rows').resample('1D').mean().interpolate(method='time', limit_area='inside').resample('A').mean()
#+END_SRC


*** Adjust thickness 
**** Millan 2018
What are the changes in discharge in Millan 2018 region?

#+NAME: millan_2018
#+BEGIN_SRC jupyter-python :exports none :results raw drawer
th['thick_max'] = np.maximum(th['thick'].values, th['thickness@Millan_2018'].values)

D_tmp = pd.DataFrame(index=th.index, columns=['BedMachine','Millan','Max'])

D_tmp['BedMachine'] = vel_baseline.apply(lambda c: c * th['thick'].values, axis=0) * 200 * 917 / 1E12
D_tmp['Millan'] = vel_baseline.apply(lambda c: c * th['thickness@Millan_2018'].values, axis=0) * 200 * 917 / 1E12
D_tmp['Max'] = vel_baseline.apply(lambda c: c * th['thick_max'].values, axis=0) * 200 * 917 / 1E12

D_tmp.index.name = "Discharge [Gt]"
D_tmp[D_tmp['Millan'] != 0].sum(axis=0)
#+END_SRC



Decision: Use Millan (2018) where it exists. Then adjust as per BedMachine for thickness <= 20 m.

**** Adjust "bad" thickness
Here we perform a few thickness adjustments:

First, patch in Millan (2018) where it exists.

+ 300 :: All ice <= 20 m thick is assumed bad and set to the minimum
         "good" thickness in a gate if good exists, or 300 m if it
         does not exist
+ 400 :: All ice <= 50 m thick is set to 400 m thick
+ fit :: All ice <= 20 m thick is fit to the log10(thickness) v.
         log10(velocity) relationship, even though it is not a good
         fit.

For testing, gate clumps 9 (all bad) and 546 (some bad)

#+CALL: load_data[:results none]()

#+NAME: adjust_thickness
#+BEGIN_SRC jupyter-python :exports none :results none

# Patch in Millan (2018) where that data set has thickness > 0.
th.loc[th['thickness@Millan_2018'] > 0, 'thick'] = th.loc[th['thickness@Millan_2018'] > 0, 'thickness@Millan_2018']

th['bad'] = th['thick'] <= 20

th['thick_adj_300'] = th['thick']
th['thick_adj_300_err'] = th['err']
for g in th[th['bad']]['gates'].unique(): # only work on gates with some (or all) bad thickness
    if all(th[th['gates'] == g]['bad']): # If all bad, set to 300
        th.loc[th['gates'] == g, 'thick_adj_300'] = 300
        th.loc[th['gates'] == g, 'thick_adj_300_err'] = 300/2.

    elif any(th[th['gates'] == g]['bad']): # If any bad, set to minimum of good.
        th.loc[(th['gates'] == g) & (th['bad']), 'thick_adj_300'] = \
        (th.loc[(th['gates'] == g) & (~th['bad']), 'thick']).min()
        th.loc[(th['gates'] == g) & (th['bad']), 'thick_adj_300_err'] = 300/2.

# aggressive: Anything <= 50 gets 400 m thickness
th['thick_adj_400'] = [400 if T <= 50 else T for T in th['thick']]
th['thick_adj_400_err'] = [400/2. if T[0] <= 50 else T[1] for T in zip(th['thick'],th['err'])]
#+END_SRC


#+BEGIN_SRC jupyter-python :exports none :results raw drawer :display text/org :session discharge :tangle no :eval no-export
<<load_data>>
<<millan_2018>>
<<adjust_thickness>>

th.describe().T
#+END_SRC

#+RESULTS:
|                       | count |    mean |     std |      min |     25% |     50% |     75% |     max |
|-----------------------+-------+---------+---------+----------+---------+---------+---------+---------|
| bed@Millan_2018       |  5829 | 80.9647 | 224.577 | -824.832 |       0 |       0 |       0 | 1430.48 |
| bed@BedMachine        |  5829 | 21.1621 | 375.987 |     -990 |    -229 |     -22 |     300 |    1433 |
| err                   |  5829 | 65.3481 | 56.2126 |       10 |      27 |      46 |      83 |     304 |
| gates                 |  5829 | 162.334 |  98.702 |        1 |      73 |     158 |     239 |     357 |
| surface@BedMachine    |  5829 | 416.305 | 227.998 |       61 |     241 |     378 |     538 |    1444 |
| thickness@Millan_2018 |  5829 |  91.966 | 201.534 | -35.2671 |       0 |       0 | 0.54737 | 1141.83 |
| thick                 |  5829 |  401.49 | 258.313 |        0 | 206.316 |     406 |     577 |    1265 |
| day@GIMP.0715         |  5829 | 4765.93 | 1336.71 |        0 |    4549 |    5225 |    5555 |    5782 |
| dem@GIMP.0715         |  5829 |  436.62 | 236.144 |  72.2317 |  252.42 | 392.626 | 572.721 | 1490.26 |
| thick_max             |  5829 | 407.221 | 260.286 |        0 |     213 |     414 |     581 |    1265 |
| thick_adj_300         |  5829 | 429.216 | 228.073 |  20.3686 |     300 |     406 |     577 |    1265 |
| thick_adj_300_err     |  5829 |  66.041 | 53.7579 |       10 |      27 |      48 |      88 |     304 |
| thick_adj_400         |  5829 | 453.789 | 208.427 |       51 |     343 |     406 |     577 |    1265 |
| thick_adj_400_err     |  5829 | 75.0142 | 65.7903 |       10 |      28 |      50 |      94 |     288 |

#+BEGIN_SRC jupyter-python :exports none :results raw drawer :display text/org :session discharge :eval no-export
D0 = (vel).apply(lambda c: c * (200 * th['thick'] * meta['err_2D'].values), axis=0) * 917 / 1E12
D1 = (vel).apply(lambda c: c * (200 * th['thick_adj_300'] * meta['err_2D'].values), axis=0) * 917 / 1E12
D0 = D0.sum(axis='rows').resample('1D').mean().interpolate(method='time', limit_area='inside').resample('A').mean()
D1 = D1.sum(axis='rows').resample('1D').mean().interpolate(method='time', limit_area='inside').resample('A').mean()
pd.concat([D0,D1, D1-D0], axis='columns', keys=['BedMachine','300','diff'])
#+END_SRC

#+RESULTS:
|                     | BedMachine |     300 |    diff |
|---------------------+------------+---------+---------|
| 1985-12-31 00:00:00 |    388.036 | 400.105 | 12.0692 |
| 1986-12-31 00:00:00 |    399.856 | 411.622 | 11.7664 |
| 1987-12-31 00:00:00 |    400.764 |  411.03 | 10.2664 |
| 1988-12-31 00:00:00 |     390.43 | 399.355 | 8.92465 |
| 1989-12-31 00:00:00 |    391.229 | 400.318 | 9.08872 |
| 1990-12-31 00:00:00 |    389.914 |   400.3 | 10.3864 |
| 1991-12-31 00:00:00 |    379.003 | 388.239 | 9.23613 |
| 1992-12-31 00:00:00 |    384.182 |  393.39 | 9.20808 |
| 1993-12-31 00:00:00 |    388.579 |  397.54 | 8.96119 |
| 1994-12-31 00:00:00 |    399.705 | 409.249 | 9.54389 |
| 1995-12-31 00:00:00 |    382.407 | 392.067 | 9.66025 |
| 1996-12-31 00:00:00 |    381.442 | 390.611 |  9.1686 |
| 1997-12-31 00:00:00 |    388.098 |  396.62 |  8.5215 |
| 1998-12-31 00:00:00 |    394.824 | 402.655 | 7.83138 |
| 1999-12-31 00:00:00 |    395.822 | 403.564 | 7.74194 |
| 2000-12-31 00:00:00 |     399.21 | 406.457 | 7.24693 |
| 2001-12-31 00:00:00 |    401.839 | 409.095 | 7.25625 |
| 2002-12-31 00:00:00 |    418.866 | 426.253 |  7.3863 |
| 2003-12-31 00:00:00 |    434.674 | 442.339 | 7.66542 |
| 2004-12-31 00:00:00 |    446.963 | 454.808 | 7.84453 |
| 2005-12-31 00:00:00 |    458.337 | 466.166 | 7.82961 |
| 2006-12-31 00:00:00 |     453.11 | 460.852 | 7.74218 |
| 2007-12-31 00:00:00 |    445.967 | 453.696 | 7.72955 |
| 2008-12-31 00:00:00 |    451.126 | 459.111 | 7.98566 |
| 2009-12-31 00:00:00 |    458.622 | 466.683 | 8.06089 |
| 2010-12-31 00:00:00 |     463.72 | 471.821 | 8.10096 |
| 2011-12-31 00:00:00 |    468.798 | 476.777 | 7.97887 |
| 2012-12-31 00:00:00 |    468.665 |  476.59 | 7.92545 |
| 2013-12-31 00:00:00 |    473.492 | 481.316 | 7.82331 |
| 2014-12-31 00:00:00 |    479.152 | 486.824 | 7.67249 |
| 2015-12-31 00:00:00 |    482.952 |  490.58 | 7.62814 |
| 2016-12-31 00:00:00 |    474.103 |  481.38 | 7.27725 |
| 2017-12-31 00:00:00 |    480.546 |  487.87 | 7.32362 |
| 2018-12-31 00:00:00 |    474.689 | 481.893 | 7.20383 |
| 2019-12-31 00:00:00 |    471.491 | 478.889 | 7.39805 |
| 2020-12-31 00:00:00 |    482.748 |  490.38 | 7.63238 |
| 2021-12-31 00:00:00 |     495.49 | 503.132 | 7.64243 |


**** Adjust thickness w thickness v. velocity fit.

#+NAME: adjust_thickness_fit
#+BEGIN_SRC jupyter-python :exports none :results raw drawer :display text/plain :eval no-export
CUTOFF = 20
df = vel_baseline.join(th['thick'])
max_vel = df.loc[df['thick'] <= CUTOFF, 'vel'].max() # limit fit to velocities where data is missing
# df = df[(df['thick'] > CUTOFF) & (df['vel'] <= max_vel)]
df = df[df['thick'] > CUTOFF]
# df = df[df['vel'] <= max_vel]

import statsmodels.api as sm
y = (df['thick'])
X = np.log10(df['vel'])
X = sm.add_constant(X)
model = sm.OLS(y, X)
fits = model.fit()
# print(fits.summary())
predictions = fits.predict(X)

from statsmodels.sandbox.regression.predstd import wls_prediction_std
XX = np.linspace(X['vel'].min(), X['vel'].max(), 50)
XX = sm.add_constant(XX)
yy = fits.predict(XX)
sdev, lower, upper = wls_prediction_std(fits, exog=XX, alpha=0.05)

# fig = plt.figure(1, figsize=(4,4)) # w,h
# # get_current_fig_manager().window.move(0,0)
# fig.clf()
# # fig.set_tight_layout(True)

# ax = fig.add_subplot(111)
# im = ax.scatter(X['vel'], y, alpha=0.1, color='k')
# xl, yl = ax.get_xlim(), ax.get_ylim()
# ax.set_ylabel('Thickness [m]')
# ax.set_xlabel('Velocity [m yr$^{-1}$]')
# ax.plot(XX[:,1], yy, 'r--')
# ax.fill_between(XX[:,1], lower, upper, color='#888888', alpha=0.4)
# ax.fill_between(XX[:,1], lower, upper, color='#888888', alpha=0.1)
# # ax.set_xlim(50,xl[1])
# ax.set_ylim(0,yl[1])
# plt.savefig('./tmp/vel_thick_fit.png', transparent=True, bbox_inches='tight', dpi=300)
# plt.savefig('./tmp/vel_thick_fit.pdf', transparent=True, bbox_inches='tight', dpi=300)
            
th['fit'] = th['thick']
vel_where_thick_bad = vel_baseline.loc[th['bad'] == True, 'vel']
th.loc[th['bad'] == True, 'fit'] = fits.predict(sm.add_constant(np.log10(vel_where_thick_bad)))
# set err to thickness where fit
th['fit_err'] = th['err']
th.loc[th['bad'] == True, 'fit_err'] = th.loc[th['bad'] == True, 'fit'] /2.


fits.summary()


D0 = (vel).apply(lambda c: c * (200 * th['thick_adj_300'] * meta['err_2D'].values), axis=0) * 917 / 1E12
D1 = (vel).apply(lambda c: c * (200 * th['fit'] * meta['err_2D'].values), axis=0) * 917 / 1E12
D0 = D0.sum(axis='rows').resample('1D').mean().interpolate(method='time', limit_area='inside').resample('A').mean()
D1 = D1.sum(axis='rows').resample('1D').mean().interpolate(method='time', limit_area='inside').resample('A').mean()
pd.concat([D0,D1, D1-D0], axis='columns', keys=['300','fit','diff'])

#+END_SRC

#+RESULTS: adjust_thickness_fit
#+begin_example
                   300         fit      diff
1985-12-31  400.105319  404.202414  4.097095
1986-12-31  411.622420  415.662301  4.039881
1987-12-31  411.030044  414.660647  3.630604
1988-12-31  399.354678  402.515612  3.160934
1989-12-31  400.317896  403.485571  3.167675
1990-12-31  400.300325  403.949763  3.649439
1991-12-31  388.239125  391.409004  3.169879
1992-12-31  393.389866  396.498551  3.108685
1993-12-31  397.540099  400.559415  3.019316
1994-12-31  409.248588  412.349642  3.101055
1995-12-31  392.067426  395.430134  3.362708
1996-12-31  390.610726  394.059871  3.449145
1997-12-31  396.619952  399.854124  3.234172
1998-12-31  402.655257  406.003282  3.348025
1999-12-31  403.563617  407.078309  3.514692
2000-12-31  406.456594  409.853875  3.397281
2001-12-31  409.095201  412.430822  3.335621
2002-12-31  426.252676  429.599353  3.346677
2003-12-31  442.339274  445.767248  3.427974
2004-12-31  454.807679  458.329937  3.522258
2005-12-31  466.166282  469.667577  3.501295
2006-12-31  460.852185  464.373098  3.520912
2007-12-31  453.696448  457.244636  3.548189
2008-12-31  459.111441  462.791642  3.680201
2009-12-31  466.683256  470.383971  3.700715
2010-12-31  471.821296  475.511720  3.690424
2011-12-31  476.776761  480.538106  3.761345
2012-12-31  476.590080  480.369616  3.779535
2013-12-31  481.315758  485.043534  3.727776
2014-12-31  486.824207  490.426491  3.602284
2015-12-31  490.580369  494.044613  3.464243
2016-12-31  481.379908  484.750582  3.370673
2017-12-31  487.869758  491.216531  3.346773
2018-12-31  481.892829  485.112355  3.219527
2019-12-31  478.889058  482.259133  3.370075
2020-12-31  490.380449  493.903958  3.523509
2021-12-31  503.132376  506.645598  3.513221
#+end_example

**** Table of thickness adjustments
:PROPERTIES:
:ID:       62f5d28c-c704-422d-9e9b-c0771d5b86ee
:END:

#+BEGIN_SRC jupyter-python :exports none :results raw drawer :display text/org :eval no-export
th[['thick','thick_adj_300','thick_adj_400','fit']].describe()
#+END_SRC

#+RESULTS:
|       |   thick | thick_adj_300 | thick_adj_400 |     fit |
|-------+---------+---------------+---------------+---------|
| count |    5829 |          5829 |          5829 |    5829 |
| mean  |  401.49 |       429.216 |       453.789 |  436.88 |
| std   | 258.313 |       228.073 |       208.427 | 223.066 |
| min   |       0 |       20.3686 |            51 | 20.3686 |
| 25%   | 206.316 |           300 |           343 |     290 |
| 50%   |     406 |           406 |           406 |     417 |
| 75%   |     577 |           577 |           577 | 577.813 |
| max   |    1265 |          1265 |          1265 |    1265 |


**** Baseline discharge values for various thickness adjustments
Here we calculate:
+ D_baseline_th_noadj :: Discharge with no thickness adjustment
+ D_baseline_th_300 :: The baseline discharge
+ D_baseline_th_400 :: The discharge assuming the aggressive thickness adjustment
+ D_baseline_th_fit :: The discharge assuming the fitted thickness adjustment
+ D_baseline :: The baseline discharge - picked from our favorite of the above. TBD

#+NAME: discharge_th
#+BEGIN_SRC jupyter-python :exports none :results raw drawer :eval no-export
D_th = pd.DataFrame(index=th.index,
                    columns=['NoAdj','NoAdj_err','300','300_err','400','400_err','fit','fit_err'])

# + D_baseline_th_noadj :: Discharge with no thickness adjustment
D_th['NoAdj'] = vel_baseline.apply(lambda c: c * (th['thick'].values * 200 * meta['err_2D'].values), axis=0) * 917 / 1E12

# should match HeatMap
D_th['NoMillan'] = vel_baseline.apply(lambda c: c * ((th['surface@BedMachine']-th['bed@BedMachine']).values * 200), axis=0) * 917 / 1E12

# D_baseline_th_noadj_err ::
D_th['NoAdj_err'] = vel_baseline.apply(lambda c: c * (th['err'].values * 200 * meta['err_2D'].values), axis=0) * 917 / 1E12

D_th['300'] = vel_baseline.apply(lambda c: c * (th['thick_adj_300'].values * 200 * meta['err_2D'].values), axis=0) * 917 / 1E12
D_th['300_err'] = vel_baseline.apply(lambda c: c * (th['thick_adj_300_err'].values  * 200 * meta['err_2D'].values), axis=0) * 917 / 1E12

D_th['400'] = vel_baseline.apply(lambda c: c * (th['thick_adj_400'].values * 200 * meta['err_2D'].values), axis=0) * 917 / 1E12
D_th['400_err'] = vel_baseline.apply(lambda c: c * (th['thick_adj_400_err'].values * 200 * meta['err_2D'].values), axis=0) * 917 / 1E12

D_th['fit'] = vel_baseline.apply(lambda c: c * (th['fit'].values * 200 * meta['err_2D'].values), axis=0) * 917 / 1E12
D_th['fit_err'] = vel_baseline.apply(lambda c: c * (th['fit_err'].values* 200 * meta['err_2D'].values), axis=0) * 917 / 1E12

D_th.sum(axis=0)
#+END_SRC

#+RESULTS: discharge_th
: NoAdj        481.499868
: NoAdj_err     49.851751
: 300          489.703317
: 300_err       49.768335
: 400          495.959841
: 400_err       52.190290
: fit          493.665593
: fit_err       51.320493
: NoMillan     472.176686
: dtype: float64

**** Map of where thickness adjustments occur

#+BEGIN_SRC jupyter-python :session gate_map :exports none :results raw drawer :tangle no
import matplotlib.pyplot as plt
import numpy as np

from grass_session import Session
from grass.pygrass.modules.shortcuts import general as g
from grass.pygrass.modules.shortcuts import raster as r
from grass.pygrass.modules.shortcuts import vector as v
from grass.pygrass.modules.shortcuts import display as d
from grass.script import array as garray

from grass.pygrass.modules.shortcuts import vector as v
import shapefile

if 'th' not in locals():
    <<load_data>>
    <<millan_2018>>
    <<adjust_thickness>>
    <<adjust_thickness_fit>>
    # <<discharge>>

# th['bad'] = th['thick'] <= 20
th['all_bad'] = False
for g in th[th['bad']]['gates'].unique():
    if all(th[th['gates'] == g]['bad']):
        th.loc[th['gates'] == g, 'all_bad'] = True
        
tmp = meta.copy()
tmp['vel'] = vel_baseline
gates = pd.DataFrame(index=th['gates'].unique())
id = 'gates' #_gateID@gates_100_5000'
gates['x'] = tmp.groupby(id).mean()['x']
gates['y'] = tmp.groupby(id).mean()['y']
gates['all_bad'] = th.groupby('gates').mean()['all_bad']
gates['bad'] = th.groupby('gates').mean()['bad']
gates['regions'] = tmp.groupby(id).first()['regions']
gates['vel_all_bad'] = tmp[th['all_bad'] == 1].groupby(id).mean()['vel']
gates['vel_part_bad'] = tmp[th['bad']>0].groupby(id).mean()['vel']
gates['vel_gd'] = tmp[th['bad'] == 0].groupby(id).mean()['vel']

fig = plt.figure(1, figsize=(8,6)) # w,h
fig.clf()
fig.set_tight_layout(True)

from matplotlib import rc
rc('font', size=12)
rc('text', usetex=False)

import matplotlib.gridspec as gridspec
gs = gridspec.GridSpec(2, 2) #h, w
ax1 = plt.subplot(gs[:,0])
ax2 = plt.subplot(gs[0,1])
ax3 = plt.subplot(gs[1,1])

SIZE=4

# Write out the vector from GRASS to disk
if 'r_regions' not in locals():
    with Session(gisdb="./", location="G", mapset="Mouginot_2019", create_opts=""):
        # r.to.vect input=regions output=regions type=area
        # v.out.ogr -c input=tmp output=tmp.shp format=ESRI_Shapefile --o
        r_regions = shapefile.Reader("./tmp/SHP/tmp.shp")

sf = r_regions

for shape in list(sf.iterShapes()):
   x_lon = np.zeros(len(shape.points))
   y_lat = np.zeros(len(shape.points))
   for ip in range(len(shape.points)):
       x_lon[ip] = shape.points[ip][0]
       y_lat[ip] = shape.points[ip][1]

   dist = np.sqrt(x_lon**2 + y_lat**2)
   dist_d = np.abs(np.diff(dist))
   bad = np.where(dist_d > 5000)[0]
   x_lon[bad] = np.nan; y_lat[bad] = np.nan
   ax1.plot(x_lon, y_lat, 'k', color='lightgray', zorder=-999)
   ax1.text(-130000,-2750000, 'SW')
   ax1.text(-130000,-2125000, 'CW')
   ax1.text(-130000,-1750000, 'NW')
   ax1.text(-135000,-1200000, 'NO')
   ax1.text(260000,-1.35E6, 'NE')
   ax1.text(370000,-2.1E6, 'CE')
   ax1.text(200000,-2.5E6, 'SE')

ax1.scatter(gates['x'],gates['y'], marker='o', color='k', s=SIZE, label="0 % Invalid")
ax1.scatter(gates.loc[gates['all_bad'] == True, 'x'],
            gates.loc[gates['all_bad'] == True, 'y'],
            marker='v', color='r', s=SIZE, label="100 % Invalid")
ax1.scatter(gates.loc[(gates['bad'] > 0) & (gates['bad'] < 1), 'x'], # partial bad
            gates.loc[(gates['bad'] > 0) & (gates['bad'] < 1), 'y'],
            marker='s', color='b', s=SIZE, label="Partial")
ax1.set_yticklabels([])
ax1.set_xticklabels([])
ax1.legend(fontsize=10, markerscale=5)

MS=4

gs = gates.sort_values(by='regions')
gs.index = np.arange(gs['bad'].size)
ax2.plot(gs.loc[gs['bad'] == 1, 'bad']*100, '.', color='r', marker='v', markersize=MS, markerfacecolor='None')
ax2.plot(gs.loc[gs['bad']%1 != 0, 'bad']*100, '.', color='b', marker='s', markersize=MS, markerfacecolor='None')
ax2.plot(gs.loc[gs['bad'] == 0, 'bad']*100, '.', color='k')
ax2.set_ylabel('Invalid thickness\npixels in gate [%]')
ax2.set_xlabel('Gate [#]')

ax3.plot(gs['vel_gd'], '.', color='k', label='Gate pixels all good')
ax3.plot(gs['vel_part_bad'], '.', color='b', label='Gate pixels partial bad', marker='s', markersize=MS, markerfacecolor='None')
ax3.plot(gs['vel_all_bad'], '.', color='r', label='Gate pixels all bad', marker='v', markersize=MS, markerfacecolor='None')
ax3.set_ylabel('Gate average speed [m yr$^{-1}$]')
ax3.set_xlabel('Gate [#]')
ax3.set_yscale('log')
# ax3.legend()

# print region label on ax4. Shade ax4 and ax5 every 2nd region
for n,R in enumerate(gs['regions'].unique()):
    ax2.text(np.mean(gs[gs['regions'] == R].index), 50, R, horizontalalignment='center', rotation=90)
    for a in [ax2,ax3]:
        if n % 2 == 0:
            a.axvspan(gs[gs['regions'] == R].index[0],
                      gs[gs['regions'] == R].index[-1],
                      alpha=0.1, color='k')
             
print("Gates: ", gates.shape[0])
print("Gates w/ any bad pixels: ", gates[gates['bad'] > 0].shape[0])
print("Gates w/ >50% bad pixels: ", gates[gates['bad'] > 0.5].shape[0])
print("Gates w/ all bad pixels: ", gates[gates['bad'] == 1].shape[0])
print("Gates w/ all bad pixels: ", gates[gates['all_bad'] == True].shape[0])
    
plt.savefig('./figs/gate_map.png', transparent=True, bbox_inches='tight', dpi=300)
# plt.savefig('./figs/gate_map.pdf', transparent=True, bbox_inches='tight', dpi=300)

print(tmp[th['bad'] == 0]['vel'].describe())
print(tmp[th['bad'] > 0]['vel'].describe())
#+END_SRC

**** Temporal changes in thickness
+ For each pixel, make daily time series of thickness changes from citet:khan_2016_geodetic
+ Then set 0 to GIMP.0715 date for each pixel
+ Then add them together

#+NAME: adjust_thickness_ts
#+BEGIN_SRC jupyter-python :exports none :results raw drawer
dhdt_ts = dhdt.copy(deep=True)
# dhdt_ts[2016] = dhdt_ts[2015] # assume annual dh/dt continues at fixed rate
# dhdt_ts[2017] = dhdt_ts[2015]
# dhdt_ts[2018] = dhdt_ts[2015]
# dhdt_ts[2016] = 0
# dhdt_ts[2017] = 0
# dhdt_ts[2018] = 0
dhdt_ts[dhdt.columns.max()+1] = 0
dhdt_ts = dhdt_ts.reindex(sorted(dhdt_ts.columns), axis='columns')
dhdt_ts = dhdt_ts.cumsum(axis='columns')
dhdt_ts.columns = dhdt_ts.columns.astype(np.str).astype('datetime64[ns]')
dhdt_ts = dhdt_ts.T.resample('1D').interpolate().T
# from above: daily accumulated change at each discharge pixel for SEC time series

# expand from SEC 1st time to velocity 1st time, assuming no changes in SEC
dhdt_ts[dhdt_ts.columns.min()] = dhdt_ts[dhdt_ts.columns.min()]
dhdt_ts[vel.columns.min()] = dhdt_ts[dhdt_ts.columns.min()]
dhdt_ts = dhdt_ts.T.resample('1D').interpolate().T

th_ts = pd.DataFrame().reindex_like(dhdt_ts)
for idx in th.index:
    t0_pix = th.loc[idx]
    # adjusted thickness at t0_pix['day']
    t0_pix_th = t0_pix['fit'] + (th.loc[idx]['dem@GIMP.0715'] - th.loc[idx]['surface@BedMachine'])

    # now using that thickness, put it in a time Series
    dhdt_pix = dhdt_ts.loc[idx]
    dhdt_pix = dhdt_pix - dhdt_pix.loc[t0_pix['day']]
    th_ts.loc[idx] = t0_pix_th + dhdt_pix

th_ts = th_ts[vel.columns]

# Re-adjust th_ts where thickness < 20 m.
bad = th_ts.min(axis=1) < 20 # Pixels with bad thickness somewhere in the time series
for px in bad[bad == True].index:
    th_ts.loc[px] = fits.predict(np.log10([1,vel_baseline.iloc[px].values[0]]))
#+END_SRC

*** Discharge

And more importantly and long-term, we calculate the following time series discharge products, using our preferred method (fill w/ 300 m):
+ D :: Discharge at gate scale
+ D_err :: The discharge error at gate scale
+ D_fill :: The fill percentage for each gate at each point in time
+ D_sector :: Same, but at Mouginot 2019 sector scale
+ D_sector_err ::
+ D_sector_fill :: 
+ D_region :: Same, but at Mouginot 2019 region scale
+ D_region_err ::
+ D_region_fill ::
+ D_all :: Same, but all GIS
+ D_all_err ::
+ D_all_fill ::

#+BEGIN_SRC jupyter-python :display text/plain :session test :tangle no
import pandas as pd
import numpy as np
filled_D = pd.DataFrame(index=['A','B'], columns=['t1','t3','t4'], data=[[8,9,7],[4,2,1]])
fill = filled_D/filled_D
fill.loc['B','t3'] = np.nan

no_filled_D = filled_D * fill
# filled_weighted_D = filled_D / filled_D.sum()
no_filled_weighted_D = no_filled_D / filled_D.sum()

r = ((filled_D*fill)/filled_D.sum()).sum()
r.round(2)                        
#+END_SRC

#+NAME: discharge
#+BEGIN_SRC jupyter-python :exports none :results raw drawer
# D :: Discharge at pixel scale
# D_err :: The discharge error at pixel scale
# D_fill :: The fill percentage for each pixel at each point in time
D = (vel*th_ts).apply(lambda c: c * (200 * meta['err_2D'].values), axis=0) * 917 / 1E12
# Don't adjust thickness over time
# D = (vel).apply(lambda c: c * (200 * meta['err_2D'].values * th['thick'].values), axis=0) * 917 / 1E12

D_err = vel.apply(lambda c: c * (th['fit_err'] * 200 * meta['err_2D'].values), axis=0) * 917 / 1E12

[DD,DD_err] = [_.copy() for _ in [D,D_err]]
DD[['gates','sectors','regions','ones','name']] = meta[['gates','sectors','regions','ones','name']]
DD_err[['gates','sectors','regions','ones','name']] = meta[['gates','sectors','regions','ones','name']]


# D_gate :: Same, but at the gate scale
# D_gate_err ::
# D_gate_fill ::
D_gates = DD.groupby('gates').sum().drop(['ones','sectors'], axis=1)
D_gates_err = DD_err.groupby('gates').sum().drop(['ones','sectors'], axis=1)
D_gates_fill_weight = pd.DataFrame().reindex_like(D_gates)
for g in D_gates.index:
    g_idx = (DD['gates'] == g)
    D_gates_fill_weight.loc[g] = ((D[g_idx]*fill[g_idx])/D[g_idx].sum()).sum()

D_gates.columns = D_gates.columns.astype(np.str).astype('datetime64[ns]')
D_gates_err.columns = D_gates_err.columns.astype(np.str).astype('datetime64[ns]')
D_gates_fill_weight.columns = D_gates_fill_weight.columns.astype(np.str).astype('datetime64[ns]')
D_gates_fill_weight.clip(lower=0, upper=1, inplace=True)



# D_sector :: Same, but at Mouginot sector scale
# D_sector_err ::
# D_sector_fill ::
D_sectors = DD.groupby('name').sum().drop(['ones','sectors','gates'], axis=1)
D_sectors_err = DD_err.groupby('name').sum().drop(['ones','sectors','gates'], axis=1)
D_sectors_fill_weight = pd.DataFrame().reindex_like(D_sectors)
for s in D_sectors.index:
    s_idx = (DD['name'] == s)
    D_sectors_fill_weight.loc[s] = ((D[s_idx]*fill[s_idx])/D[s_idx].sum()).sum()

D_sectors.columns = D_sectors.columns.astype(np.str).astype('datetime64[ns]')
D_sectors_err.columns = D_sectors_err.columns.astype(np.str).astype('datetime64[ns]')
D_sectors_fill_weight.columns = D_sectors_fill_weight.columns.astype(np.str).astype('datetime64[ns]')
D_sectors_fill_weight.clip(lower=0, upper=1, inplace=True)


# D_region :: Same, but at Mouginot region scale
# D_region_err ::
# D_region_fill ::
D_regions = DD.groupby('regions').sum().drop(['ones','sectors','gates'], axis=1)
D_regions_err = DD_err.groupby('regions').sum().drop(['ones','sectors','gates'], axis=1)
D_regions_fill_weight = pd.DataFrame().reindex_like(D_regions)
for r in D_regions.index:
    r_idx = DD['regions'] == r
    D_regions_fill_weight.loc[r] = ((D[r_idx]*fill[r_idx])/D[r_idx].sum()).sum()
    
    # # or, broken apart into simple steps.
    # # Whether any given pixel is filled (1) or not (0).
    # r_fill = fill[DD['regions'] == r].fillna(value=0)
    # # Discharge for each pixel in this region, using filling
    # r_filled_D = DD[DD['regions'] == r].drop(['sectors','regions','ones'], axis=1)
    # # weighted filling for this region
    # r_fill_weight = ((r_filled_D*r_fill)/r_filled_D.sum()).sum()
    # D_regions_fill_weight.loc[r] = r_fill_weight
    
D_regions.columns = D_regions.columns.astype(np.str).astype('datetime64[ns]')
D_regions_err.columns = D_regions_err.columns.astype(np.str).astype('datetime64[ns]')
D_regions_fill_weight.columns = D_regions_fill_weight.columns.astype(np.str).astype('datetime64[ns]')
D_regions_fill_weight.clip(lower=0, upper=1, inplace=True)


# D_all :: Same, but all GIS
# D_all_err ::
# D_all_fill ::
D_all = DD.drop(['regions','sectors','ones','name','gates'], axis=1).sum()
D_all_err = DD_err.drop(['regions','sectors','ones','name','gates'], axis=1).sum()
D_all_fill_weight = pd.Series().reindex_like(D_all)
for c in D.columns:
    D_all_fill_weight.loc[c] = (fill[c] * (D[c] / D[c].sum())).sum()
#+END_SRC

*** SAVE & RESTORE STATE

#+BEGIN_SRC jupyter-python :results raw drawer :tangle no
%store D
%store D_err
%store fill
%store D_gates
%store D_gates_err
%store D_gates_fill_weight
%store D_sectors
%store D_sectors_err
%store D_sectors_fill_weight
%store D_regions
%store D_regions_err
%store D_regions_fill_weight
%store D_all
%store D_all_err
%store D_all_fill_weight
%store meta
#+END_SRC

#+BEGIN_SRC jupyter-python :results raw drawer :tangle no
%store -r

D = D.T['2000':].T
D_err = D_err.T['2000':].T
fill = fill.T['2000':].T
D_gates = D_gates.T['2000':].T
D_gates_err = D_gates_err.T['2000':].T
D_gates_fill_weight = D_gates_fill_weight.T['2000':].T
D_sectors = D_sectors.T['2000':].T
D_sectors_err = D_sectors_err.T['2000':].T
D_sectors_fill_weight = D_sectors_fill_weight.T['2000':].T
D_regions = D_regions.T['2000':].T
D_regions_err = D_regions_err.T['2000':].T
D_regions_fill_weight = D_regions_fill_weight.T['2000':].T
D_all = D_all.T['2000':].T
D_all_err = D_all_err.T['2000':].T
D_all_fill_weight = D_all_fill_weight.T['2000':].T
#+END_SRC


*** Export Data
**** Crop time series
#+BEGIN_SRC jupyter-python :exports both :results raw drawer

STARTDATE='1986'
D_all = D_all.T[STARTDATE:].T
D_all_err = D_all_err.T[STARTDATE:].T
D_all_fill_weight = D_all_fill_weight.T[STARTDATE:].T
D_gates = D_gates.T[STARTDATE:].T
D_gates_err = D_gates_err.T[STARTDATE:].T
D_gates_fill_weight = D_gates_fill_weight.T[STARTDATE:].T
D_sectors = D_sectors.T[STARTDATE:].T
D_sectors_err = D_sectors_err.T[STARTDATE:].T
D_sectors_fill_weight = D_sectors_fill_weight.T[STARTDATE:].T
D_regions = D_regions.T[STARTDATE:].T
D_regions_err = D_regions_err.T[STARTDATE:].T
D_regions_fill_weight = D_regions_fill_weight.T[STARTDATE:].T
D_all = D_all.T[STARTDATE:].T
D_all_err = D_all_err.T[STARTDATE:].T
D_all_fill_weight = D_all_fill_weight.T[STARTDATE:].T

#+END_SRC

**** README

#+BEGIN_SRC bash :mkdirp ./out :eval no-export
cat << EOF > ./out/README.txt
<<README>>
EOF

cat << EOF | cut -c2- >> ./out/README.txt 
 * Version

 This version of this README generated from git commit: $(git describe --always)
EOF

#+END_SRC

#+RESULTS:

#+NAME: README
#+BEGIN_SRC org
README for "Greenland Ice Sheet solid ice discharge from 1986 through March 2020"
 
Reference paper: doi:10.5194/essd-12-1367-2020  https://doi.org/10.5194/essd-12-1367-2020
Data Citations: doi:10.22008/promice/data/ice_discharge

Source: https://github.com/GEUS-PROMICE/ice_discharge

,* Usage instructions:

When using any of the following data, you are required to cite the paper and the data set.

,* Data Descriptions

Data sets released as part of this work include:
+ Discharge data
+ Gates
+ Surface Elevation Change
+ Code

Each are described briefly below.

,** Discharge Data

This data set is made up of the following files

| Filename            | Description                                                            |
|---------------------+------------------------------------------------------------------------|
| GIS_D.csv           | Greenland Ice Sheet cumulative discharge by timestamp                  |
| GIS_err.csv         | Errors for GIS_D.csv                                                   |
| GIS_coverage.csv    | Coverage for GIS_D.csv                                                 |
| GIS.nc              | Discharge, errors, and covarge for GIS                                 |
| region_D.csv        | Regional discharge                                                     |
| region_err.csv      | Errors for region_D.csv                                                |
| region_coverage.csv | Coverage for region_D.csv                                              |
| region.nc           | Discharge, errors, and covarge for GIS regions                         |
| sector_D.csv        | Sector discharge                                                       |
| sector_err.csv      | Errors for sector_D.csv                                                |
| sector_coverage.csv | Coverage for sector_D.csv                                              |
| sector.nc           | Discharge, errors, and covarge for GIS sectors                         |
| gate_D.csv          | Gate discharge                                                         |
| gate_err.csv        | Errors for gate_D.csv                                                  |
| gate_coverage.csv   | Coverage for gate_D.csv                                                |
| gate.nc             | Discharge, errors, and covarge for GIS gates - including gate metadata |
|---------------------+------------------------------------------------------------------------|
| gate_meta.csv       | Metadata for each gate                                                 |

D and err data have units [Gt yr-1].
Coverage is in range [0, 1]

,** Surface elevation change

See doi:10.22008/promice/data/DTU/surface_elevation_change/v1.0.0

,** Code

See https://github.com/GEUS-PROMICE/ice_discharge

#+END_SRC

**** Gates
***** D, err, coverage
#+BEGIN_SRC jupyter-python :exports both :results raw drawer
D_gatesT = D_gates.T
D_gates_errT = D_gates_err.T
D_gates_fill_weightT = D_gates_fill_weight.T

D_gatesT.index.name = "Date"
D_gates_errT.index.name = "Date"
D_gates_fill_weightT.index.name = "Date"

D_gatesT.to_csv('./out/gate_D.csv', float_format='%.3f')
D_gates_errT.to_csv('./out/gate_err.csv', float_format='%.3f')
D_gates_fill_weightT.to_csv('./out/gate_coverage.csv', float_format='%.3f')
#+END_SRC

**** Sectors
#+BEGIN_SRC jupyter-python :exports both :results raw drawer :display text/org
# meta_sector = pd.DataFrame(index=meta.groupby('sectors').first().index)
# meta_sector['mean x'] = meta.groupby('sectors').mean()['x'].round().astype(np.int)
# meta_sector['mean y'] = meta.groupby('sectors').mean()['y'].round().astype(np.int)
# meta_sector['n gates'] = meta.groupby('sectors').count()['gates'].round().astype(np.int)
# meta_sector['region'] = meta.groupby('sectors').first()['regions']

D_sectorsT = D_sectors.T
D_sectors_errT = D_sectors_err.T
D_sectors_fill_weightT = D_sectors_fill_weight.T

D_sectorsT.index.name = "Date"
D_sectors_errT.index.name = "Date"
D_sectors_fill_weightT.index.name = "Date"

# meta_sector.to_csv('./out/sector_meta.csv')
D_sectorsT.to_csv('./out/sector_D.csv', float_format='%.3f')
D_sectors_errT.to_csv('./out/sector_err.csv', float_format='%.3f')
D_sectors_fill_weightT.to_csv('./out/sector_coverage.csv', float_format='%.3f')

# meta_sector.head(10)
#+END_SRC

**** Regions
#+BEGIN_SRC jupyter-python :exports both :results raw drawer :display text/org
# meta_region = pd.DataFrame(index=meta.groupby('regions').first().index)
# meta_region['n gates'] = meta.groupby('regions').count()['gates'].round().astype(np.int)

D_regionsT = D_regions.T
D_regions_errT = D_regions_err.T
D_regions_fill_weightT = D_regions_fill_weight.T
D_regionsT.index.name = "Date"
D_regions_errT.index.name = "Date"
D_regions_fill_weightT.index.name = "Date"

# meta_region.to_csv('./out/region_meta.csv')
D_regionsT.to_csv('./out/region_D.csv', float_format='%.3f')
D_regions_errT.to_csv('./out/region_err.csv', float_format='%.3f')
D_regions_fill_weightT.to_csv('./out/region_coverage.csv', float_format='%.3f')

# meta_region.head(10)
#+END_SRC


**** GIS
#+BEGIN_SRC jupyter-python :exports both :results raw drawer
D_all.index.name = "Date"
D_all_err.index.name = "Date"
D_all_fill_weight.index.name = "Date"

D_all.to_csv('./out/GIS_D.csv', float_format='%.3f', header=["Discharge [Gt yr-1]"])
D_all_err.to_csv('./out/GIS_err.csv', float_format='%.3f', header=["Discharge Error [Gt yr-1]"])
D_all_fill_weight.to_csv('./out/GIS_coverage.csv', float_format='%.3f', header=["Coverage [unit]"])
#+END_SRC

**** Gates
#+BEGIN_SRC bash :results verbatim :tangle gate_export.sh
g.mapset gates_100_5000

v.out.ogr input=gates_final output=./out/gates.kml format=KML --o
(cd out; zip gates.kmz gates.kml; rm gates.kml)
v.out.ogr input=gates_final output=./out/gates.gpkg format=GPKG --o
#+END_SRC

**** Elevation change

Done manually. See DOI

**** TODO Code

Make sure this Org file is tidy enough...

**** TODO Distribute
#+BEGIN_SRC bash :results verbatim :tangle no
(cd out; zip -e /media/kdm/promicedata/ice_discharge/gates/gates.zip gates*)
(cd out; zip -e /media/kdm/promicedata/ice_discharge/d/D.zip D*csv)
cp ./out/README.txt /media/kdm/promicedata/ice_discharge/

zip -e /media/kdm/promicedata/ice_discharge/code/mankoff_et_al.zip ice_discharge.org

cp ${DATADIR}/Khan_2016/dhdt_1995-2015_GrIS.txt /media/kdm/promicedata/ice_discharge/surface_elevation_change

#+END_SRC

** CSV to NetCDF
:PROPERTIES:
:header-args:jupyter-python+: :tangle csv2nc.py :session discharge :eval no-export
:END:

#+BEGIN_SRC jupyter-python
import pandas as pd
import xarray as xr
import numpy as np
import subprocess
import datetime
#+END_SRC

#+RESULTS:

*** GIS
#+BEGIN_SRC jupyter-python
csvfile = 'GIS'

df_D = pd.read_csv('./out/' + csvfile + '_D.csv', index_col=0, parse_dates=True)
df_err = pd.read_csv('./out/' + csvfile + '_err.csv', index_col=0, parse_dates=True)
df_coverage = pd.read_csv('./out/' + csvfile + '_coverage.csv', index_col=0, parse_dates=True)

# ds = df_D.to_xarray()

# ds = xr.Dataset({'time': df_D})
ds = xr.Dataset()

ds["time"] = ("time", df_D.index)
ds["time"].attrs["long_name"] = "time of measurement"
ds["time"].attrs["standard_name"] = "time"
ds["time"].attrs["axis"] = "T"
ds["time"].attrs["cf_role"] = "timeseries_id"

ds["discharge"] = ("time", df_D['Discharge [Gt yr-1]'].astype(np.float32))
ds["discharge"].attrs["long_name"] = "Discharge"
ds["discharge"].attrs["standard_name"] = "land_ice_mass_tranport_due_to_calving_and_ice_front_melting"
ds["discharge"].attrs["units"] = "Gt yr-1"
ds["discharge"].attrs["coordinates"] = "time"

ds["err"] = ("time", df_err['Discharge Error [Gt yr-1]'].astype(np.float32))
ds["err"].attrs["long_name"] = "Error"
ds["err"].attrs["standard_name"] = "Uncertainty"
ds["err"].attrs["units"] = "Gt yr-1"
ds["err"].attrs["coordinates"] = "time"

ds["coverage"] = ("time", df_coverage['Coverage [unit]'].astype(np.float32))
ds["coverage"].attrs["long_name"] = "Coverage"
ds["coverage"].attrs["standard_name"] = "Coverage"
# ds["coverage"].attrs["units"] = "-"
ds["coverage"].attrs["coordinates"] = "time"

ds.attrs["featureType"] = "timeSeries"
ds.attrs["title"] = "Greenland discharge"
ds.attrs["summary"] = "Greenland discharge"
ds.attrs["keywords"] = "Greenland; Ice Discharge; Calving; Submarine Melt"
# ds.attrs["Conventions"] = "CF-1.8"
ds.attrs["source"] = "git commit: " + subprocess.check_output(["git", "describe", "--always"]).strip().decode('UTF-8')
# ds.attrs["comment"] = "TODO"
# ds.attrs["acknowledgment"] = "TODO"
# ds.attrs["license"] = "TODO"
# ds.attrs["date_created"] = datetime.datetime.now().strftime("%Y-%m-%d")
ds.attrs["creator_name"] = "Ken Mankoff"
ds.attrs["creator_email"] = "kdm@geus.dk"
ds.attrs["creator_url"] = "http://kenmankoff.com"
ds.attrs["institution"] = "GEUS"
# ds.attrs["time_coverage_start"] = "TODO"
# ds.attrs["time_coverage_end"] = "TODO"
# ds.attrs["time_coverage_resolution"] = "TODO"
ds.attrs["references"] = "10.22008/promice/ice_discharge"
ds.attrs["product_version"] = 2.0

# NOTE: Compression here does not save space
# comp = dict(zlib=True, complevel=5)
# encoding = {var: comp for var in ds.data_vars} # all
# encoding = {var: comp for var in ['time','coverage']} # some

ds.to_netcdf('./out/GIS.nc', mode='w')#, encoding=encoding)
#+END_SRC

#+RESULTS:

*** Region
#+BEGIN_SRC jupyter-python

csvfile = 'region'

df_D = pd.read_csv('./out/' + csvfile + '_D.csv', index_col=0, parse_dates=True)
df_err = pd.read_csv('./out/' + csvfile + '_err.csv', index_col=0, parse_dates=True)
df_coverage = pd.read_csv('./out/' + csvfile + '_coverage.csv', index_col=0, parse_dates=True)

ds = xr.Dataset()

ds["time"] = (("time"), df_D.index)
ds["time"].attrs["cf_role"] = "timeseries_id"
ds["time"].attrs["standard_name"] = "time"
# ds["time"].attrs["units"] = "day of year"
# ds["time"].attrs["calendar"] = "julian"
ds["time"].attrs["axis"] = "T"

ds["region"] = (("region"), df_D.columns)
ds["region"].attrs["long_name"] = "Region"
ds["region"].attrs["standard_name"] = "N/A"
ds["region"].attrs["comment"] = "Regions from Mouginot (2019)"

ds["discharge"] = (("region", "time"), df_D.T.values.astype(np.float32))
ds["discharge"].attrs["long_name"] = "Discharge"
ds["discharge"].attrs["standard_name"] = "land_ice_mass_tranport_due_to_calving_and_ice_front_melting"
ds["discharge"].attrs["units"] = "Gt yr-1"
ds["discharge"].attrs["coordinates"] = "time region"

ds["err"] = (("region", "time"), df_err.T.values.astype(np.float32))
ds["err"].attrs["long_name"] = "Error"
ds["err"].attrs["standard_name"] = "Uncertainty"
ds["err"].attrs["units"] = "Gt yr-1"
ds["err"].attrs["coordinates"] = "time region"

ds["coverage"] = (("region", "time"), df_coverage.T.values.astype(np.float32))
ds["coverage"].attrs["long_name"] = "Coverage"
ds["coverage"].attrs["standard_name"] = "Coverage"
# ds["coverage"].attrs["units"] = "-"
ds["coverage"].attrs["coordinates"] = "time region"

# ds["lat"] = (("station"), meta.loc['lat'].astype(np.float32))
# #ds["lat"].attrs["coordinates"] = "station"
# ds["lat"].attrs["long_name"] = "latitude"
# ds["lat"].attrs["standard_name"] = "latitude"
# ds["lat"].attrs["units"] = "degrees_north"
# ds["lat"].attrs["axis"] = "Y"

# ds["lon"] = (("station"), meta.loc['lon'].astype(np.float32))
# #ds["lon"].attrs["coordinates"] = "station"
# ds["lon"].attrs["long_name"] = "longitude"
# ds["lon"].attrs["standard_name"] = "longitude"
# ds["lon"].attrs["units"] = "degrees_east"
# ds["lon"].attrs["axis"] = "X"

# ds["alt"] = (("station"), meta.loc['elev'].astype(np.float32))
# ds["alt"].attrs["long_name"] = "height_above_mean_sea_level"
# ds["alt"].attrs["standard_name"] = "altitude"
# # ds["alt"].attrs["long_name"] = "height above mean sea level"
# # ds["alt"].attrs["standard_name"] = "height"
# ds["alt"].attrs["units"] = "m"
# ds["alt"].attrs["positive"] = "up"
# ds["alt"].attrs["axis"] = "Z"

ds.attrs["featureType"] = "timeSeries"
ds.attrs["title"] = "Greenland discharge"
ds.attrs["summary"] = "Greenland discharge per region"
ds.attrs["keywords"] = "Greenland; Ice Discharge; Calving; Submarine Melt"
# ds.attrs["Conventions"] = "CF-1.8"
ds.attrs["source"] = "git commit: " + subprocess.check_output(["git", "describe", "--always"]).strip().decode('UTF-8')
# ds.attrs["comment"] = "TODO"
# ds.attrs["acknowledgment"] = "TODO"
# ds.attrs["license"] = "TODO"
# ds.attrs["date_created"] = datetime.datetime.now().strftime("%Y-%m-%d")
ds.attrs["creator_name"] = "Ken Mankoff"
ds.attrs["creator_email"] = "kdm@geus.dk"
ds.attrs["creator_url"] = "http://kenmankoff.com"
ds.attrs["institution"] = "GEUS"
# ds.attrs["time_coverage_start"] = "TODO"
# ds.attrs["time_coverage_end"] = "TODO"
# ds.attrs["time_coverage_resolution"] = "TODO"
ds.attrs["references"] = "10.22008/promice/ice_discharge"
ds.attrs["product_version"] = 2.0

comp = dict(zlib=True, complevel=9)
encoding = {var: comp for var in ds.data_vars} # all

ds.to_netcdf('./out/region.nc', mode='w', encoding=encoding)
#+END_SRC

#+RESULTS:

*** Sectors
#+BEGIN_SRC jupyter-python

csvfile = 'sector'

df_D = pd.read_csv('./out/' + csvfile + '_D.csv', index_col=0, parse_dates=True)
df_err = pd.read_csv('./out/' + csvfile + '_err.csv', index_col=0, parse_dates=True)
df_coverage = pd.read_csv('./out/' + csvfile + '_coverage.csv', index_col=0, parse_dates=True)

ds = xr.Dataset()

ds["time"] = (("time"), df_D.index)
ds["time"].attrs["cf_role"] = "timeseries_id"
ds["time"].attrs["standard_name"] = "time"
# ds["time"].attrs["units"] = "day of year"
# ds["time"].attrs["calendar"] = "julian"
ds["time"].attrs["axis"] = "T"

ds["sector"] = (("sector"), df_D.columns)
ds["sector"].attrs["long_name"] = "Sector"
ds["sector"].attrs["standard_name"] = "N/A"
ds["sector"].attrs["comment"] = "Sectors from Mouginot (2019)"

ds["discharge"] = (("sector", "time"), df_D.T.values.astype(np.float32))
ds["discharge"].attrs["long_name"] = "Discharge"
ds["discharge"].attrs["standard_name"] = "land_ice_mass_tranport_due_to_calving_and_ice_front_melting"
ds["discharge"].attrs["units"] = "Gt yr-1"
ds["discharge"].attrs["coordinates"] = "time sector"

ds["err"] = (("sector", "time"), df_err.T.values.astype(np.float32))
ds["err"].attrs["long_name"] = "Error"
ds["err"].attrs["standard_name"] = "Uncertainty"
ds["err"].attrs["units"] = "Gt yr-1"
ds["err"].attrs["coordinates"] = "time sector"

ds["coverage"] = (("sector", "time"), df_coverage.T.values.astype(np.float32))
ds["coverage"].attrs["long_name"] = "Coverage"
ds["coverage"].attrs["standard_name"] = "Coverage"
# ds["coverage"].attrs["units"] = "-"
ds["coverage"].attrs["coordinates"] = "time sector"

# ds["lat"] = (("station"), meta.loc['lat'].astype(np.float32))
# #ds["lat"].attrs["coordinates"] = "station"
# ds["lat"].attrs["long_name"] = "latitude"
# ds["lat"].attrs["standard_name"] = "latitude"
# ds["lat"].attrs["units"] = "degrees_north"
# ds["lat"].attrs["axis"] = "Y"

# ds["lon"] = (("station"), meta.loc['lon'].astype(np.float32))
# #ds["lon"].attrs["coordinates"] = "station"
# ds["lon"].attrs["long_name"] = "longitude"
# ds["lon"].attrs["standard_name"] = "longitude"
# ds["lon"].attrs["units"] = "degrees_east"
# ds["lon"].attrs["axis"] = "X"

# ds["alt"] = (("station"), meta.loc['elev'].astype(np.float32))
# ds["alt"].attrs["long_name"] = "height_above_mean_sea_level"
# ds["alt"].attrs["standard_name"] = "altitude"
# # ds["alt"].attrs["long_name"] = "height above mean sea level"
# # ds["alt"].attrs["standard_name"] = "height"
# ds["alt"].attrs["units"] = "m"
# ds["alt"].attrs["positive"] = "up"
# ds["alt"].attrs["axis"] = "Z"

ds.attrs["featureType"] = "timeSeries"
ds.attrs["title"] = "Greenland discharge"
ds.attrs["summary"] = "Greenland discharge per sector"
ds.attrs["keywords"] = "Greenland; Ice Discharge; Calving; Submarine Melt"
# ds.attrs["Conventions"] = "CF-1.8"
ds.attrs["source"] = "git commit: " + subprocess.check_output(["git", "describe", "--always"]).strip().decode('UTF-8')
# ds.attrs["comment"] = "TODO"
# ds.attrs["acknowledgment"] = "TODO"
# ds.attrs["license"] = "TODO"
# ds.attrs["date_created"] = datetime.datetime.now().strftime("%Y-%m-%d")
ds.attrs["creator_name"] = "Ken Mankoff"
ds.attrs["creator_email"] = "kdm@geus.dk"
ds.attrs["creator_url"] = "http://kenmankoff.com"
ds.attrs["institution"] = "GEUS"
# ds.attrs["time_coverage_start"] = "TODO"
# ds.attrs["time_coverage_end"] = "TODO"
# ds.attrs["time_coverage_resolution"] = "TODO"
ds.attrs["references"] = "10.22008/promice/ice_discharge"
ds.attrs["product_version"] = 2.0

comp = dict(zlib=True, complevel=9)
encoding = {var: comp for var in ds.data_vars} # all

ds.to_netcdf('./out/sector.nc', mode='w', encoding=encoding)
#+END_SRC

#+RESULTS:

*** Gates

#+BEGIN_SRC jupyter-python

csvfile = 'gate'

df_D = pd.read_csv('./out/' + csvfile + '_D.csv', index_col=0, parse_dates=True)
df_err = pd.read_csv('./out/' + csvfile + '_err.csv', index_col=0, parse_dates=True)
df_coverage = pd.read_csv('./out/' + csvfile + '_coverage.csv', index_col=0, parse_dates=True)

meta = pd.read_csv("./out/gate_meta.csv")

ds = xr.Dataset()

ds["time"] = (("time"), df_D.index)
ds["time"].attrs["cf_role"] = "timeseries_id"
ds["time"].attrs["standard_name"] = "time"
# ds["time"].attrs["units"] = "day of year"
# ds["time"].attrs["calendar"] = "julian"
ds["time"].attrs["axis"] = "T"

ds["gate"] = (("gate"), df_D.columns.astype(np.int32))
ds["gate"].attrs["long_name"] = "Gate"
ds["gate"].attrs["standard_name"] = "N/A"

ds["discharge"] = (("gate", "time"), df_D.T.values.astype(np.float32))
ds["discharge"].attrs["long_name"] = "Discharge"
ds["discharge"].attrs["standard_name"] = "land_ice_mass_tranport_due_to_calving_and_ice_front_melting"
ds["discharge"].attrs["units"] = "Gt yr-1"
ds["discharge"].attrs["coordinates"] = "time gate"

ds["err"] = (("gate", "time"), df_err.T.values.astype(np.float32))
ds["err"].attrs["long_name"] = "Error"
ds["err"].attrs["standard_name"] = "Uncertainty"
ds["err"].attrs["units"] = "Gt yr-1"
ds["err"].attrs["coordinates"] = "time gate"

ds["coverage"] = (("gate", "time"), df_coverage.T.values.astype(np.float32))
ds["coverage"].attrs["long_name"] = "Coverage"
ds["coverage"].attrs["standard_name"] = "Coverage"
# ds["coverage"].attrs["units"] = "-"
ds["coverage"].attrs["coordinates"] = "time gate"

ds["mean_x"] = (("gate"), meta.mean_x.astype(np.int32))
ds["mean_x"].attrs["long_name"] = "Mean x coordinate of gate in EPSG:3413"
ds["mean_x"].attrs["standard_name"] = "Mean x"

ds["mean_y"] = (("gate"), meta.mean_y.astype(np.int32))
ds["mean_y"].attrs["long_name"] = "Mean y coordinate of gate in EPSG:3413"
ds["mean_y"].attrs["standard_name"] = "Mean y"

ds["mean_lon"] = (("gate"), meta.lon.astype(np.float32))
ds["mean_lon"].attrs["long_name"] = "Mean lon coordinate of gate"
ds["mean_lon"].attrs["standard_name"] = "Longitude"

ds["mean_lat"] = (("gate"), meta.lat.astype(np.float32))
ds["mean_lat"].attrs["long_name"] = "Mean lat coordinate of gate"
ds["mean_lat"].attrs["standard_name"] = "Latitude"

ds["sector"] = (("gate"), meta.sector.astype(np.int32))
ds["sector"].attrs["long_name"] = "Mouginot 2019 sector containing gate"

ds["region"] = (("gate"), meta.region)
ds["region"].attrs["long_name"] = "Mouginot 2019 region containing gate"

ds["Zwally_2012"] = (("gate"), meta.Zwally_2012)
ds["Zwally_2012"].attrs["long_name"] = "Zwally 2012 sector containing gate"

ds["name_Bjørk"] = (("gate"), meta.Bjork_2015)
ds["name_Bjørk"].attrs["long_name"] = "Nearest name from Bjørk (2015)"

ds["name_Mouginot"] = (("gate"), meta.Mouginot_2019)
ds["name_Mouginot"].attrs["long_name"] = "Nearest name from Mouginot (2019)"

ds.attrs["featureType"] = "timeSeries"
ds.attrs["title"] = "Greenland discharge"
ds.attrs["summary"] = "Greenland discharge per gate"
ds.attrs["keywords"] = "Greenland; Ice Discharge; Calving; Submarine Melt"
# ds.attrs["Conventions"] = "CF-1.8"
ds.attrs["source"] = "git commit: " + subprocess.check_output(["git", "describe", "--always"]).strip().decode('UTF-8')
# ds.attrs["comment"] = "TODO"
# ds.attrs["acknowledgment"] = "TODO"
# ds.attrs["license"] = "TODO"
# ds.attrs["date_created"] = datetime.datetime.now().strftime("%Y-%m-%d")
ds.attrs["creator_name"] = "Ken Mankoff"
ds.attrs["creator_email"] = "kdm@geus.dk"
ds.attrs["creator_url"] = "http://kenmankoff.com"
ds.attrs["institution"] = "GEUS"
# ds.attrs["time_coverage_start"] = "TODO"
# ds.attrs["time_coverage_end"] = "TODO"
# ds.attrs["time_coverage_resolution"] = "TODO"
ds.attrs["references"] = "10.22008/promice/ice_discharge"
ds.attrs["product_version"] = 2.0

comp = dict(zlib=True, complevel=9)
encoding = {var: comp for var in ds.data_vars} # all

ds.to_netcdf('./out/gate.nc', mode='w', encoding=encoding)
#+END_SRC

#+RESULTS:


** Figures
:PROPERTIES:
:header-args:jupyter-python+: :tangle figures.py
:header-args:jupyter-python+: :session sob_figures
:END:
*** Overview
:PROPERTIES:
:header-args:jupyter-python+: :tangle no
:END:
**** Top contributors
#+BEGIN_SRC jupyter-python :exports both :results raw drawer :display text/org :eval no-export
import pandas as pd

# annual average
df = pd.read_csv('./out/sector_D.csv', index_col=0, parse_dates=True)\
       .resample('1D')\
       .mean()\
       .interpolate(method='time')\
       .resample('A')\
       .mean()\

top_few = df.iloc[-1].sort_values(ascending=False).head(8)
# names = {}
# for m in mouginot_names: names[m] = ""
# names["JAKOBSHAVN_ISBRAE"] = "Sermeq Kujalleq (Jakobshavn Isbræ)"
# names["KOGE_BUGT_C"] = "(Køge Bugt C)"
# names["ZACHARIAE_ISSTROM"] = "Zachariae Isstrøm"
# names["RINK_ISBRAE"] = 'Kangilliup Sermia (Rink Isbræ)',
# names["NIOGHALVFJERDSFJORDEN"] = "(Nioghalvfjerdsfjorden)"

meta = pd.read_csv("./out/gate_meta.csv")

out = pd.DataFrame(index=top_few.index, columns=["D","x","y"])
for name in out.index:
    out.loc[name]["D"] = top_few[name]
    out.loc[name]["x"] = meta[meta["Mouginot_2019"] == name]["mean_x"].values[0]
    out.loc[name]["y"] = meta[meta["Mouginot_2019"] == name]["mean_y"].values[0]

out.to_csv('./tmp/overview_D.csv')
out
#+END_SRC

#+RESULTS:
|                       |       D |       x |            y |
|-----------------------+---------+---------+--------------|
| JAKOBSHAVN_ISBRAE     | 44.0496 | -182123 |  -2.2672e+06 |
| HELHEIMGLETSCHER      | 31.2242 |  304157 | -2.57653e+06 |
| KANGERLUSSUAQ         | 25.2912 |  487300 | -2.28998e+06 |
| ZACHARIAE_ISSTROM     | 15.8577 |  488407 | -1.10017e+06 |
| KOGE_BUGT_C           | 15.0238 |  184648 | -2.72185e+06 |
| NIOGHALVFJERDSFJORDEN | 13.2263 |  439187 |  -1.0736e+06 |
| RINK_ISBRAE           | 12.4659 | -224240 | -1.97637e+06 |
| PETERMANN_GLETSCHER   |  11.765 | -261888 |      -996839 |

**** Prep data

#+BEGIN_SRC bash :results verbatim
grass -c ./G/fig_overview
g.region -d
r.mask -r


###
### vel
###
r.mask mask_GIC@Mouginot_2019 --o
r.mapcalc "vel = vel_baseline@MEaSUREs.0478" --o
r.mask -r

r.mapcalc "vel2 = if(vel < 100, null(), vel)" --o
# r.mapcalc "vel2 = if(vel2 > max(vel2)*0.5, max(vel2)*0.5, vel2)" --o
# r.colors -g map=vel2 color=oranges

cat << EOF | r.colors map=vel2 rules=-
0 255:255:255
99 255:255:255
100 255:235:215
500 255:128:0
15000 255:128:0
nv 255:255:255
default 255:255:255
EOF

g.copy vector=sectors@Mouginot_2019,sectors --o
g.copy vector=regions@Mouginot_2019,regions --o
g.copy vector=gates_final@gates_100_5000,gates --o


### get baseline discharge at each gate
v.in.ascii input=./tmp/overview_D.csv output=overview_D separator=, skip=1 x=2 y=3 --o


###
### Ocean Basemap
###
r.mask -i mask@BedMachine
g.region res=1000
r.relief input=bed@BedMachine output=ocean_relief zscale=30  --o
# r.colors map=bed@BedMachine color=srtm_plus
r.colors -ne map=bed@BedMachine color=water
r.shade shade=ocean_relief color=bed@BedMachine output=ocean_shade --o
g.region -d


r.mask -r 
g.region res=2500
r.relief input=bed@BedMachine output=land_relief zscale=30  --o
r.mapcalc "land_relief = land_relief" --o
# r.colors map=bed@BedMachine color=srtm_plus
# r.shade shade=land_relief color=bed@BedMachine output=land_shade --o
g.region -d




g.region -d
r.mask -r
g.copy mask_ice@BedMachine,ice --o
# r.mapcalc "ice = if(isnull(ice), 2, 1)" --o
cat << EOF | r.colors map=ice rules=-
# 2 0:0:0
1 255:255:255
EOF



r.mask -r
d.mon start=wx0
d.erase
d.rast land_relief
d.rast ocean_shade
# d.rast ocean_relief
# d.rast land_shade
d.rast ice
d.rast vel2


## now patch them all to there R,G,B channels so we can produce a single ps.map raster.

g.region res=1000
r.mapcalc --o <<EOF
ocean.r = if(isnull(ocean_shade), null(), r#ocean_shade)
ocean.g = if(isnull(ocean_shade), null(), g#ocean_shade)
ocean.b = if(isnull(ocean_shade), null(), b#ocean_shade)
land.r = if(isnull(land_relief), null(), r#land_relief)
land.g = if(isnull(land_relief), null(), g#land_relief)
land.b = if(isnull(land_relief), null(), b#land_relief)
ice.r = if(isnull(ice), null(), r#ice)
ice.g = if(isnull(ice), null(), g#ice)
ice.b = if(isnull(ice), null(), b#ice)
vel.r = if(isnull(vel2), null(), r#vel2)
vel.g = if(isnull(vel2), null(), g#vel2)
vel.b = if(isnull(vel2), null(), b#vel2)
EOF

r.patch -s input=vel.r,ice.r,ocean.r,land.r output=rr --o
r.patch -s input=vel.g,ice.g,ocean.g,land.g output=gg --o
r.patch -s input=vel.b,ice.b,ocean.b,land.b output=bb --o

r.colors map=rr,gg,bb color=grey

d.erase
d.rgb -n red=rr green=gg blue=bb


g.region res=1000
cat << EOF | ps.map input=- output=./figs/psmap/BASE.ps --o
border n
rgb rr gg bb
EOF
g.region -d
# convert ${CONVERTOPTS} -transparent white ./figs/psmap/vel.ps ./figs/psmap/vel.png



# gates at each of the top 7 dischargers
# for row in $(db.select -c table=overview_D | tr ' ' '_' | tac); do
g.region -d
r.mapcalc "vel3 = vel2" --o

# r.colors map=vel3 color=oranges
cat << EOF | r.colors map=vel3 rules=-
0 255:255:255
99 255:255:255
100 255:235:215
10000 255:128:0
20000 255:128:0
nv 255:255:255
default 255:255:255
EOF



mkdir -p ./figs/psmap
id=$(db.select -c sql='select cat from overview_D'|head -n1) # DEBUG
for id in $(db.select -c sql='select cat from overview_D'); do
  xy=$(db.select -c sql="select int_1,int_2 from overview_D where cat == '${id}'")
  x=$(echo ${xy}|cut -d"|" -f1)
  y=$(echo ${xy}|cut -d"|" -f2)
  g.region w=$x s=$y e=$(( $x + 1 )) n=$(( $y + 1))
  g.region w=w-15000 s=s-15000 e=e+15000 n=n+15000 res=200
  g.region save=${id} --o

  cat << EOF | ps.map input=- output=./figs/psmap/${id}.ps --o
border n
raster vel3
vareas gates
  color black
  end
EOF
  convert -trim ./figs/psmap/${id}.{ps,png}
done


# overview map w/ boxes
# db.select -c sql='select cat from overview_D'
# 1 through 8

g.region -d res=1000
cat << EOF | ps.map input=- output=./figs/psmap/BASE_boxes.ps --o
border n
rgb rr gg bb
region 1
  color black
  width 1
  end  
region 2
  color black
  width 1
  end  
region 3
  color black
  width 1
  end  
region 4
  color black
  width 1
  end  
region 5
  color black
  width 1
  end  
region 6
  color black
  width 1
  end  
region 7
  color black
  width 1
  end  
region 8
  color black
  width 1
  end  
EOF
g.region -d
#+END_SRC

**** ps.map overview
+ create named regions with
  + d.mon start=wx0
  + d.rast vel
  + d.rast gates color=red
  + zoom, then "set computational region extent from display"
  + then "g.region save=<name>"

#+BEGIN_SRC bash :results verbatim
g.mapset fig_overview
g.list type=region mapset=.
# g.remove -f type=region pattern=*
#+END_SRC


#+BEGIN_SRC PSMAP :tangle overview.psmap
border n

rgb rr gg bb

# raster vel2
#+END_SRC

**** ps.map inset

#+BEGIN_SRC PSMAP :tangle overview_inset.psmap
border n

raster vel3

vareas gates
  color black
  end

end
#+END_SRC

**** Run psmap

#+BEGIN_SRC bash :results verbatim
g.region -d res=5000 -pa
ps.map input=overview.psmap output=overview.ps --o; o overview.ps
# ps.map -e input=overview.psmap output=overview.eps --o; o overview.eps

region=$(g.list type=region mapset=.|head -n1) # DEBUG
for region in $(g.list type=region mapset=.); do
  g.region ${region}
  g.region res=100
  ps.map input=overview_inset.psmap output=${region}.ps --o; 
  # o ${region}.ps
  convert -trim -transparent white ${region}.ps ./figs/psmap/${region}.png
  rm ${region}.ps
  # o ./figs/psmap/${region}.png
done
#+END_SRC

**** Configure in Inkscape

Manually align and adjust in Inkscape, add text, boxes, etc. then...

#+BEGIN_SRC bash :results verbatim
inkscape -z ./figs/overview.svg -e ./figs/overview.png
#+END_SRC

*** Discharge Time Series - GIS
#+NAME: fig:discharge_ts
#+BEGIN_SRC jupyter-python :results raw drawer :display text/plain :eval no-export
import matplotlib.gridspec as gridspec
import numpy as np
import pandas as pd
from adjust_spines import adjust_spines as adj
import matplotlib.pyplot as plt
import datetime as dt

plt.close(1)

fig = plt.figure(1, figsize=(9,5)) # w,h
fig.clf()
grid = plt.GridSpec(2, 1, height_ratios=[1,5], hspace=0.1) # h, w

ax_D = fig.add_subplot(grid[1,:])
ax_coverage = fig.add_subplot(grid[0,:], sharex=ax_D)

adj(ax_D, ['left','bottom'])
adj(ax_coverage, ['left'])
ax_coverage.minorticks_off()
ax_coverage.tick_params(length=0, which='both', axis='x')

D = pd.read_csv("./out/GIS_D.csv", index_col=0, parse_dates=True)
err = pd.read_csv("./out/GIS_err.csv", index_col=0, parse_dates=True)
coverage = pd.read_csv("./out/GIS_coverage.csv", index_col=0, parse_dates=True)

THRESH = coverage.values.flatten() < 0.5
D[THRESH] = np.nan
err[THRESH] = np.nan
coverage[THRESH] = np.nan

# Add t0 and t_end so that graph covers a nice time span
def pad_df(df):
    df = df.append(pd.DataFrame(index=np.array(['1986-01-01']).astype('datetime64[ns]')), sort=True)
    idx = str(df.index.year.max())+'-12-31'
    df = df.append(pd.DataFrame(index=np.array([idx]).astype('datetime64[ns]')), sort=True)
    df = df.sort_index()
    return df

D = pad_df(D)
err = pad_df(err)
coverage = pad_df(coverage)

MS=4
ax_D.errorbar(err.index, D.values, fmt='o', mfc='none', mec='k', ms=MS)
for i in np.arange(D.values.size):
    ax_D.errorbar(D.index[i], D.values[i],
                  yerr=err.values[i], ecolor='grey',
                  alpha=coverage.values[i][0],
                  marker='o', ms=MS, mfc='k', mec='k')

# Take annual average from daily interpolated rather than the existing samples.
D_day_year = D.resample('1D').mean().interpolate(method='time',limit_area='inside',axis=0).resample('A').mean()
err_day_year = err.resample('1D').mean().interpolate(method='time',limit_area='inside',axis=0).resample('A').mean()

# No annual average if few sample
num_obs = D.resample('Y').count().values
D_day_year[num_obs < 4] = np.nan
err_day_year[num_obs < 4] = np.nan

Z=99
D_day_year.plot(drawstyle='steps', linewidth=3, ax=ax_D, alpha=0.75, color='orange', zorder=Z)

ax_D.legend("", framealpha=0)
ax_D.set_xlabel('Time [Years]')
ax_D.set_ylabel('Discharge [Gt yr$^{-1}$]')

import matplotlib.dates as mdates
ax_D.xaxis.set_major_locator(mdates.YearLocator())
ax_D.minorticks_off()
ax_D.xaxis.set_tick_params(rotation=-90) #, ha="left", rotation_mode="anchor")
for tick in ax_D.xaxis.get_majorticklabels():
    tick.set_horizontalalignment("left")

ax_D.set_xlim(D.index[0], D.index[-1])

###
### Coverage
###

ax_coverage.scatter(coverage.index, coverage.values*100,
                    color='k',
                    marker='.',
                    alpha=0.25)
                  # linewidth=3,
ax_coverage.set_ylim(45,105)
ax_coverage.set_yticks([50,100])
ax_coverage.spines['left'].set_bounds(ax_coverage.get_ylim()[0],100)
ax_coverage.set_ylabel('Coverage [%]')

plt.savefig('./figs/discharge_ts.png', transparent=False, bbox_inches='tight', dpi=300)

disp = pd.DataFrame(index = D_day_year.index.year,
                    data = {'D' : D_day_year.values.flatten(), 
                            'err' : err_day_year.values.flatten()})
disp.index.name = 'Year'
disp
#+END_SRC

#+RESULTS: fig:discharge_ts
#+begin_example
               D        err
Year                       
1986         NaN        NaN
1987  453.309986  46.829545
1988  442.026985  45.318031
1989         NaN        NaN
1990  444.998890  46.796828
1991         NaN        NaN
1992         NaN        NaN
1993         NaN        NaN
1994         NaN        NaN
1995         NaN        NaN
1996         NaN        NaN
1997         NaN        NaN
1998  436.475229  44.617930
1999         NaN        NaN
2000  441.803382  44.189384
2001  444.055473  44.245330
2002  461.489628  46.026021
2003  474.376248  47.198290
2004  485.665522  48.680195
2005  496.329301  49.624639
2006  488.221824  49.041769
2007  479.357540  48.491110
2008  482.936008  49.376899
2009  488.183501  49.931460
2010  494.055727  50.669375
2011  497.474820  51.050237
2012  493.518516  51.123998
2013  496.733490  51.143418
2014  499.927477  51.246976
2015  502.976869  51.420012
2016  492.353186  50.575257
2017  498.490550  50.833692
2018  491.820198  50.056542
2019  488.238976  50.010446
2020  498.609277  51.390258
2021  510.750188  52.749159
#+end_example





*** Discharge Time Series - Regions
#+NAME: fig:discharge_ts_regions
#+BEGIN_SRC jupyter-python :results raw drawer :display text/plain :eval no-export
import matplotlib.gridspec as gridspec
import numpy as np
import pandas as pd
from adjust_spines import adjust_spines as adj
import datetime as dt

plt.close(1)

fig = plt.figure(1, figsize=(9,7)) # w,h
fig.clf()
# fig.set_tight_layout(True)
grid = plt.GridSpec(2, 1, height_ratios=[1,6], hspace=0.1) # h, w

ax_D = fig.add_subplot(grid[1,:])
ax_coverage = fig.add_subplot(grid[0,:], sharex=ax_D)

from adjust_spines import adjust_spines as adj
adj(ax_D, ['left','bottom'])
adj(ax_coverage, ['left'])
ax_coverage.minorticks_off()
ax_coverage.tick_params(length=0, which='both', axis='x')


D = pd.read_csv("./out/region_D.csv", index_col=0, parse_dates=True)
err = pd.read_csv("./out/region_err.csv", index_col=0, parse_dates=True)
coverage = pd.read_csv("./out/region_coverage.csv", index_col=0, parse_dates=True)

THRESH = coverage < 0.5
D[THRESH] = np.nan
err[THRESH] = np.nan
coverage[THRESH] = np.nan

def pad_df(df):
    df = df.append(pd.DataFrame(index=np.array(['1986-01-01']).astype('datetime64[ns]')), sort=True)
    idx = str(df.index.year.max())+'-12-31'
    df = df.append(pd.DataFrame(index=np.array([idx]).astype('datetime64[ns]')), sort=True)
    df = df.sort_index()
    return df

D = pad_df(D)
err = pad_df(err)
coverage = pad_df(coverage)

### Take annual average from daily interpolated rather than the existing samples.
D_day_year = D.resample('1D',axis='rows').mean().interpolate(method='time',limit_area='inside').resample('A',axis='rows').mean()
err_day_year=err.resample('1D',axis='rows').mean().interpolate(method='time',limit_area='inside').resample('A',axis='rows').mean()

# No annual average if few sample
num_obs = D.resample('Y').count().values
D_day_year[num_obs<=3] = np.nan
err_day_year[num_obs<=3] = np.nan

MS=4
Z=99
for r in D.columns:
    e = ax_D.errorbar(D[r].index, D[r].values, fmt='o', mfc='none', ms=MS)
    C = e.lines[0].get_color()
    D_day_year[r].plot(drawstyle='steps', linewidth=2, ax=ax_D,
                       color=C,
                       # color='orange'
                       alpha=0.75, zorder=Z)
    for i in np.arange(D.index.size):
        ax_D.errorbar(D.iloc[i].name, D.iloc[i][r],
                      yerr=err.iloc[i][r], ecolor='gray',
                      marker='o', ms=MS,
                      # mfc='k', mec='k',
                      mfc=C, mec=C,
                      alpha=coverage.iloc[i][r])

    tx = pd.Timestamp(str(D[r].dropna().index[-1].year) + '-01-01') + dt.timedelta(days=380)
    ty = D_day_year[r].dropna().iloc[-1]
    # if r in ['CE', 'SW']: ty=ty-4
    # if r == 'NE': ty=ty+4
    # if r == 'NO': ty=ty-2
    ax_D.text(tx, ty, r, verticalalignment='center', horizontalalignment='left')

    # if r in ['CE','NE','SE']:
    ax_coverage.scatter(coverage.index, coverage[r]*100,
                        marker='.',
                        alpha=0.25,
                        color=C)

ax_coverage.set_ylabel('Coverage [%]')
ax_coverage.set_ylim(45,105)
ax_coverage.set_yticks([50,100])
ax_coverage.spines['left'].set_bounds(ax_coverage.get_ylim()[0],100)
    
import matplotlib.dates as mdates
ax_D.xaxis.set_major_locator(mdates.YearLocator())

# plt.legend()
ax_D.legend("", framealpha=0)
ax_D.set_xlabel('Time [Years]')
ax_D.set_ylabel('Discharge [Gt yr$^{-1}$]')
ax_D.set_xlim(D.index[0], D.index[-1])
ax_D.set_xticklabels(D.index.year.unique())
# ax_D.set_yscale('log')

ax_D.xaxis.set_tick_params(rotation=-90)
for tick in ax_D.xaxis.get_majorticklabels():
    tick.set_horizontalalignment("left")

plt.savefig('./figs/discharge_ts_regions.png', transparent=False, bbox_inches='tight', dpi=300)
# plt.savefig('./figs/discharge_ts_regions.pdf', transparent=True, bbox_inches='tight', dpi=300)

Err_pct = (err_day_year.values/D_day_year.values*100).round().astype(np.int).astype(np.str)
Err_pct[Err_pct.astype(np.float)<0] = 'NaN'
tbl = (D_day_year.round().fillna(value=0).astype(np.int).astype(np.str) + ' ('+Err_pct+')')
tbl.index = tbl.index.year.astype(np.str)
tbl.columns = [_ + ' (Err %)' for _ in tbl.columns]
tbl
#+END_SRC

#+RESULTS: fig:discharge_ts_regions
#+begin_example
     CE (Err %) CW (Err %) NE (Err %) NO (Err %) NW (Err %) SE (Err %) SW (Err %)
1986    68 (11)    0 (NaN)     23 (8)    0 (NaN)    0 (NaN)    0 (NaN)    0 (NaN)
1987    67 (11)     71 (9)     22 (8)     24 (8)     94 (8)    0 (NaN)    0 (NaN)
1988    67 (11)     68 (8)     22 (8)     23 (8)    0 (NaN)    0 (NaN)    0 (NaN)
1989    68 (11)     69 (8)     21 (8)     23 (8)    0 (NaN)    0 (NaN)    0 (NaN)
1990    70 (12)     68 (8)     22 (8)     22 (8)    0 (NaN)    0 (NaN)    0 (NaN)
1991    0 (NaN)    0 (NaN)    0 (NaN)    0 (NaN)    0 (NaN)    0 (NaN)    0 (NaN)
1992    0 (NaN)    0 (NaN)    0 (NaN)    0 (NaN)    0 (NaN)    0 (NaN)    0 (NaN)
1993    0 (NaN)    0 (NaN)    0 (NaN)    0 (NaN)    0 (NaN)    0 (NaN)    21 (14)
1994    69 (12)     70 (8)     23 (8)     24 (9)     95 (8)    0 (NaN)    0 (NaN)
1995    0 (NaN)    0 (NaN)    0 (NaN)    0 (NaN)    0 (NaN)    0 (NaN)    0 (NaN)
1996    0 (NaN)    0 (NaN)    0 (NaN)    0 (NaN)    0 (NaN)    0 (NaN)    0 (NaN)
1997    0 (NaN)    0 (NaN)    0 (NaN)    0 (NaN)    0 (NaN)    0 (NaN)    0 (NaN)
1998    71 (11)     74 (8)     22 (8)     22 (7)     91 (9)   138 (12)    0 (NaN)
1999    69 (11)    0 (NaN)    0 (NaN)    0 (NaN)    0 (NaN)    0 (NaN)    0 (NaN)
2000    68 (11)     79 (8)     23 (8)    0 (NaN)     90 (8)   139 (12)    20 (14)
2001    69 (11)     81 (8)    0 (NaN)    0 (NaN)     91 (8)   137 (12)    20 (14)
2002    69 (11)     81 (8)    0 (NaN)    0 (NaN)     91 (9)   147 (11)    20 (14)
2003    71 (11)     85 (8)    0 (NaN)    0 (NaN)     93 (9)   156 (11)    0 (NaN)
2004    73 (11)     85 (8)    0 (NaN)    0 (NaN)     96 (9)   164 (11)    0 (NaN)
2005    84 (10)     84 (8)    0 (NaN)    0 (NaN)     96 (9)   163 (11)    0 (NaN)
2006    84 (10)     86 (8)     24 (8)    0 (NaN)     96 (9)   153 (12)    21 (15)
2007    80 (11)     86 (8)    0 (NaN)     24 (8)     95 (9)   147 (12)    20 (15)
2008    78 (11)     88 (9)    0 (NaN)    0 (NaN)     97 (9)   149 (12)    0 (NaN)
2009    78 (11)     89 (9)     25 (8)    0 (NaN)     99 (9)   155 (12)    19 (15)
2010    77 (11)     89 (9)    0 (NaN)    0 (NaN)    102 (9)   155 (12)    19 (16)
2011    79 (11)     88 (9)    0 (NaN)    0 (NaN)    104 (9)   154 (12)    20 (15)
2012    77 (11)     91 (9)     26 (8)     25 (7)    104 (9)   150 (12)    21 (16)
2013    78 (11)     94 (9)     26 (8)     24 (7)    106 (9)   149 (12)    20 (15)
2014    77 (11)     94 (9)     27 (8)     25 (7)    109 (9)   148 (12)    20 (15)
2015    76 (11)     94 (9)     28 (9)     25 (7)    110 (9)   151 (12)    20 (15)
2016    74 (11)     93 (9)     28 (9)     25 (7)    110 (9)   143 (12)    19 (16)
2017    79 (11)     82 (9)     29 (9)     26 (7)    113 (9)   151 (12)    20 (15)
2018    79 (11)     77 (9)     30 (9)     27 (8)    113 (9)   148 (12)    19 (15)
2019    77 (11)     77 (8)     30 (9)     27 (8)    107 (9)   151 (12)    19 (15)
2020    81 (11)     82 (9)     30 (9)     26 (8)    107 (9)   153 (12)    19 (16)
2021    82 (11)     87 (9)     30 (9)     26 (8)    109 (9)   156 (12)    21 (15)
#+end_example

*** Region & Catchment Contributions
:PROPERTIES:
:header-args:jupyter-python+: :tangle no
:END:
**** 2000 to present mean
:PROPERTIES:
:ID:       eca400fe-cffc-4e6b-8fc1-694945093adb
:END:
#+BEGIN_SRC jupyter-python :exports both :results raw drawer :display text/org :eval no-export
D = pd.read_csv("./out/GIS_D.csv", index_col=0, parse_dates=True)
err = pd.read_csv("./out/GIS_err.csv", index_col=0, parse_dates=True)

D = D[D.index.year >= 2000]\
    .resample('1D',axis='rows')\
    .mean()\
    .interpolate(method='time',limit_area='inside')\
    .mean()

err = err[err.index.year >= 2000]\
      .resample('1D',axis='rows')\
      .mean()\
      .interpolate(method='time',limit_area='inside')\
      .mean()

print(D.values)
print(err.values)
#+END_SRC

#+RESULTS:
: [485.79514956]
: [49.39273105]




**** Discharge time series
#+BEGIN_SRC jupyter-python :exports both :results raw drawer :display text/org :eval no-export
D = pd.read_csv("./out/GIS_D.csv", index_col=0, parse_dates=True)
err = pd.read_csv("./out/GIS_err.csv", index_col=0, parse_dates=True)

D = D.resample('1D',axis='rows').mean().interpolate(method='time',limit_area='inside').resample('A',axis='rows').mean()
err = err.resample('1D',axis='rows').mean().interpolate(method='time',limit_area='inside').resample('A',axis='rows').mean()

df = pd.DataFrame(index=D.index)
df['D'] = D
df['err'] = err

print("Min: ", df.loc[df['D'].idxmin])
print("Max: ", df.loc[df['D'].idxmin])
df
#+END_SRC

#+RESULTS:
:RESULTS:
: Min:  D      427.013623
: err     43.900582
: Name: 1996-12-31 00:00:00, dtype: float64
: Max:  D      427.013623
: err     43.900582
: Name: 1996-12-31 00:00:00, dtype: float64
| Date                |       D |     err |
|---------------------+---------+---------|
| 1986-12-31 00:00:00 | 460.315 | 49.3726 |
| 1987-12-31 00:00:00 | 454.162 | 47.4203 |
| 1988-12-31 00:00:00 | 440.215 | 45.2627 |
| 1989-12-31 00:00:00 | 440.627 | 45.5213 |
| 1990-12-31 00:00:00 | 441.208 | 46.4519 |
| 1991-12-31 00:00:00 | 427.156 | 44.0657 |
| 1992-12-31 00:00:00 | 432.663 | 44.3169 |
| 1993-12-31 00:00:00 | 436.539 | 44.374  |
| 1994-12-31 00:00:00 | 450.151 | 45.9845 |
| 1995-12-31 00:00:00 | 430.9   | 44.0024 |
| 1996-12-31 00:00:00 | 427.014 | 43.9006 |
| 1997-12-31 00:00:00 | 432.559 | 44.3164 |
| 1998-12-31 00:00:00 | 439.269 | 44.7863 |
| 1999-12-31 00:00:00 | 439.573 | 44.5995 |
| 2000-12-31 00:00:00 | 441.691 | 44.243  |
| 2001-12-31 00:00:00 | 443.508 | 44.2439 |
| 2002-12-31 00:00:00 | 459.999 | 45.8672 |
| 2003-12-31 00:00:00 | 475.139 | 47.2683 |
| 2004-12-31 00:00:00 | 486.419 | 48.756  |
| 2005-12-31 00:00:00 | 496.418 | 49.6608 |
| 2006-12-31 00:00:00 | 488.709 | 49.092  |
| 2007-12-31 00:00:00 | 479.544 | 48.5518 |
| 2008-12-31 00:00:00 | 483.371 | 49.3997 |
| 2009-12-31 00:00:00 | 488.953 | 49.9427 |
| 2010-12-31 00:00:00 | 492.467 | 50.4296 |
| 2011-12-31 00:00:00 | 495.843 | 50.9212 |
| 2012-12-31 00:00:00 | 493.573 | 51.2042 |
| 2013-12-31 00:00:00 | 496.818 | 51.2008 |
| 2014-12-31 00:00:00 | 500.461 | 51.3386 |
| 2015-12-31 00:00:00 | 503.079 | 51.4396 |
| 2016-12-31 00:00:00 | 492.394 | 50.5809 |
| 2017-12-31 00:00:00 | 498.886 | 50.8725 |
| 2018-12-31 00:00:00 | 491.817 | 50.0544 |
| 2019-12-31 00:00:00 | 488.239 | 50.0104 |
| 2020-12-31 00:00:00 | 498.609 | 51.3903 |
| 2021-12-31 00:00:00 | 510.75  | 52.7492 |
:END:


**** Contribution from SE
#+BEGIN_SRC jupyter-python :exports both :results raw drawer :display text/org :eval no-export
D = pd.read_csv("./out/region_D.csv", index_col=0, parse_dates=True)
err = pd.read_csv("./out/region_err.csv", index_col=0, parse_dates=True)

D = D.resample('1D',axis='rows').mean().interpolate(method='time',limit_area='inside').resample('A',axis='rows').mean()
err = err.resample('1D',axis='rows').mean().interpolate(method='time',limit_area='inside').resample('A',axis='rows').mean()

print("D SE described:\n", D['SE'].describe())
print("\nD SE err percent:", (err['SE']/D['SE']*100).describe())

df = pd.DataFrame(index=D.index)
df['SE'] = D['SE']
df['SEerr'] = err['SE']
df
#+END_SRC

#+RESULTS:
:RESULTS:
#+begin_example
D SE described:
 count     36.000000
mean     148.195426
std        7.257900
min      136.490089
25%      142.662220
50%      148.417468
75%      153.298959
max      163.817895
Name: SE, dtype: float64

D SE err percent: count    36.000000
mean     11.938148
std       0.377445
min      11.265953
25%      11.731382
50%      11.895029
75%      12.148898
max      13.189469
Name: SE, dtype: float64
#+end_example
| Date                |      SE |   SEerr |
|---------------------+---------+---------|
| 1986-12-31 00:00:00 | 154.644 | 20.3967 |
| 1987-12-31 00:00:00 | 155.203 | 19.4612 |
| 1988-12-31 00:00:00 | 144.049 | 17.531  |
| 1989-12-31 00:00:00 | 136.857 | 16.9471 |
| 1990-12-31 00:00:00 | 136.854 | 17.0803 |
| 1991-12-31 00:00:00 | 138.414 | 16.9424 |
| 1992-12-31 00:00:00 | 143.729 | 17.4003 |
| 1993-12-31 00:00:00 | 145.304 | 17.4219 |
| 1994-12-31 00:00:00 | 152.838 | 17.895  |
| 1995-12-31 00:00:00 | 145.079 | 17.1192 |
| 1996-12-31 00:00:00 | 140.783 | 17.2443 |
| 1997-12-31 00:00:00 | 141.622 | 17.3713 |
| 1998-12-31 00:00:00 | 139.592 | 17.0213 |
| 1999-12-31 00:00:00 | 140.358 | 17.0054 |
| 2000-12-31 00:00:00 | 137.987 | 16.3815 |
| 2001-12-31 00:00:00 | 136.49  | 15.9679 |
| 2002-12-31 00:00:00 | 147.175 | 16.8632 |
| 2003-12-31 00:00:00 | 156.796 | 17.7312 |
| 2004-12-31 00:00:00 | 163.818 | 18.4556 |
| 2005-12-31 00:00:00 | 163.39  | 18.4836 |
| 2006-12-31 00:00:00 | 152.92  | 17.7384 |
| 2007-12-31 00:00:00 | 148.089 | 17.3842 |
| 2008-12-31 00:00:00 | 149.431 | 17.8095 |
| 2009-12-31 00:00:00 | 154.723 | 18.1917 |
| 2010-12-31 00:00:00 | 155.958 | 18.3875 |
| 2011-12-31 00:00:00 | 153.784 | 18.4141 |
| 2012-12-31 00:00:00 | 149.852 | 18.1947 |
| 2013-12-31 00:00:00 | 148.557 | 17.9454 |
| 2014-12-31 00:00:00 | 148.277 | 17.7021 |
| 2015-12-31 00:00:00 | 150.623 | 17.6975 |
| 2016-12-31 00:00:00 | 143.009 | 17.0764 |
| 2017-12-31 00:00:00 | 150.804 | 17.634  |
| 2018-12-31 00:00:00 | 147.693 | 17.2481 |
| 2019-12-31 00:00:00 | 150.85  | 17.7821 |
| 2020-12-31 00:00:00 | 153.137 | 18.1115 |
| 2021-12-31 00:00:00 | 156.348 | 18.4648 |
:END:

**** Contribution from SE relative to the total
#+BEGIN_SRC jupyter-python :exports both :results raw drawer :display text/org :eval no-export
D = pd.read_csv("./out/region_D.csv", index_col=0, parse_dates=True)
err = pd.read_csv("./out/region_err.csv", index_col=0, parse_dates=True)

D = D.resample('1D',axis='rows').mean().interpolate(method='time',limit_area='inside').resample('A',axis='rows').mean()
err = err.resample('1D',axis='rows').mean().interpolate(method='time',limit_area='inside').resample('A',axis='rows').mean()

D_SE = D['SE']
# D_rest = D.drop(columns='SE').sum(axis='columns')
D_rest = D.sum(axis='columns')

print((D_SE/D_rest*100).describe())
print("")
print(D_SE/D_rest*100)
#+END_SRC

#+RESULTS:
#+begin_example
count    36.000000
mean     31.691291
std       1.373625
min      29.043621
25%      30.759519
50%      31.467105
75%      32.927624
max      34.173441
dtype: float64

Date
1986-12-31    33.595230
1987-12-31    34.173441
1988-12-31    32.722370
1989-12-31    31.059697
1990-12-31    31.018115
1991-12-31    32.403580
1992-12-31    33.219556
1993-12-31    33.285394
1994-12-31    33.952510
1995-12-31    33.668730
1996-12-31    32.969197
1997-12-31    32.740439
1998-12-31    31.778269
1999-12-31    31.930466
2000-12-31    31.240627
2001-12-31    30.775048
2002-12-31    31.994640
2003-12-31    33.000091
2004-12-31    33.678355
2005-12-31    32.913766
2006-12-31    31.290553
2007-12-31    30.881201
2008-12-31    30.914288
2009-12-31    31.643657
2010-12-31    31.668799
2011-12-31    31.014607
2012-12-31    30.360629
2013-12-31    29.901742
2014-12-31    29.628217
2015-12-31    29.940260
2016-12-31    29.043621
2017-12-31    30.228158
2018-12-31    30.030044
2019-12-31    30.896844
2020-12-31    30.712932
2021-12-31    30.611422
Freq: A-DEC, dtype: float64
#+end_example


**** Contribution from others relative to the total
#+BEGIN_SRC jupyter-python :exports both :results raw drawer :display text/org :eval no-export
D = pd.read_csv("./out/region_D.csv", index_col=0, parse_dates=True)
err = pd.read_csv("./out/region_err.csv", index_col=0, parse_dates=True)

D = D.resample('1D',axis='rows').mean().interpolate(method='time',limit_area='inside').resample('A',axis='rows').mean()
err = err.resample('1D',axis='rows').mean().interpolate(method='time',limit_area='inside').resample('A',axis='rows').mean()

print("\nNO+NE+NW:", (D[['NO','NE','NW']].sum(axis='columns')).describe()[['min','max']])

# print("\nERR NO+NE+NW:", (err[['NO','NE','NW']].sum(axis='columns')).describe()[['mean']])

print("\nNO+NE+NW%:", (D[['NO','NE','NW']].sum(axis='columns')/D.sum(axis='columns')*100).describe()[['mean']])

print("\nNW increase:", D['NW'])
      
# D_SE = D['SE']
# # D_rest = D.drop(columns='SE').sum(axis='columns')
# D_rest = D.sum(axis='columns')

# print((D_SE/D_rest*100).describe())
# print("")
# print(D_SE/D_rest*100)
#+END_SRC

#+RESULTS:
#+begin_example

NO+NE+NW: min    132.010507
max    169.406964
dtype: float64

NO+NE+NW%: mean    31.365081
dtype: float64

NW increase: Date
1986-12-31     95.904101
1987-12-31     92.268404
1988-12-31     94.326525
1989-12-31    100.323093
1990-12-31    100.342807
1991-12-31     90.549585
1992-12-31     88.151201
1993-12-31     90.274921
1994-12-31     94.570629
1995-12-31     89.834626
1996-12-31     88.549086
1997-12-31     89.195396
1998-12-31     91.170978
1999-12-31     88.812933
2000-12-31     90.090320
2001-12-31     90.071784
2002-12-31     91.267990
2003-12-31     92.660183
2004-12-31     95.800659
2005-12-31     95.822215
2006-12-31     96.050959
2007-12-31     95.320722
2008-12-31     96.956927
2009-12-31     99.031696
2010-12-31    101.529947
2011-12-31    104.323557
2012-12-31    103.813127
2013-12-31    106.073166
2014-12-31    109.553287
2015-12-31    109.803959
2016-12-31    110.253406
2017-12-31    113.229978
2018-12-31    112.686835
2019-12-31    107.184761
2020-12-31    107.313426
2021-12-31    108.788271
Freq: A-DEC, Name: NW, dtype: float64
#+end_example

**** Sermeq Kujalleq (Jakobshavn Isbræ)
#+BEGIN_SRC jupyter-python :exports both :results raw drawer :display text/org :eval no-export
D = pd.read_csv("./out/sector_D.csv", index_col=0, parse_dates=True)
err = pd.read_csv("./out/sector_err.csv", index_col=0, parse_dates=True)

D = D['JAKOBSHAVN_ISBRAE'].resample('1D',axis='rows').mean().interpolate(method='time',limit_area='inside').resample('A',axis='rows').mean()

err = err['JAKOBSHAVN_ISBRAE'].resample('1D',axis='rows').mean().interpolate(method='time',limit_area='inside').resample('A',axis='rows').mean()

print("Jakobshavn described:\n", D.describe())

df = pd.DataFrame(index=D.index)
df['Jako'] = D
df['err'] = err
df
#+END_SRC

#+RESULTS:
:RESULTS:
: Jakobshavn described:
:  count    36.000000
: mean     36.783534
: std       9.460157
: min      22.632363
: 25%      26.791783
: 50%      37.754108
: 75%      44.893308
: max      51.025019
: Name: JAKOBSHAVN_ISBRAE, dtype: float64
| Date                |    Jako |     err |
|---------------------+---------+---------|
| 1986-12-31 00:00:00 | 29.1027 | 3.03729 |
| 1987-12-31 00:00:00 | 27.3893 | 2.80639 |
| 1988-12-31 00:00:00 | 25.1938 | 2.55343 |
| 1989-12-31 00:00:00 | 26.8218 | 2.69433 |
| 1990-12-31 00:00:00 | 25.4813 | 2.4713  |
| 1991-12-31 00:00:00 | 22.9329 | 2.19825 |
| 1992-12-31 00:00:00 | 22.6324 | 2.18419 |
| 1993-12-31 00:00:00 | 24.2123 | 2.29701 |
| 1994-12-31 00:00:00 | 25.5632 | 2.39126 |
| 1995-12-31 00:00:00 | 23.8666 | 2.19525 |
| 1996-12-31 00:00:00 | 25.6793 | 2.31924 |
| 1997-12-31 00:00:00 | 26.7017 | 2.38738 |
| 1998-12-31 00:00:00 | 31.2986 | 2.86247 |
| 1999-12-31 00:00:00 | 33.001  | 2.9232  |
| 2000-12-31 00:00:00 | 35.8069 | 3.1497  |
| 2001-12-31 00:00:00 | 37.0548 | 3.24836 |
| 2002-12-31 00:00:00 | 38.4587 | 3.38152 |
| 2003-12-31 00:00:00 | 41.0551 | 3.6446  |
| 2004-12-31 00:00:00 | 42.7938 | 3.84119 |
| 2005-12-31 00:00:00 | 43.3356 | 3.93917 |
| 2006-12-31 00:00:00 | 44.7137 | 4.11274 |
| 2007-12-31 00:00:00 | 44.7496 | 4.14659 |
| 2008-12-31 00:00:00 | 45.6215 | 4.23475 |
| 2009-12-31 00:00:00 | 46.3395 | 4.32163 |
| 2010-12-31 00:00:00 | 46.5323 | 4.36192 |
| 2011-12-31 00:00:00 | 45.3245 | 4.27409 |
| 2012-12-31 00:00:00 | 49.5439 | 4.74749 |
| 2013-12-31 00:00:00 | 51.025  | 4.93618 |
| 2014-12-31 00:00:00 | 50.4373 | 4.89051 |
| 2015-12-31 00:00:00 | 49.3549 | 4.83337 |
| 2016-12-31 00:00:00 | 49.7386 | 4.8283  |
| 2017-12-31 00:00:00 | 38.4534 | 3.72792 |
| 2018-12-31 00:00:00 | 34.6881 | 3.31249 |
| 2019-12-31 00:00:00 | 35.7139 | 3.34612 |
| 2020-12-31 00:00:00 | 39.5395 | 3.73164 |
| 2021-12-31 00:00:00 | 44.0496 | 4.1862  |
:END:

*** Discharge Time Series - Sectors
#+BEGIN_SRC jupyter-python :results raw drawer :display text/plain :eval no-export
import matplotlib.gridspec as gridspec
import matplotlib.pyplot as plt
import numpy as np
import pandas as pd

plt.close(1)

fig = plt.figure(1, figsize=(9,5)) # w,h
fig.clf()
# fig.set_tight_layout(True)
grid = plt.GridSpec(2, 1, height_ratios=[1,10], hspace=0.1) # h, w


ax_D = fig.add_subplot(grid[1,:])
ax_coverage = fig.add_subplot(grid[0,:], sharex=ax_D)

from adjust_spines import adjust_spines as adj
adj(ax_D, ['left','bottom'])
adj(ax_coverage, ['left'])
ax_coverage.minorticks_off()
ax_coverage.tick_params(length=0, which='both', axis='x')


D = pd.read_csv("./out/sector_D.csv", index_col=0, parse_dates=True)
err = pd.read_csv("./out/sector_err.csv", index_col=0, parse_dates=True)
coverage = pd.read_csv("./out/sector_coverage.csv", index_col=0, parse_dates=True)

THRESH = coverage < 0.5
D[THRESH] = np.nan
err[THRESH] = np.nan
coverage[THRESH] = np.nan


def pad_df(df):
    df = df.append(pd.DataFrame(index=np.array(['1986-01-01']).astype('datetime64[ns]')), sort=True)
    idx = str(df.index.year.max())+'-12-31'
    df = df.append(pd.DataFrame(index=np.array([idx]).astype('datetime64[ns]')), sort=True)
    df = df.sort_index()
    return df

D = pad_df(D)
err = pad_df(err)
coverage = pad_df(coverage)

### Take annual average from daily interpolated rather than the existing samples.
D_day_year = D.resample('1D',axis='rows').mean().interpolate(method='time',limit_area='inside').resample('A',axis='rows').mean()
err_day_year=err.resample('1D',axis='rows').mean().interpolate(method='time',limit_area='inside').resample('A',axis='rows').mean()


# No annual average if few sample
num_obs = D.resample('Y').count()
D_day_year[num_obs<=3] = np.nan
err_day_year[num_obs<=3] = np.nan


# largest average for last year
D_sort = D.resample('Y', axis='rows')\
          .mean()\
          .iloc[-1]\
          .sort_values(ascending=False)

LABELS={}
# for k in D_sort.head(8).index: LABELS[k] = k
# Use the last       ^ glaciers

# Make legend pretty
LABELS['JAKOBSHAVN_ISBRAE'] = 'Sermeq Kujalleq (Jakobshavn Isbræ)'
LABELS['HELHEIMGLETSCHER'] = 'Helheim Gletsjer'
LABELS['KANGERLUSSUAQ'] = 'Kangerlussuaq Gletsjer'
LABELS['KOGE_BUGT_C'] = '(Køge Bugt C)'
LABELS['ZACHARIAE_ISSTROM'] = 'Zachariae Isstrøm'
LABELS['RINK_ISBRAE'] = 'Kangilliup Sermia (Rink Isbræ)'
LABELS['NIOGHALVFJERDSFJORDEN'] = '(Nioghalvfjerdsbrae)'
LABELS['PETERMANN_GLETSCHER'] ='Petermann Gletsjer'

SYMBOLS={}
SYMBOLS['JAKOBSHAVN_ISBRAE'] = 'o'
SYMBOLS['HELHEIMGLETSCHER'] = 's'
SYMBOLS['KANGERLUSSUAQ'] = 'v'
SYMBOLS['KOGE_BUGT_C'] = '^'
SYMBOLS['NIOGHALVFJERDSFJORDEN'] = 'v'
SYMBOLS['RINK_ISBRAE'] = 's'
SYMBOLS['ZACHARIAE_ISSTROM'] = 'o'
SYMBOLS['PETERMANN_GLETSCHER'] ='^'

MS=4
Z=99
for g in LABELS.keys(): # for each glacier

    # scatter of symbols
    e = ax_D.errorbar(D.loc[:,g].index,
                      D.loc[:,g].values,
                      label=LABELS[g],
                      fmt=SYMBOLS[g],
                      mfc='none',
                      ms=MS)

    # Annual average
    C = e.lines[0].get_color()
    D_day_year.loc[:,g].plot(drawstyle='steps', linewidth=2,
                             label='',
                             ax=ax_D,
                             alpha=0.75, color=C, zorder=Z)

    # Error bars, each one w/ custom opacity.
    # Also, fill symbols w/ same opacity.
    for i,idx in enumerate(D.loc[:,g].index):
        ax_D.errorbar(D.loc[:,g].index[i],
                      D.loc[:,g].values[i],
                      yerr=err.loc[:,g].values[i],
                      alpha=coverage.loc[:,g].values[i],
                      label='',
                      marker=SYMBOLS[g],
                      ecolor='grey',
                      mfc=C, mec=C,
                      ms=MS)


    # Coverage scatter on top axis
    ax_coverage.scatter(D.loc[:,g].index,
                        coverage.loc[:,g].values*100,
                        alpha=0.25,
                        marker=SYMBOLS[g],
                        facecolor='none',
                        s=10,
                        color=C)

# yl = ax_D.get_ylim()

ax_D.legend(fontsize=8, ncol=2, loc=(0.0, 0.82), fancybox=False, frameon=False)
ax_D.set_xlabel('Time [Years]')
ax_D.set_ylabel('Discharge [Gt yr$^{-1}$]')
ax_D.set_xlim(D.index[0], D.index[-1])
ax_D.set_xticklabels(D.index.year.unique())

import matplotlib.dates as mdates
ax_D.xaxis.set_major_locator(mdates.YearLocator())
ax_D.xaxis.set_tick_params(rotation=-90)
for tick in ax_D.xaxis.get_majorticklabels():
    tick.set_horizontalalignment("left")

ax_coverage.set_ylabel('Coverage [%]')
ax_coverage.set_ylim([45,105])
ax_coverage.set_yticks([50,100])
ax_coverage.spines['left'].set_bounds(ax_coverage.get_ylim()[0],100)

plt.savefig('./figs/discharge_ts_topfew.png', transparent=False, bbox_inches='tight', dpi=300)

Err_pct = (err_day_year / D_day_year*100).round().fillna(value=0).astype(np.int).astype(np.str)
Err_pct = Err_pct[list(LABELS.keys())]
tbl = D_day_year[list(LABELS.keys())].round().fillna(value=0).astype(np.int).astype(np.str) + ' (' + Err_pct+')'
tbl.index = tbl.index.year.fillna(value=0).astype(np.str)
tbl.columns = [_ + ' (%)' for _ in tbl.columns]
tbl
#+END_SRC

#+RESULTS:
#+begin_example
     JAKOBSHAVN_ISBRAE (%) HELHEIMGLETSCHER (%) KANGERLUSSUAQ (%) KOGE_BUGT_C (%)  \
1986                 0 (0)               33 (6)            16 (7)          16 (5)   
1987                 0 (0)               33 (6)            16 (7)          16 (5)   
1988               25 (10)               30 (6)            16 (8)           0 (0)   
1989               27 (10)               27 (6)            17 (7)           0 (0)   
1990               25 (10)               27 (6)            19 (7)           0 (0)   
1991                 0 (0)                0 (0)             0 (0)           0 (0)   
1992                 0 (0)                0 (0)             0 (0)           0 (0)   
1993                 0 (0)                0 (0)             0 (0)           0 (0)   
1994                26 (9)                0 (0)            18 (8)           0 (0)   
1995                 0 (0)                0 (0)             0 (0)           0 (0)   
1996                 0 (0)                0 (0)             0 (0)           0 (0)   
1997                 0 (0)                0 (0)             0 (0)           0 (0)   
1998                32 (9)               23 (7)            22 (7)           0 (0)   
1999                 0 (0)                0 (0)            20 (8)           0 (0)   
2000                36 (9)               24 (7)            20 (8)          15 (5)   
2001                37 (9)               24 (7)            21 (8)          15 (5)   
2002                39 (9)               27 (7)            20 (8)           0 (0)   
2003                41 (9)               30 (7)            21 (8)           0 (0)   
2004                43 (9)               32 (7)            23 (8)          18 (5)   
2005                43 (9)                0 (0)            34 (8)          18 (5)   
2006                45 (9)               29 (7)            34 (8)          17 (5)   
2007                45 (9)               29 (7)            29 (8)          15 (5)   
2008                46 (9)               27 (7)            27 (8)           0 (0)   
2009                46 (9)               29 (8)            26 (8)          18 (5)   
2010                47 (9)               28 (8)            26 (8)           0 (0)   
2011                45 (9)               27 (8)            27 (8)           0 (0)   
2012               50 (10)               26 (8)            27 (8)          17 (5)   
2013               51 (10)               26 (8)            27 (8)          16 (5)   
2014               50 (10)               26 (8)            26 (8)          17 (5)   
2015               49 (10)               29 (8)            25 (8)          17 (5)   
2016               50 (10)               27 (8)            24 (8)          14 (5)   
2017               38 (10)               31 (8)            27 (8)          15 (5)   
2018               35 (10)               29 (8)            28 (8)          16 (5)   
2019                36 (9)               31 (8)            26 (8)          15 (5)   
2020                40 (9)               31 (8)            26 (8)          16 (5)   
2021               44 (10)               31 (8)            25 (8)          15 (5)   

     ZACHARIAE_ISSTROM (%) RINK_ISBRAE (%) NIOGHALVFJERDSFJORDEN (%) PETERMANN_GLETSCHER (%)  
1986               10 (10)          13 (6)                    12 (5)                   0 (0)  
1987                9 (10)          13 (6)                    12 (5)                  12 (4)  
1988                9 (10)          13 (6)                    12 (5)                  11 (4)  
1989               10 (10)          13 (6)                    11 (5)                  11 (4)  
1990               10 (10)          13 (6)                    11 (5)                  11 (4)  
1991                 0 (0)           0 (0)                     0 (0)                   0 (0)  
1992                 0 (0)           0 (0)                     0 (0)                   0 (0)  
1993                 0 (0)           0 (0)                     0 (0)                   0 (0)  
1994               10 (10)           0 (0)                     0 (0)                  12 (4)  
1995                 0 (0)           0 (0)                     0 (0)                   0 (0)  
1996                 0 (0)           0 (0)                     0 (0)                   0 (0)  
1997                 0 (0)           0 (0)                     0 (0)                   0 (0)  
1998                9 (10)           0 (0)                    12 (5)                  11 (4)  
1999                9 (10)           0 (0)                     0 (0)                   0 (0)  
2000               10 (10)          14 (6)                    12 (5)                  11 (4)  
2001                 0 (0)          14 (7)                     0 (0)                   0 (0)  
2002                 0 (0)          13 (7)                     0 (0)                   0 (0)  
2003                 0 (0)           0 (0)                     0 (0)                   0 (0)  
2004                 0 (0)          13 (7)                     0 (0)                   0 (0)  
2005                 0 (0)          13 (7)                     0 (0)                   0 (0)  
2006                 0 (0)          14 (7)                    12 (5)                   0 (0)  
2007               12 (10)          13 (7)                     0 (0)                  11 (4)  
2008                 0 (0)          14 (7)                     0 (0)                   0 (0)  
2009               12 (10)          13 (7)                     0 (0)                   0 (0)  
2010                 0 (0)          13 (7)                     0 (0)                   0 (0)  
2011                 0 (0)          13 (7)                     0 (0)                   0 (0)  
2012               13 (10)          13 (7)                    12 (5)                  12 (4)  
2013               13 (10)          13 (7)                     0 (0)                  12 (4)  
2014               14 (10)          13 (7)                    13 (5)                  11 (4)  
2015               14 (10)          13 (7)                    13 (5)                  12 (4)  
2016               15 (10)          14 (6)                    13 (5)                  12 (4)  
2017               15 (10)          13 (6)                    13 (5)                  12 (4)  
2018               15 (10)          12 (7)                    13 (5)                  12 (4)  
2019               15 (10)          12 (7)                    13 (5)                  12 (4)  
2020               16 (10)          12 (7)                    13 (5)                  12 (4)  
2021               16 (10)          12 (7)                    13 (5)                  12 (4)  
#+end_example

:END:
:END:
:end:

*** Køge Bugt
:PROPERTIES:
:header-args:jupyter-python+: :tangle no
:END:

#+BEGIN_SRC jupyter-python :session koge_bugt :results drawer
import os
import numpy as np
import shapefile

import matplotlib.pyplot as plt
from grass_session import Session
from grass.pygrass.modules.shortcuts import general as g
from grass.pygrass.modules.shortcuts import raster as r
from grass.pygrass.modules.shortcuts import vector as v
from grass.pygrass.modules.shortcuts import display as d
from grass.script import array as garray
from grass.script import core as gcore

if 'bamber' not in locals():
    PERMANENT = Session()
    PERMANENT.open(gisdb="./", location="G", mapset="tmp_KogeBugt", create_opts="")
    
    x = garray.array("x@PERMANENT", null=np.nan)
    y = garray.array("y@PERMANENT", null=np.nan)
    vel = garray.array("vel_baseline@MEaSUREs.0478", null=np.nan)
    vx = garray.array("vx_baseline@MEaSUREs.0478", null=np.nan)
    vy = garray.array("vy_baseline@MEaSUREs.0478", null=np.nan)
    z_s = garray.array("surface@BedMachine", null=np.nan)
    z_b = garray.array("bed@BedMachine", null=np.nan)
    bamber = garray.array("thickness@Bamber_2013", null=np.nan)
    bamber[bamber == 0] = np.nan
    z_s[z_s == 0] = np.nan
    z_b[z_s == 0] = np.nan
    thick = z_s - z_b
    diff = thick - bamber
    gates = garray.array("gates_final@gates_100_5000", null=np.nan)

    # v.out_ogr(input='gate_lines', output='./tmp/SHP/E2014_gates.shp', format='ESRI_Shapefile', overwrite=True)
    # gates_E2014 = shapefile.Reader("./tmp/SHP/E2014_gates.shp")
    PERMANENT.close()

# get numbers below by zooming in, then plt.xlim(), plt.ylim()    
#     a.set_xlim([160000, 200000])
#     a.set_ylim([-2750000, -2710000])

if 'x_koge' not in locals():
    idx_x0 = np.where(x[0,:] > 170000)[0][0]    
    idx_x1 = np.where(x[0,:] > 200000)[0][0]
    idx_y0 = np.where(y[:,0] < -2710000)[0][0]
    # idx_y1 = np.where(y[:,0] < -2750000)[0][0]
    idx_y1 = np.where(y[:,0] < -2735000)[0][0]
    vel_koge = vel[idx_y0:idx_y1, idx_x0:idx_x1]
    vx_koge = vx[idx_y0:idx_y1, idx_x0:idx_x1]
    vy_koge = vy[idx_y0:idx_y1, idx_x0:idx_x1]
    thick_koge = thick[idx_y0:idx_y1, idx_x0:idx_x1]
    bamber_koge = bamber[idx_y0:idx_y1, idx_x0:idx_x1]
    diff_koge = diff[idx_y0:idx_y1, idx_x0:idx_x1]
    x_koge = x[idx_y0:idx_y1, idx_x0:idx_x1]
    y_koge = y[idx_y0:idx_y1, idx_x0:idx_x1]

# plt.close(1)
plt.clf()
fig = plt.figure(1, figsize=(8,6)) # w,h
# get_current_fig_manager().window.move(0,0)
fig.clf()
fig.set_tight_layout(True)

ax1 = fig.add_subplot(221)
ax2 = fig.add_subplot(222)
ax3 = fig.add_subplot(223)
ax4 = fig.add_subplot(224)

# extent = [x.min(),x.max(),y.min(),y.max()]
extent = [x_koge.min(), x_koge.max(), y_koge.min(), y_koge.max()]

plt.cm.Blues.set_bad('gray', 0.3)
plt.cm.RdBu_r.set_bad('gray', 0.3)
plt.cm.viridis.set_bad('gray', 0.3)
im1 = ax1.imshow(np.log10(vel_koge), extent=extent)
im2 = ax2.imshow(thick_koge, extent=extent, cmap=plt.cm.Blues, vmin=0, vmax=1500)
im3 = ax3.imshow(bamber_koge, extent=extent, cmap=plt.cm.Blues, vmin=0, vmax=1500)
im4 = ax4.imshow(diff_koge, extent=extent, cmap=plt.cm.RdBu_r, vmin=-1500, vmax=1500)

label = ['a','b','c','d']  
for i,a in enumerate([ax1,ax2,ax3,ax4]):
    C = plt.cm.gray_r if a == ax1 else plt.cm.gray
    a.imshow(gates[idx_y0:idx_y1, idx_x0:idx_x1], extent=extent, cmap=C)
    C = 'w' if i <= 2 else 'k'
    a.text(0.03,0.88,label[i], transform=a.transAxes, color=C, fontsize=14)
    a.set_yticklabels([])
    a.set_xticklabels([])

from mpl_toolkits.axes_grid1 import make_axes_locatable
# for i,a in zip([im1,im2,im3,im4],[ax1,ax2,ax3,ax4]):
divider = make_axes_locatable(ax1); cax = divider.append_axes("right", size="5%", pad=0.05)
c = fig.colorbar(im1, cax=cax); c.set_label('log$_{10}$ Speed [m yr$^{-1}$]')
divider = make_axes_locatable(ax2); cax = divider.append_axes("right", size="5%", pad=0.05)
c = fig.colorbar(im2, cax=cax); c.set_label('Thickness [m]')
divider = make_axes_locatable(ax3); cax = divider.append_axes("right", size="5%", pad=0.05)
c = fig.colorbar(im3, cax=cax); c.set_label('Thickness [m]')
divider = make_axes_locatable(ax4); cax = divider.append_axes("right", size="5%", pad=0.05)
c = fig.colorbar(im4, cax=cax); c.set_label('$\Delta$ Thickness [m]')

plt.savefig('./figs/koge_bugt.png', transparent=True, bbox_inches='tight', dpi=300)
plt.savefig('./figs/koge_bugt.pdf', transparent=True, bbox_inches='tight', dpi=300)
#+END_SRC

*** Adjust Spines

http://matplotlib.org/examples/pylab_examples/spine_placement_demo.html

#+BEGIN_SRC python :tangle adjust_spines.py
def adjust_spines(ax,spines, offset=10):
    for loc, spine in ax.spines.items():
        if loc in spines:
            spine.set_position(('outward', offset)) # outward by 10 points
            #spine.set_smart_bounds(True)
        else:
            spine.set_color('none') # don't draw spine

        # turn off ticks where there is no spine
        if 'left' in spines:
            ax.yaxis.set_tick_params(length=5)
            ax.yaxis.set_tick_params(direction='out')
            ax.yaxis.set_ticks_position('left')
            ax.yaxis.set_label_position('left')
        elif 'right' in spines:
            ax.yaxis.set_tick_params(length=5)
            ax.yaxis.set_tick_params(direction='out')
            ax.yaxis.set_ticks_position('right')
            ax.yaxis.set_label_position('right')
        else: # no yaxis ticks
            ax.yaxis.set_ticks([])

        if 'bottom' in spines:
            ax.xaxis.set_ticks_position('bottom')
            ax.xaxis.set_tick_params(length=5)
            ax.xaxis.set_tick_params(direction='out')
            ax.xaxis.set_label_position('bottom')
        elif 'top' in spines:
            ax.xaxis.set_ticks_position('top')
            ax.xaxis.set_tick_params(length=5)
            ax.xaxis.set_tick_params(direction='out')
            ax.xaxis.set_label_position('top')
        else: # no xaxis ticks
            ax.xaxis.set_ticks([])


if __name__ == "__main__":
    import numpy as np            
    x = np.random.random(100)
    fig = plt.figure(100)
    fig.clf()
    ax = fig.add_axes([0.1,0.1,0.8,0.8])
    ax.plot(x)
    adjust_spines(ax,["left","bottom"])

#+END_SRC
#+RESULTS:

** Auto update

*** Local
#+BEGIN_SRC bash :tangle update_wrapper.sh
<<MSGS_pretty_print>>

MSG_OK "Updating Sentinel velocity files..."
workingdir=$(pwd)
cd ${DATADIR}/Sentinel1/Sentinel1_IV_maps/

if [[ -e urls.txt ]]; then cp urls.txt urls.txt.last; fi
curl https://dataverse01.geus.dk/api/datasets/:persistentId?persistentId=doi:10.22008/promice/data/sentinel1icevelocity/greenlandicesheet | tr ',' '\n' | grep -E '"persistentId"' | cut -d'"' -f4 > urls.txt

if cmp -s urls.txt urls.txt.last; then
  MSG_WARN "No new files..."
  exit
fi

# for PID in $(cat urls.txt); do
for PID in $(cat urls.txt | tail -n5); do
  wget --content-disposition --continue "https://dataverse01.geus.dk/api/access/datafile/:persistentId?persistentId=${PID}"
done

MSG_OK "New Sentinel velocity files found..."
cd ${workingdir}

grass ./G/PERMANENT --exec ./update_worker.sh
cp ./tmp/dat_100_5000.csv ./tmp/dat_100_5000.csv.last
grass ./G/PERMANENT --exec ./export.sh

if cmp -s ./tmp/dat_100_5000.csv ./tmp/dat_100_5000.csv.last; then 
  MSG_ERR "No change"
  exit
fi

python ./errors.py
python ./raw2discharge.py
python ./csv2nc.py
cp ./out/* ~/data/Mankoff_2020/ice/latest
python ./upload.py

#+END_SRC

#+BEGIN_SRC bash :tangle update_worker.sh
<<MSGS_pretty_print>>
<<GRASS_config>>
<<sentinel1_import>>
	
MAPSET=gates_100_5000
<<sentinel1_effective_velocity>>
#+END_SRC
*** Upload

# #+header-args :tangle upload.py  # don't overwrite local copy without manual effort.
#+BEGIN_SRC jupyter-python 
from pyDataverse.api import NativeApi
import os
import json

import subprocess
hash = subprocess.check_output(["git", "describe", "--always"]).strip().decode('utf-8')
hash = subprocess.check_output(["git", "describe", "--always", "--dirty='*'"]).strip().decode('utf-8')
assert("*" not in hash)

base_url = 'TODO'
api_token = 'SECRET'

api = NativeApi(base_url, api_token) # establish connection

# get dataverse metadata
identifier = 'doi:10.22008/promice/data/ice_discharge/d/v02'
resp = api.get_dataset(identifier)
files = resp.json()['data']['latestVersion']['files']
for f in files:
    persistentId = f['dataFile']['persistentId']
    description = f['dataFile']['description']
    filename = f['dataFile']['filename']
    fileId = f['dataFile']['id']

    assert(os.path.isfile("./out/"+filename))

    description = description.split(".")[0] + ". "
    description = description + "Git hash: " + hash
    
    if 'content' in locals(): del(content)
    if filename[-3:] == ".nc": content = "application/x-netcdf"
    if filename[-3:] == "csv": content = "text/csv"
    if filename[-3:] == "txt": content = "text/plain"
    json_dict={"description":description, 
               "directoryLabel":".", 
               "forceReplace":True, 
               "filename":filename, 
               "label":filename, 
               "contentType":content}

    json_str = json.dumps(json_dict)
    d = api.replace_datafile(persistentId, "./out/"+filename, json_str)
  
    if d.json()["status"] == "ERROR": 
        print(d.content)
        print("\n")
        continue

    # need to update filenames after uploading because of DataVerse bug
    # https://github.com/IQSS/dataverse/issues/7223
    file_id = d.json()['data']['files'][0]['dataFile']['id']
    d2 = api.update_datafile_metadata(file_id, json_str=json_str, is_filepid=False)
#+END_SRC


* Supplementary Material                                :noexport:
:PROPERTIES:
:header-args:jupyter-python+: :tangle no
:END:
** Errors by gate sorted by total D, err, err %
**** Top by Discharge
#+BEGIN_SRC jupyter-python :results raw drawer :session discharge :display text/org :eval no-export
import pandas as pd
import numpy as np

err_gate = pd.read_csv('./tmp/err_gate.csv', index_col=0)
err_gate.loc['GIS'] = np.nan
err_gate.dropna(inplace=True)
err_gate.rename(columns = {'D':'D [Gt]', 
                           'E':'Error [Gt]',
                           'E%':'Error [%]'}, inplace=True)
 
err_gate.sort_values('D [Gt]', inplace=True, ascending=False)
err_gate = err_gate.iloc[:25]
err_gate
#+END_SRC

#+RESULTS:
| Gate |  D [Gt] | Error [Gt] | Error [%] | name                      |
|------+---------+------------+-----------+---------------------------|
|  184 | 45.8327 |    4.25735 |   9.28889 | JAKOBSHAVN_ISBRAE         |
|  231 | 28.3759 |    2.23476 |   7.87556 | HELHEIMGLETSCHER          |
|  190 |   25.69 |    2.10264 |   8.18466 | KANGERLUSSUAQ             |
|  245 | 16.5818 |   0.776811 |   4.68471 | KOGE_BUGT_C               |
|   31 | 14.3226 |    1.46042 |   10.1966 | ZACHARIAE_ISSTROM         |
|  143 | 12.9161 |   0.860943 |   6.66564 | RINK_ISBRAE               |
|   29 | 12.2803 |   0.662151 |   5.39196 | NIOGHALVFJERDSFJORDEN     |
|   27 | 11.3084 |    0.48615 |     4.299 | PETERMANN_GLETSCHER       |
|  239 | 10.3018 |   0.945436 |   9.17739 | IKERTIVAQ_M               |
|  140 | 9.21617 |   0.672305 |   7.29484 | DAUGAARD-JENSEN           |
|   73 | 8.37833 |   0.428752 |    5.1174 | KONG_OSCAR_GLETSCHER      |
|  165 | 8.37552 |   0.669684 |   7.99573 | STORE_GLETSCHER           |
|   79 |  8.2212 |   0.472487 |   5.74718 | NORDENSKIOLD_GLESCHER_NW  |
|  306 | 7.88829 |   0.646318 |   8.19339 | TINGMIARMIUT_FJORD        |
|  103 | 7.80872 |   0.861927 |    11.038 | HAYES_GLETSCHER_N_NN      |
|  238 | 7.58332 |   0.891979 |   11.7624 | IKERTIVAQ_NN              |
|  210 | 7.53807 |   0.211834 |   2.81018 | UNNAMED_DECEPTION_O_CN_CS |
|  134 | 7.42538 |   0.762106 |   10.2635 | UPERNAVIK_ISSTROM_N       |
|  169 | 7.31806 |   0.612554 |   8.37045 | SERMEQ_KUJALLEQ           |
|  135 | 6.59969 |   0.819664 |   12.4197 | UPERNAVIK_ISSTROM_C       |
|  251 | 6.25444 |   0.330864 |   5.29007 | KOGE_BUGT_S               |
|  129 | 6.21867 |   0.256793 |    4.1294 | KAKIVFAAT_SERMIAT         |
|   28 |  6.0462 |   0.343538 |   5.68188 | HUMBOLDT_GLETSCHER        |
|   95 | 5.69675 |   0.692471 |   12.1555 | KJER_GLETSCHER            |
|   91 | 5.50316 |   0.469718 |   8.53541 | SVERDRUP_GLETSCHER        |

**** Top by Error [Gt]
#+BEGIN_SRC jupyter-python :results value :session discharge :display text/org :eval no-export
import pandas as pd
err_gate = pd.read_csv('./tmp/err_gate.csv', index_col=0)
err_gate.loc['GIS'] = np.nan
err_gate.dropna(inplace=True)
err_gate.rename(columns = {'D':'D [Gt]', 
                           'E':'Error [Gt]',
                           'E%':'Error [%]',
                           'Ew':'Error Weighted',
                           'Ew%':'Error Weighted %'}, inplace=True)

err_gate.sort_values('Error [Gt]', inplace=True, ascending=False)
err_gate = err_gate.iloc[:25]
err_gate
#+END_SRC

#+RESULTS:
| Gate |   D [Gt] | Error [Gt] | Error [%] | name                        |
|------+----------+------------+-----------+-----------------------------|
|  184 |  45.8327 |    4.25735 |   9.28889 | JAKOBSHAVN_ISBRAE           |
|  231 |  28.3759 |    2.23476 |   7.87556 | HELHEIMGLETSCHER            |
|  190 |    25.69 |    2.10264 |   8.18466 | KANGERLUSSUAQ               |
|   31 |  14.3226 |    1.46042 |   10.1966 | ZACHARIAE_ISSTROM           |
|  338 |  1.68952 |    1.43696 |   85.0517 | EQALORUTSIT_KILLIIT_SERMIAT |
|  264 |  4.54327 |    1.03591 |    22.801 | UMIIVIK_FJORD               |
|  239 |  10.3018 |   0.945436 |   9.17739 | IKERTIVAQ_M                 |
|  238 |  7.58332 |   0.891979 |   11.7624 | IKERTIVAQ_NN                |
|  103 |  7.80872 |   0.861927 |    11.038 | HAYES_GLETSCHER_N_NN        |
|  143 |  12.9161 |   0.860943 |   6.66564 | RINK_ISBRAE                 |
|  244 |  3.97901 |   0.852601 |   21.4275 | KOGE_BUGT_N                 |
|  135 |  6.59969 |   0.819664 |   12.4197 | UPERNAVIK_ISSTROM_C         |
|  224 |  4.68071 |   0.799209 |   17.0745 | KIV_STEENSTRUP_NODRE_BRAE   |
|  245 |  16.5818 |   0.776811 |   4.68471 | KOGE_BUGT_C                 |
|  134 |  7.42538 |   0.762106 |   10.2635 | UPERNAVIK_ISSTROM_N         |
|   95 |  5.69675 |   0.692471 |   12.1555 | KJER_GLETSCHER              |
|  140 |  9.21617 |   0.672305 |   7.29484 | DAUGAARD-JENSEN             |
|  165 |  8.37552 |   0.669684 |   7.99573 | STORE_GLETSCHER             |
|   29 |  12.2803 |   0.662151 |   5.39196 | NIOGHALVFJERDSFJORDEN       |
|  306 |  7.88829 |   0.646318 |   8.19339 | TINGMIARMIUT_FJORD          |
|  169 |  7.31806 |   0.612554 |   8.37045 | SERMEQ_KUJALLEQ             |
|  113 |   5.4707 |   0.600724 |   10.9807 | ALISON_GLETSCHER            |
|  272 |  4.34363 |   0.590233 |   13.5885 | GRAULV                      |
|  235 | 0.465927 |   0.577122 |   123.865 | HEIM_GLETSCHER              |
|  237 | 0.727763 |   0.561489 |   77.1526 | NONAME_IKERTIVAQ_N          |


**** Top by Error [%]
#+BEGIN_SRC jupyter-python :results value :session discharge :display text/org :eval no-export
import pandas as pd
err_gate = pd.read_csv('./tmp/err_gate.csv', index_col=0)
err_gate.loc['GIS'] = np.nan
err_gate.dropna(inplace=True)
err_gate.rename(columns = {'D':'D [Gt]', 
                           'E':'Error [Gt]',
                           'E%':'Error [%]',
                           'Ew':'Error Weighted',
                           'Ew%':'Error Weighted %'}, inplace=True)

err_gate.sort_values('Error [%]', inplace=True, ascending=False)
err_gate = err_gate.iloc[:25]
err_gate
#+END_SRC

#+RESULTS:
| Gate |      D [Gt] | Error [Gt] | Error [%] | name                           |
|------+-------------+------------+-----------+--------------------------------|
|  343 | 0.000406285 |   0.101505 |   24983.6 | NAAJAT_SERMIAT                 |
|  280 | 0.000322359 |  0.0686486 |   21295.7 | GYLDENLOVE_SS                  |
|  323 | 7.64832e-05 |  0.0160352 |   20965.6 | NAPASORSUAQ_C_S                |
|  271 | 0.000274782 |  0.0575628 |   20948.5 | APUSEERSERPIA                  |
|  148 | 0.000214731 |   0.042169 |     19638 | GEIKIE3                        |
|  289 | 0.000892266 |   0.174267 |   19530.9 | SE_NONAME2                     |
|  331 |   0.0013534 |   0.259317 |   19160.4 | UNNAMED_ANORITUUP_KANGERLUA_S  |
|  332 | 0.000125657 |  0.0235513 |   18742.6 | UNNAMED_ANORITUUP_KANGERLUA_SS |
|  311 | 0.000279193 |  0.0520355 |   18637.8 | MOGENS_HEINESEN_SS_SSS         |
|  225 | 0.000364528 |  0.0678545 |   18614.4 | KIV_STEENSTRUP_SONDRE_BRAE     |
|  254 | 0.000476612 |  0.0881848 |   18502.4 | KOGE_BUGT_SS                   |
|  285 | 0.000512678 |  0.0943475 |   18402.9 | SE_NONAME2                     |
|  353 | 0.000162942 |  0.0297611 |   18264.9 | SOUTHERN_TIP                   |
|  284 | 0.000866503 |   0.154398 |   17818.6 | SE_NONAME2                     |
|  257 | 0.000940643 |   0.165067 |   17548.3 | KOGE_BUGT_SS                   |
|  333 | 0.000157755 |  0.0272631 |   17281.9 | UNNAMED_ANORITUUP_KANGERLUA_SS |
|  295 | 0.000255828 |  0.0436295 |   17054.2 | SE_NONAME2                     |
|  223 |  0.00193743 |   0.329281 |   16995.7 | UNNAMED_LAUBE_S                |
|  296 | 0.000252462 |  0.0424767 |     16825 | SE_NONAME2                     |
|  216 | 0.000397872 |  0.0664788 |   16708.6 | UNNAMED_LAUBE_S                |
|  287 |  0.00212486 |   0.354715 |   16693.6 | FIMBULGETLSCHER                |
|  324 | 0.000108454 |  0.0172894 |   15941.7 | NAPASORSUAQ_C_S                |
|  278 |  2.8184e-05 | 0.00448207 |   15902.9 | SE_NONAME2                     |
|  282 | 3.29127e-05 | 0.00523086 |   15893.1 | SE_NONAME2                     |
|  352 | 6.05612e-05 | 0.00952727 |   15731.6 | SOUTHERN_TIP                   |

**** Bottom by Error [%]
#+BEGIN_SRC jupyter-python :results value :session discharge :display text/org :eval no-export
import pandas as pd
err_gate = pd.read_csv('./tmp/err_gate.csv', index_col=0)
err_gate.loc['GIS'] = np.nan
err_gate.dropna(inplace=True)
err_gate.rename(columns = {'D':'D [Gt]', 
                           'E':'Error [Gt]',
                           'E%':'Error [%]',
                           'Ew':'Error Weighted',
                           'Ew%':'Error Weighted %'}, inplace=True)

err_gate.sort_values('Error [%]', inplace=True, ascending=True)
err_gate = err_gate.iloc[:25]
err_gate
#+END_SRC

#+RESULTS:
| Gate |    D [Gt] | Error [Gt] | Error [%] | name                      |
|------+-----------+------------+-----------+---------------------------|
|  209 |   2.04015 |  0.0460258 |     2.256 | UNNAMED_DECEPTION_O_CN_CS |
|   69 |    1.0023 |  0.0280765 |    2.8012 | ISSUUARSUIT_SERMIA        |
|  210 |   7.53807 |   0.211834 |   2.81018 | UNNAMED_DECEPTION_O_CN_CS |
|  310 |   4.76843 |   0.171368 |    3.5938 | MOGENS_HEINESEN_S         |
|  127 |  0.722277 |  0.0267532 |   3.70401 | QEQERTARSUUP_SERMIA       |
|   71 |    1.1039 |  0.0416315 |   3.77131 | ISSUUARSUIT_SERMIA        |
|  192 |  0.782581 |  0.0303407 |     3.877 | UNNAMED_KANGER_W          |
|   10 |   2.56798 |    0.10477 |   4.07984 | RYDER_GLETSCHER           |
|  129 |   6.21867 |   0.256793 |    4.1294 | KAKIVFAAT_SERMIAT         |
|   78 | 0.0623227 |  0.0026047 |   4.17937 | NORDENSKIOLD_GLESCHER_NW  |
|  246 |  0.286414 |   0.012137 |   4.23755 | KOGE_BUGT_S               |
|  211 |    5.1197 |   0.217338 |   4.24513 | UNNAMED_UUNARTIT_ISLANDS  |
|   27 |   11.3084 |    0.48615 |     4.299 | PETERMANN_GLETSCHER       |
|   46 |  0.880626 |  0.0390674 |   4.43633 | HARALD_MOLTKE_BRAE        |
|  245 |   16.5818 |   0.776811 |   4.68471 | KOGE_BUGT_C               |
|  177 |  0.987068 |  0.0470645 |   4.76811 | KANGILERNGATA_SERMIA      |
|   67 |   3.46136 |    0.17273 |   4.99025 | ISSUUARSUIT_SERMIA        |
|  187 | 0.0774279 | 0.00387909 |   5.00994 | KONG_CHRISTIAN            |
|   30 |  0.211186 |  0.0106246 |   5.03091 | HUMBOLDT_GLETSCHER        |
|  163 |  0.351213 |  0.0176866 |   5.03587 | STORE_GLETSCHER           |
|  102 |  0.764497 |  0.0387761 |   5.07211 | HAYES_GLETSCHER_N_NN      |
|   73 |   8.37833 |   0.428752 |    5.1174 | KONG_OSCAR_GLETSCHER      |
|  212 |  0.782933 |   0.040692 |   5.19739 | KRUUSE_FJORD              |
|  153 |  0.666664 |  0.0349643 |   5.24467 | SERMEQ_SILARLEQ           |
|  251 |   6.25444 |   0.330864 |   5.29007 | KOGE_BUGT_S               |


** Annual averages from observations or linear interpolation
Compute the annual average for all GIS and some other glaciers using two methods, and compare the differences
+ Method 1: Annual average from observations
+ Method 2: Annual average after linearly interpolating observations to daily resolution

NOTE - do this with the "rawest" velocity product prior to any interpolation.

#+BEGIN_SRC jupyter-python :session avgmethod :exports both :results raw drawer :display text/org
import matplotlib.pyplot as plt
import numpy as np
import pandas as pd
import datetime as dt

if 'th' not in locals():
    <<load_data>>
    <<millan_2018>>
    <<adjust_thickness>>
    <<adjust_thickness_fit>>

# What is D where velocity is directly observed, no velocity filling?
D = (fill*vel).apply(lambda c: c * (th['fit'].values * 200), axis=0) * 917 / 1E12

ann = pd.DataFrame(index = D.resample("A", axis='columns').mean().columns)
ann['obs'] = D.sum(axis='rows').resample('A').mean().values
ann['daily'] = np.nan
for y in np.arange(1985,2018):
    ann.loc[ann.index.year == y, 'daily'] \
        = D\
        .T[D.columns.year == y]\
        .T\
        .sum(axis='rows')\
        .resample('1D')\
        .mean()\
        .interpolate(method="time")\
        .resample("A")\
        .mean()\
        .values
    
ann['diff'] = ann['obs'] - ann['daily']
ann['diff [%]'] = 100 - ann['daily']/ann['obs']*100

print(ann.describe())

ann
#+END_SRC

** Køge Bugt Y2K
#+BEGIN_SRC jupyter-python :session kb_y2k :exports both :results raw drawer :display text/org
D = pd.read_csv("./out/sector_D.csv", index_col=0, parse_dates=True)
err = pd.read_csv("./out/sector_err.csv", index_col=0, parse_dates=True)

S = "KOGE_BUGT_C"
D = D[S].resample('1D',axis='rows').mean().interpolate(method='time',limit_area='inside').resample('A',axis='rows').mean()

err = err[S].resample('1D',axis='rows').mean().interpolate(method='time',limit_area='inside').resample('A',axis='rows').mean()

print("Køge Bugt C described:\n", D.describe())

df = pd.DataFrame(index=D.index)
df['KB'] = D
df['err'] = err
df
#+END_SRC

* QA / QC / tests                                       :noexport:
** Files used in this work                              :noexport:
*** MEaSUREs
**** 0478
***** File List

#+NAME: QC_filelist_NSIDC_0478
#+BEGIN_SRC bash :results verbatim :eval no-export
find ${DATADIR}/MEaSUREs/NSIDC-0478.002 | sed "s:^${DATADIR}::" | LC_ALL=C sort
#+END_SRC

#+RESULTS: QC_filelist_NSIDC_0478
#+begin_example
/MEaSUREs/NSIDC-0478.002
/MEaSUREs/NSIDC-0478.002/2000.09.03
/MEaSUREs/NSIDC-0478.002/2000.09.03/greenland_vel_mosaic500_2000_2001_browse_v02.1.jpg
/MEaSUREs/NSIDC-0478.002/2000.09.03/greenland_vel_mosaic500_2000_2001_ex_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2000.09.03/greenland_vel_mosaic500_2000_2001_ey_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2000.09.03/greenland_vel_mosaic500_2000_2001_v02.1.xml
/MEaSUREs/NSIDC-0478.002/2000.09.03/greenland_vel_mosaic500_2000_2001_vv_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2000.09.03/greenland_vel_mosaic500_2000_2001_vx_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2000.09.03/greenland_vel_mosaic500_2000_2001_vy_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2000.09.03/greenland_vel_mosaic_2000_2001_v02.1.dbf
/MEaSUREs/NSIDC-0478.002/2000.09.03/greenland_vel_mosaic_2000_2001_v02.1.prj
/MEaSUREs/NSIDC-0478.002/2000.09.03/greenland_vel_mosaic_2000_2001_v02.1.shp
/MEaSUREs/NSIDC-0478.002/2000.09.03/greenland_vel_mosaic_2000_2001_v02.1.shx
/MEaSUREs/NSIDC-0478.002/2000.09.03/greenland_vel_mosaic_2000_2001_v02.1.xml
/MEaSUREs/NSIDC-0478.002/2005.12.13
/MEaSUREs/NSIDC-0478.002/2005.12.13/greenland_vel_mosaic500_2005_2006_browse_v02.1.jpg
/MEaSUREs/NSIDC-0478.002/2005.12.13/greenland_vel_mosaic500_2005_2006_ex_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2005.12.13/greenland_vel_mosaic500_2005_2006_ey_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2005.12.13/greenland_vel_mosaic500_2005_2006_v02.1.xml
/MEaSUREs/NSIDC-0478.002/2005.12.13/greenland_vel_mosaic500_2005_2006_vv_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2005.12.13/greenland_vel_mosaic500_2005_2006_vx_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2005.12.13/greenland_vel_mosaic500_2005_2006_vy_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2005.12.13/greenland_vel_mosaic_2005_2006_v02.1.dbf
/MEaSUREs/NSIDC-0478.002/2005.12.13/greenland_vel_mosaic_2005_2006_v02.1.prj
/MEaSUREs/NSIDC-0478.002/2005.12.13/greenland_vel_mosaic_2005_2006_v02.1.shp
/MEaSUREs/NSIDC-0478.002/2005.12.13/greenland_vel_mosaic_2005_2006_v02.1.shx
/MEaSUREs/NSIDC-0478.002/2005.12.13/greenland_vel_mosaic_2005_2006_v02.1.xml
/MEaSUREs/NSIDC-0478.002/2006.12.18
/MEaSUREs/NSIDC-0478.002/2006.12.18/greenland_vel_mosaic500_2006_2007_browse_v02.1.jpg
/MEaSUREs/NSIDC-0478.002/2006.12.18/greenland_vel_mosaic500_2006_2007_ex_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2006.12.18/greenland_vel_mosaic500_2006_2007_ey_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2006.12.18/greenland_vel_mosaic500_2006_2007_v02.1.xml
/MEaSUREs/NSIDC-0478.002/2006.12.18/greenland_vel_mosaic500_2006_2007_vv_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2006.12.18/greenland_vel_mosaic500_2006_2007_vx_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2006.12.18/greenland_vel_mosaic500_2006_2007_vy_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2006.12.18/greenland_vel_mosaic_2006_2007_v02.1.dbf
/MEaSUREs/NSIDC-0478.002/2006.12.18/greenland_vel_mosaic_2006_2007_v02.1.prj
/MEaSUREs/NSIDC-0478.002/2006.12.18/greenland_vel_mosaic_2006_2007_v02.1.shp
/MEaSUREs/NSIDC-0478.002/2006.12.18/greenland_vel_mosaic_2006_2007_v02.1.shx
/MEaSUREs/NSIDC-0478.002/2006.12.18/greenland_vel_mosaic_2006_2007_v02.1.xml
/MEaSUREs/NSIDC-0478.002/2007.09.07
/MEaSUREs/NSIDC-0478.002/2007.09.07/greenland_vel_mosaic500_2007_2008_browse_v02.1.jpg
/MEaSUREs/NSIDC-0478.002/2007.09.07/greenland_vel_mosaic500_2007_2008_ex_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2007.09.07/greenland_vel_mosaic500_2007_2008_ey_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2007.09.07/greenland_vel_mosaic500_2007_2008_v02.1.xml
/MEaSUREs/NSIDC-0478.002/2007.09.07/greenland_vel_mosaic500_2007_2008_vv_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2007.09.07/greenland_vel_mosaic500_2007_2008_vx_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2007.09.07/greenland_vel_mosaic500_2007_2008_vy_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2007.09.07/greenland_vel_mosaic_2007_2008_v02.1.dbf
/MEaSUREs/NSIDC-0478.002/2007.09.07/greenland_vel_mosaic_2007_2008_v02.1.prj
/MEaSUREs/NSIDC-0478.002/2007.09.07/greenland_vel_mosaic_2007_2008_v02.1.shp
/MEaSUREs/NSIDC-0478.002/2007.09.07/greenland_vel_mosaic_2007_2008_v02.1.shx
/MEaSUREs/NSIDC-0478.002/2007.09.07/greenland_vel_mosaic_2007_2008_v02.1.xml
/MEaSUREs/NSIDC-0478.002/2008.09.15
/MEaSUREs/NSIDC-0478.002/2008.09.15/greenland_vel_mosaic500_2008_2009_browse_v02.1.jpg
/MEaSUREs/NSIDC-0478.002/2008.09.15/greenland_vel_mosaic500_2008_2009_ex_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2008.09.15/greenland_vel_mosaic500_2008_2009_ey_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2008.09.15/greenland_vel_mosaic500_2008_2009_v02.1.xml
/MEaSUREs/NSIDC-0478.002/2008.09.15/greenland_vel_mosaic500_2008_2009_vv_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2008.09.15/greenland_vel_mosaic500_2008_2009_vx_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2008.09.15/greenland_vel_mosaic500_2008_2009_vy_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2008.09.15/greenland_vel_mosaic_2008_2009_v02.1.dbf
/MEaSUREs/NSIDC-0478.002/2008.09.15/greenland_vel_mosaic_2008_2009_v02.1.prj
/MEaSUREs/NSIDC-0478.002/2008.09.15/greenland_vel_mosaic_2008_2009_v02.1.shp
/MEaSUREs/NSIDC-0478.002/2008.09.15/greenland_vel_mosaic_2008_2009_v02.1.shx
/MEaSUREs/NSIDC-0478.002/2008.09.15/greenland_vel_mosaic_2008_2009_v02.1.xml
/MEaSUREs/NSIDC-0478.002/2009.09.02
/MEaSUREs/NSIDC-0478.002/2009.09.02/greenland_vel_mosaic500_2009_2010_browse_v02.1.jpg
/MEaSUREs/NSIDC-0478.002/2009.09.02/greenland_vel_mosaic500_2009_2010_ex_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2009.09.02/greenland_vel_mosaic500_2009_2010_ey_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2009.09.02/greenland_vel_mosaic500_2009_2010_v02.1.xml
/MEaSUREs/NSIDC-0478.002/2009.09.02/greenland_vel_mosaic500_2009_2010_vv_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2009.09.02/greenland_vel_mosaic500_2009_2010_vx_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2009.09.02/greenland_vel_mosaic500_2009_2010_vy_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2009.09.02/greenland_vel_mosaic_2009_2010_v02.1.dbf
/MEaSUREs/NSIDC-0478.002/2009.09.02/greenland_vel_mosaic_2009_2010_v02.1.prj
/MEaSUREs/NSIDC-0478.002/2009.09.02/greenland_vel_mosaic_2009_2010_v02.1.shp
/MEaSUREs/NSIDC-0478.002/2009.09.02/greenland_vel_mosaic_2009_2010_v02.1.shx
/MEaSUREs/NSIDC-0478.002/2009.09.02/greenland_vel_mosaic_2009_2010_v02.1.xml
/MEaSUREs/NSIDC-0478.002/2012.11.10
/MEaSUREs/NSIDC-0478.002/2012.11.10/greenland_vel_mosaic500_2012_2013_browse_v02.1.jpg
/MEaSUREs/NSIDC-0478.002/2012.11.10/greenland_vel_mosaic500_2012_2013_ex_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2012.11.10/greenland_vel_mosaic500_2012_2013_ey_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2012.11.10/greenland_vel_mosaic500_2012_2013_v02.1.xml
/MEaSUREs/NSIDC-0478.002/2012.11.10/greenland_vel_mosaic500_2012_2013_vv_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2012.11.10/greenland_vel_mosaic500_2012_2013_vx_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2012.11.10/greenland_vel_mosaic500_2012_2013_vy_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2012.11.10/greenland_vel_mosaic_2012_2013_v02.1.dbf
/MEaSUREs/NSIDC-0478.002/2012.11.10/greenland_vel_mosaic_2012_2013_v02.1.prj
/MEaSUREs/NSIDC-0478.002/2012.11.10/greenland_vel_mosaic_2012_2013_v02.1.shp
/MEaSUREs/NSIDC-0478.002/2012.11.10/greenland_vel_mosaic_2012_2013_v02.1.shx
/MEaSUREs/NSIDC-0478.002/2012.11.10/greenland_vel_mosaic_2012_2013_v02.1.xml
/MEaSUREs/NSIDC-0478.002/2014.09.01
/MEaSUREs/NSIDC-0478.002/2014.09.01/greenland_vel_mosaic200_2014_2015_browse_v02.1.jpg
/MEaSUREs/NSIDC-0478.002/2014.09.01/greenland_vel_mosaic200_2014_2015_ex_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2014.09.01/greenland_vel_mosaic200_2014_2015_ey_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2014.09.01/greenland_vel_mosaic200_2014_2015_v02.1.xml
/MEaSUREs/NSIDC-0478.002/2014.09.01/greenland_vel_mosaic200_2014_2015_vv_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2014.09.01/greenland_vel_mosaic200_2014_2015_vx_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2014.09.01/greenland_vel_mosaic200_2014_2015_vy_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2014.09.01/greenland_vel_mosaic500_2014_2015_browse_v02.1.jpg
/MEaSUREs/NSIDC-0478.002/2014.09.01/greenland_vel_mosaic500_2014_2015_ex_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2014.09.01/greenland_vel_mosaic500_2014_2015_ey_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2014.09.01/greenland_vel_mosaic500_2014_2015_v02.1.xml
/MEaSUREs/NSIDC-0478.002/2014.09.01/greenland_vel_mosaic500_2014_2015_vv_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2014.09.01/greenland_vel_mosaic500_2014_2015_vx_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2014.09.01/greenland_vel_mosaic500_2014_2015_vy_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2014.09.01/greenland_vel_mosaic_2014_2015_v02.1.dbf
/MEaSUREs/NSIDC-0478.002/2014.09.01/greenland_vel_mosaic_2014_2015_v02.1.prj
/MEaSUREs/NSIDC-0478.002/2014.09.01/greenland_vel_mosaic_2014_2015_v02.1.shp
/MEaSUREs/NSIDC-0478.002/2014.09.01/greenland_vel_mosaic_2014_2015_v02.1.shx
/MEaSUREs/NSIDC-0478.002/2014.09.01/greenland_vel_mosaic_2014_2015_v02.1.xml
/MEaSUREs/NSIDC-0478.002/2015.09.01
/MEaSUREs/NSIDC-0478.002/2015.09.01/greenland_vel_mosaic200_2015_2016_browse_v02.1.jpg
/MEaSUREs/NSIDC-0478.002/2015.09.01/greenland_vel_mosaic200_2015_2016_ex_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2015.09.01/greenland_vel_mosaic200_2015_2016_ey_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2015.09.01/greenland_vel_mosaic200_2015_2016_v02.1.xml
/MEaSUREs/NSIDC-0478.002/2015.09.01/greenland_vel_mosaic200_2015_2016_vv_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2015.09.01/greenland_vel_mosaic200_2015_2016_vx_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2015.09.01/greenland_vel_mosaic200_2015_2016_vy_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2015.09.01/greenland_vel_mosaic500_2015_2016_browse_v02.1.jpg
/MEaSUREs/NSIDC-0478.002/2015.09.01/greenland_vel_mosaic500_2015_2016_ex_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2015.09.01/greenland_vel_mosaic500_2015_2016_ey_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2015.09.01/greenland_vel_mosaic500_2015_2016_v02.1.xml
/MEaSUREs/NSIDC-0478.002/2015.09.01/greenland_vel_mosaic500_2015_2016_vv_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2015.09.01/greenland_vel_mosaic500_2015_2016_vx_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2015.09.01/greenland_vel_mosaic500_2015_2016_vy_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2015.09.01/greenland_vel_mosaic_2015_2016_v02.1.dbf
/MEaSUREs/NSIDC-0478.002/2015.09.01/greenland_vel_mosaic_2015_2016_v02.1.prj
/MEaSUREs/NSIDC-0478.002/2015.09.01/greenland_vel_mosaic_2015_2016_v02.1.shp
/MEaSUREs/NSIDC-0478.002/2015.09.01/greenland_vel_mosaic_2015_2016_v02.1.shx
/MEaSUREs/NSIDC-0478.002/2015.09.01/greenland_vel_mosaic_2015_2016_v02.1.xml
/MEaSUREs/NSIDC-0478.002/2016.09.01
/MEaSUREs/NSIDC-0478.002/2016.09.01/greenland_vel_mosaic200_2016_2017_browse_v02.1.jpg
/MEaSUREs/NSIDC-0478.002/2016.09.01/greenland_vel_mosaic200_2016_2017_ex_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2016.09.01/greenland_vel_mosaic200_2016_2017_ey_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2016.09.01/greenland_vel_mosaic200_2016_2017_v02.1.xml
/MEaSUREs/NSIDC-0478.002/2016.09.01/greenland_vel_mosaic200_2016_2017_vv_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2016.09.01/greenland_vel_mosaic200_2016_2017_vx_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2016.09.01/greenland_vel_mosaic200_2016_2017_vy_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2016.09.01/greenland_vel_mosaic500_2016_2017_browse_v02.1.jpg
/MEaSUREs/NSIDC-0478.002/2016.09.01/greenland_vel_mosaic500_2016_2017_ex_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2016.09.01/greenland_vel_mosaic500_2016_2017_ey_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2016.09.01/greenland_vel_mosaic500_2016_2017_v02.1.xml
/MEaSUREs/NSIDC-0478.002/2016.09.01/greenland_vel_mosaic500_2016_2017_vv_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2016.09.01/greenland_vel_mosaic500_2016_2017_vx_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2016.09.01/greenland_vel_mosaic500_2016_2017_vy_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2016.09.01/greenland_vel_mosaic_2016_2017_v02.1.dbf
/MEaSUREs/NSIDC-0478.002/2016.09.01/greenland_vel_mosaic_2016_2017_v02.1.prj
/MEaSUREs/NSIDC-0478.002/2016.09.01/greenland_vel_mosaic_2016_2017_v02.1.shp
/MEaSUREs/NSIDC-0478.002/2016.09.01/greenland_vel_mosaic_2016_2017_v02.1.shx
/MEaSUREs/NSIDC-0478.002/2016.09.01/greenland_vel_mosaic_2016_2017_v02.1.xml
/MEaSUREs/NSIDC-0478.002/2017.09.01
/MEaSUREs/NSIDC-0478.002/2017.09.01/greenland_vel_mosaic200_2017_2018_browse_v02.1.jpg
/MEaSUREs/NSIDC-0478.002/2017.09.01/greenland_vel_mosaic200_2017_2018_ex_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2017.09.01/greenland_vel_mosaic200_2017_2018_ey_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2017.09.01/greenland_vel_mosaic200_2017_2018_v02.1.xml
/MEaSUREs/NSIDC-0478.002/2017.09.01/greenland_vel_mosaic200_2017_2018_vv_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2017.09.01/greenland_vel_mosaic200_2017_2018_vx_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2017.09.01/greenland_vel_mosaic200_2017_2018_vy_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2017.09.01/greenland_vel_mosaic500_2017_2018_browse_v02.1.jpg
/MEaSUREs/NSIDC-0478.002/2017.09.01/greenland_vel_mosaic500_2017_2018_ex_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2017.09.01/greenland_vel_mosaic500_2017_2018_ey_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2017.09.01/greenland_vel_mosaic500_2017_2018_v02.1.xml
/MEaSUREs/NSIDC-0478.002/2017.09.01/greenland_vel_mosaic500_2017_2018_vv_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2017.09.01/greenland_vel_mosaic500_2017_2018_vx_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2017.09.01/greenland_vel_mosaic500_2017_2018_vy_v02.1.tif
/MEaSUREs/NSIDC-0478.002/2017.09.01/greenland_vel_mosaic_2017_2018_v02.1.dbf
/MEaSUREs/NSIDC-0478.002/2017.09.01/greenland_vel_mosaic_2017_2018_v02.1.prj
/MEaSUREs/NSIDC-0478.002/2017.09.01/greenland_vel_mosaic_2017_2018_v02.1.shp
/MEaSUREs/NSIDC-0478.002/2017.09.01/greenland_vel_mosaic_2017_2018_v02.1.shx
/MEaSUREs/NSIDC-0478.002/2017.09.01/greenland_vel_mosaic_2017_2018_v02.1.xml
/MEaSUREs/NSIDC-0478.002/README.org
#+end_example


***** File Metadata

#+NAME: QC_gdalinfo_NSIDC_0478
#+BEGIN_SRC bash :results verbatim :eval no-export
somefile=$(find ${DATADIR}/MEaSUREs/NSIDC-0478.002 -name "*.tif"  | LC_ALL=C sort | grep ".*mosaic200.*vv.*" | head -n1)
md5sum ${somefile}
echo ""
gdalinfo -mm ${somefile}
#+END_SRC

#+RESULTS: QC_gdalinfo_NSIDC_0478
#+begin_example
9bf8fcf0c4add78ed54c4a35b444bdc3  /home/kdm/data/MEaSUREs/NSIDC-0478.002/2014.09.01/greenland_vel_mosaic200_2014_2015_vv_v02.1.tif

Driver: GTiff/GeoTIFF
Files: /home/kdm/data/MEaSUREs/NSIDC-0478.002/2014.09.01/greenland_vel_mosaic200_2014_2015_vv_v02.1.tif
Size is 7585, 13700
Coordinate System is:
PROJCRS["unnamed",
    BASEGEOGCRS["WGS 84",
        DATUM["World Geodetic System 1984",
            ELLIPSOID["WGS 84",6378137,298.257223563,
                LENGTHUNIT["metre",1]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433]],
        ID["EPSG",4326]],
    CONVERSION["Polar Stereographic (variant B)",
        METHOD["Polar Stereographic (variant B)",
            ID["EPSG",9829]],
        PARAMETER["Latitude of standard parallel",70,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8832]],
        PARAMETER["Longitude of origin",-45,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8833]],
        PARAMETER["False easting",0,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",0,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["(E)",south,
            MERIDIAN[90,
                ANGLEUNIT["degree",0.0174532925199433,
                    ID["EPSG",9122]]],
            ORDER[1],
            LENGTHUNIT["metre",1]],
        AXIS["(N)",south,
            MERIDIAN[180,
                ANGLEUNIT["degree",0.0174532925199433,
                    ID["EPSG",9122]]],
            ORDER[2],
            LENGTHUNIT["metre",1]]]
Data axis to CRS axis mapping: 1,2
Origin = (-659100.000000000000000,-639100.000000000000000)
Pixel Size = (200.000000000000000,-200.000000000000000)
Metadata:
  AREA_OR_POINT=Area
Image Structure Metadata:
  INTERLEAVE=BAND
Corner Coordinates:
Upper Left  ( -659100.000, -639100.000) ( 90d52'57.45"W, 81d32'23.19"N)
Lower Left  ( -659100.000,-3379100.000) ( 56d 2'13.47"W, 58d58'10.19"N)
Upper Right (  857900.000, -639100.000) (  8d18'55.49"E, 80d 8'52.35"N)
Lower Right (  857900.000,-3379100.000) ( 30d45'16.18"W, 58d35'44.75"N)
Center      (   99400.000,-2009100.000) ( 42d10' 3.39"W, 71d35' 4.30"N)
Band 1 Block=7585x1 Type=Float32, ColorInterp=Gray
    Computed Min/Max=0.002,18831.568
  NoData Value=-1
#+end_example


***** md5sum hashes of all data

#+NAME: QC_md5sum_NSIDC_0478
#+BEGIN_SRC bash :results table :eval no-export
cd ${DATADIR}/MEaSUREs/NSIDC-0478.002
# awk 'NR % 5 == 0' input > output # print every 5th line
# head -n2 # top two files
find . -type f | LC_ALL=C sort | parallel --keep-order "md5sum {}"
#+END_SRC

#+RESULTS: QC_md5sum_NSIDC_0478
| e6867a11fe4f5512b3bbc2c98e898b68 | ./2000.09.03/greenland_vel_mosaic500_2000_2001_browse_v02.1.jpg |
| 5ea53ca6a21c442579c306ad7238de17 | ./2000.09.03/greenland_vel_mosaic500_2000_2001_ex_v02.1.tif     |
| ff11d930cd3f0756bb824921842e6cca | ./2000.09.03/greenland_vel_mosaic500_2000_2001_ey_v02.1.tif     |
| 73a9d1b70b038157693715f3a523e35d | ./2000.09.03/greenland_vel_mosaic500_2000_2001_v02.1.xml        |
| ca9145a87fa424fe8abeb32052267e33 | ./2000.09.03/greenland_vel_mosaic500_2000_2001_vv_v02.1.tif     |
| dc4e91af90f43097f6a4f4ba9597910c | ./2000.09.03/greenland_vel_mosaic500_2000_2001_vx_v02.1.tif     |
| 1d6954709642cec561dc91b90ac7f60f | ./2000.09.03/greenland_vel_mosaic500_2000_2001_vy_v02.1.tif     |
| c84107bba5052e9df4d7ec8701118307 | ./2000.09.03/greenland_vel_mosaic_2000_2001_v02.1.dbf           |
| 46b30532526b6ff959b307123a6d5e71 | ./2000.09.03/greenland_vel_mosaic_2000_2001_v02.1.prj           |
| 8e6039ab0f15c9126516065fc287f607 | ./2000.09.03/greenland_vel_mosaic_2000_2001_v02.1.shp           |
| 640c87cc6ce1af1dacb7f66419ecf197 | ./2000.09.03/greenland_vel_mosaic_2000_2001_v02.1.shx           |
| 7b2371d700693f5b3ae689fcfe730cdd | ./2000.09.03/greenland_vel_mosaic_2000_2001_v02.1.xml           |
| 64d246573c12172be2219930ac1e7eda | ./2005.12.13/greenland_vel_mosaic500_2005_2006_browse_v02.1.jpg |
| bb97aa565833a16397581e8de241a812 | ./2005.12.13/greenland_vel_mosaic500_2005_2006_ex_v02.1.tif     |
| 8caba334c0b82f1266bc51370909b4f6 | ./2005.12.13/greenland_vel_mosaic500_2005_2006_ey_v02.1.tif     |
| e2e99719ddb1f48213942b5cbcc41925 | ./2005.12.13/greenland_vel_mosaic500_2005_2006_v02.1.xml        |
| 259b6cf64eb6c0c04bcbc06ba325f3d8 | ./2005.12.13/greenland_vel_mosaic500_2005_2006_vv_v02.1.tif     |
| 03ad1862e1ed6ec439130d9a92817560 | ./2005.12.13/greenland_vel_mosaic500_2005_2006_vx_v02.1.tif     |
| 92135c8aa6ce1ce3cc56d63d008358fa | ./2005.12.13/greenland_vel_mosaic500_2005_2006_vy_v02.1.tif     |
| 47cd89de9cfa4778653c0c83719c6105 | ./2005.12.13/greenland_vel_mosaic_2005_2006_v02.1.dbf           |
| 46b30532526b6ff959b307123a6d5e71 | ./2005.12.13/greenland_vel_mosaic_2005_2006_v02.1.prj           |
| 53c6479e54c23fe0e2d1957f9fafeb4f | ./2005.12.13/greenland_vel_mosaic_2005_2006_v02.1.shp           |
| d6e80a79eaa6535ebf68803e951a7f50 | ./2005.12.13/greenland_vel_mosaic_2005_2006_v02.1.shx           |
| 35791a242f3cdf1b6142cbbcaa33fee6 | ./2005.12.13/greenland_vel_mosaic_2005_2006_v02.1.xml           |
| 7d22aa4b7e7bb2222b32d9dff4b6e983 | ./2006.12.18/greenland_vel_mosaic500_2006_2007_browse_v02.1.jpg |
| 5284edf84ebbf582dd3e1fdb8c0a75a2 | ./2006.12.18/greenland_vel_mosaic500_2006_2007_ex_v02.1.tif     |
| 72018561e3234b6e7327ee99f6165fc4 | ./2006.12.18/greenland_vel_mosaic500_2006_2007_ey_v02.1.tif     |
| 8216f1e6e5cd3347308a6dc33b576aac | ./2006.12.18/greenland_vel_mosaic500_2006_2007_v02.1.xml        |
| 7c6ea53e512f5ad44f8e847b29cc5ed6 | ./2006.12.18/greenland_vel_mosaic500_2006_2007_vv_v02.1.tif     |
| b7eb89b5ebd1a9a964aadead2d785460 | ./2006.12.18/greenland_vel_mosaic500_2006_2007_vx_v02.1.tif     |
| ccc099a8bd54b18ca42274fa3b579404 | ./2006.12.18/greenland_vel_mosaic500_2006_2007_vy_v02.1.tif     |
| 36cfad6bdd621148c9f35c3dbd6591ae | ./2006.12.18/greenland_vel_mosaic_2006_2007_v02.1.dbf           |
| 46b30532526b6ff959b307123a6d5e71 | ./2006.12.18/greenland_vel_mosaic_2006_2007_v02.1.prj           |
| a92b357d325733c3aaf5311190b7c314 | ./2006.12.18/greenland_vel_mosaic_2006_2007_v02.1.shp           |
| 735fbcc0fcf628874d88b1b6eb1b7676 | ./2006.12.18/greenland_vel_mosaic_2006_2007_v02.1.shx           |
| 26437e169a4c192a6c4b2d5bac3b5cf0 | ./2006.12.18/greenland_vel_mosaic_2006_2007_v02.1.xml           |
| 9bb4a95fec1ffcfe9a0cd78be3787c2d | ./2007.09.07/greenland_vel_mosaic500_2007_2008_browse_v02.1.jpg |
| c44c35a30e1005bc80100377d92c5e0f | ./2007.09.07/greenland_vel_mosaic500_2007_2008_ex_v02.1.tif     |
| 7ebe65a72c1ec39f2e4cacf0a1974a06 | ./2007.09.07/greenland_vel_mosaic500_2007_2008_ey_v02.1.tif     |
| 87c00a4679d0101301155970220c5258 | ./2007.09.07/greenland_vel_mosaic500_2007_2008_v02.1.xml        |
| ba1f857fa37d4283900da6c8765872d2 | ./2007.09.07/greenland_vel_mosaic500_2007_2008_vv_v02.1.tif     |
| b54034263d8097659d47a923cacf42c1 | ./2007.09.07/greenland_vel_mosaic500_2007_2008_vx_v02.1.tif     |
| 68e11a41d9812827fa3f24a94542d0fd | ./2007.09.07/greenland_vel_mosaic500_2007_2008_vy_v02.1.tif     |
| 9a1ec4e17ef3e1f9f47d14c7a5fd5e86 | ./2007.09.07/greenland_vel_mosaic_2007_2008_v02.1.dbf           |
| 46b30532526b6ff959b307123a6d5e71 | ./2007.09.07/greenland_vel_mosaic_2007_2008_v02.1.prj           |
| 3aca53c07b1e34aaae7db97ea312c505 | ./2007.09.07/greenland_vel_mosaic_2007_2008_v02.1.shp           |
| f96c1c94232309994639fd42b78a7339 | ./2007.09.07/greenland_vel_mosaic_2007_2008_v02.1.shx           |
| 676dec0bddf08e07f7a1f01e1c5c94ba | ./2007.09.07/greenland_vel_mosaic_2007_2008_v02.1.xml           |
| 36a762e907dbda8829f6869112a1a9d5 | ./2008.09.15/greenland_vel_mosaic500_2008_2009_browse_v02.1.jpg |
| 0a01a2050ca4c0792129755ceca795aa | ./2008.09.15/greenland_vel_mosaic500_2008_2009_ex_v02.1.tif     |
| 94ea8fbabb89f1dfc1fcbaa88ad39796 | ./2008.09.15/greenland_vel_mosaic500_2008_2009_ey_v02.1.tif     |
| c43daa03a92e971e4bd7f7587011ab7f | ./2008.09.15/greenland_vel_mosaic500_2008_2009_v02.1.xml        |
| 018d7bcef3cff89e039484b8a35458eb | ./2008.09.15/greenland_vel_mosaic500_2008_2009_vv_v02.1.tif     |
| 166c6c1f647214ca1e7fc49fe90757a9 | ./2008.09.15/greenland_vel_mosaic500_2008_2009_vx_v02.1.tif     |
| 504b14bde498b6363c408442772a50be | ./2008.09.15/greenland_vel_mosaic500_2008_2009_vy_v02.1.tif     |
| bd3c23e4319c726575e0812067e968c3 | ./2008.09.15/greenland_vel_mosaic_2008_2009_v02.1.dbf           |
| 46b30532526b6ff959b307123a6d5e71 | ./2008.09.15/greenland_vel_mosaic_2008_2009_v02.1.prj           |
| fe32ee188b6eebde9e326724ae482152 | ./2008.09.15/greenland_vel_mosaic_2008_2009_v02.1.shp           |
| 8bbdc422f66c7f84b4962b2724927d8d | ./2008.09.15/greenland_vel_mosaic_2008_2009_v02.1.shx           |
| 9c4aca08efd481d81e9131f2f40b1755 | ./2008.09.15/greenland_vel_mosaic_2008_2009_v02.1.xml           |
| ac9d007f4c045d34d305fa7fed5517d6 | ./2009.09.02/greenland_vel_mosaic500_2009_2010_browse_v02.1.jpg |
| 6f467702bf41bdc8055c19b04d87f873 | ./2009.09.02/greenland_vel_mosaic500_2009_2010_ex_v02.1.tif     |
| 42888c41f7207c0654f8e80453e82c6a | ./2009.09.02/greenland_vel_mosaic500_2009_2010_ey_v02.1.tif     |
| 4fee3d32a4558553040da6075e1a93bb | ./2009.09.02/greenland_vel_mosaic500_2009_2010_v02.1.xml        |
| 743829d41ea07969345b6c768303b0e6 | ./2009.09.02/greenland_vel_mosaic500_2009_2010_vv_v02.1.tif     |
| af0583eb16c6d31cb8ceaeb64a3d6acd | ./2009.09.02/greenland_vel_mosaic500_2009_2010_vx_v02.1.tif     |
| 5abb91da20cbbdfe196e4a8bb5cc3e90 | ./2009.09.02/greenland_vel_mosaic500_2009_2010_vy_v02.1.tif     |
| a317e41c220f2f56216750d5b1d9a9c6 | ./2009.09.02/greenland_vel_mosaic_2009_2010_v02.1.dbf           |
| 46b30532526b6ff959b307123a6d5e71 | ./2009.09.02/greenland_vel_mosaic_2009_2010_v02.1.prj           |
| 4c73eb0870a52aa74a395eb1ae650b9c | ./2009.09.02/greenland_vel_mosaic_2009_2010_v02.1.shp           |
| 35568d07793ddcc4e93e5089ab4af9df | ./2009.09.02/greenland_vel_mosaic_2009_2010_v02.1.shx           |
| fe7f6ecba95baf148130a0d191898237 | ./2009.09.02/greenland_vel_mosaic_2009_2010_v02.1.xml           |
| cc34a28ba7a906fdbba4b003d3540a83 | ./2012.11.10/greenland_vel_mosaic500_2012_2013_browse_v02.1.jpg |
| 1e08376f4b552e82cb275b225d9a1e5b | ./2012.11.10/greenland_vel_mosaic500_2012_2013_ex_v02.1.tif     |
| 996d97a3ee004397d2185d37ddd5ebfe | ./2012.11.10/greenland_vel_mosaic500_2012_2013_ey_v02.1.tif     |
| fd82349e7193e754b21968bfd0846353 | ./2012.11.10/greenland_vel_mosaic500_2012_2013_v02.1.xml        |
| ca4fc877f5763218db73a19cd6c95a6a | ./2012.11.10/greenland_vel_mosaic500_2012_2013_vv_v02.1.tif     |
| ef668984eea41219fc3128ab83c2db32 | ./2012.11.10/greenland_vel_mosaic500_2012_2013_vx_v02.1.tif     |
| 0905c136d52a61e48fef38a6bafb72f0 | ./2012.11.10/greenland_vel_mosaic500_2012_2013_vy_v02.1.tif     |
| 095b0fc251b7ea2c6c15c28d2b9119a6 | ./2012.11.10/greenland_vel_mosaic_2012_2013_v02.1.dbf           |
| 46b30532526b6ff959b307123a6d5e71 | ./2012.11.10/greenland_vel_mosaic_2012_2013_v02.1.prj           |
| ce934db526d861877d2d81ed15192332 | ./2012.11.10/greenland_vel_mosaic_2012_2013_v02.1.shp           |
| f0400a26b83b90f241f62fcb362d1ac9 | ./2012.11.10/greenland_vel_mosaic_2012_2013_v02.1.shx           |
| 4a93e5ec8f254ea59da65ffd43c360a6 | ./2012.11.10/greenland_vel_mosaic_2012_2013_v02.1.xml           |
| 6d7f97224c4f318f984d8b0012be194b | ./2014.09.01/greenland_vel_mosaic200_2014_2015_browse_v02.1.jpg |
| 8529ea4957a4d98c15c6459985cbbac1 | ./2014.09.01/greenland_vel_mosaic200_2014_2015_ex_v02.1.tif     |
| dfcd41f9be8618d272562a0228183c0f | ./2014.09.01/greenland_vel_mosaic200_2014_2015_ey_v02.1.tif     |
| 065db101e178e62ac4589ec7a18f3b8f | ./2014.09.01/greenland_vel_mosaic200_2014_2015_v02.1.xml        |
| 9bf8fcf0c4add78ed54c4a35b444bdc3 | ./2014.09.01/greenland_vel_mosaic200_2014_2015_vv_v02.1.tif     |
| b39158d4fa66121a23543b1cf84eb967 | ./2014.09.01/greenland_vel_mosaic200_2014_2015_vx_v02.1.tif     |
| aadfd0763da9acb5604caa1e3e2a4906 | ./2014.09.01/greenland_vel_mosaic200_2014_2015_vy_v02.1.tif     |
| 48058d4bfba2526b66f74d9e093eaf6b | ./2014.09.01/greenland_vel_mosaic500_2014_2015_browse_v02.1.jpg |
| fa297f954f247cb5e8104c63ddb80def | ./2014.09.01/greenland_vel_mosaic500_2014_2015_ex_v02.1.tif     |
| 5beaf898560f0b53b06e02c00c570680 | ./2014.09.01/greenland_vel_mosaic500_2014_2015_ey_v02.1.tif     |
| c5f0562045c4c30cda5bfaba55269a37 | ./2014.09.01/greenland_vel_mosaic500_2014_2015_v02.1.xml        |
| 0a32de5018bc8779441678b78c0050a8 | ./2014.09.01/greenland_vel_mosaic500_2014_2015_vv_v02.1.tif     |
| 5d9fa64901b201e485b87dd421be0d6b | ./2014.09.01/greenland_vel_mosaic500_2014_2015_vx_v02.1.tif     |
| 1059e370d6b42df96fd096c047d598b7 | ./2014.09.01/greenland_vel_mosaic500_2014_2015_vy_v02.1.tif     |
| 8bed0f9b98bf18e6b230f1763d2d0a85 | ./2014.09.01/greenland_vel_mosaic_2014_2015_v02.1.dbf           |
| 46b30532526b6ff959b307123a6d5e71 | ./2014.09.01/greenland_vel_mosaic_2014_2015_v02.1.prj           |
| e3e424bcf9662294c816f097176795e6 | ./2014.09.01/greenland_vel_mosaic_2014_2015_v02.1.shp           |
| 9b736f353dc7dd85fa41404595cdc070 | ./2014.09.01/greenland_vel_mosaic_2014_2015_v02.1.shx           |
| 2b8cc13c69f6e36f7d47d99d9224d1d1 | ./2014.09.01/greenland_vel_mosaic_2014_2015_v02.1.xml           |
| 2cbe77ad0dc94962dd40d91b9d7bc1b9 | ./2015.09.01/greenland_vel_mosaic200_2015_2016_browse_v02.1.jpg |
| e9e3d01d630533d870d552da023a66ba | ./2015.09.01/greenland_vel_mosaic200_2015_2016_ex_v02.1.tif     |
| 1d1b5b0efcdf24218e9f7d75b6750a3d | ./2015.09.01/greenland_vel_mosaic200_2015_2016_ey_v02.1.tif     |
| 6fcbded660bff6d6663fba9f1c9753d3 | ./2015.09.01/greenland_vel_mosaic200_2015_2016_v02.1.xml        |
| c4e31ad76bf8c774d2d2717ee1298a36 | ./2015.09.01/greenland_vel_mosaic200_2015_2016_vv_v02.1.tif     |
| 48bfa5266b6ecf5d4939c306f665ce47 | ./2015.09.01/greenland_vel_mosaic200_2015_2016_vx_v02.1.tif     |
| f68a5bbc76bcbb11b3cfe7a979d64651 | ./2015.09.01/greenland_vel_mosaic200_2015_2016_vy_v02.1.tif     |
| 476cac9fe27f28218ad3bd40a06a8278 | ./2015.09.01/greenland_vel_mosaic500_2015_2016_browse_v02.1.jpg |
| e88ca627886afdb8435205a7b1c3f483 | ./2015.09.01/greenland_vel_mosaic500_2015_2016_ex_v02.1.tif     |
| b91a3cdede19b30f8268c56af97a1401 | ./2015.09.01/greenland_vel_mosaic500_2015_2016_ey_v02.1.tif     |
| 29814600e8360652bad1a92dbb5c12b1 | ./2015.09.01/greenland_vel_mosaic500_2015_2016_v02.1.xml        |
| b56ca5d8e3fabe640802ef10cac98c05 | ./2015.09.01/greenland_vel_mosaic500_2015_2016_vv_v02.1.tif     |
| 94fac5a60e8d74d5daef331437725a2a | ./2015.09.01/greenland_vel_mosaic500_2015_2016_vx_v02.1.tif     |
| 7e62f18ca9a76646329a5c9de0774c70 | ./2015.09.01/greenland_vel_mosaic500_2015_2016_vy_v02.1.tif     |
| c56deac0f504fb790a0d41580ed3b93f | ./2015.09.01/greenland_vel_mosaic_2015_2016_v02.1.dbf           |
| 46b30532526b6ff959b307123a6d5e71 | ./2015.09.01/greenland_vel_mosaic_2015_2016_v02.1.prj           |
| 7dbe778bdcfa579fc06c38aaea44ca0b | ./2015.09.01/greenland_vel_mosaic_2015_2016_v02.1.shp           |
| 8c46c7d794b1b41a61c8a768000ddb92 | ./2015.09.01/greenland_vel_mosaic_2015_2016_v02.1.shx           |
| 017ceccd7054a6a5ac467573ec89717b | ./2015.09.01/greenland_vel_mosaic_2015_2016_v02.1.xml           |
| 0aef551d3da1ba45837130be98bf9ee7 | ./2016.09.01/greenland_vel_mosaic200_2016_2017_browse_v02.1.jpg |
| 8cecafd27346f730c02d0c887d608d39 | ./2016.09.01/greenland_vel_mosaic200_2016_2017_ex_v02.1.tif     |
| 56355df21064d121305ead513682222d | ./2016.09.01/greenland_vel_mosaic200_2016_2017_ey_v02.1.tif     |
| ace1b23a7a5c74ba25e1457c830b410f | ./2016.09.01/greenland_vel_mosaic200_2016_2017_v02.1.xml        |
| 0532b20cddc74867a770c5b306c442ec | ./2016.09.01/greenland_vel_mosaic200_2016_2017_vv_v02.1.tif     |
| 522dd0173fad38c99f0a6c896be48914 | ./2016.09.01/greenland_vel_mosaic200_2016_2017_vx_v02.1.tif     |
| 7964dca90e3d5b48fb8e39f0160aa705 | ./2016.09.01/greenland_vel_mosaic200_2016_2017_vy_v02.1.tif     |
| 1d5721a981065aa92b3f1a9b02691f40 | ./2016.09.01/greenland_vel_mosaic500_2016_2017_browse_v02.1.jpg |
| 9bf87cf955a0ef2e1fedab5bbb5e49c0 | ./2016.09.01/greenland_vel_mosaic500_2016_2017_ex_v02.1.tif     |
| f5ba497d91161e2c92e5c6c6333e9dd9 | ./2016.09.01/greenland_vel_mosaic500_2016_2017_ey_v02.1.tif     |
| 3d613e5b8cddfaad13a0bd4226185afc | ./2016.09.01/greenland_vel_mosaic500_2016_2017_v02.1.xml        |
| 7dbfed1d27cb7f53425042170e9f612b | ./2016.09.01/greenland_vel_mosaic500_2016_2017_vv_v02.1.tif     |
| 9e66bb5b796781e50c63ac084268c07f | ./2016.09.01/greenland_vel_mosaic500_2016_2017_vx_v02.1.tif     |
| d13679a8fedfdb88e6ea2bfb1c79c523 | ./2016.09.01/greenland_vel_mosaic500_2016_2017_vy_v02.1.tif     |
| 16acfc18fc991cc3627426695ab78d32 | ./2016.09.01/greenland_vel_mosaic_2016_2017_v02.1.dbf           |
| 46b30532526b6ff959b307123a6d5e71 | ./2016.09.01/greenland_vel_mosaic_2016_2017_v02.1.prj           |
| 0314c3b53b2f894bc049468080da81df | ./2016.09.01/greenland_vel_mosaic_2016_2017_v02.1.shp           |
| 0ffbae03976b6d3832b183521c7197ab | ./2016.09.01/greenland_vel_mosaic_2016_2017_v02.1.shx           |
| 4bb7af95ad3aa0a51d36ed87a0f6b894 | ./2016.09.01/greenland_vel_mosaic_2016_2017_v02.1.xml           |
| ab274d74bd6a7cbd39d41989b91b2bcf | ./2017.09.01/greenland_vel_mosaic200_2017_2018_browse_v02.1.jpg |
| fdf36e5a01118dd4e54996665d13c170 | ./2017.09.01/greenland_vel_mosaic200_2017_2018_ex_v02.1.tif     |
| 1b1c7ffae2ea5e2d0b28f0428549c1e2 | ./2017.09.01/greenland_vel_mosaic200_2017_2018_ey_v02.1.tif     |
| 598d5f3645bb378f89e53e2c216ce35d | ./2017.09.01/greenland_vel_mosaic200_2017_2018_v02.1.xml        |
| 00651d98489def32128f3175e6ce67a1 | ./2017.09.01/greenland_vel_mosaic200_2017_2018_vv_v02.1.tif     |
| 6cdb1a1651c843ca9a8d06e069a0cf34 | ./2017.09.01/greenland_vel_mosaic200_2017_2018_vx_v02.1.tif     |
| 1facbb34e2e58b657b8b7f2a4188dde2 | ./2017.09.01/greenland_vel_mosaic200_2017_2018_vy_v02.1.tif     |
| cdf3f2674515176a734df5a7b6f0f297 | ./2017.09.01/greenland_vel_mosaic500_2017_2018_browse_v02.1.jpg |
| 9837baeee2a7e7a12b4c49ac88198d47 | ./2017.09.01/greenland_vel_mosaic500_2017_2018_ex_v02.1.tif     |
| e825dc3f37c4bb36833b073195885a06 | ./2017.09.01/greenland_vel_mosaic500_2017_2018_ey_v02.1.tif     |
| 1c621f7082212eef4c0d189fc9af841a | ./2017.09.01/greenland_vel_mosaic500_2017_2018_v02.1.xml        |
| 59ffa5696a35920d3b8242d81a47421a | ./2017.09.01/greenland_vel_mosaic500_2017_2018_vv_v02.1.tif     |
| 56be38d07feb7a57fe44e1aa4c864a21 | ./2017.09.01/greenland_vel_mosaic500_2017_2018_vx_v02.1.tif     |
| 4027678341666a9cefde6752dfe2d3c1 | ./2017.09.01/greenland_vel_mosaic500_2017_2018_vy_v02.1.tif     |
| e95ef0a9bb8affd130037299b82bbda5 | ./2017.09.01/greenland_vel_mosaic_2017_2018_v02.1.dbf           |
| 46b30532526b6ff959b307123a6d5e71 | ./2017.09.01/greenland_vel_mosaic_2017_2018_v02.1.prj           |
| 952ff8d38c6a7104d15085f665026779 | ./2017.09.01/greenland_vel_mosaic_2017_2018_v02.1.shp           |
| 40bb5405e925c999e34e7b07c78058f5 | ./2017.09.01/greenland_vel_mosaic_2017_2018_v02.1.shx           |
| b4bc3cacacbba2428e706734b8a96b09 | ./2017.09.01/greenland_vel_mosaic_2017_2018_v02.1.xml           |
| 45b436c3ccefeaea2e802c9e2eeecac7 | ./README.org                                                    |


**** 0646
***** List of times, and count of folders at that time

#+NAME: QC_times_NSIDC_0646
#+BEGIN_SRC bash :results table :eval no-export
find ${DATADIR}/MEaSUREs/NSIDC-0646.003/ -type f -name "*vx_v03.0.tif" | rev | cut -d"_" -f3 | rev | LC_ALL=C sort | uniq -c
#+END_SRC

#+RESULTS: QC_times_NSIDC_0646
| 28 | 1985-03 |
| 37 | 1985-04 |
| 42 | 1985-05 |
| 45 | 1985-06 |
| 46 | 1985-07 |
| 50 | 1985-08 |
| 46 | 1985-09 |
| 36 | 1986-04 |
| 40 | 1986-05 |
| 37 | 1986-06 |
| 39 | 1986-07 |
| 44 | 1986-08 |
| 37 | 1986-09 |
|  9 | 1986-10 |
|  4 | 1987-03 |
| 44 | 1987-04 |
| 48 | 1987-05 |
| 45 | 1987-06 |
| 50 | 1987-07 |
| 47 | 1987-08 |
| 43 | 1987-09 |
| 21 | 1987-10 |
|  7 | 1988-03 |
| 43 | 1988-04 |
| 48 | 1988-05 |
| 42 | 1988-06 |
| 43 | 1988-07 |
| 42 | 1988-08 |
| 39 | 1988-09 |
| 16 | 1988-10 |
| 27 | 1989-03 |
| 49 | 1989-04 |
| 44 | 1989-05 |
| 43 | 1989-06 |
| 39 | 1989-07 |
| 42 | 1989-08 |
| 41 | 1989-09 |
|  6 | 1989-10 |
| 32 | 1990-03 |
| 50 | 1990-04 |
| 46 | 1990-05 |
| 45 | 1990-06 |
| 39 | 1990-07 |
| 39 | 1990-08 |
| 34 | 1990-09 |
| 21 | 1990-10 |
|  3 | 1991-06 |
|  2 | 1992-06 |
| 12 | 1992-07 |
| 11 | 1992-08 |
|  5 | 1992-09 |
|  4 | 1992-10 |
|  2 | 1993-03 |
| 12 | 1993-04 |
|  7 | 1993-05 |
|  5 | 1993-06 |
|  2 | 1993-07 |
|  6 | 1993-08 |
|  1 | 1993-09 |
| 42 | 1994-05 |
| 49 | 1994-06 |
| 43 | 1994-07 |
| 47 | 1994-08 |
| 42 | 1994-09 |
|  3 | 1995-04 |
|  1 | 1995-05 |
|  1 | 1995-06 |
| 10 | 1995-07 |
|  2 | 1995-08 |
|  1 | 1995-09 |
|  1 | 1995-10 |
|  6 | 1996-04 |
|  6 | 1996-05 |
| 12 | 1996-06 |
|  9 | 1996-07 |
|  4 | 1996-08 |
|  3 | 1996-09 |
|  1 | 1996-10 |
|  1 | 1997-03 |
|  5 | 1997-04 |
|  3 | 1997-05 |
|  6 | 1997-06 |
|  2 | 1997-07 |
| 11 | 1997-09 |
| 23 | 1997-10 |
| 30 | 1998-03 |
| 55 | 1998-04 |
| 53 | 1998-05 |
| 45 | 1998-06 |
| 46 | 1998-07 |
| 52 | 1998-08 |
| 48 | 1998-09 |
| 16 | 1998-10 |
| 42 | 1999-07 |
| 56 | 1999-08 |
| 57 | 1999-09 |
| 43 | 1999-10 |
|  8 | 1999-11 |
|  2 | 1999-12 |
| 22 | 2000-02 |
| 56 | 2000-03 |
| 55 | 2000-04 |
| 57 | 2000-05 |
| 72 | 2000-06 |
| 62 | 2000-07 |
| 66 | 2000-08 |
| 57 | 2000-09 |
| 28 | 2000-10 |
|  1 | 2000-11 |
| 49 | 2001-03 |
| 65 | 2001-04 |
| 61 | 2001-05 |
| 64 | 2001-06 |
| 65 | 2001-07 |
| 54 | 2001-08 |
| 51 | 2001-09 |
| 44 | 2001-10 |
|  5 | 2001-11 |
|  3 | 2002-01 |
|  5 | 2002-02 |
| 55 | 2002-03 |
| 63 | 2002-04 |
| 57 | 2002-05 |
| 67 | 2002-06 |
| 66 | 2002-07 |
| 56 | 2002-08 |
| 34 | 2002-09 |
| 12 | 2002-10 |
|  6 | 2003-02 |
| 35 | 2003-03 |
| 63 | 2003-04 |
| 63 | 2003-05 |
| 58 | 2003-06 |
| 48 | 2003-07 |
| 53 | 2003-08 |
| 45 | 2003-09 |
|  2 | 2003-10 |
| 27 | 2004-03 |
| 56 | 2004-04 |
| 60 | 2004-05 |
| 72 | 2004-06 |
| 72 | 2004-07 |
| 67 | 2004-08 |
| 57 | 2004-09 |
| 10 | 2004-10 |
| 19 | 2005-03 |
| 60 | 2005-04 |
| 55 | 2005-05 |
| 66 | 2005-06 |
| 63 | 2005-07 |
| 57 | 2005-08 |
| 57 | 2005-09 |
| 21 | 2005-10 |
| 40 | 2006-03 |
| 60 | 2006-04 |
| 57 | 2006-05 |
| 74 | 2006-06 |
| 74 | 2006-07 |
| 67 | 2006-08 |
| 56 | 2006-09 |
| 20 | 2006-10 |
|  2 | 2006-11 |
| 66 | 2007-03 |
| 69 | 2007-04 |
| 68 | 2007-05 |
| 73 | 2007-06 |
| 71 | 2007-07 |
| 67 | 2007-08 |
| 67 | 2007-09 |
| 19 | 2007-10 |
| 15 | 2008-03 |
| 61 | 2008-04 |
| 57 | 2008-05 |
| 69 | 2008-06 |
| 73 | 2008-07 |
| 60 | 2008-08 |
| 51 | 2008-09 |
| 15 | 2008-10 |
|  1 | 2008-11 |
|  2 | 2009-01 |
|  1 | 2009-02 |
| 36 | 2009-03 |
| 52 | 2009-04 |
| 60 | 2009-05 |
| 70 | 2009-06 |
| 73 | 2009-07 |
| 70 | 2009-08 |
| 58 | 2009-09 |
| 12 | 2009-10 |
| 26 | 2010-03 |
| 59 | 2010-04 |
| 63 | 2010-05 |
| 70 | 2010-06 |
| 73 | 2010-07 |
| 66 | 2010-08 |
| 52 | 2010-09 |
| 15 | 2010-10 |
| 32 | 2011-03 |
| 50 | 2011-04 |
| 59 | 2011-05 |
| 68 | 2011-06 |
| 71 | 2011-07 |
| 71 | 2011-08 |
| 56 | 2011-09 |
| 19 | 2011-10 |
|  2 | 2012-01 |
| 19 | 2012-03 |
| 54 | 2012-04 |
| 65 | 2012-05 |
| 74 | 2012-06 |
| 74 | 2012-07 |
| 74 | 2012-08 |
| 59 | 2012-09 |
| 20 | 2012-10 |
|  4 | 2013-02 |
| 63 | 2013-03 |
| 73 | 2013-04 |
| 73 | 2013-05 |
| 74 | 2013-06 |
| 72 | 2013-07 |
| 72 | 2013-08 |
| 73 | 2013-09 |
| 48 | 2013-10 |
| 23 | 2013-11 |
| 11 | 2013-12 |
| 13 | 2014-01 |
| 43 | 2014-02 |
| 66 | 2014-03 |
| 68 | 2014-04 |
| 71 | 2014-05 |
| 74 | 2014-06 |
| 74 | 2014-07 |
| 74 | 2014-08 |
| 74 | 2014-09 |
| 49 | 2014-10 |
| 26 | 2014-11 |
| 14 | 2014-12 |
| 15 | 2015-01 |
| 51 | 2015-02 |
| 72 | 2015-03 |
| 71 | 2015-04 |
| 74 | 2015-05 |
| 74 | 2015-06 |
| 74 | 2015-07 |
| 74 | 2015-08 |
| 74 | 2015-09 |
| 70 | 2015-10 |
| 25 | 2015-11 |
|  9 | 2015-12 |
|  5 | 2016-01 |
| 53 | 2016-02 |
| 73 | 2016-03 |
| 74 | 2016-04 |
| 74 | 2016-05 |
| 74 | 2016-06 |
| 74 | 2016-07 |
| 74 | 2016-08 |
| 72 | 2016-09 |
| 61 | 2016-10 |
| 25 | 2016-11 |
| 12 | 2016-12 |
| 17 | 2017-01 |
| 50 | 2017-02 |
| 70 | 2017-03 |
| 71 | 2017-04 |
| 69 | 2017-05 |
| 69 | 2017-06 |
| 69 | 2017-07 |
| 71 | 2017-08 |
| 69 | 2017-09 |
| 64 | 2017-10 |
| 32 | 2017-11 |
| 11 | 2017-12 |
| 21 | 2018-01 |
| 52 | 2018-02 |
| 69 | 2018-03 |
| 69 | 2018-04 |
| 69 | 2018-05 |
| 63 | 2018-06 |
| 66 | 2018-07 |
| 67 | 2018-08 |
| 65 | 2018-09 |
| 64 | 2018-10 |
| 24 | 2018-11 |
|  6 | 2018-12 |
| 14 | 2019-01 |
| 59 | 2019-02 |
| 69 | 2019-03 |
| 66 | 2019-04 |
| 64 | 2019-05 |
| 69 | 2019-06 |
| 69 | 2019-07 |
| 69 | 2019-08 |
| 69 | 2019-09 |
| 65 | 2019-10 |
| 36 | 2019-11 |
|  4 | 2019-12 |

**** 0731
***** File List
Subset to vx

#+BEGIN_SRC bash :results verbatim :eval no-export
(cd ${DATADIR}/MEaSUREs/NSIDC-0731.001; find -name "*vx*.tif"| LC_ALL=C sort)
#+END_SRC

#+RESULTS:
#+begin_example
./greenland_vel_mosaic_2014-12-01_2014-12-31_v01/greenland_vel_mosaic_2014-12-01_2014-12-31_vx_v01.1.tif
./greenland_vel_mosaic_2015-01-01_2015-01-31_v01/greenland_vel_mosaic_2015-01-01_2015-01-31_vx_v01.1.tif
./greenland_vel_mosaic_2015-02-01_2015-02-28_v01/greenland_vel_mosaic_2015-02-01_2015-02-28_vx_v01.1.tif
./greenland_vel_mosaic_2015-03-01_2015-03-31_v01/greenland_vel_mosaic_2015-03-01_2015-03-31_vx_v01.1.tif
./greenland_vel_mosaic_2015-04-01_2015-04-30_v01/greenland_vel_mosaic_2015-04-01_2015-04-30_vx_v01.1.tif
./greenland_vel_mosaic_2015-05-01_2015-05-31_v01/greenland_vel_mosaic_2015-05-01_2015-05-31_vx_v01.1.tif
./greenland_vel_mosaic_2015-06-01_2015-06-30_v01/greenland_vel_mosaic_2015-06-01_2015-06-30_vx_v01.1.tif
./greenland_vel_mosaic_2015-07-01_2015-07-31_v01/greenland_vel_mosaic_2015-07-01_2015-07-31_vx_v01.1.tif
./greenland_vel_mosaic_2015-08-01_2015-08-31_v01/greenland_vel_mosaic_2015-08-01_2015-08-31_vx_v01.1.tif
./greenland_vel_mosaic_2015-09-01_2015-09-30_v01/greenland_vel_mosaic_2015-09-01_2015-09-30_vx_v01.1.tif
./greenland_vel_mosaic_2015-10-01_2015-10-31_v01/greenland_vel_mosaic_2015-10-01_2015-10-31_vx_v01.1.tif
./greenland_vel_mosaic_2015-11-01_2015-11-30_v01/greenland_vel_mosaic_2015-11-01_2015-11-30_vx_v01.1.tif
./greenland_vel_mosaic_2015-12-01_2015-12-31_v01/greenland_vel_mosaic_2015-12-01_2015-12-31_vx_v01.1.tif
./greenland_vel_mosaic_2016-01-01_2016-01-31_v01/greenland_vel_mosaic_2016-01-01_2016-01-31_vx_v01.1.tif
./greenland_vel_mosaic_2016-02-01_2016-02-29_v01/greenland_vel_mosaic_2016-02-01_2016-02-29_vx_v01.1.tif
./greenland_vel_mosaic_2016-03-01_2016-03-31_v01/greenland_vel_mosaic_2016-03-01_2016-03-31_vx_v01.1.tif
./greenland_vel_mosaic_2016-04-01_2016-04-30_v01/greenland_vel_mosaic_2016-04-01_2016-04-30_vx_v01.1.tif
./greenland_vel_mosaic_2016-05-01_2016-05-31_v01/greenland_vel_mosaic_2016-05-01_2016-05-31_vx_v01.1.tif
./greenland_vel_mosaic_2016-06-01_2016-06-30_v01/greenland_vel_mosaic_2016-06-01_2016-06-30_vx_v01.1.tif
./greenland_vel_mosaic_2016-07-01_2016-07-31_v01/greenland_vel_mosaic_2016-07-01_2016-07-31_vx_v01.1.tif
./greenland_vel_mosaic_2016-08-01_2016-08-31_v01/greenland_vel_mosaic_2016-08-01_2016-08-31_vx_v01.1.tif
./greenland_vel_mosaic_2016-09-01_2016-09-30_v01/greenland_vel_mosaic_2016-09-01_2016-09-30_vx_v01.1.tif
./greenland_vel_mosaic_2016-10-01_2016-10-31_v01/greenland_vel_mosaic_2016-10-01_2016-10-31_vx_v01.1.tif
./greenland_vel_mosaic_2016-11-01_2016-11-30_v01/greenland_vel_mosaic_2016-11-01_2016-11-30_vx_v01.1.tif
./greenland_vel_mosaic_2016-12-01_2016-12-31_v01/greenland_vel_mosaic_2016-12-01_2016-12-31_vx_v01.1.tif
./greenland_vel_mosaic_2017-01-01_2017-01-31_v01/greenland_vel_mosaic_2017-01-01_2017-01-31_vx_v01.1.tif
./greenland_vel_mosaic_2017-02-01_2017-02-28_v01/greenland_vel_mosaic_2017-02-01_2017-02-28_vx_v01.1.tif
./greenland_vel_mosaic_2017-03-01_2017-03-31_v01/greenland_vel_mosaic_2017-03-01_2017-03-31_vx_v01.1.tif
./greenland_vel_mosaic_2017-04-01_2017-04-30_v01/greenland_vel_mosaic_2017-04-01_2017-04-30_vx_v01.1.tif
./greenland_vel_mosaic_2017-05-01_2017-05-31_v01/greenland_vel_mosaic_2017-05-01_2017-05-31_vx_v01.1.tif
./greenland_vel_mosaic_2017-06-01_2017-06-30_v01/greenland_vel_mosaic_2017-06-01_2017-06-30_vx_v01.1.tif
./greenland_vel_mosaic_2017-07-01_2017-07-31_v01/greenland_vel_mosaic_2017-07-01_2017-07-31_vx_v01.1.tif
./greenland_vel_mosaic_2017-08-01_2017-08-31_v01/greenland_vel_mosaic_2017-08-01_2017-08-31_vx_v01.1.tif
./greenland_vel_mosaic_2017-09-01_2017-09-30_v01/greenland_vel_mosaic_2017-09-01_2017-09-30_vx_v01.1.tif
./greenland_vel_mosaic_2017-10-01_2017-10-31_v01/greenland_vel_mosaic_2017-10-01_2017-10-31_vx_v01.1.tif
./greenland_vel_mosaic_2017-11-01_2017-11-30_v01/greenland_vel_mosaic_2017-11-01_2017-11-30_vx_v01.1.tif
./greenland_vel_mosaic_2017-12-01_2017-12-31_v01/greenland_vel_mosaic_2017-12-01_2017-12-31_vx_v01.1.tif
./greenland_vel_mosaic_2018-01-01_2018-01-31_v01/greenland_vel_mosaic_2018-01-01_2018-01-31_vx_v01.1.tif
./greenland_vel_mosaic_2018-02-01_2018-02-28_v01/greenland_vel_mosaic_2018-02-01_2018-02-28_vx_v01.1.tif
./greenland_vel_mosaic_2018-03-01_2018-03-31_v01/greenland_vel_mosaic_2018-03-01_2018-03-31_vx_v01.1.tif
./greenland_vel_mosaic_2018-04-01_2018-04-30_v01/greenland_vel_mosaic_2018-04-01_2018-04-30_vx_v01.1.tif
./greenland_vel_mosaic_2018-05-01_2018-05-31_v01/greenland_vel_mosaic_2018-05-01_2018-05-31_vx_v01.1.tif
./greenland_vel_mosaic_2018-06-01_2018-06-30_v01/greenland_vel_mosaic_2018-06-01_2018-06-30_vx_v01.1.tif
./greenland_vel_mosaic_2018-07-01_2018-07-31_v01/greenland_vel_mosaic_2018-07-01_2018-07-31_vx_v01.1.tif
./greenland_vel_mosaic_2018-08-01_2018-08-31_v01/greenland_vel_mosaic_2018-08-01_2018-08-31_vx_v01.1.tif
./greenland_vel_mosaic_2018-09-01_2018-09-30_v01/greenland_vel_mosaic_2018-09-01_2018-09-30_vx_v01.1.tif
./greenland_vel_mosaic_2018-10-01_2018-10-31_v01/greenland_vel_mosaic_2018-10-01_2018-10-31_vx_v01.1.tif
./greenland_vel_mosaic_2018-11-01_2018-11-30_v01/greenland_vel_mosaic_2018-11-01_2018-11-30_vx_v01.1.tif
#+end_example

***** File Metadata

#+NAME: QC_gdalinfo_NSIDC_0731
#+BEGIN_SRC bash :results verbatim :eval no-export
somefile=$(find ${DATADIR}/MEaSUREs/NSIDC-0731.001 -name "*vx*.tif" | LC_ALL=C sort | head -n1)
md5sum ${somefile}
echo ""
gdalinfo -mm ${somefile}
#+END_SRC

#+RESULTS: QC_gdalinfo_NSIDC_0731
#+begin_example
02a6415f4fed38bf8e5ae585eb4a2796  /home/kdm/data/MEaSUREs/NSIDC-0731.001/greenland_vel_mosaic_2014-12-01_2014-12-31_v01/greenland_vel_mosaic_2014-12-01_2014-12-31_vx_v01.1.tif

Driver: GTiff/GeoTIFF
Files: /home/kdm/data/MEaSUREs/NSIDC-0731.001/greenland_vel_mosaic_2014-12-01_2014-12-31_v01/greenland_vel_mosaic_2014-12-01_2014-12-31_vx_v01.1.tif
Size is 7585, 13700
Coordinate System is:
PROJCRS["WGS84/NSIDCSeaIcePolarStereographicNorth",
    BASEGEOGCRS["WGS 84",
        DATUM["World Geodetic System 1984",
            ELLIPSOID["WGS 84",6378137,298.257223563,
                LENGTHUNIT["metre",1]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433]],
        ID["EPSG",4326]],
    CONVERSION["Polar Stereographic (variant B)",
        METHOD["Polar Stereographic (variant B)",
            ID["EPSG",9829]],
        PARAMETER["Latitude of standard parallel",70,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8832]],
        PARAMETER["Longitude of origin",-45,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8833]],
        PARAMETER["False easting",0,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",0,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["(E)",south,
            MERIDIAN[90,
                ANGLEUNIT["degree",0.0174532925199433,
                    ID["EPSG",9122]]],
            ORDER[1],
            LENGTHUNIT["metre",1]],
        AXIS["(N)",south,
            MERIDIAN[180,
                ANGLEUNIT["degree",0.0174532925199433,
                    ID["EPSG",9122]]],
            ORDER[2],
            LENGTHUNIT["metre",1]]]
Data axis to CRS axis mapping: 1,2
Origin = (-659100.000000000000000,-639100.000000000000000)
Pixel Size = (200.000000000000000,-200.000000000000000)
Metadata:
  AREA_OR_POINT=Area
Image Structure Metadata:
  COMPRESSION=LZW
  INTERLEAVE=BAND
Corner Coordinates:
Upper Left  ( -659100.000, -639100.000) ( 90d52'57.45"W, 81d32'23.19"N)
Lower Left  ( -659100.000,-3379100.000) ( 56d 2'13.47"W, 58d58'10.19"N)
Upper Right (  857900.000, -639100.000) (  8d18'55.49"E, 80d 8'52.35"N)
Lower Right (  857900.000,-3379100.000) ( 30d45'16.18"W, 58d35'44.75"N)
Center      (   99400.000,-2009100.000) ( 42d10' 3.39"W, 71d35' 4.30"N)
Band 1 Block=256x256 Type=Float32, ColorInterp=Gray
    Computed Min/Max=-22201.459,8229.834
  NoData Value=-2000000000
#+end_example

***** md5sum hashes of all data

#+NAME: QC_md5sum_NSIDC_0731
#+BEGIN_SRC bash :results table :eval no-export
cd ${DATADIR}/MEaSUREs/NSIDC-0731.001
# awk 'NR % 5 == 0' input > output # print every 5th line
# head -n2 # top two files
find . -type f -name "*vx*.tif" | LC_ALL=C sort | tail -n16| parallel --keep-order "md5sum {}"
#+END_SRC

#+RESULTS: QC_md5sum_NSIDC_0731
| 81da7a23eb7c837292b500b5b7379ed5 | ./greenland_vel_mosaic_2017-08-01_2017-08-31_v01/greenland_vel_mosaic_2017-08-01_2017-08-31_vx_v01.1.tif |
| 06b706180b5eb840df9837cd419f5e70 | ./greenland_vel_mosaic_2017-09-01_2017-09-30_v01/greenland_vel_mosaic_2017-09-01_2017-09-30_vx_v01.1.tif |
| d28772162a33c7c8e25b3d697e2a8235 | ./greenland_vel_mosaic_2017-10-01_2017-10-31_v01/greenland_vel_mosaic_2017-10-01_2017-10-31_vx_v01.1.tif |
| bbe74d73b60c867139a7c37f1d9a25c4 | ./greenland_vel_mosaic_2017-11-01_2017-11-30_v01/greenland_vel_mosaic_2017-11-01_2017-11-30_vx_v01.1.tif |
| f908de1e0ae70a45321149f65b481482 | ./greenland_vel_mosaic_2017-12-01_2017-12-31_v01/greenland_vel_mosaic_2017-12-01_2017-12-31_vx_v01.1.tif |
| 859c4aef099ef2b7f32d2cad560efb4f | ./greenland_vel_mosaic_2018-01-01_2018-01-31_v01/greenland_vel_mosaic_2018-01-01_2018-01-31_vx_v01.1.tif |
| 63f52f28ad324b0dd531f3f885d19804 | ./greenland_vel_mosaic_2018-02-01_2018-02-28_v01/greenland_vel_mosaic_2018-02-01_2018-02-28_vx_v01.1.tif |
| ba146f97be7656efbc20c5c7e861128b | ./greenland_vel_mosaic_2018-03-01_2018-03-31_v01/greenland_vel_mosaic_2018-03-01_2018-03-31_vx_v01.1.tif |
| f22da3bbb7a3ec0c8c044747ec5776a1 | ./greenland_vel_mosaic_2018-04-01_2018-04-30_v01/greenland_vel_mosaic_2018-04-01_2018-04-30_vx_v01.1.tif |
| 5784f8b5f02b233e3f8c09171763d560 | ./greenland_vel_mosaic_2018-05-01_2018-05-31_v01/greenland_vel_mosaic_2018-05-01_2018-05-31_vx_v01.1.tif |
| c9f9c67d001859228d8665a70f847313 | ./greenland_vel_mosaic_2018-06-01_2018-06-30_v01/greenland_vel_mosaic_2018-06-01_2018-06-30_vx_v01.1.tif |
| debe629561dd7ce29587c25bb6ab8b5d | ./greenland_vel_mosaic_2018-07-01_2018-07-31_v01/greenland_vel_mosaic_2018-07-01_2018-07-31_vx_v01.1.tif |
| c5ae0b3e3a2ad0e07e8d74f91f08b1e7 | ./greenland_vel_mosaic_2018-08-01_2018-08-31_v01/greenland_vel_mosaic_2018-08-01_2018-08-31_vx_v01.1.tif |
| 13e416c623b801238905c11f0c01cf82 | ./greenland_vel_mosaic_2018-09-01_2018-09-30_v01/greenland_vel_mosaic_2018-09-01_2018-09-30_vx_v01.1.tif |
| cb753e82570b353a1af4f3b60699284e | ./greenland_vel_mosaic_2018-10-01_2018-10-31_v01/greenland_vel_mosaic_2018-10-01_2018-10-31_vx_v01.1.tif |
| 7d4ae0393311cf0c980397cff08a54be | ./greenland_vel_mosaic_2018-11-01_2018-11-30_v01/greenland_vel_mosaic_2018-11-01_2018-11-30_vx_v01.1.tif |

*** Sentinel 1
***** File List

#+BEGIN_SRC bash :results verbatim :eval no-export
(cd ${DATADIR}/Sentinel1; find . -name "*.nc" | LC_ALL=C sort)
#+END_SRC

#+RESULTS:
#+begin_example
./Sentinel1_IV_maps/IV_20160914_20161006.nc
./Sentinel1_IV_maps/IV_20160925_20161018.nc
./Sentinel1_IV_maps/IV_20161006_20161030.nc
./Sentinel1_IV_maps/IV_20161018_20161111.nc
./Sentinel1_IV_maps/IV_20161030_20161123.nc
./Sentinel1_IV_maps/IV_20161111_20161205.nc
./Sentinel1_IV_maps/IV_20161123_20161217.nc
./Sentinel1_IV_maps/IV_20161205_20161229.nc
./Sentinel1_IV_maps/IV_20161217_20170110.nc
./Sentinel1_IV_maps/IV_20161229_20170111.nc
./Sentinel1_IV_maps/IV_20170110_20170203.nc
./Sentinel1_IV_maps/IV_20170112_20170215.nc
./Sentinel1_IV_maps/IV_20170122_20170227.nc
./Sentinel1_IV_maps/IV_20170215_20170311.nc
./Sentinel1_IV_maps/IV_20170227_20170323.nc
./Sentinel1_IV_maps/IV_20170311_20170404.nc
./Sentinel1_IV_maps/IV_20170510_20170603.nc
./Sentinel1_IV_maps/IV_20170522_20170615.nc
./Sentinel1_IV_maps/IV_20170603_20170627.nc
./Sentinel1_IV_maps/IV_20170615_20170709.nc
./Sentinel1_IV_maps/IV_20170627_20170721.nc
./Sentinel1_IV_maps/IV_20171106_20171130.nc
./Sentinel1_IV_maps/IV_20171118_20171212.nc
./Sentinel1_IV_maps/IV_20171130_20171224.nc
./Sentinel1_IV_maps/IV_20171212_20180105.nc
./Sentinel1_IV_maps/IV_20171224_20180117.nc
./Sentinel1_IV_maps/IV_20180105_20180129.nc
./Sentinel1_IV_maps/IV_20180117_20180210.nc
./Sentinel1_IV_maps/IV_20180129_20180222.nc
./Sentinel1_IV_maps/IV_20180210_20180306.nc
./Sentinel1_IV_maps/IV_20180222_20180318.nc
./Sentinel1_IV_maps/IV_20180306_20180330.nc
./Sentinel1_IV_maps/IV_20180318_20180411.nc
./Sentinel1_IV_maps/IV_20180330_20180423.nc
./Sentinel1_IV_maps/IV_20180411_20180505.nc
./Sentinel1_IV_maps/IV_20180423_20180517.nc
./Sentinel1_IV_maps/IV_20180505_20180529.nc
./Sentinel1_IV_maps/IV_20180517_20180610.nc
./Sentinel1_IV_maps/IV_20180529_20180622.nc
./Sentinel1_IV_maps/IV_20180610_20180704.nc
./Sentinel1_IV_maps/IV_20180622_20180716.nc
./Sentinel1_IV_maps/IV_20180704_20180728.nc
./Sentinel1_IV_maps/IV_20180716_20180809.nc
./Sentinel1_IV_maps/IV_20180728_20180821.nc
./Sentinel1_IV_maps/IV_20180809_20180902.nc
./Sentinel1_IV_maps/IV_20180821_20180914.nc
./Sentinel1_IV_maps/IV_20180902_20180926.nc
./Sentinel1_IV_maps/IV_20180914_20181008.nc
./Sentinel1_IV_maps/IV_20180926_20181020.nc
./Sentinel1_IV_maps/IV_20181008_20181101.nc
./Sentinel1_IV_maps/IV_20181020_20181113.nc
./Sentinel1_IV_maps/IV_20181101_20181125.nc
./Sentinel1_IV_maps/IV_20181113_20181207.nc
./Sentinel1_IV_maps/IV_20181126_20181219.nc
./Sentinel1_IV_maps/IV_20181207_20181231.nc
./Sentinel1_IV_maps/IV_20181219_20190112.nc
./Sentinel1_IV_maps/IV_20181231_20190124.nc
./Sentinel1_IV_maps/IV_20190112_20190205.nc
./Sentinel1_IV_maps/IV_20190124_20190217.nc
./Sentinel1_IV_maps/IV_20190205_20190301.nc
./Sentinel1_IV_maps/IV_20190217_20190313.nc
./Sentinel1_IV_maps/IV_20190301_20190325.nc
./Sentinel1_IV_maps/IV_20190313_20190406.nc
./Sentinel1_IV_maps/IV_20190325_20190417.nc
./Sentinel1_IV_maps/IV_20190406_20190430.nc
./Sentinel1_IV_maps/IV_20190418_20190512.nc
./Sentinel1_IV_maps/IV_20190430_20190524.nc
./Sentinel1_IV_maps/IV_20190512_20190605.nc
./Sentinel1_IV_maps/IV_20190524_20190617.nc
./Sentinel1_IV_maps/IV_20190605_20190629.nc
./Sentinel1_IV_maps/IV_20190617_20190711.nc
./Sentinel1_IV_maps/IV_20190629_20190723.nc
./Sentinel1_IV_maps/IV_20190711_20190804.nc
./Sentinel1_IV_maps/IV_20190723_20190816.nc
./Sentinel1_IV_maps/IV_20190804_20190828.nc
./Sentinel1_IV_maps/IV_20190816_20190909.nc
./Sentinel1_IV_maps/IV_20190828_20190921.nc
./Sentinel1_IV_maps/IV_20190909_20191003.nc
./Sentinel1_IV_maps/IV_20190921_20191015.nc
./Sentinel1_IV_maps/IV_20191003_20191027.nc
./Sentinel1_IV_maps/IV_20191015_20191108.nc
./Sentinel1_IV_maps/IV_20191027_20191120.nc
./Sentinel1_IV_maps/IV_20191108_20191202.nc
./Sentinel1_IV_maps/IV_20191120_20191214.nc
./Sentinel1_IV_maps/IV_20191202_20191226.nc
./Sentinel1_IV_maps/IV_20191214_20200107.nc
./Sentinel1_IV_maps/IV_20191226_20200119.nc
./Sentinel1_IV_maps/IV_20200107_20200131.nc
./Sentinel1_IV_maps/IV_20200119_20200212.nc
./Sentinel1_IV_maps/IV_20200131_20200224.nc
./Sentinel1_IV_maps/IV_20200212_20200307.nc
./Sentinel1_IV_maps/IV_20200224_20200319.nc
./Sentinel1_IV_maps/IV_20200307_20200331.nc
./Sentinel1_IV_maps/IV_20200319_20200412.nc
./Sentinel1_IV_maps/IV_20200331_20200424.nc
./Sentinel1_IV_maps/IV_20200412_20200506.nc
./Sentinel1_IV_maps/IV_20200424_20200518.nc
./Sentinel1_IV_maps/IV_20200506_20200530.nc
./Sentinel1_IV_maps/IV_20200518_20200611.nc
./Sentinel1_IV_maps/IV_20200530_20200623.nc
./Sentinel1_IV_maps/IV_20200611_20200705.nc
./Sentinel1_IV_maps/IV_20200623_20200717.nc
./Sentinel1_IV_maps/IV_20200705_20200729.nc
./Sentinel1_IV_maps/IV_20200717_20200810.nc
./Sentinel1_IV_maps/IV_20200729_20200822.nc
./Sentinel1_IV_maps/IV_20200810_20200903.nc
./Sentinel1_IV_maps/IV_20200822_20200915.nc
./Sentinel1_IV_maps/IV_20200903_20200927.nc
./Sentinel1_IV_maps/IV_20200915_20201009.nc
./Sentinel1_IV_maps/IV_20200927_20201021.nc
./Sentinel1_IV_maps/IV_20201009_20201102.nc
./Sentinel1_IV_maps/IV_20201021_20201114.nc
./Sentinel1_IV_maps/IV_20201102_20201126.nc
./Sentinel1_IV_maps/IV_20201114_20201208.nc
./Sentinel1_IV_maps/IV_20201126_20201220.nc
./Sentinel1_IV_maps/IV_20201208_20210101.nc
./Sentinel1_IV_maps/IV_20201220_20210113.nc
./Sentinel1_IV_maps/IV_20210101_20210125.nc
./Sentinel1_IV_maps/IV_20210113_20210206.nc
./Sentinel1_IV_maps/IV_20210125_20210218.nc
./Sentinel1_IV_maps/IV_20210206_20210302.nc
./Sentinel1_IV_maps/IV_20210218_20210314.nc
./Sentinel1_IV_maps/IV_20210302_20210326.nc
./Sentinel1_IV_maps/IV_20210314_20210407.nc
#+end_example

***** File Metadata

#+NAME: QC_ncdump_Sentinel1
#+BEGIN_SRC bash :results verbatim :eval no-export
somefile=$(find ${DATADIR}/Sentinel1 -name "*.nc" | LC_ALL=C sort | head -n1)
# md5sum ${somefile}
echo ""
ncdump -chs ${somefile}
#+END_SRC

#+RESULTS: QC_ncdump_Sentinel1
#+begin_example

netcdf IV_20160914_20161006 {
dimensions:
	y = 5400 ;
	x = 3000 ;
	time = UNLIMITED ; // (1 currently)
	bnds = 2 ;
variables:
	char crs ;
		crs:grid_mapping_name = "polar_stereographic" ;
		crs:standard_parallel = 70. ;
		crs:longitude_of_prime_meridian = 0. ;
		crs:straight_vertical_longitude_from_pole = -45. ;
		crs:semi_major_axis = 6378137. ;
		crs:inverse_flattening = 298.257223563 ;
		crs:latitude_of_projection_origin = 90. ;
		crs:false_easting = 0. ;
		crs:false_northing = 0. ;
		crs:_Storage = "contiguous" ;
	double y(y) ;
		y:units = "m" ;
		y:axis = "Y" ;
		y:long_name = "y coordinate of projection" ;
		y:standard_name = "projection_y_coordinate" ;
		y:_Storage = "contiguous" ;
		y:_Endianness = "little" ;
	double x(x) ;
		x:units = "m" ;
		x:axis = "X" ;
		x:long_name = "x coordinate of projection" ;
		x:standard_name = "projection_x_coordinate" ;
		x:_Storage = "contiguous" ;
		x:_Endianness = "little" ;
	double time(time) ;
		time:standard_name = "time" ;
		time:long_name = "Midpoint time of acquisitons used" ;
		time:bounds = "time_bnds" ;
		time:units = "days since 1990-1-1 0:0:0" ;
		time:calendar = "standard" ;
		time:_Storage = "chunked" ;
		time:_ChunkSizes = 512 ;
		time:_Endianness = "little" ;
	double time_bnds(time, bnds) ;
		time_bnds:units = "days since 1990-1-1 0:0:0" ;
		time_bnds:_Storage = "chunked" ;
		time_bnds:_ChunkSizes = 1, 2 ;
		time_bnds:_Endianness = "little" ;
	float land_ice_surface_easting_velocity(time, y, x) ;
		land_ice_surface_easting_velocity:_FillValue = 1.e+20f ;
		land_ice_surface_easting_velocity:units = "m/day" ;
		land_ice_surface_easting_velocity:description = "easting ice velocity" ;
		land_ice_surface_easting_velocity:grid_mapping = "crs" ;
		land_ice_surface_easting_velocity:coordinates = "time y x" ;
		land_ice_surface_easting_velocity:cell_methods = "time: mean (weighted average (based on error estimates) over contributing acquisitons)" ;
		land_ice_surface_easting_velocity:missing_value = 1.e+20f ;
		land_ice_surface_easting_velocity:standard_name = "land_ice_surface_x_velocity" ;
		land_ice_surface_easting_velocity:long_name = "easting ice velocity" ;
		land_ice_surface_easting_velocity:_Storage = "chunked" ;
		land_ice_surface_easting_velocity:_ChunkSizes = 1, 1350, 750 ;
		land_ice_surface_easting_velocity:_DeflateLevel = 4 ;
		land_ice_surface_easting_velocity:_Shuffle = "true" ;
		land_ice_surface_easting_velocity:_Endianness = "little" ;
	float land_ice_surface_northing_velocity(time, y, x) ;
		land_ice_surface_northing_velocity:_FillValue = 1.e+20f ;
		land_ice_surface_northing_velocity:units = "m/day" ;
		land_ice_surface_northing_velocity:description = "northing ice velocity" ;
		land_ice_surface_northing_velocity:grid_mapping = "crs" ;
		land_ice_surface_northing_velocity:coordinates = "time y x" ;
		land_ice_surface_northing_velocity:cell_methods = "time: mean (weighted average (based on error estimates) over contributing acquisitons)" ;
		land_ice_surface_northing_velocity:missing_value = 1.e+20f ;
		land_ice_surface_northing_velocity:standard_name = "land_ice_surface_y_velocity" ;
		land_ice_surface_northing_velocity:long_name = "northing ice velocity" ;
		land_ice_surface_northing_velocity:_Storage = "chunked" ;
		land_ice_surface_northing_velocity:_ChunkSizes = 1, 1350, 750 ;
		land_ice_surface_northing_velocity:_DeflateLevel = 4 ;
		land_ice_surface_northing_velocity:_Shuffle = "true" ;
		land_ice_surface_northing_velocity:_Endianness = "little" ;
	float land_ice_surface_vertical_velocity(time, y, x) ;
		land_ice_surface_vertical_velocity:_FillValue = 1.e+20f ;
		land_ice_surface_vertical_velocity:units = "m/day" ;
		land_ice_surface_vertical_velocity:grid_mapping = "crs" ;
		land_ice_surface_vertical_velocity:coordinates = "time y x" ;
		land_ice_surface_vertical_velocity:cell_methods = "time: mean (weighted average (based on error estimates) over contributing acquisitons)" ;
		land_ice_surface_vertical_velocity:missing_value = 1.e+20f ;
		land_ice_surface_vertical_velocity:description = "vertical velocity derived assuming surface parallel flow" ;
		land_ice_surface_vertical_velocity:long_name = "vertical velocity derived assuming surface parallel flow" ;
		land_ice_surface_vertical_velocity:_Storage = "chunked" ;
		land_ice_surface_vertical_velocity:_ChunkSizes = 1, 1350, 750 ;
		land_ice_surface_vertical_velocity:_DeflateLevel = 4 ;
		land_ice_surface_vertical_velocity:_Shuffle = "true" ;
		land_ice_surface_vertical_velocity:_Endianness = "little" ;
	float land_ice_surface_velocity_magnitude(time, y, x) ;
		land_ice_surface_velocity_magnitude:_FillValue = 1.e+20f ;
		land_ice_surface_velocity_magnitude:units = "m/day" ;
		land_ice_surface_velocity_magnitude:description = "magnitude of horizontal ice velocity" ;
		land_ice_surface_velocity_magnitude:grid_mapping = "crs" ;
		land_ice_surface_velocity_magnitude:coordinates = "time y x" ;
		land_ice_surface_velocity_magnitude:cell_methods = "time: mean (weighted average (based on error estimates) over contributing acquisitons)" ;
		land_ice_surface_velocity_magnitude:missing_value = 1.e+20f ;
		land_ice_surface_velocity_magnitude:long_name = "magnitude of horizontal ice velocity" ;
		land_ice_surface_velocity_magnitude:_Storage = "chunked" ;
		land_ice_surface_velocity_magnitude:_ChunkSizes = 1, 1350, 750 ;
		land_ice_surface_velocity_magnitude:_DeflateLevel = 4 ;
		land_ice_surface_velocity_magnitude:_Shuffle = "true" ;
		land_ice_surface_velocity_magnitude:_Endianness = "little" ;
	float land_ice_surface_easting_velocity_std(time, y, x) ;
		land_ice_surface_easting_velocity_std:_FillValue = 1.e+20f ;
		land_ice_surface_easting_velocity_std:units = "m/day" ;
		land_ice_surface_easting_velocity_std:description = "easting ice velocity error estimate " ;
		land_ice_surface_easting_velocity_std:grid_mapping = "crs" ;
		land_ice_surface_easting_velocity_std:coordinates = "time y x" ;
		land_ice_surface_easting_velocity_std:cell_methods = "time: mean (weighted average (based on error estimates) over contributing acquisitons)" ;
		land_ice_surface_easting_velocity_std:missing_value = 1.e+20f ;
		land_ice_surface_easting_velocity_std:standard_name = "land_ice_surface_x_velocity standard_error" ;
		land_ice_surface_easting_velocity_std:long_name = "easting ice velocity error estimate " ;
		land_ice_surface_easting_velocity_std:_Storage = "chunked" ;
		land_ice_surface_easting_velocity_std:_ChunkSizes = 1, 1350, 750 ;
		land_ice_surface_easting_velocity_std:_DeflateLevel = 4 ;
		land_ice_surface_easting_velocity_std:_Shuffle = "true" ;
		land_ice_surface_easting_velocity_std:_Endianness = "little" ;
	float land_ice_surface_northing_velocity_std(time, y, x) ;
		land_ice_surface_northing_velocity_std:_FillValue = 1.e+20f ;
		land_ice_surface_northing_velocity_std:units = "m/day" ;
		land_ice_surface_northing_velocity_std:description = "northing ice velocity error estimate" ;
		land_ice_surface_northing_velocity_std:grid_mapping = "crs" ;
		land_ice_surface_northing_velocity_std:coordinates = "time y x" ;
		land_ice_surface_northing_velocity_std:cell_methods = "time: mean (weighted average (based on error estimates) over contributing acquisitons)" ;
		land_ice_surface_northing_velocity_std:missing_value = 1.e+20f ;
		land_ice_surface_northing_velocity_std:standard_name = "land_ice_surface_y_velocity standard_error" ;
		land_ice_surface_northing_velocity_std:long_name = "northing ice velocity error estimate" ;
		land_ice_surface_northing_velocity_std:_Storage = "chunked" ;
		land_ice_surface_northing_velocity_std:_ChunkSizes = 1, 1350, 750 ;
		land_ice_surface_northing_velocity_std:_DeflateLevel = 4 ;
		land_ice_surface_northing_velocity_std:_Shuffle = "true" ;
		land_ice_surface_northing_velocity_std:_Endianness = "little" ;
	float land_ice_surface_velocity_magnitude_std(time, y, x) ;
		land_ice_surface_velocity_magnitude_std:_FillValue = 1.e+20f ;
		land_ice_surface_velocity_magnitude_std:units = "m/day" ;
		land_ice_surface_velocity_magnitude_std:description = "horizontal ice velocity error magnitude estimate" ;
		land_ice_surface_velocity_magnitude_std:grid_mapping = "crs" ;
		land_ice_surface_velocity_magnitude_std:coordinates = "time y x" ;
		land_ice_surface_velocity_magnitude_std:cell_methods = "time: mean (weighted average (based on error estimates) over contributing acquisitons)" ;
		land_ice_surface_velocity_magnitude_std:missing_value = 1.e+20f ;
		land_ice_surface_velocity_magnitude_std:long_name = "horizontal ice velocity error magnitude estimate" ;
		land_ice_surface_velocity_magnitude_std:_Storage = "chunked" ;
		land_ice_surface_velocity_magnitude_std:_ChunkSizes = 1, 1350, 750 ;
		land_ice_surface_velocity_magnitude_std:_DeflateLevel = 4 ;
		land_ice_surface_velocity_magnitude_std:_Shuffle = "true" ;
		land_ice_surface_velocity_magnitude_std:_Endianness = "little" ;

// global attributes:
		:date_created = "2021-02-09" ;
		:project = "PROMICE" ;
		:tracking_id = "f834013c-afe4-4f61-b3c8-158cb3d8c4e6" ;
		:time_coverage_start = "2016-09-14" ;
		:time_coverage_end = "2016-10-06" ;
		:sensors_used = "Sentinel-1A" ;
		:velocity_projection_method = "Surface Parallel Flow" ;
		:Conventions = "CF-1.5" ;
		:product_version = "1.0" ;
		:title = "Greenland Ice Velocity from 2016-09-14 to 2016-10-06" ;
		:institution = "GEUS and DTU" ;
		:summary = "Greenland Ice Velocity from Sentinel-1 offset tracking for the period 2016-09-14 to 2016-10-06" ;
		:methods_used = "Offset-tracking" ;
		:calibration_method = "None" ;
		:_NCProperties = "version=1|netcdflibversion=4.6.0|hdf5libversion=1.10.0" ;
		:_SuperblockVersion = 0 ;
		:_IsNetcdf4 = 1 ;
		:_Format = "netCDF-4" ;
}
#+end_example


***** md5sum Hashes

#+NAME: QC_md5sum_Sentinel1
#+BEGIN_SRC bash :results table :eval no-export
cd ${DATADIR}/Sentinel1
# awk 'NR % 5 == 0' input > output # print every 5th line
# head -n2 # top two files
find . -type f -name "*.nc" | LC_ALL=C sort | tail -n16 | parallel --keep-order "md5sum {}"
#+END_SRC

#+RESULTS: QC_md5sum_Sentinel1
| 6dbae343dac280d64c708999d14306fe | ./Sentinel1_IV_maps/IV_20200915_20201009.nc |
| 71aa187d1da4377c2240b0dc49ae51da | ./Sentinel1_IV_maps/IV_20200927_20201021.nc |
| 09501412e77f70bcad7ba3e1ba731340 | ./Sentinel1_IV_maps/IV_20201009_20201102.nc |
| c384dcc0d5eee78e9df8f5608b2dcdbd | ./Sentinel1_IV_maps/IV_20201021_20201114.nc |
| eb23c73303fdb849e7eeef07d86addc8 | ./Sentinel1_IV_maps/IV_20201102_20201126.nc |
| f4d5db5631e637518f9b1cd8ae908223 | ./Sentinel1_IV_maps/IV_20201114_20201208.nc |
| 5633069121b5935bb4b307f27a5a0f1a | ./Sentinel1_IV_maps/IV_20201126_20201220.nc |
| 5bf0fbc0b4426df81a12bf0b62cb08ac | ./Sentinel1_IV_maps/IV_20201208_20210101.nc |
| d84335b9fe7f35a4c59db8dfcce3c315 | ./Sentinel1_IV_maps/IV_20201220_20210113.nc |
| be63dd5799bebe9e9e85db7a2a9c4670 | ./Sentinel1_IV_maps/IV_20210101_20210125.nc |
| 4102719c00491e6c0876084255848c91 | ./Sentinel1_IV_maps/IV_20210113_20210206.nc |
| 723087235dfcda40462e4ff6fece3fda | ./Sentinel1_IV_maps/IV_20210125_20210218.nc |
| f5d011105c332a14269ab561c9aaffc5 | ./Sentinel1_IV_maps/IV_20210206_20210302.nc |
| 9c45d322157d35720308297a2c6228af | ./Sentinel1_IV_maps/IV_20210218_20210314.nc |
| e61cb0d46dbef7299ac751ebd713eec0 | ./Sentinel1_IV_maps/IV_20210302_20210326.nc |
| 150d8947d3c4c121c8c90021c35dc6c4 | ./Sentinel1_IV_maps/IV_20210314_20210407.nc |

** Results
*** GIS
#+BEGIN_SRC bash :results table :eval no-export
FILE=./out/GIS_D.csv
cat ${FILE}
#+END_SRC

#+RESULTS:
|       Date | Discharge [Gt yr-1] |
| 1986-04-15 |             444.215 |
| 1986-05-15 |             453.517 |
| 1986-06-15 |             459.634 |
| 1986-07-15 |             461.533 |
| 1986-08-15 |             460.848 |
| 1986-09-15 |               465.8 |
| 1986-10-15 |             464.323 |
| 1987-03-15 |             458.585 |
| 1987-04-15 |             460.219 |
| 1987-05-15 |             449.235 |
| 1987-06-15 |             456.378 |
| 1987-07-15 |             451.374 |
| 1987-08-15 |              450.09 |
| 1987-09-15 |             452.258 |
| 1987-10-15 |              452.38 |
| 1988-03-15 |             444.064 |
| 1988-04-15 |             443.625 |
| 1988-05-15 |             441.889 |
| 1988-06-15 |              449.81 |
| 1988-07-15 |              443.25 |
| 1988-08-15 |             441.796 |
| 1988-09-15 |             433.379 |
| 1988-10-15 |             430.172 |
| 1989-03-15 |             432.688 |
| 1989-04-15 |             428.013 |
| 1989-05-15 |             443.868 |
| 1989-06-15 |             450.887 |
| 1989-07-15 |             447.367 |
| 1989-08-15 |             442.732 |
| 1989-09-15 |             446.273 |
| 1989-10-15 |             443.039 |
| 1990-03-15 |             445.968 |
| 1990-04-15 |             438.066 |
| 1990-05-15 |             444.689 |
| 1990-06-15 |             449.947 |
| 1990-07-15 |             447.991 |
| 1990-08-15 |             440.303 |
| 1990-09-15 |             434.869 |
| 1990-10-15 |             439.248 |
| 1991-01-01 |             427.503 |
| 1991-06-15 |             426.943 |
| 1992-01-01 |             427.257 |
| 1992-06-15 |             437.243 |
| 1992-07-15 |             439.073 |
| 1992-08-15 |              433.42 |
| 1992-09-15 |             432.718 |
| 1992-10-15 |             431.579 |
| 1993-01-01 |             428.523 |
| 1993-03-15 |             434.787 |
| 1993-04-15 |             437.031 |
| 1993-05-15 |             437.367 |
| 1993-06-15 |             436.642 |
| 1993-07-15 |             437.654 |
| 1993-08-15 |             437.863 |
| 1993-09-15 |             438.065 |
| 1994-01-01 |             439.592 |
| 1994-05-15 |             450.985 |
| 1994-06-15 |             459.658 |
| 1994-07-15 |             475.097 |
| 1994-08-15 |             465.359 |
| 1994-09-15 |             445.496 |
| 1995-01-01 |             439.778 |
| 1995-04-15 |             436.355 |
| 1995-05-15 |             434.984 |
| 1995-06-15 |             433.532 |
| 1995-07-15 |             431.641 |
| 1995-08-15 |              428.94 |
| 1995-09-15 |             426.471 |
| 1995-10-15 |             424.079 |
| 1996-01-01 |             418.045 |
| 1996-04-15 |             425.217 |
| 1996-05-15 |             426.583 |
| 1996-06-15 |             427.811 |
| 1996-07-15 |             427.477 |
| 1996-08-15 |              428.38 |
| 1996-09-15 |               429.8 |
| 1996-10-15 |             430.713 |
| 1997-01-01 |             433.356 |
| 1997-03-15 |             433.566 |
| 1997-04-15 |             433.635 |
| 1997-05-15 |             433.599 |
| 1997-06-15 |              433.81 |
| 1997-07-15 |             433.327 |
| 1997-09-15 |             432.465 |
| 1997-10-15 |             431.796 |
| 1998-01-01 |             428.035 |
| 1998-03-15 |             434.419 |
| 1998-04-15 |             436.716 |
| 1998-05-15 |             444.589 |
| 1998-06-15 |             456.909 |
| 1998-07-15 |             453.192 |
| 1998-08-15 |             442.447 |
| 1998-09-15 |             429.311 |
| 1998-10-15 |             438.651 |
| 1999-01-01 |             435.617 |
| 1999-07-15 |             441.844 |
| 1999-08-15 |             437.002 |
| 1999-09-15 |              440.31 |
| 1999-10-15 |              439.96 |
| 1999-11-15 |             441.553 |
| 1999-12-15 |             443.035 |
| 2000-01-01 |             443.928 |
| 2000-02-15 |             442.985 |
| 2000-03-15 |             439.304 |
| 2000-04-15 |             443.209 |
| 2000-05-15 |             442.333 |
| 2000-06-15 |             452.647 |
| 2000-07-15 |             452.494 |
| 2000-08-15 |             452.611 |
| 2000-09-03 |             430.174 |
| 2000-09-15 |             433.227 |
| 2000-10-15 |              432.77 |
| 2000-11-15 |             434.335 |
| 2001-03-15 |             440.331 |
| 2001-04-15 |              441.27 |
| 2001-05-15 |             436.815 |
| 2001-06-15 |              456.42 |
| 2001-07-15 |             453.156 |
| 2001-08-15 |             442.506 |
| 2001-09-15 |             444.681 |
| 2001-10-15 |             440.958 |
| 2001-11-15 |             444.012 |
| 2002-01-15 |             446.492 |
| 2002-02-15 |             448.305 |
| 2002-03-15 |             450.127 |
| 2002-04-15 |             452.155 |
| 2002-05-15 |             459.787 |
| 2002-06-15 |             472.036 |
| 2002-07-15 |             469.886 |
| 2002-08-15 |             464.112 |
| 2002-09-15 |             459.571 |
| 2002-10-15 |             463.814 |
| 2003-02-15 |             470.182 |
| 2003-03-15 |             471.684 |
| 2003-04-15 |             475.853 |
| 2003-05-15 |             471.747 |
| 2003-06-15 |             481.254 |
| 2003-07-15 |             477.216 |
| 2003-08-15 |             473.817 |
| 2003-09-15 |             475.428 |
| 2003-10-15 |             477.009 |
| 2004-03-15 |              484.17 |
| 2004-04-15 |             481.059 |
| 2004-05-15 |             483.893 |
| 2004-06-15 |             500.767 |
| 2004-07-15 |             492.139 |
| 2004-08-15 |              481.42 |
| 2004-09-15 |             484.393 |
| 2004-10-15 |             485.814 |
| 2005-03-15 |             497.599 |
| 2005-04-15 |             498.569 |
| 2005-05-15 |             502.078 |
| 2005-06-15 |             515.146 |
| 2005-07-15 |             509.982 |
| 2005-08-15 |             495.899 |
| 2005-09-15 |             487.463 |
| 2005-10-15 |              486.82 |
| 2005-12-13 |             487.923 |
| 2006-03-15 |             491.537 |
| 2006-04-15 |             491.559 |
| 2006-05-15 |             494.449 |
| 2006-06-15 |             497.705 |
| 2006-07-15 |              506.47 |
| 2006-08-15 |             495.072 |
| 2006-09-15 |              476.03 |
| 2006-10-15 |              480.05 |
| 2006-11-15 |             477.063 |
| 2006-12-18 |             475.302 |
| 2007-03-15 |             479.906 |
| 2007-04-15 |             476.712 |
| 2007-05-15 |             481.409 |
| 2007-06-15 |             507.006 |
| 2007-07-15 |             496.941 |
| 2007-08-15 |             473.332 |
| 2007-09-07 |             474.327 |
| 2007-09-15 |             468.319 |
| 2007-10-15 |             470.062 |
| 2008-03-15 |             475.681 |
| 2008-04-15 |             475.844 |
| 2008-05-15 |             481.702 |
| 2008-06-15 |             500.397 |
| 2008-07-15 |             492.765 |
| 2008-08-15 |             485.101 |
| 2008-10-15 |             484.933 |
| 2008-11-15 |             485.153 |
| 2009-01-15 |             485.573 |
| 2009-02-15 |             485.764 |
| 2009-03-15 |             485.936 |
| 2009-04-15 |             483.152 |
| 2009-05-15 |             488.739 |
| 2009-06-15 |             506.742 |
| 2009-07-15 |             515.734 |
| 2009-08-15 |             482.305 |
| 2009-09-02 |             479.166 |
| 2009-09-15 |              480.26 |
| 2009-10-15 |               482.4 |
| 2010-03-15 |             493.311 |
| 2010-04-15 |             492.048 |
| 2010-05-15 |             488.274 |
| 2010-06-15 |             510.672 |
| 2010-07-15 |             498.766 |
| 2010-08-15 |             493.444 |
| 2010-09-15 |             487.646 |
| 2010-10-15 |             487.806 |
| 2011-03-15 |             490.887 |
| 2011-04-15 |             496.018 |
| 2011-05-15 |             498.101 |
| 2011-06-15 |             507.851 |
| 2011-07-15 |              508.19 |
| 2011-08-15 |             496.079 |
| 2011-09-15 |             493.568 |
| 2011-10-15 |             493.494 |
| 2012-01-15 |             492.218 |
| 2012-03-15 |             491.567 |
| 2012-04-15 |             491.389 |
| 2012-05-15 |             494.442 |
| 2012-06-15 |             513.911 |
| 2012-07-15 |             502.558 |
| 2012-08-15 |             486.215 |
| 2012-09-15 |             484.653 |
| 2012-10-15 |             489.586 |
| 2012-11-10 |             491.876 |
| 2013-02-15 |             493.124 |
| 2013-03-15 |             493.429 |
| 2013-04-15 |             487.836 |
| 2013-05-15 |              487.58 |
| 2013-06-15 |             502.401 |
| 2013-07-15 |             501.996 |
| 2013-08-15 |             501.782 |
| 2013-09-15 |             499.861 |
| 2013-10-15 |             500.036 |
| 2013-11-15 |              500.64 |
| 2013-12-15 |             499.885 |
| 2014-01-15 |             500.498 |
| 2014-02-15 |             498.741 |
| 2014-03-15 |             499.406 |
| 2014-04-15 |             495.819 |
| 2014-05-15 |             497.721 |
| 2014-06-15 |             517.994 |
| 2014-07-15 |             516.445 |
| 2014-08-15 |             495.388 |
| 2014-09-01 |             496.518 |
| 2014-09-15 |             480.009 |
| 2014-10-15 |              495.92 |
| 2014-11-15 |             501.032 |
| 2014-12-15 |             501.582 |
| 2014-12-16 |             502.127 |
| 2015-01-15 |             500.981 |
| 2015-01-16 |             500.368 |
| 2015-02-14 |             501.596 |
| 2015-02-15 |             499.294 |
| 2015-03-15 |             501.788 |
| 2015-03-16 |             504.124 |
| 2015-05-15 |             497.492 |
| 2015-05-16 |             503.099 |
| 2015-07-15 |             519.808 |
| 2015-07-16 |             514.439 |
| 2015-08-15 |              500.49 |
| 2015-08-16 |             499.084 |
| 2015-09-01 |             501.658 |
| 2015-10-15 |              501.47 |
| 2015-10-16 |             501.278 |
| 2015-12-15 |             499.994 |
| 2015-12-16 |             499.366 |
| 2016-01-15 |             493.585 |
| 2016-01-16 |             493.371 |
| 2016-03-15 |             485.734 |
| 2016-03-16 |             490.768 |
| 2016-05-15 |             491.458 |
| 2016-05-16 |             499.087 |
| 2016-07-15 |              507.08 |
| 2016-07-16 |             504.175 |
| 2016-08-15 |             490.512 |
| 2016-08-16 |             491.316 |
| 2016-09-01 |             498.829 |
| 2016-09-25 |             477.034 |
| 2016-10-06 |             484.808 |
| 2016-10-15 |             488.525 |
| 2016-10-16 |              485.94 |
| 2016-10-18 |             487.458 |
| 2016-10-30 |             483.724 |
| 2016-11-11 |             486.343 |
| 2016-11-23 |             488.353 |
| 2016-12-05 |             490.564 |
| 2016-12-15 |             490.973 |
| 2016-12-16 |             490.746 |
| 2016-12-17 |             489.661 |
| 2016-12-29 |             488.264 |
| 2017-01-04 |             491.216 |
| 2017-01-15 |             494.102 |
| 2017-01-16 |             493.647 |
| 2017-01-22 |             488.666 |
| 2017-01-29 |             486.172 |
| 2017-02-09 |             488.849 |
| 2017-02-14 |             495.742 |
| 2017-02-15 |              493.09 |
| 2017-02-27 |              491.31 |
| 2017-03-11 |             492.945 |
| 2017-03-15 |             493.443 |
| 2017-03-16 |             495.405 |
| 2017-03-23 |             491.614 |
| 2017-05-15 |              499.58 |
| 2017-05-16 |             505.634 |
| 2017-05-22 |             493.731 |
| 2017-06-03 |             491.497 |
| 2017-06-27 |             497.894 |
| 2017-07-09 |             499.887 |
| 2017-07-15 |              519.59 |
| 2017-07-16 |             520.205 |
| 2017-08-15 |             509.231 |
| 2017-08-16 |             511.341 |
| 2017-09-01 |               503.9 |
| 2017-10-15 |             508.362 |
| 2017-10-16 |             501.404 |
| 2017-11-18 |             494.585 |
| 2017-11-30 |             498.272 |
| 2017-12-12 |             498.939 |
| 2017-12-15 |             504.553 |
| 2017-12-16 |             506.386 |
| 2017-12-24 |             492.964 |
| 2018-01-05 |             496.586 |
| 2018-01-15 |             504.737 |
| 2018-01-16 |              505.22 |
| 2018-01-17 |             496.386 |
| 2018-01-29 |             493.988 |
| 2018-02-10 |             494.554 |
| 2018-02-14 |             501.743 |
| 2018-02-15 |             498.696 |
| 2018-02-22 |             490.782 |
| 2018-03-06 |              492.25 |
| 2018-03-15 |             497.582 |
| 2018-03-16 |             500.533 |
| 2018-03-18 |             491.219 |
| 2018-03-30 |             488.752 |
| 2018-04-11 |             491.932 |
| 2018-04-23 |              491.82 |
| 2018-05-05 |             490.723 |
| 2018-05-15 |             495.494 |
| 2018-05-16 |             503.971 |
| 2018-05-17 |              496.38 |
| 2018-05-29 |             490.733 |
| 2018-06-10 |             490.298 |
| 2018-06-22 |             492.736 |
| 2018-07-04 |             493.212 |
| 2018-07-15 |             503.821 |
| 2018-07-28 |             489.629 |
| 2018-08-09 |             490.129 |
| 2018-08-15 |             500.698 |
| 2018-08-16 |             504.171 |
| 2018-08-21 |             481.191 |
| 2018-09-02 |             479.612 |
| 2018-09-14 |             481.359 |
| 2018-09-26 |             479.973 |
| 2018-10-08 |             488.554 |
| 2018-10-15 |             499.153 |
| 2018-10-16 |             499.413 |
| 2018-10-20 |             496.536 |
| 2018-11-01 |             493.607 |
| 2018-11-13 |              492.17 |
| 2018-11-25 |             491.331 |
| 2018-12-07 |             490.175 |
| 2018-12-15 |               491.3 |
| 2018-12-19 |             490.879 |
| 2018-12-31 |             489.853 |
| 2019-01-12 |             488.693 |
| 2019-01-24 |             488.514 |
| 2019-02-05 |             486.452 |
| 2019-02-17 |             487.166 |
| 2019-03-01 |              485.51 |
| 2019-03-13 |             485.775 |
| 2019-03-25 |             484.971 |
| 2019-04-05 |             485.355 |
| 2019-04-18 |             487.482 |
| 2019-04-30 |             490.491 |
| 2019-05-12 |             487.317 |
| 2019-05-24 |             490.863 |
| 2019-06-05 |             492.533 |
| 2019-06-17 |             497.145 |
| 2019-06-29 |             493.405 |
| 2019-07-11 |             497.634 |
| 2019-07-23 |             485.501 |
| 2019-08-04 |             484.738 |
| 2019-08-16 |             476.981 |
| 2019-08-28 |             479.325 |
| 2019-09-09 |             478.865 |
| 2019-09-21 |             483.233 |
| 2019-10-03 |             486.615 |
| 2019-10-15 |             484.973 |
| 2019-10-27 |             491.382 |
| 2019-11-08 |             491.731 |
| 2019-11-20 |             491.773 |
| 2019-12-02 |             494.453 |
| 2019-12-14 |             493.907 |
| 2019-12-26 |             493.583 |
| 2020-01-07 |             495.326 |
| 2020-01-19 |             494.388 |
| 2020-01-31 |             496.509 |
| 2020-02-12 |              496.87 |
| 2020-02-24 |             494.748 |
| 2020-03-07 |             492.713 |
| 2020-03-19 |             493.956 |
| 2020-03-31 |             494.345 |
| 2020-04-12 |             498.053 |
| 2020-04-24 |              498.87 |
| 2020-05-06 |             497.333 |
| 2020-05-18 |             497.518 |
| 2020-05-30 |             497.085 |
| 2020-06-11 |             501.018 |
| 2020-06-23 |             502.809 |
| 2020-07-05 |             505.775 |
| 2020-07-17 |             501.734 |
| 2020-07-29 |             496.824 |
| 2020-08-10 |             494.057 |
| 2020-08-22 |              498.87 |
| 2020-09-03 |             489.666 |
| 2020-09-15 |             487.477 |
| 2020-09-27 |             494.557 |
| 2020-10-09 |             501.986 |
| 2020-10-21 |              504.71 |
| 2020-11-02 |             508.116 |
| 2020-11-14 |             503.542 |
| 2020-11-26 |              505.04 |
| 2020-12-08 |             504.225 |
| 2020-12-20 |             505.648 |
| 2021-01-01 |             509.303 |
| 2021-01-13 |             509.908 |
| 2021-01-25 |             511.794 |
| 2021-02-06 |             510.432 |
| 2021-02-18 |              513.68 |
| 2021-03-02 |             512.037 |
| 2021-03-14 |              509.87 |
| 2021-03-26 |             506.253 |

*** Regions
#+BEGIN_SRC bash :results table :eval no-export
FILE=./out/region_D.csv
cat ${FILE}
#+END_SRC

#+RESULTS:
|       Date |     CE |     CW |     NE |     NO |      NW |      SE |     SW |
| 1986-04-15 | 65.412 | 67.956 | 22.466 | 21.203 |  92.644 | 152.701 | 21.832 |
| 1986-05-15 | 65.783 | 75.055 | 22.594 | 20.504 |  93.585 | 154.163 | 21.832 |
| 1986-06-15 | 69.129 | 75.039 | 22.798 | 23.775 |  95.603 | 151.458 | 21.832 |
| 1986-07-15 | 68.765 | 75.104 | 20.948 | 24.777 |   97.71 | 152.397 | 21.831 |
| 1986-08-15 | 67.813 | 73.658 |  22.72 | 23.721 |  97.382 | 153.724 | 21.831 |
| 1986-09-15 |  70.01 | 73.257 | 23.797 | 23.918 |  98.027 |  154.96 | 21.831 |
| 1986-10-15 | 69.393 | 72.869 | 23.196 | 24.109 |  96.825 | 156.101 | 21.831 |
| 1987-03-15 |  68.99 |   70.9 | 20.172 | 25.067 |  90.772 | 160.856 | 21.829 |
| 1987-04-15 | 68.907 | 70.493 | 22.369 | 25.264 |  89.529 |  161.83 | 21.829 |
| 1987-05-15 | 67.308 | 67.556 | 23.244 | 21.602 |  89.935 | 157.761 | 21.828 |
| 1987-06-15 | 69.168 | 70.014 | 21.858 | 23.721 |  95.909 |  153.88 | 21.828 |
| 1987-07-15 | 67.487 | 74.582 | 22.747 |  22.01 |  95.786 | 146.935 | 21.828 |
| 1987-08-15 | 63.943 |  72.91 | 23.444 | 24.689 |   91.88 | 151.862 | 21.361 |
| 1987-09-15 | 67.529 | 72.394 | 23.808 | 23.153 |  91.935 | 151.924 | 21.515 |
| 1987-10-15 | 66.364 | 71.374 | 23.962 | 23.027 |  92.009 | 154.119 | 21.524 |
| 1988-03-15 | 68.293 | 66.183 | 24.276 | 22.394 |  92.389 | 148.959 | 21.569 |
| 1988-04-15 | 68.686 | 65.889 |  24.34 | 22.265 |  92.962 | 147.905 | 21.579 |
| 1988-05-15 | 69.971 | 70.477 | 23.194 | 21.043 |  90.802 | 144.814 | 21.587 |
| 1988-06-15 | 69.595 | 70.087 | 22.675 | 24.941 |  95.452 | 145.462 | 21.597 |
| 1988-07-15 | 68.553 | 69.738 | 21.267 | 23.721 |   97.45 | 140.915 | 21.605 |
| 1988-08-15 | 65.738 | 68.736 | 19.373 | 23.426 |  94.927 | 147.983 | 21.615 |
| 1988-09-15 | 64.975 | 67.827 | 19.433 | 23.371 |  94.545 | 141.604 | 21.624 |
| 1988-10-15 |  64.84 | 67.624 |  19.86 | 23.318 |  95.352 | 137.546 | 21.633 |
| 1989-03-15 | 65.949 | 66.589 | 22.008 | 23.053 |   99.41 | 134.003 | 21.677 |
| 1989-04-15 | 65.494 | 64.789 | 20.603 | 22.998 |   99.17 | 133.274 | 21.686 |
| 1989-05-15 | 64.772 | 65.927 | 22.382 |  22.16 | 101.303 | 145.628 | 21.694 |
| 1989-06-15 | 69.861 | 68.766 | 22.233 | 24.077 | 101.627 |  142.62 | 21.703 |
| 1989-07-15 |  70.29 | 68.255 | 22.145 | 25.095 |  103.25 |  136.62 | 21.712 |
| 1989-08-15 | 69.573 | 71.831 | 22.092 | 22.991 |  98.704 | 135.821 | 21.721 |
| 1989-09-15 | 70.599 | 72.173 | 22.671 |  23.15 | 100.594 | 135.355 |  21.73 |
| 1989-10-15 | 67.359 | 71.807 | 22.492 | 23.027 | 100.839 | 135.777 | 21.739 |
| 1990-03-15 | 70.302 | 69.949 | 21.587 | 22.406 | 102.061 |  137.88 | 21.782 |
| 1990-04-15 | 66.913 |  67.75 |  20.33 | 22.279 | 101.947 | 137.056 | 21.791 |
| 1990-05-15 | 70.091 |  63.78 | 23.466 | 21.087 | 102.516 |  141.95 |   21.8 |
| 1990-06-15 | 73.912 | 70.681 | 22.396 | 23.554 | 103.173 | 134.423 | 21.808 |
| 1990-07-15 |  74.62 | 70.123 | 22.594 | 24.093 |  101.01 | 133.733 | 21.817 |
| 1990-08-15 |  72.19 | 66.777 | 22.031 | 21.756 | 100.431 | 135.294 | 21.826 |
| 1990-09-15 |  66.88 | 65.365 | 21.952 | 22.688 | 100.217 | 135.932 | 21.835 |
| 1990-10-15 | 71.592 | 65.157 |  21.95 | 22.608 |   98.45 | 137.648 | 21.843 |
| 1991-01-01 | 66.336 | 64.614 | 21.888 | 22.402 |  93.859 | 136.538 | 21.865 |
| 1991-06-15 | 69.007 | 63.454 | 21.756 | 21.968 |  90.597 | 138.249 | 21.911 |
| 1992-01-01 | 72.244 | 62.024 | 21.597 | 21.443 |  87.702 |  140.28 | 21.967 |
| 1992-06-15 | 71.804 | 62.686 | 21.709 | 22.076 |  88.111 | 146.947 |  23.91 |
| 1992-07-15 | 71.724 | 62.806 |  21.73 |  22.19 |  88.185 | 148.148 |  24.29 |
| 1992-08-15 | 71.641 | 62.931 | 21.751 | 22.308 |  88.261 | 145.493 | 21.034 |
| 1992-09-15 | 71.558 | 63.056 | 21.772 | 22.427 |  88.337 | 144.231 | 21.338 |
| 1992-10-15 | 71.477 | 63.177 | 21.792 | 22.541 |  88.411 | 142.784 | 21.396 |
| 1993-01-01 | 71.267 | 63.494 | 21.845 | 22.838 |  88.601 | 139.023 | 21.455 |
| 1993-03-15 | 71.017 | 63.894 | 21.966 | 22.757 |  89.272 | 143.417 | 22.465 |
| 1993-04-15 |  70.91 | 64.064 | 22.017 | 22.722 |  89.557 | 145.279 | 22.481 |
| 1993-05-15 | 70.808 | 64.229 | 22.067 | 22.689 |  89.833 |  145.58 | 22.162 |
| 1993-06-15 | 70.702 |   64.4 | 22.118 | 22.654 |  90.118 |  145.89 | 20.761 |
| 1993-07-15 | 70.599 | 64.565 | 22.168 | 22.621 |  90.394 | 146.189 | 21.118 |
| 1993-08-15 | 70.493 | 64.736 | 22.219 | 22.586 |   90.68 | 146.496 | 20.652 |
| 1993-09-15 | 70.388 | 64.907 | 22.271 | 22.552 |  90.965 | 146.803 | 20.179 |
| 1994-01-01 | 70.021 | 65.506 |  22.45 | 22.431 |  91.959 | 147.862 | 19.364 |
| 1994-05-15 | 69.243 |  69.31 | 23.834 | 22.751 |  96.153 |  150.17 | 19.524 |
| 1994-06-15 | 71.045 | 70.894 | 24.603 | 24.217 |   97.83 | 151.509 |  19.56 |
| 1994-07-15 | 70.203 |  83.52 | 23.661 | 24.826 |  98.898 | 154.493 | 19.495 |
| 1994-08-15 | 66.485 | 76.652 | 23.158 | 26.775 |  95.287 | 157.574 | 19.428 |
| 1994-09-15 | 64.325 |   60.3 | 22.917 | 26.366 |  94.206 |  158.75 | 18.633 |
| 1995-01-01 | 67.486 | 61.161 |  22.28 | 25.947 |  91.159 | 152.617 | 19.128 |
| 1995-04-15 | 67.328 | 62.177 | 22.101 | 24.769 |  90.402 | 149.004 | 20.575 |
| 1995-05-15 | 67.283 | 62.471 | 22.049 | 24.429 |  90.183 | 147.969 | 20.599 |
| 1995-06-15 | 67.237 | 62.776 | 21.996 | 24.078 |  89.958 | 146.904 | 20.584 |
| 1995-07-15 | 67.192 | 63.072 | 21.944 | 23.738 |   89.74 | 145.877 | 20.079 |
| 1995-08-15 | 67.147 | 63.378 | 21.891 | 23.386 |  89.514 | 143.821 | 19.802 |
| 1995-09-15 | 67.101 | 63.685 | 21.838 | 23.034 |  89.289 | 141.769 | 19.754 |
| 1995-10-15 | 67.058 | 63.983 | 21.786 | 22.694 |  89.071 | 139.788 | 19.699 |
| 1996-01-01 | 66.946 | 64.761 | 21.652 | 21.809 |  88.504 | 134.654 |  19.72 |
| 1996-04-15 | 68.004 | 64.587 | 21.814 | 21.692 |   88.53 | 138.637 | 21.952 |
| 1996-05-15 | 68.306 | 64.539 |  21.86 | 21.659 |  88.537 | 139.775 | 21.907 |
| 1996-06-15 | 68.619 | 64.488 | 21.908 | 21.624 |  88.545 |  140.95 | 21.677 |
| 1996-07-15 | 68.922 |  64.44 | 21.955 | 21.591 |  88.552 |   141.6 | 20.418 |
| 1996-08-15 | 69.234 |  64.39 | 22.002 | 21.556 |   88.56 | 142.343 | 20.294 |
| 1996-09-15 | 69.547 | 64.341 |  22.05 | 21.522 |  88.568 | 143.087 | 20.686 |
| 1996-10-15 |  69.85 | 64.293 | 22.096 | 21.488 |  88.575 | 143.807 | 20.603 |
| 1997-01-01 | 70.638 |  64.17 | 22.216 | 21.401 |  88.595 | 145.678 | 20.657 |
| 1997-03-15 | 70.933 | 64.995 | 22.205 | 21.349 |  88.836 | 144.173 | 21.074 |
| 1997-04-15 |  71.06 | 65.346 | 22.201 | 21.326 |  88.938 | 143.534 | 21.231 |
| 1997-05-15 | 71.182 | 65.685 | 22.196 | 21.305 |  89.037 | 142.916 | 21.278 |
| 1997-06-15 | 71.309 | 66.036 | 22.192 | 21.282 |  89.139 | 142.277 | 21.575 |
| 1997-07-15 | 71.433 | 66.375 | 22.187 | 21.261 |  89.238 | 141.658 | 21.175 |
| 1997-09-15 |  71.69 | 67.077 | 22.178 | 21.216 |  89.443 |  140.38 | 20.482 |
| 1997-10-15 | 71.562 | 67.417 | 22.174 | 21.194 |  89.542 | 139.761 | 20.146 |
| 1998-01-01 | 71.238 | 68.301 | 22.162 | 21.138 |  89.799 | 135.269 | 20.126 |
| 1998-03-15 | 71.799 | 72.279 | 19.852 | 20.506 |  91.485 | 137.379 | 21.119 |
| 1998-04-15 | 71.353 | 74.032 | 18.852 | 20.238 |  92.576 | 138.095 |  21.57 |
| 1998-05-15 | 73.935 | 72.614 | 21.327 | 21.561 |   92.25 | 140.629 | 22.274 |
| 1998-06-15 | 74.256 | 74.996 | 23.535 | 27.571 |  95.846 | 140.085 |  20.62 |
| 1998-07-15 | 72.659 | 76.073 | 23.492 | 23.719 |  96.434 | 141.417 | 19.399 |
| 1998-08-15 |  70.59 | 76.408 | 23.429 | 20.256 |  90.926 | 143.085 | 17.753 |
| 1998-09-15 | 68.187 | 76.455 | 21.429 | 20.775 |   89.18 | 135.403 | 17.882 |
| 1998-10-15 |  69.94 | 75.893 | 21.669 | 21.277 |  88.702 | 143.162 | 18.008 |
| 1999-01-01 |  69.75 |  74.43 | 22.293 | 22.583 |  87.462 | 140.763 | 18.335 |
| 1999-07-15 | 69.624 | 76.479 | 22.378 | 25.869 |  88.603 | 138.931 | 19.959 |
| 1999-08-15 | 67.227 | 76.007 | 21.663 | 25.576 |  88.369 | 138.662 | 19.497 |
| 1999-09-15 | 66.265 | 76.154 |  21.01 | 25.284 |  88.891 | 143.825 | 18.881 |
| 1999-10-15 | 67.681 | 75.119 | 21.332 |   25.0 |  90.026 | 141.434 | 19.367 |
| 1999-11-15 | 68.041 | 75.989 | 21.551 | 24.708 |  90.597 | 141.175 | 19.493 |
| 1999-12-15 | 68.389 | 76.831 | 21.762 | 24.424 |  91.149 | 140.741 |  19.74 |
| 2000-01-01 | 68.586 | 77.308 | 21.882 | 24.264 |  91.461 | 140.547 |  19.88 |
| 2000-02-15 | 68.943 | 77.146 | 22.383 | 23.835 |  91.115 | 138.954 |  20.61 |
| 2000-03-15 |  67.76 | 75.448 | 22.705 | 23.558 |  90.892 |  137.93 | 21.011 |
| 2000-04-15 | 68.868 | 77.273 | 23.147 | 23.263 |  87.639 | 141.561 | 21.458 |
| 2000-05-15 | 68.876 | 79.101 | 23.484 | 22.977 |  88.978 | 136.853 | 22.064 |
| 2000-06-15 | 68.609 | 80.793 | 24.001 | 23.019 |  92.286 | 142.351 | 21.588 |
| 2000-07-15 | 69.116 | 83.356 | 21.045 | 25.571 |  96.327 | 135.487 | 21.592 |
| 2000-08-15 | 69.339 | 82.226 |  22.67 | 23.048 |   91.27 | 144.603 | 19.454 |
| 2000-09-03 |  66.33 | 79.778 | 22.573 | 21.501 |  87.727 | 133.056 | 19.208 |
| 2000-09-15 | 65.373 | 80.396 | 22.552 | 21.505 |  87.309 | 136.923 |  19.17 |
| 2000-10-15 | 65.743 | 80.461 | 22.732 | 21.514 |  87.582 |  135.16 | 19.577 |
| 2000-11-15 | 66.529 | 80.699 | 22.925 | 21.523 |  88.152 | 134.862 | 19.645 |
| 2001-03-15 | 69.551 | 81.594 | 23.671 | 21.556 |  90.399 | 133.651 |  19.91 |
| 2001-04-15 | 69.485 | 80.024 | 23.818 | 21.564 |  91.587 | 134.787 | 20.006 |
| 2001-05-15 | 68.767 | 77.384 | 23.989 | 21.572 |  89.245 | 135.413 | 20.446 |
| 2001-06-15 | 71.315 | 83.702 | 24.374 | 22.687 |    91.5 |   142.4 | 20.443 |
| 2001-07-15 | 71.239 | 83.626 | 24.752 | 23.829 |  95.109 | 134.524 | 20.077 |
| 2001-08-15 | 66.561 | 81.058 |  25.12 | 23.635 |  91.459 | 134.787 | 19.886 |
| 2001-09-15 | 68.391 | 82.705 | 25.422 | 23.441 |  87.961 | 137.096 | 19.666 |
| 2001-10-15 | 67.393 |  80.28 | 25.829 | 23.253 |  87.829 | 137.117 |  19.26 |
| 2001-11-15 | 68.042 | 79.724 | 26.271 | 23.059 |   88.16 | 139.473 | 19.282 |
| 2002-01-15 | 69.302 | 78.617 | 27.142 | 22.677 |  88.813 | 140.612 | 19.329 |
| 2002-02-15 | 69.908 | 78.028 | 27.583 | 22.484 |  89.147 | 141.694 |  19.46 |
| 2002-03-15 | 70.455 | 77.496 | 27.981 |  22.31 |  89.449 | 142.673 | 19.764 |
| 2002-04-15 | 69.051 | 81.705 | 28.455 | 22.117 |  88.961 | 141.963 | 19.905 |
| 2002-05-15 | 69.146 | 84.005 | 28.855 | 21.931 |  91.151 | 144.351 | 20.349 |
| 2002-06-15 | 70.901 | 86.339 |  29.39 | 21.738 |  96.533 | 146.461 | 20.674 |
| 2002-07-15 | 67.679 | 83.916 |  29.19 | 24.942 |  95.825 | 148.582 | 19.752 |
| 2002-08-15 | 67.722 | 80.285 | 28.759 | 24.734 |   90.53 | 152.776 | 19.306 |
| 2002-09-15 | 66.214 |  81.23 |  28.52 | 24.525 |  90.883 | 148.819 |  19.38 |
| 2002-10-15 | 67.171 | 81.594 | 28.214 | 24.323 |  91.068 | 152.033 |  19.41 |
| 2003-02-15 | 71.081 | 83.086 | 26.954 | 23.497 |  91.825 | 153.844 | 19.894 |
| 2003-03-15 |  71.97 | 83.426 | 26.667 | 23.309 |  91.998 | 154.133 | 20.181 |
| 2003-04-15 | 74.079 | 84.454 | 26.348 | 23.101 |  92.872 | 154.777 | 20.221 |
| 2003-05-15 |  69.46 | 85.596 | 26.147 |   22.9 |  91.493 | 155.701 |  20.45 |
| 2003-06-15 | 71.246 | 86.324 |  25.83 | 23.458 |  96.083 | 157.891 | 20.423 |
| 2003-07-15 | 68.985 | 86.089 | 25.536 | 23.942 |   94.74 | 157.183 |  20.74 |
| 2003-08-15 |  70.72 | 85.902 | 25.478 | 24.015 |  92.723 | 154.889 | 20.091 |
| 2003-09-15 |  69.14 |  85.94 | 25.413 | 24.088 |  91.971 | 158.716 | 20.162 |
| 2003-10-15 | 69.957 |  85.69 | 25.364 | 24.158 |  92.073 | 159.544 | 20.221 |
| 2004-03-15 | 74.137 | 84.404 | 25.119 | 24.513 |  92.594 | 162.867 | 20.536 |
| 2004-04-15 | 74.866 | 81.419 | 25.069 | 24.584 |  92.765 | 162.284 | 20.071 |
| 2004-05-15 | 72.946 | 85.054 | 25.003 | 24.654 |  94.609 | 161.096 | 20.532 |
| 2004-06-15 | 75.174 | 86.583 | 25.158 | 23.841 | 100.677 | 168.829 | 20.506 |
| 2004-07-15 | 75.112 | 85.516 | 22.648 | 24.606 | 101.992 |  162.32 | 19.944 |
| 2004-08-15 | 72.376 | 84.431 | 22.857 | 24.435 |  97.113 | 160.818 |  19.39 |
| 2004-09-15 | 69.223 | 84.592 | 23.066 | 24.265 |  96.117 | 166.881 | 20.249 |
| 2004-10-15 | 71.554 | 84.492 | 23.307 |   24.1 |  96.171 | 165.803 | 20.387 |
| 2005-03-15 | 83.242 |  84.03 | 24.521 |  23.27 |  96.417 | 165.041 | 21.076 |
| 2005-04-15 | 85.637 | 83.944 |  24.71 |   23.1 |  94.493 | 164.892 | 21.794 |
| 2005-05-15 |   87.2 | 83.151 | 24.983 | 22.935 |   93.15 |  168.98 | 21.679 |
| 2005-06-15 | 87.888 | 86.697 | 25.266 | 22.765 |  99.277 | 171.981 | 21.274 |
| 2005-07-15 | 87.176 | 87.026 | 25.649 | 23.326 | 100.544 |  165.16 |   21.1 |
| 2005-08-15 | 82.867 | 84.837 | 25.274 | 22.983 |   95.25 | 163.466 | 21.221 |
| 2005-09-15 | 82.628 | 82.901 | 24.751 | 22.792 |    93.8 | 159.117 | 21.474 |
| 2005-10-15 | 84.007 | 82.767 | 24.269 | 22.607 |  94.283 | 157.882 | 21.005 |
| 2005-12-13 | 86.716 | 82.507 | 23.321 | 22.243 |  95.232 | 156.714 | 21.189 |
| 2006-03-15 |  87.28 | 82.147 | 24.315 | 23.595 |  95.428 | 157.016 | 21.756 |
| 2006-04-15 | 84.863 | 84.391 | 24.597 |  24.05 |   93.94 | 157.638 |  22.08 |
| 2006-05-15 | 86.249 | 83.352 | 24.972 | 24.489 |  94.521 | 158.548 | 22.317 |
| 2006-06-15 | 83.492 | 86.932 | 25.202 | 24.943 | 100.298 | 153.577 | 23.261 |
| 2006-07-15 | 86.248 | 91.781 | 24.867 | 24.584 | 102.981 | 154.147 | 21.862 |
| 2006-08-15 | 87.216 | 90.116 | 25.073 | 24.277 |  96.305 | 152.443 | 19.642 |
| 2006-09-15 |  77.55 | 88.256 | 24.688 | 23.969 |   94.75 | 148.719 | 18.097 |
| 2006-10-15 |   82.1 | 87.444 | 24.411 | 23.672 |  94.662 | 147.946 | 19.815 |
| 2006-11-15 | 82.337 | 86.608 | 24.125 | 23.365 |   94.57 | 146.563 | 19.496 |
| 2006-12-18 | 82.589 | 85.722 |  23.82 | 23.039 |  94.471 |  145.09 | 20.571 |
| 2007-03-15 | 82.355 |  83.85 | 24.073 | 24.728 |  94.759 | 149.069 | 21.073 |
| 2007-04-15 |   82.0 | 82.477 | 24.431 | 25.288 |  94.145 | 146.601 | 21.771 |
| 2007-05-15 | 81.892 | 84.852 | 24.914 | 26.003 |  94.693 | 147.475 |  21.58 |
| 2007-06-15 | 84.054 | 90.166 | 25.571 | 26.592 | 103.411 | 155.195 | 22.016 |
| 2007-07-15 | 81.089 | 88.693 | 25.083 | 25.503 |  104.48 | 151.269 | 20.824 |
| 2007-08-15 | 76.688 | 87.826 | 23.168 | 23.782 |  95.272 |  147.49 | 19.106 |
| 2007-09-07 | 80.594 |  84.55 | 24.323 | 23.348 |  94.563 | 147.837 | 19.113 |
| 2007-09-15 | 77.452 | 88.808 | 24.435 | 23.471 |  90.516 | 144.959 | 18.679 |
| 2007-10-15 | 77.529 | 87.968 | 24.531 | 23.935 |  91.227 | 146.301 | 18.573 |
| 2008-03-15 | 77.479 | 83.756 | 25.014 | 26.277 |  94.813 | 147.906 | 20.436 |
| 2008-04-15 | 77.067 | 82.906 |  25.04 | 26.753 |  95.542 | 148.623 | 19.915 |
| 2008-05-15 | 78.019 | 83.686 | 25.199 | 27.214 |  94.041 | 153.393 | 20.151 |
| 2008-06-15 | 79.086 |  89.25 | 25.429 |  27.69 | 105.124 | 153.685 | 20.132 |
| 2008-07-15 | 79.818 | 91.324 |   26.2 | 26.236 | 102.482 | 148.347 | 18.358 |
| 2008-08-15 | 78.391 |  93.43 | 26.106 | 25.974 |  96.534 | 146.571 | 18.094 |
| 2008-10-15 | 78.371 | 90.885 | 25.903 | 25.428 |  96.776 | 149.167 | 18.402 |
| 2008-11-15 | 78.361 | 89.594 |   25.8 |  25.15 |  96.899 | 150.549 |   18.8 |
| 2009-01-15 | 78.344 | 87.055 | 25.599 | 24.604 |   97.14 | 153.255 | 19.576 |
| 2009-02-15 | 78.343 | 85.762 | 25.498 | 24.326 |  97.262 | 154.611 | 19.962 |
| 2009-03-15 | 78.342 | 84.595 | 25.407 | 24.076 |  97.372 | 155.835 | 20.309 |
| 2009-04-15 | 77.594 | 84.103 | 25.424 | 23.799 |  97.493 | 154.497 | 20.241 |
| 2009-05-15 | 77.997 | 85.278 | 25.268 | 23.531 |  97.065 | 158.874 | 20.727 |
| 2009-06-15 | 80.094 | 93.049 | 25.251 | 23.253 | 103.208 | 161.056 |  20.83 |
| 2009-07-15 | 79.259 | 97.218 | 25.922 | 24.472 | 107.848 | 160.554 | 20.461 |
| 2009-08-15 | 75.247 | 91.005 | 23.094 | 23.215 |   97.64 | 152.906 | 19.197 |
| 2009-09-02 | 77.351 | 87.542 | 24.652 | 22.485 |  99.109 | 149.404 | 18.624 |
| 2009-09-15 | 75.784 | 91.695 | 24.784 | 22.622 |  97.486 |  150.03 | 17.859 |
| 2009-10-15 |  76.04 | 91.535 | 24.763 | 22.936 |  97.887 | 151.001 | 18.236 |
| 2010-03-15 | 77.367 | 90.765 | 24.666 | 24.518 |  99.948 | 156.052 | 19.994 |
| 2010-04-15 | 77.536 | 90.614 | 24.707 | 24.843 | 100.549 | 153.983 | 19.816 |
| 2010-05-15 |  77.34 | 93.234 |  24.57 | 25.157 |  96.313 | 151.662 | 19.998 |
| 2010-06-15 | 79.412 | 95.946 | 24.638 | 25.482 | 107.471 | 158.339 | 19.383 |
| 2010-07-15 | 78.477 | 91.285 | 25.296 | 25.506 | 104.131 | 155.816 | 18.254 |
| 2010-08-15 | 75.983 |  86.92 | 25.035 | 26.836 |  102.98 | 157.945 | 17.746 |
| 2010-09-15 | 75.925 |  84.61 | 25.104 | 26.397 | 101.209 | 157.744 | 16.655 |
| 2010-10-15 | 76.104 | 84.185 | 25.219 | 26.287 |  101.74 | 157.199 | 17.073 |
| 2011-03-15 | 76.975 |  81.98 | 25.784 | 25.728 | 104.333 | 155.902 | 20.185 |
| 2011-04-15 | 79.524 | 83.659 | 25.931 | 25.612 |  104.86 |  155.78 | 20.651 |
| 2011-05-15 | 81.799 | 84.517 | 26.097 |   25.5 | 104.352 | 155.119 | 20.717 |
| 2011-06-15 | 80.999 | 87.465 | 26.206 | 25.385 | 107.899 | 159.389 | 20.508 |
| 2011-07-15 | 82.898 | 88.175 | 26.214 | 24.433 | 110.746 | 155.368 | 20.354 |
| 2011-08-15 | 79.007 | 89.384 | 25.405 | 27.175 | 102.463 | 151.931 | 20.714 |
| 2011-09-15 | 76.698 | 93.302 | 25.424 | 26.881 | 102.297 | 149.318 | 19.647 |
| 2011-10-15 | 77.023 | 91.895 | 25.547 | 26.596 | 102.454 | 149.826 | 20.153 |
| 2012-01-15 | 78.022 | 87.622 | 25.925 | 25.724 | 102.938 | 150.654 | 21.332 |
| 2012-03-15 | 78.696 |  84.92 | 26.176 | 25.155 | 103.298 | 151.212 | 22.109 |
| 2012-04-15 | 77.146 | 83.525 | 26.193 | 24.861 | 103.483 | 154.211 | 21.968 |
| 2012-05-15 |  78.42 | 88.967 | 26.276 | 24.577 | 102.428 | 150.861 | 22.913 |
| 2012-06-15 | 80.525 | 99.661 | 26.446 | 24.284 | 109.678 |  150.35 | 22.967 |
| 2012-07-15 |  79.32 |  93.81 | 26.553 | 27.042 |  109.94 | 145.377 | 20.515 |
| 2012-08-15 | 73.982 | 92.538 | 24.235 | 26.458 | 101.555 |  149.88 | 17.566 |
| 2012-09-15 | 73.523 | 92.651 | 24.673 | 25.216 |  99.602 |  151.06 | 17.928 |
| 2012-10-15 | 75.682 | 93.863 | 25.185 | 24.015 | 101.946 | 150.409 | 18.485 |
| 2012-11-10 | 77.554 | 94.914 | 25.613 | 22.974 | 103.977 | 146.741 | 20.105 |
| 2013-02-15 | 78.811 | 94.748 | 25.592 | 22.827 |  103.22 |  147.34 | 20.585 |
| 2013-03-15 | 79.177 | 94.699 | 25.587 | 22.785 | 102.989 | 147.481 | 20.712 |
| 2013-04-15 | 77.329 | 91.775 | 25.575 | 22.738 | 103.176 | 146.758 | 20.485 |
| 2013-05-15 | 76.476 | 88.358 | 25.638 | 24.729 | 103.005 |  148.31 | 21.065 |
| 2013-06-15 | 77.683 | 91.966 | 26.194 | 24.656 | 108.048 | 151.472 | 22.383 |
| 2013-07-15 |  77.39 | 90.202 | 26.193 | 25.212 | 112.872 | 148.667 | 21.461 |
| 2013-08-15 | 77.924 | 95.794 | 25.039 |  25.59 | 107.009 | 150.857 | 19.568 |
| 2013-09-15 | 75.493 | 98.486 | 25.527 | 23.424 | 105.659 | 151.999 | 19.274 |
| 2013-10-15 |  78.89 | 98.634 | 25.764 | 23.391 |  106.76 | 147.246 | 19.351 |
| 2013-11-15 | 78.773 | 97.024 | 26.009 | 23.358 | 107.659 | 147.386 | 20.431 |
| 2013-12-15 | 78.371 | 95.469 | 26.246 | 23.325 | 108.528 | 147.822 | 20.125 |
| 2014-01-15 | 77.957 | 93.861 |  26.49 | 23.292 | 109.438 | 148.601 | 20.858 |
| 2014-02-15 | 77.547 | 92.253 | 26.733 | 23.261 | 110.363 | 148.129 | 20.455 |
| 2014-03-15 | 76.371 | 91.777 | 26.952 | 23.233 | 111.116 | 148.624 | 21.332 |
| 2014-04-15 | 76.558 | 87.006 | 27.299 | 23.959 | 111.634 | 147.749 | 21.614 |
| 2014-05-15 | 75.357 |  91.59 | 26.819 | 25.395 | 110.966 | 145.308 | 22.287 |
| 2014-06-15 | 79.415 | 98.697 |  27.78 | 25.852 | 115.566 |   147.9 | 22.785 |
| 2014-07-15 | 77.385 | 97.973 | 28.081 | 26.894 |  116.51 | 149.479 | 20.122 |
| 2014-08-15 | 74.917 | 95.586 | 27.418 |  26.06 | 104.914 | 147.706 | 18.788 |
| 2014-09-01 | 76.526 | 90.754 | 27.917 | 24.988 | 109.315 | 147.594 | 19.425 |
| 2014-09-15 | 73.812 |   85.9 | 26.931 | 24.245 | 103.167 | 147.405 | 18.548 |
| 2014-10-15 | 74.997 | 97.375 | 27.098 | 24.414 | 104.636 | 148.593 | 18.806 |
| 2014-11-15 | 76.266 | 96.775 | 27.271 | 24.588 | 106.151 | 150.872 | 19.109 |
| 2014-12-15 | 77.306 | 96.193 | 27.438 | 24.757 | 107.617 | 149.015 | 19.255 |
| 2014-12-16 | 77.341 | 96.174 | 27.444 | 24.763 | 107.666 | 149.218 | 19.521 |
| 2015-01-15 |  77.27 | 94.607 | 27.647 | 24.707 | 108.648 | 148.448 | 19.654 |
| 2015-01-16 | 77.267 | 94.556 | 27.654 | 24.705 | 108.681 | 148.025 |  19.48 |
| 2015-02-14 |  76.81 | 92.957 | 27.841 | 24.917 | 110.301 | 149.175 | 19.595 |
| 2015-02-15 | 76.629 | 91.099 | 27.882 | 24.924 | 109.519 | 149.303 | 19.938 |
| 2015-03-15 |  76.81 | 89.693 | 27.626 |  25.11 | 110.564 | 150.778 | 21.208 |
| 2015-03-16 | 77.044 | 90.914 | 27.527 | 25.139 | 112.211 | 151.042 | 20.246 |
| 2015-05-15 | 75.372 | 86.473 | 28.028 | 25.319 | 109.246 | 152.003 |  21.05 |
| 2015-05-16 | 76.983 | 86.913 | 28.704 | 25.526 | 112.653 | 151.743 | 20.577 |
| 2015-07-15 | 77.037 | 96.886 | 28.911 | 25.913 | 113.728 |  156.04 | 21.292 |
| 2015-07-16 | 77.207 | 97.349 | 29.145 | 25.974 | 112.086 | 151.694 | 20.982 |
| 2015-08-15 | 74.853 | 92.851 | 27.889 | 25.414 | 105.581 | 153.574 | 20.328 |
| 2015-08-16 | 74.808 | 93.889 | 28.527 | 25.564 | 105.353 | 150.899 | 20.043 |
| 2015-09-01 | 75.121 |  95.82 | 28.107 | 24.725 | 110.908 | 146.838 |  20.14 |
| 2015-10-15 | 74.942 | 94.401 | 27.591 |  23.96 | 107.483 | 153.446 | 19.647 |
| 2015-10-16 | 75.333 | 99.716 | 27.578 | 23.943 | 106.604 | 149.459 | 18.646 |
| 2015-12-15 |   74.3 | 97.004 | 28.049 | 24.413 | 108.626 |  148.17 | 19.433 |
| 2015-12-16 | 74.283 | 96.958 | 28.057 |  24.42 | 108.659 | 147.915 | 19.072 |
| 2016-01-15 |  74.25 | 93.013 |  28.11 | 24.558 |  108.45 | 145.986 | 19.218 |
| 2016-01-16 | 74.249 | 92.882 | 28.111 | 24.562 | 108.443 | 145.922 | 19.201 |
| 2016-03-15 | 72.351 | 90.525 | 28.181 | 24.535 | 107.607 | 143.214 | 19.321 |
| 2016-03-16 |  73.65 | 92.998 | 28.488 | 24.765 | 109.431 | 142.322 | 19.113 |
| 2016-05-15 | 72.997 | 95.283 | 28.721 | 24.803 | 108.029 | 142.062 | 19.562 |
| 2016-05-16 | 74.535 | 96.415 | 28.733 | 25.399 | 111.938 | 142.648 | 19.419 |
| 2016-07-15 | 74.777 | 99.949 | 28.953 | 26.554 | 114.421 | 143.808 | 18.617 |
| 2016-07-16 | 76.021 | 98.226 | 29.079 | 26.568 | 114.809 | 141.242 | 18.229 |
| 2016-08-15 | 72.741 | 93.601 | 28.419 | 26.281 | 109.739 | 142.087 | 17.645 |
| 2016-08-16 | 73.911 | 93.332 | 28.885 | 26.261 | 110.381 | 141.029 | 17.518 |
| 2016-09-01 | 75.302 | 91.356 | 28.283 | 25.522 | 112.225 | 146.877 | 19.264 |
| 2016-09-25 |  71.74 | 90.969 | 27.642 | 25.213 | 107.706 | 136.429 | 17.334 |
| 2016-10-06 | 72.265 | 92.385 | 27.772 | 24.755 | 109.093 |  140.83 | 17.707 |
| 2016-10-15 | 73.112 | 89.089 | 27.838 | 25.012 | 108.777 | 146.172 | 18.524 |
| 2016-10-16 | 73.621 | 91.963 | 27.845 |  25.04 | 108.673 | 140.896 | 17.901 |
| 2016-10-18 |  73.33 | 92.594 | 27.772 |  24.78 | 111.089 | 140.247 | 17.646 |
| 2016-10-30 | 71.873 | 92.513 | 27.792 | 24.797 | 109.791 | 139.125 | 17.834 |
| 2016-11-11 |  72.67 | 90.294 | 27.841 | 24.846 |  109.89 | 142.415 | 18.387 |
| 2016-11-23 | 73.606 | 89.261 | 27.884 | 25.083 | 110.687 | 142.906 | 18.925 |
| 2016-12-05 | 74.448 | 87.804 | 27.946 | 25.075 | 111.372 | 144.691 | 19.228 |
| 2016-12-15 | 76.375 | 84.516 | 27.982 | 25.248 | 111.264 |  146.66 | 18.929 |
| 2016-12-16 | 76.568 | 84.187 | 27.986 | 25.265 | 111.253 | 146.475 | 19.013 |
| 2016-12-17 | 75.018 | 85.798 |   28.0 | 24.894 | 112.134 | 144.782 | 19.035 |
| 2016-12-29 | 74.993 | 84.912 |  28.22 | 24.834 | 110.857 | 144.972 | 19.476 |
| 2017-01-04 | 76.227 | 84.351 | 28.453 | 24.908 | 110.621 |  147.04 | 19.615 |
| 2017-01-15 | 78.416 | 82.588 | 28.191 | 25.378 |  111.15 | 148.749 |  19.63 |
| 2017-01-16 | 78.615 | 82.428 | 28.167 | 25.421 | 111.199 | 148.102 | 19.717 |
| 2017-01-22 | 76.624 |  81.66 | 28.059 | 25.082 |  112.45 | 144.839 | 19.951 |
| 2017-01-29 | 76.881 | 80.512 |  28.08 | 25.221 | 110.722 |  145.14 | 19.616 |
| 2017-02-09 | 77.086 | 79.974 | 28.229 | 25.344 | 111.173 | 147.253 | 19.789 |
| 2017-02-14 | 78.954 | 81.699 | 28.227 | 25.531 | 111.445 | 150.277 | 19.609 |
| 2017-02-15 | 78.778 | 79.121 |  28.27 | 25.531 | 111.144 | 150.778 | 19.468 |
| 2017-02-27 | 78.506 | 81.617 |  28.26 | 25.525 | 111.179 | 146.408 | 19.815 |
| 2017-03-11 | 79.325 | 81.207 | 28.391 | 25.375 | 111.233 | 147.603 | 19.811 |
| 2017-03-15 |  78.85 | 80.094 | 28.377 | 25.757 | 109.335 | 150.451 | 20.579 |
| 2017-03-16 | 79.966 | 80.435 | 28.478 | 25.653 | 111.482 | 149.449 | 19.942 |
| 2017-03-23 | 78.181 | 79.012 | 28.541 | 25.673 | 111.676 | 148.567 | 19.964 |
| 2017-05-15 | 79.756 | 79.284 | 28.288 | 26.225 | 111.232 | 152.965 | 21.829 |
| 2017-05-16 | 80.264 | 79.812 | 28.877 | 26.298 | 114.771 |  154.38 | 21.231 |
| 2017-05-22 | 77.802 |  79.56 | 28.757 | 26.082 | 114.098 | 146.978 | 20.454 |
| 2017-06-03 | 77.748 | 78.653 | 29.158 | 26.047 | 112.729 | 146.655 | 20.507 |
| 2017-06-27 | 79.373 | 81.269 | 29.587 | 26.461 | 113.577 | 147.676 | 19.952 |
| 2017-07-09 | 78.999 | 82.476 | 29.577 | 26.672 | 115.037 | 147.347 | 19.778 |
| 2017-07-15 | 80.638 | 85.756 | 29.346 | 26.702 | 117.682 | 158.867 | 20.599 |
| 2017-07-16 | 81.567 | 85.787 | 29.592 | 26.879 | 117.518 |  157.99 | 20.873 |
| 2017-08-15 | 79.039 | 84.214 | 29.313 | 26.619 | 114.699 | 156.176 | 19.171 |
| 2017-08-16 | 79.778 | 84.471 | 29.498 | 26.589 | 115.328 | 156.652 | 19.025 |
| 2017-09-01 | 80.306 | 81.083 | 29.148 | 26.282 | 115.378 | 152.593 | 19.108 |
| 2017-10-15 | 79.078 |  83.38 | 29.069 |  25.98 |   113.6 | 158.294 |  18.96 |
| 2017-10-16 | 78.735 |  83.83 | 29.065 | 25.974 | 112.494 | 153.027 |  18.28 |
| 2017-11-18 | 77.197 | 82.253 | 29.354 | 25.761 | 113.114 | 148.579 | 18.328 |
| 2017-11-30 | 77.493 | 82.811 | 29.195 | 25.948 | 114.562 | 149.419 | 18.844 |
| 2017-12-12 |  77.73 | 81.899 | 29.054 | 26.091 | 115.295 | 149.902 | 18.969 |
| 2017-12-15 | 79.028 | 82.098 | 29.056 | 26.246 | 115.351 | 153.888 | 18.886 |
| 2017-12-16 | 79.461 | 82.165 | 29.057 | 26.297 | 115.369 | 155.219 | 18.819 |
| 2017-12-24 | 77.511 | 79.579 | 29.104 | 25.933 | 113.929 | 147.932 | 18.978 |
| 2018-01-05 |  77.57 | 79.869 | 29.133 | 26.119 | 115.367 | 149.195 | 19.332 |
| 2018-01-15 | 80.675 | 80.204 | 29.157 | 26.431 | 115.605 | 153.234 |  19.43 |
| 2018-01-16 | 80.988 | 80.238 |  29.16 | 26.462 | 115.628 |  153.39 | 19.353 |
| 2018-01-17 | 79.161 | 79.138 | 29.184 |  26.18 | 114.927 | 148.427 | 19.369 |
| 2018-01-29 |  77.68 | 78.615 | 29.174 |  26.36 | 114.844 | 147.912 | 19.402 |
| 2018-02-10 | 78.453 | 77.637 | 29.309 | 26.145 | 114.509 | 148.853 | 19.647 |
| 2018-02-14 | 80.987 | 78.053 | 29.172 | 26.497 | 114.499 | 153.111 | 19.424 |
| 2018-02-15 | 79.824 | 76.838 | 29.191 | 26.491 | 113.897 | 153.005 | 19.448 |
| 2018-02-22 | 78.558 | 75.054 | 29.333 |  26.45 | 114.169 | 147.946 | 19.272 |
| 2018-03-06 |  77.99 | 75.693 | 29.169 | 26.328 | 114.412 | 149.366 | 19.292 |
| 2018-03-15 |  79.99 | 77.352 | 29.177 | 26.362 | 111.657 | 153.518 | 19.525 |
| 2018-03-16 |  81.73 | 77.674 | 29.289 | 26.558 | 114.865 | 150.968 | 19.447 |
| 2018-03-18 | 79.334 | 75.049 | 29.106 | 26.301 | 114.324 | 147.441 | 19.664 |
| 2018-03-30 | 79.518 | 74.341 | 29.112 | 26.175 |  114.46 |  145.65 | 19.496 |
| 2018-04-11 | 80.243 | 74.281 | 29.372 | 26.354 | 114.525 |  147.64 | 19.519 |
| 2018-04-23 | 79.135 | 74.461 | 29.342 | 26.569 | 113.911 | 148.767 | 19.636 |
| 2018-05-05 | 80.541 | 74.543 | 29.255 | 26.493 | 112.338 | 147.977 | 19.577 |
| 2018-05-15 | 81.398 | 74.924 | 29.287 | 26.478 | 111.111 | 152.938 | 19.357 |
| 2018-05-16 | 83.253 | 76.476 | 29.509 | 26.978 | 116.051 | 152.134 | 19.569 |
| 2018-05-17 | 82.152 | 75.922 | 29.347 | 26.623 | 116.225 | 146.642 | 19.469 |
| 2018-05-29 | 81.235 | 74.402 | 29.444 | 26.822 | 113.112 | 146.082 | 19.636 |
| 2018-06-10 | 80.282 | 75.369 | 29.666 |  26.86 |  112.55 | 145.687 | 19.885 |
| 2018-06-22 | 80.334 | 77.135 | 29.973 |  27.64 | 113.856 | 144.279 | 19.518 |
| 2018-07-04 | 80.187 | 75.926 | 30.075 | 27.958 | 114.694 | 144.768 | 19.604 |
| 2018-07-15 | 81.878 | 77.015 | 30.125 | 28.033 | 115.133 | 152.349 | 19.288 |
| 2018-07-28 | 80.677 | 76.233 | 30.184 | 28.169 |   114.1 | 142.417 | 17.849 |
| 2018-08-09 | 78.651 | 77.491 | 30.073 | 28.295 | 114.645 | 143.455 | 17.521 |
| 2018-08-15 | 79.487 | 79.557 | 29.887 | 28.294 | 114.074 | 151.625 | 17.775 |
| 2018-08-16 | 82.266 | 79.211 | 29.888 | 28.467 | 114.484 | 151.939 | 17.917 |
| 2018-08-21 | 76.457 | 78.753 | 29.667 | 28.467 | 109.874 | 141.116 | 16.857 |
| 2018-09-02 | 75.624 |  79.52 | 29.605 | 27.784 |  109.26 | 141.125 | 16.694 |
| 2018-09-14 | 75.408 | 80.674 | 29.833 | 27.441 | 108.202 | 143.035 | 16.765 |
| 2018-09-26 | 74.747 | 80.119 | 29.779 | 27.314 | 108.076 | 142.363 | 17.575 |
| 2018-10-08 | 76.931 | 79.562 | 29.586 | 27.288 | 109.526 |  147.65 | 18.011 |
| 2018-10-15 | 80.006 | 81.208 |  29.71 | 27.479 | 110.065 | 152.025 | 18.658 |
| 2018-10-16 | 80.596 |  80.35 | 29.725 | 27.507 | 111.825 | 151.236 | 18.173 |
| 2018-10-20 | 79.005 | 80.208 |  29.67 | 27.373 | 111.649 | 150.505 | 18.125 |
| 2018-11-01 | 78.221 | 79.366 |  29.96 | 27.405 | 110.688 | 149.841 | 18.126 |
| 2018-11-13 | 78.617 | 75.644 | 29.917 | 27.253 | 110.674 | 151.844 | 18.221 |
| 2018-11-25 | 77.917 | 75.892 | 29.887 | 27.407 | 111.481 | 150.443 | 18.303 |
| 2018-12-07 | 78.084 | 74.216 | 29.922 | 27.385 | 111.876 | 150.081 | 18.611 |
| 2018-12-15 | 78.564 | 74.654 | 30.021 | 27.367 | 110.975 |  150.34 | 19.379 |
| 2018-12-19 | 78.805 | 74.873 | 30.071 | 27.358 | 110.524 | 150.378 | 18.869 |
| 2018-12-31 | 79.207 | 74.871 | 29.958 | 27.527 | 110.637 | 148.576 | 19.078 |
| 2019-01-12 | 78.895 | 73.502 | 29.995 | 27.564 | 110.386 | 148.955 | 19.396 |
| 2019-01-24 | 78.002 | 73.125 | 29.976 | 27.668 | 110.584 | 149.513 | 19.647 |
| 2019-02-05 | 77.628 | 71.778 | 29.947 | 27.559 | 109.685 | 150.464 | 19.392 |
| 2019-02-17 | 77.931 | 73.422 | 29.811 | 27.603 | 110.307 | 148.871 |  19.22 |
| 2019-03-01 | 77.121 | 72.668 | 29.826 | 27.585 | 109.985 | 148.831 | 19.494 |
| 2019-03-13 | 76.956 | 71.852 | 29.785 | 27.645 | 109.982 | 149.952 | 19.601 |
| 2019-03-25 | 76.634 | 73.112 | 29.856 | 27.647 | 109.449 | 148.401 | 19.873 |
| 2019-04-05 | 76.706 | 72.955 | 29.835 | 27.812 | 108.437 | 149.881 |  19.73 |
| 2019-04-18 | 76.117 | 73.594 | 29.843 | 27.963 | 108.586 | 151.162 | 20.217 |
| 2019-04-30 | 77.029 | 73.745 |  29.69 | 27.808 | 111.373 | 150.755 | 20.091 |
| 2019-05-12 | 77.246 | 75.428 | 29.758 | 27.822 | 108.285 | 148.705 | 20.072 |
| 2019-05-24 | 76.734 | 77.698 | 29.972 | 27.782 | 110.148 | 148.481 | 20.048 |
| 2019-06-05 | 76.522 | 79.816 | 30.232 | 28.041 |  109.11 | 148.958 | 19.854 |
| 2019-06-17 | 77.246 | 81.575 | 30.363 | 28.135 | 110.279 | 149.597 |  19.95 |
| 2019-06-29 | 76.458 | 79.422 | 30.445 | 28.099 | 109.145 | 150.628 | 19.208 |
| 2019-07-11 | 76.415 | 85.125 | 30.408 | 28.013 | 108.335 | 150.591 | 18.747 |
| 2019-07-23 | 76.571 | 77.712 | 30.297 | 27.727 | 104.681 | 150.247 | 18.266 |
| 2019-08-04 | 75.613 | 81.074 | 30.239 |  27.67 | 103.091 | 150.028 | 17.022 |
| 2019-08-16 |  74.21 | 80.523 | 29.885 | 26.861 | 101.323 | 148.118 | 16.062 |
| 2019-08-28 |  75.78 | 81.747 | 29.223 | 26.457 | 101.774 | 148.027 | 16.318 |
| 2019-09-09 | 75.997 | 81.282 | 29.019 | 25.723 | 102.058 | 148.247 | 16.538 |
| 2019-09-21 | 78.016 | 80.741 | 29.147 | 25.121 | 101.364 | 152.192 | 16.651 |
| 2019-10-03 | 78.145 | 80.448 | 29.165 | 25.252 | 102.887 | 153.196 | 17.521 |
| 2019-10-15 | 77.602 |  81.17 |  29.29 | 25.214 | 102.847 | 151.224 | 17.626 |
| 2019-10-27 | 78.834 | 79.603 | 29.421 | 25.445 | 105.565 | 154.722 | 17.793 |
| 2019-11-08 | 79.296 | 78.441 | 29.385 |  25.25 | 106.249 | 154.898 | 18.212 |
| 2019-11-20 | 79.062 | 77.967 | 29.475 | 25.593 | 105.394 | 155.904 | 18.377 |
| 2019-12-02 | 79.795 | 77.327 | 29.511 | 25.677 | 107.521 | 155.817 | 18.805 |
| 2019-12-14 | 80.507 | 76.603 | 29.546 | 25.572 | 107.188 | 155.613 | 18.878 |
| 2019-12-26 | 80.402 | 76.523 | 29.618 | 25.505 | 107.929 | 154.521 | 19.085 |
| 2020-01-07 | 80.888 | 75.686 | 29.552 | 25.639 | 108.702 | 155.423 | 19.436 |
| 2020-01-19 | 81.458 | 74.346 | 29.663 | 25.692 | 107.446 | 156.034 | 19.748 |
| 2020-01-31 | 82.256 | 74.499 | 29.688 | 25.583 | 108.221 | 156.503 | 19.759 |
| 2020-02-12 | 81.679 | 74.119 | 29.677 | 25.698 | 108.273 |  157.53 | 19.894 |
| 2020-02-24 | 81.525 | 73.617 | 29.509 | 25.689 | 108.311 | 156.365 | 19.731 |
| 2020-03-07 | 81.617 | 73.118 | 29.758 | 25.821 | 107.782 | 155.001 | 19.615 |
| 2020-03-19 |  80.76 | 73.308 | 29.703 |  25.84 | 107.365 | 157.258 | 19.722 |
| 2020-03-31 | 80.677 | 73.319 | 29.825 | 25.928 | 107.024 | 157.418 | 20.154 |
| 2020-04-12 | 81.448 | 74.171 | 29.855 | 25.969 | 108.037 | 158.242 | 20.331 |
| 2020-04-24 | 81.338 | 74.858 | 29.692 | 26.064 |  109.11 | 157.845 | 19.963 |
| 2020-05-06 | 81.838 |   75.4 | 29.702 | 26.169 | 107.208 | 156.859 | 20.157 |
| 2020-05-18 | 81.909 | 76.695 | 29.957 | 26.282 | 108.052 | 154.026 | 20.597 |
| 2020-05-30 | 80.999 | 79.851 | 30.306 | 26.317 | 106.789 | 152.137 | 20.685 |
| 2020-06-11 | 81.203 | 82.744 |  30.44 | 26.723 | 106.512 | 153.074 | 20.323 |
| 2020-06-23 | 82.153 | 85.478 | 30.576 | 26.684 | 107.063 | 150.849 | 20.005 |
| 2020-07-05 |  82.04 | 87.293 | 30.614 |  26.63 | 109.142 | 149.864 | 20.192 |
| 2020-07-17 | 80.467 | 86.494 | 30.542 | 26.538 | 108.909 | 149.163 | 19.619 |
| 2020-07-29 | 79.756 | 86.539 | 30.509 |  26.45 | 106.824 | 148.383 | 18.363 |
| 2020-08-10 |  79.84 | 87.161 | 30.405 | 26.065 | 104.486 |  148.52 | 17.579 |
| 2020-08-22 | 79.801 |  89.09 | 30.102 | 26.179 | 107.194 | 149.274 |  17.23 |
| 2020-09-03 | 78.817 | 88.046 | 29.549 | 25.477 |  104.51 | 146.105 | 17.162 |
| 2020-09-15 | 78.204 | 87.594 | 29.461 | 25.052 | 102.925 | 147.101 |  17.14 |
| 2020-09-27 | 79.781 | 88.667 | 29.579 | 25.195 | 103.937 | 149.917 |  17.48 |
| 2020-10-09 | 81.272 | 88.437 | 29.448 | 25.143 | 106.318 | 152.975 | 18.393 |
| 2020-10-21 | 81.209 | 88.687 | 29.631 | 25.328 | 108.097 | 152.499 | 19.259 |
| 2020-11-02 | 80.747 | 89.427 | 29.686 | 25.249 | 107.743 | 155.941 | 19.324 |
| 2020-11-14 | 80.417 | 88.229 | 29.603 | 25.242 | 107.324 | 153.025 | 19.701 |
| 2020-11-26 | 81.083 |  87.38 |  29.72 | 25.474 | 108.198 | 153.223 | 19.962 |
| 2020-12-08 |  81.62 |  87.92 | 29.773 | 25.368 | 108.355 | 150.797 | 20.391 |
| 2020-12-20 | 82.263 | 86.089 | 29.796 | 25.503 | 109.038 | 152.307 | 20.653 |
| 2021-01-01 | 82.157 | 87.942 | 30.028 | 25.346 | 108.541 | 154.232 | 21.057 |
| 2021-01-13 | 80.796 | 87.607 | 29.994 | 25.534 | 108.863 | 155.825 | 21.289 |
| 2021-01-25 | 81.967 | 87.958 | 29.891 | 25.501 |   108.4 | 156.728 | 21.349 |
| 2021-02-06 | 82.659 |  86.96 | 29.821 | 25.495 | 109.125 | 155.032 |  21.34 |
| 2021-02-18 | 82.683 |  88.33 | 30.135 | 25.449 | 109.313 | 156.522 | 21.248 |
| 2021-03-02 |  81.49 | 87.142 | 29.942 | 25.559 |  108.02 |  158.63 | 21.255 |
| 2021-03-14 | 80.847 | 85.772 | 29.921 | 25.703 | 109.101 | 157.008 | 21.516 |
| 2021-03-26 | 80.427 | 84.438 | 29.906 | 25.636 | 108.865 | 155.403 | 21.578 |

*** Some arbitrary glaciers
#+BEGIN_SRC bash :results table :eval no-export
FILE=./out/sector_D.csv

# GLLIST='Date|ACADEMY|SERMEQ_KUJ|BOWDOIN|BUGT|HELH|STORE|KANGER|ZACH|RINK|NIOGHALV|PETERMANN'
GLLIST='Date|JAKOBSH|HELH|STORE|ZACH' # |RINK'

# head -n1 ${FILE} \
#   | tr ',' '\n' \
#   | cat -n \
#   | grep -E ${GLLIST}

COLS=$(\
head -n1 <(cat ${FILE}) \
  | tr ',' '\n' \
  | cat -n \
  | grep -E ${GLLIST} \
  | cut -d$'\t' -f1 
)

cut -d, -f$(echo $COLS|tr ' ' ',') <(cat ${FILE})
#+END_SRC

#+RESULTS:
|       Date | HELHEIMGLETSCHER | JAKOBSHAVN_ISBRAE | STORE_GLETSCHER | ZACHARIAE_ISSTROM |
| 1986-04-15 |           29.661 |             23.13 |          11.224 |             9.203 |
| 1986-05-15 |           33.247 |            30.015 |          11.099 |             9.276 |
| 1986-06-15 |           31.413 |            29.951 |          10.878 |             9.351 |
| 1986-07-15 |           33.056 |             29.89 |          10.664 |             8.954 |
| 1986-08-15 |            31.73 |            29.826 |          10.619 |             9.829 |
| 1986-09-15 |           32.881 |            29.515 |          10.574 |            10.486 |
| 1986-10-15 |           32.982 |            29.214 |          10.531 |            10.144 |
| 1987-03-15 |           33.482 |            27.684 |          10.312 |             8.423 |
| 1987-04-15 |           33.583 |            27.368 |          10.267 |             8.069 |
| 1987-05-15 |           33.295 |            23.841 |           9.917 |             9.443 |
| 1987-06-15 |           31.651 |            25.476 |          10.217 |             8.985 |
| 1987-07-15 |           31.729 |            30.408 |          10.092 |            10.055 |
| 1987-08-15 |           33.948 |            29.454 |           9.843 |             9.921 |
| 1987-09-15 |           31.764 |            28.498 |           9.917 |             9.887 |
| 1987-10-15 |            31.76 |            27.572 |           9.989 |             9.854 |
| 1988-03-15 |           32.391 |            22.857 |          10.352 |             9.685 |
| 1988-04-15 |           32.518 |            23.334 |          10.577 |             9.651 |
| 1988-05-15 |           29.599 |             27.34 |          10.154 |             9.584 |
| 1988-06-15 |           30.437 |            27.635 |          10.134 |             9.548 |
| 1988-07-15 |           27.957 |            26.272 |          10.709 |             8.946 |
| 1988-08-15 |           29.659 |            25.932 |          10.245 |             7.927 |
| 1988-09-15 |           30.545 |            25.592 |           9.782 |             8.918 |
| 1988-10-15 |           27.134 |            25.262 |           9.827 |             9.132 |
| 1989-03-15 |             27.3 |            23.593 |          10.054 |            10.205 |
| 1989-04-15 |           27.333 |            23.931 |          10.008 |             8.551 |
| 1989-05-15 |           29.533 |            24.061 |          10.041 |             9.948 |
| 1989-06-15 |           28.758 |            25.772 |          10.181 |             9.474 |
| 1989-07-15 |           27.728 |            25.929 |          10.714 |             9.877 |
| 1989-08-15 |           27.229 |            31.401 |          10.205 |             9.787 |
| 1989-09-15 |           26.411 |            30.837 |          10.471 |             9.768 |
| 1989-10-15 |           26.704 |            30.077 |          10.479 |             9.749 |
| 1990-03-15 |           28.161 |            26.236 |          10.516 |             9.655 |
| 1990-04-15 |           28.095 |            24.389 |          10.267 |             9.031 |
| 1990-05-15 |           26.519 |            22.356 |           9.936 |            11.171 |
| 1990-06-15 |           27.102 |            27.876 |           10.56 |             9.697 |
| 1990-07-15 |           26.555 |            26.783 |           10.38 |             9.388 |
| 1990-08-15 |           26.464 |            25.601 |          10.193 |              9.72 |
| 1990-09-15 |           25.875 |            24.769 |          10.006 |             9.691 |
| 1990-10-15 |           26.651 |            24.582 |           9.991 |             9.662 |
| 1991-01-01 |           25.823 |            24.094 |           9.951 |             9.587 |
| 1991-06-15 |           27.249 |            23.047 |           9.867 |              9.43 |
| 1992-01-01 |           28.935 |            21.755 |           9.766 |             9.238 |
| 1992-06-15 |           30.299 |            22.551 |           9.682 |             9.337 |
| 1992-07-15 |           30.542 |            22.696 |           9.666 |             9.354 |
| 1992-08-15 |           30.792 |            22.845 |           9.651 |             9.373 |
| 1992-09-15 |           31.041 |            22.995 |           9.635 |             9.391 |
| 1992-10-15 |           31.281 |            23.141 |            9.62 |             9.409 |
| 1993-01-01 |             31.9 |             23.52 |           9.581 |             9.455 |
| 1993-03-15 |           32.472 |            23.796 |            9.59 |             9.498 |
| 1993-04-15 |           32.713 |            23.914 |           9.594 |             9.517 |
| 1993-05-15 |           32.945 |            24.028 |           9.598 |             9.535 |
| 1993-06-15 |           33.184 |            24.146 |           9.602 |             9.553 |
| 1993-07-15 |           33.414 |             24.26 |           9.606 |             9.571 |
| 1993-08-15 |            33.65 |            24.379 |            9.61 |             9.589 |
| 1993-09-15 |           33.886 |            24.498 |           9.614 |             9.608 |
| 1994-01-01 |           34.697 |            24.914 |           9.627 |             9.672 |
| 1994-05-15 |           35.796 |            26.035 |           9.821 |             10.23 |
| 1994-06-15 |           36.048 |            26.296 |           9.932 |            11.408 |
| 1994-07-15 |           36.292 |            39.294 |           8.914 |             10.74 |
| 1994-08-15 |           36.543 |            33.529 |           8.588 |            10.166 |
| 1994-09-15 |           36.793 |            18.052 |           8.669 |            10.014 |
| 1995-01-01 |           31.934 |            22.551 |           8.581 |             9.484 |
| 1995-04-15 |           29.462 |            23.297 |           8.695 |             9.335 |
| 1995-05-15 |           28.755 |            23.513 |           8.729 |             9.292 |
| 1995-06-15 |           28.029 |            23.738 |           8.763 |             9.247 |
| 1995-07-15 |           27.328 |            23.956 |           8.796 |             9.204 |
| 1995-08-15 |           26.608 |            24.183 |            8.83 |             9.159 |
| 1995-09-15 |            25.89 |             24.41 |           8.863 |             9.115 |
| 1995-10-15 |           25.199 |             24.63 |           8.896 |             9.071 |
| 1996-01-01 |           23.416 |            25.207 |           8.981 |             8.959 |
| 1996-04-15 |            23.46 |            25.478 |           8.664 |             9.213 |
| 1996-05-15 |           23.472 |            25.556 |           8.574 |             9.285 |
| 1996-06-15 |           23.484 |            25.636 |            8.48 |              9.36 |
| 1996-07-15 |           23.495 |            25.714 |            8.39 |             9.433 |
| 1996-08-15 |           23.507 |            25.794 |           8.297 |             9.508 |
| 1996-09-15 |           23.518 |            25.875 |           8.204 |             9.583 |
| 1996-10-15 |           23.528 |            25.953 |           8.115 |             9.656 |
| 1997-01-01 |           23.553 |            26.156 |           7.882 |             9.844 |
| 1997-03-15 |           23.371 |            26.374 |           8.243 |             9.781 |
| 1997-04-15 |           23.294 |            26.467 |           8.397 |             9.754 |
| 1997-05-15 |           23.219 |            26.557 |           8.545 |             9.728 |
| 1997-06-15 |           23.142 |             26.65 |           8.698 |             9.702 |
| 1997-07-15 |           23.068 |             26.74 |           8.846 |             9.676 |
| 1997-09-15 |           22.914 |            26.927 |           9.152 |             9.622 |
| 1997-10-15 |            22.84 |            27.017 |             9.3 |             9.596 |
| 1998-01-01 |           22.648 |            27.253 |           9.684 |             9.528 |
| 1998-03-15 |           22.566 |            29.514 |          10.062 |             8.635 |
| 1998-04-15 |            23.63 |            30.475 |          10.222 |             8.255 |
| 1998-05-15 |           24.554 |            29.457 |          10.175 |             8.221 |
| 1998-06-15 |           22.766 |            31.527 |          10.246 |            10.303 |
| 1998-07-15 |           24.154 |            33.136 |          10.084 |            10.574 |
| 1998-08-15 |            23.51 |            33.456 |          10.093 |            10.693 |
| 1998-09-15 |           22.979 |            33.468 |          10.121 |             8.731 |
| 1998-10-15 |            22.93 |            33.089 |          10.127 |             8.923 |
| 1999-01-01 |           23.407 |            32.105 |          10.141 |             9.421 |
| 1999-07-15 |           24.436 |            33.512 |           9.619 |             9.923 |
| 1999-08-15 |             24.6 |            33.736 |            10.0 |             9.288 |
| 1999-09-15 |           24.612 |             33.96 |          10.346 |             8.707 |
| 1999-10-15 |           24.624 |            31.953 |           10.04 |             8.796 |
| 1999-11-15 |           24.363 |            32.727 |          10.075 |             8.887 |
| 1999-12-15 |           24.111 |            33.476 |           10.11 |             8.975 |
| 2000-01-01 |           23.968 |            33.901 |           10.13 |             9.025 |
| 2000-02-15 |           23.436 |            33.385 |          10.182 |             9.341 |
| 2000-03-15 |           23.093 |            33.053 |           10.23 |             9.545 |
| 2000-04-15 |           24.356 |            34.873 |          10.037 |             9.763 |
| 2000-05-15 |           22.794 |            34.955 |           10.36 |             9.974 |
| 2000-06-15 |           23.543 |            36.102 |          10.557 |            10.192 |
| 2000-07-15 |            25.14 |            37.823 |           9.686 |             9.314 |
| 2000-08-15 |           23.524 |             38.03 |           9.789 |             9.771 |
| 2000-09-03 |           23.198 |            37.068 |           9.641 |             9.829 |
| 2000-09-15 |           24.142 |            37.315 |           9.639 |             9.554 |
| 2000-10-15 |           24.022 |            36.894 |           9.749 |             9.656 |
| 2000-11-15 |           23.898 |            36.819 |           9.863 |             9.762 |
| 2001-03-15 |           23.378 |            36.522 |          10.296 |            10.171 |
| 2001-04-15 |           24.186 |            36.444 |          10.177 |            10.276 |
| 2001-05-15 |           22.827 |            35.486 |           9.947 |            10.378 |
| 2001-06-15 |           23.798 |            38.056 |          10.409 |            10.484 |
| 2001-07-15 |           25.164 |            39.468 |           9.725 |            10.898 |
| 2001-08-15 |           24.544 |            37.565 |           9.849 |            11.325 |
| 2001-09-15 |           23.926 |            38.449 |           9.656 |            11.752 |
| 2001-10-15 |           23.327 |            36.635 |            9.47 |            12.166 |
| 2001-11-15 |           23.793 |            36.469 |           9.566 |            12.593 |
| 2002-01-15 |           24.716 |            36.123 |           9.757 |            13.433 |
| 2002-02-15 |           25.199 |            35.914 |           9.858 |            13.858 |
| 2002-03-15 |           25.635 |            35.725 |           9.949 |            14.242 |
| 2002-04-15 |           26.118 |            37.023 |          10.588 |            14.667 |
| 2002-05-15 |           27.022 |            39.515 |           9.795 |            15.079 |
| 2002-06-15 |           28.056 |            41.521 |          10.557 |            15.504 |
| 2002-07-15 |           28.096 |            40.903 |           9.456 |            15.132 |
| 2002-08-15 |           29.301 |            38.087 |           9.155 |            14.747 |
| 2002-09-15 |           29.347 |            38.844 |           9.401 |            14.363 |
| 2002-10-15 |           29.393 |            39.016 |           9.639 |            13.991 |
| 2003-02-15 |           29.587 |            39.714 |           10.62 |            12.467 |
| 2003-03-15 |           29.634 |             39.87 |          10.845 |             12.12 |
| 2003-04-15 |           29.687 |            41.535 |          10.177 |            11.735 |
| 2003-05-15 |           27.956 |            41.589 |          10.361 |            11.364 |
| 2003-06-15 |           28.795 |             41.49 |            10.2 |             10.98 |
| 2003-07-15 |           30.386 |            41.395 |          10.192 |            10.608 |
| 2003-08-15 |           31.339 |            41.296 |          10.183 |            10.668 |
| 2003-09-15 |           31.026 |            41.198 |          10.174 |            10.728 |
| 2003-10-15 |           30.797 |            41.413 |          10.166 |            10.786 |
| 2004-03-15 |           29.578 |            42.484 |          10.119 |            11.077 |
| 2004-04-15 |           29.317 |            39.776 |          10.372 |            11.136 |
| 2004-05-15 |           29.943 |            41.698 |           10.06 |            11.192 |
| 2004-06-15 |           31.468 |            43.641 |           8.399 |            11.251 |
| 2004-07-15 |           31.443 |            44.243 |           8.105 |             10.69 |
| 2004-08-15 |           32.563 |            43.045 |           8.785 |            10.831 |
| 2004-09-15 |           34.394 |            44.008 |           8.651 |            10.972 |
| 2004-10-15 |           34.321 |            43.724 |           8.855 |            11.108 |
| 2005-03-15 |           34.033 |            42.316 |           9.884 |            11.793 |
| 2005-04-15 |            33.99 |            42.031 |          10.096 |            11.934 |
| 2005-05-15 |           34.593 |            41.701 |           9.418 |             12.07 |
| 2005-06-15 |           34.594 |            43.363 |           9.899 |             12.21 |
| 2005-07-15 |           34.615 |            46.023 |           8.806 |            12.256 |
| 2005-08-15 |           34.412 |            44.754 |           8.386 |            11.908 |
| 2005-09-15 |           33.902 |            44.449 |           8.436 |             11.56 |
| 2005-10-15 |           33.127 |            43.878 |           8.559 |            11.224 |
| 2005-12-13 |             31.6 |            42.758 |           8.803 |            10.563 |
| 2006-03-15 |           30.302 |            41.721 |           9.211 |            11.217 |
| 2006-04-15 |            30.37 |            42.987 |           9.476 |            11.438 |
| 2006-05-15 |           28.344 |            42.206 |           9.435 |            11.651 |
| 2006-06-15 |           29.022 |            45.741 |            8.81 |            11.871 |
| 2006-07-15 |           28.678 |            47.765 |           9.736 |            12.175 |
| 2006-08-15 |           28.176 |            48.889 |           9.164 |            12.125 |
| 2006-09-15 |           27.255 |            47.577 |           8.649 |            11.864 |
| 2006-10-15 |            26.94 |            46.312 |           8.911 |            11.612 |
| 2006-11-15 |           26.615 |            45.007 |           9.181 |            11.352 |
| 2006-12-18 |            26.27 |            43.623 |            9.47 |            11.075 |
| 2007-03-15 |           29.276 |            42.178 |           9.815 |            11.415 |
| 2007-04-15 |           28.584 |            40.615 |           9.705 |            11.734 |
| 2007-05-15 |           27.915 |            43.178 |           9.566 |            12.043 |
| 2007-06-15 |           27.223 |            46.117 |            9.09 |            12.362 |
| 2007-07-15 |           28.925 |            48.394 |           9.123 |            11.879 |
| 2007-08-15 |           31.493 |            47.049 |           8.679 |            10.034 |
| 2007-09-07 |           30.787 |            43.498 |           9.393 |             11.44 |
| 2007-09-15 |           30.541 |            47.662 |           9.004 |            11.472 |
| 2007-10-15 |           30.723 |            46.815 |           9.075 |            11.591 |
| 2008-03-15 |           27.378 |            42.569 |           9.434 |            12.187 |
| 2008-04-15 |           26.892 |            41.711 |           9.507 |            12.307 |
| 2008-05-15 |            27.39 |            40.883 |           9.578 |            12.423 |
| 2008-06-15 |            25.54 |            45.025 |           9.465 |            12.543 |
| 2008-07-15 |             26.3 |            49.647 |           9.596 |            13.067 |
| 2008-08-15 |           25.539 |            50.641 |           9.521 |             12.97 |
| 2008-10-15 |           26.719 |             47.99 |           9.616 |            12.782 |
| 2008-11-15 |           27.318 |            46.644 |           9.664 |            12.686 |
| 2009-01-15 |           28.497 |            44.001 |           9.759 |            12.497 |
| 2009-02-15 |           29.097 |            42.658 |           9.807 |            12.401 |
| 2009-03-15 |           29.639 |            41.446 |           9.851 |            12.315 |
| 2009-04-15 |           30.238 |            41.816 |           9.852 |            12.219 |
| 2009-05-15 |           30.818 |            42.275 |          10.199 |            12.126 |
| 2009-06-15 |           31.417 |             48.37 |          10.125 |            12.031 |
| 2009-07-15 |           29.444 |             52.44 |           9.951 |            12.132 |
| 2009-08-15 |           28.298 |            49.113 |           9.447 |            10.774 |
| 2009-09-02 |           27.855 |            44.463 |           9.651 |            11.763 |
| 2009-09-15 |           28.574 |            49.244 |           9.568 |            11.766 |
| 2009-10-15 |           28.431 |            49.048 |           9.647 |            11.774 |
| 2010-03-15 |           27.706 |            48.076 |           10.05 |            11.822 |
| 2010-04-15 |           27.558 |            47.879 |          10.133 |            11.833 |
| 2010-05-15 |           26.955 |            47.726 |          10.268 |            11.844 |
| 2010-06-15 |           28.882 |            51.703 |            9.41 |            11.856 |
| 2010-07-15 |            26.98 |            49.305 |           8.485 |            11.789 |
| 2010-08-15 |           30.357 |            45.608 |           9.031 |            11.901 |
| 2010-09-15 |           29.965 |             44.01 |           9.007 |            12.012 |
| 2010-10-15 |           29.775 |            43.311 |           9.098 |             12.12 |
| 2011-03-15 |           28.815 |            39.742 |           9.554 |            12.654 |
| 2011-04-15 |            27.85 |            40.972 |           9.647 |            12.761 |
| 2011-05-15 |           26.916 |            40.523 |            9.56 |            12.866 |
| 2011-06-15 |           26.046 |            42.991 |           9.824 |            12.973 |
| 2011-07-15 |           27.802 |            45.514 |            9.06 |            13.138 |
| 2011-08-15 |             27.5 |            51.014 |           8.068 |             12.47 |
| 2011-09-15 |           26.508 |            52.651 |           8.377 |            12.597 |
| 2011-10-15 |           26.153 |            51.087 |           8.324 |            12.721 |
| 2012-01-15 |           26.264 |             46.33 |           8.164 |              13.1 |
| 2012-03-15 |           26.336 |            43.303 |           8.062 |            13.352 |
| 2012-04-15 |           26.373 |            41.741 |            8.01 |            13.482 |
| 2012-05-15 |           27.042 |            46.433 |           9.006 |            13.608 |
| 2012-06-15 |           27.087 |            55.211 |            9.33 |            13.738 |
| 2012-07-15 |           25.959 |            52.115 |             8.4 |            13.385 |
| 2012-08-15 |            26.79 |            52.924 |           8.039 |            11.775 |
| 2012-09-15 |           26.657 |            53.492 |           8.169 |            12.099 |
| 2012-10-15 |           25.898 |            53.106 |           8.551 |            12.413 |
| 2012-11-10 |           25.241 |            52.771 |           8.883 |            12.684 |
| 2013-02-15 |           26.056 |            50.581 |           9.341 |            12.647 |
| 2013-03-15 |            26.29 |            49.949 |           9.473 |            12.638 |
| 2013-04-15 |           25.649 |            48.328 |           9.581 |            12.626 |
| 2013-05-15 |           25.024 |            46.753 |           8.948 |            13.307 |
| 2013-06-15 |           27.493 |            48.627 |           9.145 |            13.599 |
| 2013-07-15 |            27.31 |             47.84 |           8.567 |            13.542 |
| 2013-08-15 |           27.857 |            52.081 |            9.71 |            12.388 |
| 2013-09-15 |           27.587 |            55.098 |           9.594 |            12.817 |
| 2013-10-15 |           27.391 |            55.746 |           9.148 |            12.959 |
| 2013-11-15 |           26.884 |            53.928 |           9.334 |            13.107 |
| 2013-12-15 |           26.395 |            52.171 |           9.513 |            13.249 |
| 2014-01-15 |           25.885 |            50.357 |           9.699 |            13.395 |
| 2014-02-15 |           25.372 |            48.546 |           9.884 |             13.54 |
| 2014-03-15 |           25.787 |             47.47 |           9.648 |            13.671 |
| 2014-04-15 |           24.635 |            43.306 |           9.586 |            13.852 |
| 2014-05-15 |            24.71 |            48.309 |           9.445 |            13.724 |
| 2014-06-15 |           25.039 |             53.65 |           9.823 |            14.084 |
| 2014-07-15 |           25.492 |            55.452 |           8.702 |            14.401 |
| 2014-08-15 |           25.273 |             53.76 |           8.479 |            13.993 |
| 2014-09-01 |           25.868 |            47.117 |            9.25 |             14.42 |
| 2014-09-15 |            26.46 |            43.988 |           8.669 |            13.277 |
| 2014-10-15 |           27.047 |            54.889 |           9.139 |            13.513 |
| 2014-11-15 |            27.32 |            53.607 |           9.306 |            13.757 |
| 2014-12-15 |           25.712 |            52.366 |           9.468 |            13.992 |
| 2014-12-16 |           25.659 |            52.325 |           9.474 |              14.0 |
| 2015-01-15 |           25.296 |             50.36 |           9.543 |            14.233 |
| 2015-01-16 |           25.284 |            50.295 |           9.545 |            14.241 |
| 2015-02-14 |           26.903 |             48.41 |           9.578 |            14.417 |
| 2015-02-15 |           27.177 |            46.574 |           9.358 |            14.412 |
| 2015-03-15 |           27.258 |             45.54 |           9.422 |            14.271 |
| 2015-03-16 |           27.288 |            46.861 |           9.631 |            14.192 |
| 2015-05-15 |           29.067 |             43.51 |           9.396 |            14.693 |
| 2015-05-16 |           29.028 |            42.785 |           9.566 |            14.863 |
| 2015-07-15 |           30.509 |            52.652 |           9.773 |            14.789 |
| 2015-07-16 |           29.987 |            52.841 |           9.577 |            14.912 |
| 2015-08-15 |            30.76 |            49.946 |           9.338 |            14.183 |
| 2015-08-16 |           30.499 |            50.254 |           9.359 |            14.652 |
| 2015-09-01 |            27.72 |            51.623 |           9.413 |            14.481 |
| 2015-10-15 |           30.311 |            50.044 |           9.538 |            14.133 |
| 2015-10-16 |            29.84 |            54.849 |            9.43 |            14.125 |
| 2015-12-15 |           28.424 |            51.924 |           9.571 |            14.406 |
| 2015-12-16 |           28.401 |            51.875 |           9.573 |            14.411 |
| 2016-01-15 |           27.719 |             48.69 |           9.641 |            14.521 |
| 2016-01-16 |           27.696 |            48.584 |           9.643 |            14.525 |
| 2016-03-15 |            25.95 |            47.261 |           9.293 |            14.408 |
| 2016-03-16 |           26.005 |            48.924 |           9.616 |            14.765 |
| 2016-05-15 |           26.545 |            51.232 |           9.504 |            14.784 |
| 2016-05-16 |           26.323 |            52.044 |           9.579 |             14.87 |
| 2016-07-15 |           26.363 |            56.828 |           9.448 |             15.01 |
| 2016-07-16 |           25.973 |            55.564 |           9.144 |            15.025 |
| 2016-08-15 |           25.752 |            52.384 |           9.037 |            14.734 |
| 2016-08-16 |           25.768 |            52.012 |           8.932 |            14.874 |
| 2016-09-01 |           28.608 |            48.288 |           8.923 |            14.562 |
| 2016-09-25 |           26.923 |            49.269 |           9.068 |            14.124 |
| 2016-10-06 |           27.741 |            49.845 |           9.025 |            14.145 |
| 2016-10-15 |           29.411 |             46.96 |           9.027 |            14.186 |
| 2016-10-16 |           27.911 |            49.886 |           9.027 |            14.191 |
| 2016-10-18 |           27.642 |            50.123 |           9.017 |            14.121 |
| 2016-10-30 |           29.399 |            49.113 |           9.334 |            14.216 |
| 2016-11-11 |           30.908 |            47.196 |           8.827 |            14.238 |
| 2016-11-23 |           31.187 |            45.861 |           8.795 |            14.297 |
| 2016-12-05 |           30.388 |            44.795 |           8.707 |            14.313 |
| 2016-12-15 |           29.083 |            41.768 |            8.68 |             14.36 |
| 2016-12-16 |           28.953 |            41.465 |           8.678 |            14.365 |
| 2016-12-17 |           30.385 |            43.165 |           8.562 |             14.37 |
| 2016-12-29 |           30.022 |            42.335 |            8.68 |            14.628 |
| 2017-01-04 |           30.122 |            41.401 |           8.882 |            14.781 |
| 2017-01-15 |           29.755 |            39.835 |           8.853 |            14.508 |
| 2017-01-16 |           29.721 |            39.693 |            8.85 |            14.483 |
| 2017-01-22 |           28.712 |            38.235 |           9.004 |            14.358 |
| 2017-01-29 |            30.75 |            37.407 |           9.031 |            14.401 |
| 2017-02-09 |           30.755 |            36.949 |           9.078 |             14.52 |
| 2017-02-14 |           29.571 |            38.532 |           9.269 |            14.492 |
| 2017-02-15 |           29.631 |            36.346 |           9.271 |            14.495 |
| 2017-02-27 |           29.422 |            38.765 |           9.139 |            14.531 |
| 2017-03-11 |           30.262 |            38.042 |           9.298 |            14.621 |
| 2017-03-15 |           29.348 |            37.085 |           9.256 |            14.678 |
| 2017-03-16 |           28.953 |            37.335 |           9.031 |            14.709 |
| 2017-03-23 |           31.117 |            35.951 |           8.994 |            14.674 |
| 2017-05-15 |           30.078 |            36.221 |           9.257 |            14.452 |
| 2017-05-16 |           30.151 |            36.455 |           9.218 |            14.996 |
| 2017-05-22 |           29.413 |            36.241 |           9.171 |            14.953 |
| 2017-06-03 |           29.401 |            35.446 |           9.235 |            15.122 |
| 2017-06-27 |           30.675 |            37.797 |           9.282 |            15.363 |
| 2017-07-09 |            30.39 |             39.32 |           9.292 |            15.386 |
| 2017-07-15 |           32.993 |            42.096 |           9.484 |            15.359 |
| 2017-07-16 |           32.658 |            42.034 |           9.335 |            15.456 |
| 2017-08-15 |           32.768 |            41.441 |            9.18 |            15.377 |
| 2017-08-16 |           33.355 |            41.713 |           9.154 |            15.368 |
| 2017-09-01 |           29.767 |            38.172 |           9.214 |             15.25 |
| 2017-10-15 |           33.135 |            41.138 |           9.103 |             15.15 |
| 2017-10-16 |           33.067 |             41.01 |             9.1 |            15.148 |
| 2017-11-18 |           33.069 |            38.695 |           9.322 |            15.415 |
| 2017-11-30 |           32.797 |            39.072 |           9.532 |            15.299 |
| 2017-12-12 |           32.391 |            38.021 |           9.392 |            15.205 |
| 2017-12-15 |           32.066 |            38.598 |           9.422 |            15.247 |
| 2017-12-16 |           31.958 |             38.79 |           9.431 |            15.261 |
| 2017-12-24 |           31.641 |            36.167 |           9.432 |            15.212 |
| 2018-01-05 |           30.833 |            36.713 |           9.235 |            15.248 |
| 2018-01-15 |           30.439 |            36.965 |           9.203 |            15.254 |
| 2018-01-16 |             30.4 |             36.99 |             9.2 |            15.255 |
| 2018-01-17 |           30.776 |            36.005 |            9.25 |            15.229 |
| 2018-01-29 |           29.293 |            35.364 |           9.337 |             15.24 |
| 2018-02-10 |           29.752 |            34.551 |            9.28 |            15.328 |
| 2018-02-14 |           29.787 |             35.25 |           9.133 |            15.288 |
| 2018-02-15 |           29.898 |            34.436 |           9.102 |            15.301 |
| 2018-02-22 |           30.652 |            32.443 |           9.096 |            15.397 |
| 2018-03-06 |           30.591 |            33.508 |           8.803 |            15.292 |
| 2018-03-15 |            29.51 |            34.676 |           9.366 |            15.267 |
| 2018-03-16 |            29.39 |            34.882 |           9.146 |             15.33 |
| 2018-03-18 |           30.506 |              32.5 |           9.242 |            15.252 |
| 2018-03-30 |           29.701 |            32.366 |            8.98 |            15.209 |
| 2018-04-11 |           30.067 |            32.113 |           9.073 |            15.363 |
| 2018-04-23 |           30.007 |            32.161 |           9.263 |            15.346 |
| 2018-05-05 |           30.293 |            32.363 |           9.297 |             15.36 |
| 2018-05-15 |           28.666 |            32.754 |           9.302 |            15.422 |
| 2018-05-16 |           28.541 |            33.754 |           9.326 |              15.4 |
| 2018-05-17 |           27.321 |            33.011 |           9.336 |            15.358 |
| 2018-05-29 |            27.02 |            32.272 |           9.248 |            15.419 |
| 2018-06-10 |           27.252 |             32.42 |           9.342 |             15.55 |
| 2018-06-22 |           26.872 |            33.785 |           9.385 |            15.623 |
| 2018-07-04 |           26.752 |            32.776 |           9.273 |            15.648 |
| 2018-07-15 |           28.619 |            34.377 |           9.294 |            15.686 |
| 2018-07-28 |           26.659 |            34.331 |           8.607 |             15.73 |
| 2018-08-09 |           27.585 |            35.698 |            8.43 |            15.601 |
| 2018-08-15 |           28.319 |            38.767 |           8.459 |            15.495 |
| 2018-08-16 |           28.582 |            37.724 |           8.452 |            15.478 |
| 2018-08-21 |           27.078 |            38.307 |           8.308 |             15.39 |
| 2018-09-02 |           27.554 |            38.887 |           8.362 |            15.381 |
| 2018-09-14 |           28.114 |            38.998 |           8.751 |             15.41 |
| 2018-09-26 |           28.198 |            38.551 |           8.979 |            15.431 |
| 2018-10-08 |           30.965 |            37.747 |           9.034 |            15.521 |
| 2018-10-15 |           29.159 |            39.481 |           9.083 |            15.488 |
| 2018-10-16 |           29.867 |            38.449 |           9.111 |            15.484 |
| 2018-10-20 |           31.832 |            37.838 |           9.036 |            15.484 |
| 2018-11-01 |           32.189 |            37.172 |           9.154 |            15.629 |
| 2018-11-13 |           32.023 |            33.688 |           9.121 |            15.578 |
| 2018-11-25 |           31.096 |            33.728 |           9.118 |            15.588 |
| 2018-12-07 |           30.878 |            32.414 |           9.024 |            15.626 |
| 2018-12-15 |           30.942 |            32.606 |           9.096 |            15.675 |
| 2018-12-19 |           30.974 |            32.703 |           9.133 |              15.7 |
| 2018-12-31 |           27.974 |            32.213 |           9.308 |            15.735 |
| 2019-01-12 |            28.75 |            31.426 |            9.31 |            15.644 |
| 2019-01-24 |           29.763 |            31.061 |           9.542 |            15.625 |
| 2019-02-05 |           30.997 |            30.059 |           9.384 |            15.665 |
| 2019-02-17 |            30.19 |            31.257 |           9.467 |            15.524 |
| 2019-03-01 |           30.709 |             30.99 |           9.403 |            15.477 |
| 2019-03-13 |            31.48 |            30.435 |            9.45 |            15.447 |
| 2019-03-25 |           31.097 |            31.271 |            9.48 |            15.528 |
| 2019-04-05 |           31.101 |            31.072 |           9.409 |            15.539 |
| 2019-04-18 |           31.639 |            31.814 |           9.506 |            15.483 |
| 2019-04-30 |           30.824 |            31.446 |           9.398 |            15.388 |
| 2019-05-12 |           29.297 |            32.884 |           9.482 |            15.446 |
| 2019-05-24 |           28.897 |            34.703 |           9.671 |            15.544 |
| 2019-06-05 |           29.477 |            36.976 |           9.777 |            15.702 |
| 2019-06-17 |           30.056 |              39.3 |           9.579 |            15.813 |
| 2019-06-29 |            30.69 |            37.773 |           9.377 |            15.877 |
| 2019-07-11 |           31.234 |             42.93 |           9.485 |            15.919 |
| 2019-07-23 |           31.967 |            36.064 |           9.314 |            15.881 |
| 2019-08-04 |           31.428 |            40.133 |           9.109 |            15.841 |
| 2019-08-16 |           31.407 |            40.657 |           8.921 |            15.622 |
| 2019-08-28 |           32.446 |            41.637 |           8.724 |            15.118 |
| 2019-09-09 |           32.562 |            41.064 |           8.598 |            14.976 |
| 2019-09-21 |           32.772 |            40.773 |           8.483 |            15.098 |
| 2019-10-03 |           33.041 |            40.033 |           8.454 |             15.08 |
| 2019-10-15 |           33.823 |            40.277 |           8.623 |            15.242 |
| 2019-10-27 |           34.724 |             38.59 |           8.643 |            15.338 |
| 2019-11-08 |           34.352 |             37.24 |           8.723 |            15.362 |
| 2019-11-20 |           34.048 |            36.666 |           8.714 |            15.379 |
| 2019-12-02 |           33.338 |            35.841 |           8.906 |            15.499 |
| 2019-12-14 |           32.555 |            34.557 |           9.041 |            15.491 |
| 2019-12-26 |           30.332 |            34.091 |           9.142 |            15.513 |
| 2020-01-07 |           32.838 |            33.229 |            9.09 |            15.527 |
| 2020-01-19 |           33.541 |             32.18 |           9.347 |            15.576 |
| 2020-01-31 |           33.298 |            32.125 |           9.345 |            15.618 |
| 2020-02-12 |           33.429 |            31.798 |           9.537 |            15.615 |
| 2020-02-24 |           32.852 |            31.402 |           9.604 |            15.533 |
| 2020-03-07 |           32.637 |            31.181 |           9.503 |            15.685 |
| 2020-03-19 |           32.634 |            31.301 |           9.602 |            15.629 |
| 2020-03-31 |           31.931 |             31.34 |           9.487 |            15.758 |
| 2020-04-12 |           32.683 |            32.061 |           9.495 |            15.797 |
| 2020-04-24 |           32.217 |            32.641 |            9.54 |            15.773 |
| 2020-05-06 |           31.315 |            33.005 |           9.369 |            15.767 |
| 2020-05-18 |           28.787 |            34.168 |           9.423 |            15.922 |
| 2020-05-30 |           28.905 |            37.327 |            9.53 |            16.077 |
| 2020-06-11 |           29.333 |            39.795 |            9.58 |            16.169 |
| 2020-06-23 |            28.79 |            42.214 |           9.558 |            16.154 |
| 2020-07-05 |           28.481 |             44.21 |           9.575 |            16.137 |
| 2020-07-17 |           28.537 |            43.558 |            9.54 |            16.099 |
| 2020-07-29 |           28.812 |            44.143 |           9.575 |            16.069 |
| 2020-08-10 |           29.147 |            45.355 |           9.414 |            15.966 |
| 2020-08-22 |           28.258 |            46.997 |            9.49 |            15.773 |
| 2020-09-03 |           28.243 |            45.876 |           9.449 |            15.449 |
| 2020-09-15 |           28.757 |            45.284 |           9.483 |            15.443 |
| 2020-09-27 |           29.398 |            46.263 |           9.548 |            15.577 |
| 2020-10-09 |           29.955 |            46.079 |           9.554 |            15.325 |
| 2020-10-21 |           29.515 |            46.024 |           9.512 |            15.482 |
| 2020-11-02 |           32.173 |            46.461 |           9.501 |            15.627 |
| 2020-11-14 |           31.049 |            45.239 |           9.583 |            15.578 |
| 2020-11-26 |            30.99 |            44.603 |           9.632 |            15.691 |
| 2020-12-08 |           28.709 |            44.849 |           9.575 |            15.768 |
| 2020-12-20 |           28.685 |            43.121 |           9.608 |            15.735 |
| 2021-01-01 |           31.936 |            44.979 |           9.753 |            15.919 |
| 2021-01-13 |           30.857 |            44.544 |           9.662 |            15.887 |
| 2021-01-25 |           31.421 |            45.228 |           9.687 |            15.801 |
| 2021-02-06 |           31.043 |            43.793 |           9.711 |            15.729 |
| 2021-02-18 |           31.438 |            44.827 |           9.872 |            15.953 |
| 2021-03-02 |           31.286 |            44.077 |           9.782 |            15.897 |
| 2021-03-14 |           30.848 |            42.845 |           9.794 |            15.832 |
| 2021-03-26 |           31.347 |            41.244 |           9.788 |            15.883 |


* Meta                                                  :noexport:

This document probably uses code - python, octave, and/or R. Below I provide the version of the software(s) used to create this document in order to support the goal of reproducibility. 

*** Os installed
#+BEGIN_SRC bash :results table :eval no-export :exports results
for tool in gdal-bin parallel sed netcdf-bin proj-bin nco bash grass-core; do dpkg -l | grep "ii  ${tool} " | sed 's/\ \ */\ /g' | cut -d" " -f2,3; done| sort
#+END_SRC

#+RESULTS:
| bash       |     5.0-6ubuntu1.1 |
| gdal-bin   | 3.0.4+dfsg-1build3 |
| grass-core |      7.8.2-1build3 |
| nco        |      4.9.1-1build2 |
| netcdf-bin |          1:4.7.3-1 |
| parallel   |       20161222-1.1 |
| proj-bin   |            6.3.1-1 |
| sed        |              4.7-1 |

*** Org Mode
#+BEGIN_SRC elisp :exports both :eval no-export
(org-version nil t)
#+END_SRC

#+RESULTS:
: Org mode version 9.4.5 (9.4.5-16-g94be20-elpa @ /home/kdm/.emacs.d/elpa/org-20210412/)

*** Python
#+BEGIN_SRC bash :cmdline -i :results verbatim :exports both :eval no-export
. /home/kdm/local/miniconda3/etc/profile.d/conda.sh
conda env export --name ice_discharge | tee environment.yml
#+END_SRC

#+RESULTS:
#+begin_example
name: ice_discharge
channels:
  - conda-forge
  - defaults
dependencies:
  - _libgcc_mutex=0.1=conda_forge
  - _openmp_mutex=4.5=1_llvm
  - attrs=19.3.0=py_0
  - backcall=0.1.0=py_0
  - bleach=3.1.4=pyh9f0ad1d_0
  - bzip2=1.0.8=h516909a_2
  - ca-certificates=2020.4.5.2=hecda079_0
  - certifi=2020.4.5.2=py38h32f6830_0
  - cfchecker=4.0.0=py_0
  - cftime=1.1.3=py38h8790de6_0
  - cfunits=3.2.7=pyh9f0ad1d_0
  - curl=7.69.1=h33f0ec9_0
  - cycler=0.10.0=py_2
  - dbus=1.13.6=he372182_0
  - decorator=4.4.2=py_0
  - defusedxml=0.6.0=py_0
  - entrypoints=0.3=py38h32f6830_1001
  - expat=2.2.9=he1b5a44_2
  - fontconfig=2.13.1=h86ecdb6_1001
  - freetype=2.10.1=he06d7ca_0
  - future=0.18.2=py38h32f6830_1
  - gettext=0.19.8.1=hc5be6a0_1002
  - glib=2.64.2=h6f030ca_0
  - gst-plugins-base=1.14.5=h0935bb2_2
  - gstreamer=1.14.5=h36ae1b5_2
  - hdf4=4.2.13=hf30be14_1003
  - hdf5=1.10.6=nompi_h3c11f04_100
  - icu=64.2=he1b5a44_1
  - importlib-metadata=1.6.0=py38h32f6830_0
  - importlib_metadata=1.6.0=0
  - ipykernel=5.2.1=py38h23f93f0_0
  - ipython=7.13.0=py38h32f6830_2
  - ipython_genutils=0.2.0=py_1
  - ipywidgets=7.5.1=py_0
  - jedi=0.17.0=py38h32f6830_0
  - jinja2=2.11.2=pyh9f0ad1d_0
  - jpeg=9c=h14c3975_1001
  - jsonschema=3.2.0=py38h32f6830_1
  - jupyter=1.0.0=py_2
  - jupyter_client=6.1.3=py_0
  - jupyter_console=6.1.0=py_1
  - jupyter_core=4.6.3=py38h32f6830_1
  - kiwisolver=1.2.0=py38hbf85e49_0
  - krb5=1.17.1=h2fd8d38_0
  - ld_impl_linux-64=2.34=h53a641e_0
  - libblas=3.8.0=16_openblas
  - libcblas=3.8.0=16_openblas
  - libclang=9.0.1=default_hde54327_0
  - libcurl=7.69.1=hf7181ac_0
  - libedit=3.1.20191231=h46ee950_0
  - libffi=3.2.1=he1b5a44_1007
  - libgcc-ng=9.2.0=h24d8f2e_2
  - libgfortran-ng=7.3.0=hdf63c60_5
  - libiconv=1.15=h516909a_1006
  - liblapack=3.8.0=16_openblas
  - libllvm9=9.0.1=he513fc3_1
  - libnetcdf=4.7.4=nompi_h84807e1_104
  - libopenblas=0.3.9=h5ec1e0e_0
  - libpng=1.6.37=hed695b0_1
  - libsodium=1.0.17=h516909a_0
  - libssh2=1.9.0=hab1572f_2
  - libstdcxx-ng=9.2.0=hdf63c60_2
  - libuuid=2.32.1=h14c3975_1000
  - libxcb=1.13=h14c3975_1002
  - libxkbcommon=0.10.0=he1b5a44_0
  - libxml2=2.9.10=hee79883_0
  - llvm-openmp=10.0.0=hc9558a2_0
  - markupsafe=1.1.1=py38h1e0a361_1
  - matplotlib=3.2.1=0
  - matplotlib-base=3.2.1=py38h2af1d28_0
  - mistune=0.8.4=py38h1e0a361_1001
  - nbconvert=5.6.1=py38h32f6830_1
  - nbformat=5.0.6=py_0
  - ncurses=6.1=hf484d3e_1002
  - netcdf4=1.5.3=nompi_py38hfd55d45_105
  - notebook=6.0.3=py38_0
  - nspr=4.25=he1b5a44_0
  - nss=3.47=he751ad9_0
  - numpy=1.18.1=py38h8854b6b_1
  - openssl=1.1.1g=h516909a_0
  - pandas=1.0.3=py38hcb8c335_1
  - pandoc=2.9.2.1=0
  - pandocfilters=1.4.2=py_1
  - parso=0.7.0=pyh9f0ad1d_0
  - patsy=0.5.1=py_0
  - pcre=8.44=he1b5a44_0
  - pexpect=4.8.0=py38h32f6830_1
  - pickleshare=0.7.5=py38h32f6830_1001
  - pip=20.1=pyh9f0ad1d_0
  - prometheus_client=0.7.1=py_0
  - prompt-toolkit=3.0.5=py_0
  - prompt_toolkit=3.0.5=0
  - pthread-stubs=0.4=h14c3975_1001
  - ptyprocess=0.6.0=py_1001
  - pygments=2.6.1=py_0
  - pyparsing=2.4.7=pyh9f0ad1d_0
  - pyqt=5.12.3=py38hcca6a23_1
  - pyrsistent=0.16.0=py38h1e0a361_0
  - python=3.8.2=he5300dc_7_cpython
  - python-dateutil=2.8.1=py_0
  - python_abi=3.8=1_cp38
  - pytz=2020.1=pyh9f0ad1d_0
  - pyzmq=19.0.0=py38ha71036d_1
  - qt=5.12.5=hd8c4c69_1
  - qtconsole=4.7.3=pyh9f0ad1d_0
  - qtpy=1.9.0=py_0
  - readline=8.0=hf8c457e_0
  - scipy=1.4.1=py38h18bccfc_3
  - send2trash=1.5.0=py_0
  - setuptools=46.1.3=py38h32f6830_0
  - six=1.14.0=py_1
  - sqlite=3.30.1=hcee41ef_0
  - statsmodels=0.11.1=py38h1e0a361_1
  - tabulate=0.8.7=pyh9f0ad1d_0
  - terminado=0.8.3=py38h32f6830_1
  - testpath=0.4.4=py_0
  - tk=8.6.10=hed695b0_0
  - tornado=6.0.4=py38h1e0a361_1
  - traitlets=4.3.3=py38h32f6830_1
  - udunits2=2.2.27.6=h4e0c4b3_1001
  - uncertainties=3.1.2=py38_0
  - wcwidth=0.1.9=pyh9f0ad1d_0
  - webencodings=0.5.1=py_1
  - wheel=0.34.2=py_1
  - widgetsnbextension=3.5.1=py38_0
  - xarray=0.15.1=py_0
  - xorg-libxau=1.0.9=h14c3975_0
  - xorg-libxdmcp=1.1.3=h516909a_0
  - xz=5.2.5=h516909a_0
  - zeromq=4.3.2=he1b5a44_2
  - zipp=3.1.0=py_0
  - zlib=1.2.11=h516909a_1006
  - pip:
    - chardet==3.0.4
    - idna==2.10
    - pydataverse==0.2.1
    - pyqt5-sip==4.19.18
    - pyqtwebengine==5.12.1
    - requests==2.24.0
    - urllib3==1.25.10
prefix: /home/kdm/local/miniconda3/envs/ice_discharge

#+end_example

* LaTeX Setup                                           :noexport:
#+NAME: copernicus-latex-setup
#+BEGIN_SRC elisp :results none :eval no-export
(add-to-list 'org-latex-classes
               `("copernicus"
                 "\\documentclass{copernicus}
               [NO-DEFAULT-PACKAGES]
               [NO-PACKAGES]
               [NO-EXTRA]"
                 ("\\section{%s}" . "\\section*{%s}")
                 ("\\subsection{%s}" . "\\subsection*{%s}")
                 ("\\subsubsection{%s}" . "\\subsubsection*{%s}")
                 ("\\paragraph{%s}" . "\\paragraph*{%s}")
                 ("\\subparagraph{%s}" . "\\subparagraph*{%s}"))
               )

;; (org-add-link-type
;;  "citet"  (lambda (key) (org-open-file cby-references-file t nil key))
;;  (lambda (path desc format)
;;    (cond
;;     ((eq format 'latex) (format "\\citet{%s}" path))
;;     ((eq format 'ascii) (format "%s" desc))
;;     )))
;; (org-add-link-type
;;  "citep"  (lambda (key) (org-open-file cby-references-file t nil key))
;;  (lambda (path desc format)
;;    (cond
;;     ((eq format 'latex) (format "\\citep{%s}" path))
;;     ((eq format 'ascii) (format "%s" desc))
;;     )))

(setq-local org-latex-title-command "")
#+END_SRC

